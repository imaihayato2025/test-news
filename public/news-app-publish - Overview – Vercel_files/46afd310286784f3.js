
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f44d214d-0081-5377-bc8a-2f62cd8601f6")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{3799021:e=>{"use strict";e.s({default:()=>s});var t=e.i(6645307),n=e.i(6530772),i=e.i(7415104),r=e.i(631755),l=e.i(8934201),a=e.i(8811733),o=e.i(3153829);let s=(0,n.memo)(e=>{let{active:s,url:d,onCancel:c}=e,[u,m]=(0,n.useState)(""),h=(0,n.useMemo)(()=>!u||u.includes(".")||!(0,i.isValid)(`${u}.${d}`),[u,d]),p=(0,n.useCallback)(()=>{m(""),c()},[c]),f=(0,n.useCallback)(e=>{e.preventDefault(),window.open((0,o.domainToUrl)(`${u}.${d}`),"_blank","noopener"),p()},[u,d,p]);return d?(0,t.jsx)(l.Modal,{active:s,onClickOutside:p,children:(0,t.jsxs)("form",{onSubmit:f,children:[(0,t.jsxs)(l.Modal.Body,{children:[(0,t.jsx)(l.Modal.Title,{children:"Wildcard Domain"}),(0,t.jsx)(a.Spacer,{}),(0,t.jsx)(l.Modal.Subtitle,{children:"Enter a subdomain to visit below."}),(0,t.jsx)(a.Spacer,{y:.75}),(0,t.jsx)(r.Input,{autoFocus:!0,id:"hostname",label:"Hostname",onChange:e=>m(e.target.value),suffix:`.${d}`,value:u})]}),(0,t.jsxs)(l.Modal.Actions,{children:[(0,t.jsx)(l.Modal.Action,{onClick:c,children:"Cancel"}),(0,t.jsx)(l.Modal.Action,{buttonType:"submit",disabled:h,children:"Visit"})]})]})}):null})},3805480:e=>{"use strict";e.s({default:()=>n});var t=e.i(1922196);function n(e){return(0,t.default)(e)?e.slice(2):e}},4760712:e=>{"use strict";e.s({default:()=>c});var t=e.i(6645307),n=e.i(6530772),i=e.i(2362802),r=e.i(3799021),l=e.i(7039668),a=e.i(3805480),o=e.i(1922196),s=e.i(3153829),d=e.i(3076719);let c=(0,n.memo)(function(e){let{url:c,truncate:u,defaultRoute:m,...h}=e,[p,f]=(0,l.default)("#wildcard"),[g,x]=(0,n.useState)(null),[y,j]=(0,n.useState)(!1),v=(0,n.useCallback)(()=>{x((0,a.default)(c)),f(!0)},[x,f,c]);return c?(0,o.default)(c)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",onClick:v,...h,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}),y||p?(0,t.jsx)(r.default,{active:p,onCancel:()=>{f(!1)},url:g}):null]}):(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,d.withDefaultRoute)((0,s.domainToUrl)(c),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}):null})},1424159:e=>{"use strict";e.s({decode:()=>h,default:()=>x,encode:()=>p,toASCII:()=>g,toUnicode:()=>f,ucs2decode:()=>d,ucs2encode:()=>c});let t=/^xn--/,n=/[^\0-\x7F]/,i=/[\x2E\u3002\uFF0E\uFF61]/g,r={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},l=Math.floor,a=String.fromCharCode;function o(e){throw RangeError(r[e])}function s(e,t){let n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+(function(e,t){let n=[],i=e.length;for(;i--;)n[i]=t(e[i]);return n})((e=e.replace(i,".")).split("."),t).join(".")}function d(e){let t=[],n=0,i=e.length;for(;n<i;){let r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){let i=e.charCodeAt(n++);(64512&i)==56320?t.push(((1023&r)<<10)+(1023&i)+65536):(t.push(r),n--)}else t.push(r)}return t}let c=e=>String.fromCodePoint(...e),u=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},m=function(e,t,n){let i=0;for(e=n?l(e/700):e>>1,e+=l(e/t);e>455;i+=36)e=l(e/35);return l(i+36*e/(e+38))},h=function(e){let t=[],n=e.length,i=0,r=128,a=72,s=e.lastIndexOf("-");s<0&&(s=0);for(let n=0;n<s;++n)e.charCodeAt(n)>=128&&o("not-basic"),t.push(e.charCodeAt(n));for(let c=s>0?s+1:0;c<n;){let s=i;for(let t=1,r=36;;r+=36){var d;c>=n&&o("invalid-input");let s=(d=e.charCodeAt(c++))>=48&&d<58?26+(d-48):d>=65&&d<91?d-65:d>=97&&d<123?d-97:36;s>=36&&o("invalid-input"),s>l((0x7fffffff-i)/t)&&o("overflow"),i+=s*t;let u=r<=a?1:r>=a+26?26:r-a;if(s<u)break;let m=36-u;t>l(0x7fffffff/m)&&o("overflow"),t*=m}let u=t.length+1;a=m(i-s,u,0==s),l(i/u)>0x7fffffff-r&&o("overflow"),r+=l(i/u),i%=u,t.splice(i++,0,r)}return String.fromCodePoint(...t)},p=function(e){let t=[],n=(e=d(e)).length,i=128,r=0,s=72;for(let n of e)n<128&&t.push(a(n));let c=t.length,h=c;for(c&&t.push("-");h<n;){let n=0x7fffffff;for(let t of e)t>=i&&t<n&&(n=t);let d=h+1;for(let p of(n-i>l((0x7fffffff-r)/d)&&o("overflow"),r+=(n-i)*d,i=n,e))if(p<i&&++r>0x7fffffff&&o("overflow"),p===i){let e=r;for(let n=36;;n+=36){let i=n<=s?1:n>=s+26?26:n-s;if(e<i)break;let r=e-i,o=36-i;t.push(a(u(i+r%o,0))),e=l(r/o)}t.push(a(u(e,0))),s=m(r,d,h===c),r=0,++h}++r,++i}return t.join("")},f=function(e){return s(e,function(e){return t.test(e)?h(e.slice(4).toLowerCase()):e})},g=function(e){return s(e,function(e){return n.test(e)?"xn--"+p(e):e})},x={version:"2.3.1",ucs2:{decode:d,encode:c},decode:h,encode:p,toASCII:g,toUnicode:f}},7415104:e=>{"use strict";var{m:t,e:n}=e,i=e.r(1424159),r={};r.rules=e.r(7012812).map(function(e){return{rule:e,suffix:e.replace(/^(\*\.|\!)/,""),punySuffix:-1,wildcard:"*"===e.charAt(0),exception:"!"===e.charAt(0)}}),r.endsWith=function(e,t){return -1!==e.indexOf(t,e.length-t.length)},r.findRule=function(e){var t=i.toASCII(e);return r.rules.reduce(function(e,n){return(-1===n.punySuffix&&(n.punySuffix=i.toASCII(n.suffix)),r.endsWith(t,"."+n.punySuffix)||t===n.punySuffix)?n:e},null)},n.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at most 63 chars long.",LABEL_TOO_SHORT:"Domain name label should be at least 1 character long.",LABEL_INVALID_CHARS:"Domain name label can only contain alphanumeric characters or dashes."},r.validate=function(e){var t,n=i.toASCII(e);if(n.length<1)return"DOMAIN_TOO_SHORT";if(n.length>255)return"DOMAIN_TOO_LONG";for(var r=n.split("."),l=0;l<r.length;++l){if(!(t=r[l]).length)return"LABEL_TOO_SHORT";if(t.length>63)return"LABEL_TOO_LONG";if("-"===t.charAt(0))return"LABEL_STARTS_WITH_DASH";if("-"===t.charAt(t.length-1))return"LABEL_ENDS_WITH_DASH";if(!/^[a-z0-9\-]+$/.test(t))return"LABEL_INVALID_CHARS"}},n.parse=function(e){if("string"!=typeof e)throw TypeError("Domain name must be a string.");var t=e.slice(0).toLowerCase();"."===t.charAt(t.length-1)&&(t=t.slice(0,t.length-1));var l=r.validate(t);if(l)return{input:e,error:{message:n.errorCodes[l],code:l}};var a={input:e,tld:null,sld:null,domain:null,subdomain:null,listed:!1},o=t.split(".");if("local"===o[o.length-1])return a;var s=function(){return/xn--/.test(t)&&(a.domain&&(a.domain=i.toASCII(a.domain)),a.subdomain&&(a.subdomain=i.toASCII(a.subdomain))),a},d=r.findRule(t);if(!d)return o.length<2?a:(a.tld=o.pop(),a.sld=o.pop(),a.domain=[a.sld,a.tld].join("."),o.length&&(a.subdomain=o.pop()),s());a.listed=!0;var c=d.suffix.split("."),u=o.slice(0,o.length-c.length);return d.exception&&u.push(c.shift()),a.tld=c.join("."),u.length&&(d.wildcard&&(c.unshift(u.pop()),a.tld=c.join(".")),u.length&&(a.sld=u.pop(),a.domain=[a.sld,a.tld].join("."),u.length&&(a.subdomain=u.join(".")))),s()},n.get=function(e){return e&&n.parse(e).domain||null},n.isValid=function(e){var t=n.parse(e);return!!(t.domain&&t.listed)}},8673823:e=>{"use strict";e.s({useAliases:()=>c,useAliasesInfinite:()=>u,useAliasesV2:()=>d},8673823);var t=e.i(6530772),n=e.i(3521787),i=e.i(7095283),r=e.i(3345839),l=e.i(6649026),a=e.i(1183506),o=e.i(9336536),s=e.i(3514588);function d(e,t){let{deploymentId:n,teamId:i}=e;return(0,r.useIsomorphicSWR)(n?function(e){let{deploymentId:t,teamId:n}=e;return`${(0,o.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,l.encode)({teamId:n})}`}({deploymentId:n,teamId:i}):null,t)}function c(e,t){return(0,n.default)(()=>{if(!e)return null;let{team:t,id:n,teamId:i}=e;return`${(0,o.API_DEPLOYMENTS)("v2")}/${n}/aliases${(0,l.encode)({teamId:i??(t?t.id:null)})}`},e=>(0,a.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,n){let{limit:r=20,domains:l,rollbackDeploymentId:d}=e,{isReady:c,team:u}=(0,s.useTeam)(),h=(0,i.default)((e,t)=>{if(!c)return null;let n=`${o.API_ALIASES}`,i=l?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${n}${m({limit:r+1,teamId:u?.id,rollbackDeploymentId:d},i)}`;let a=t?.aliases&&t.aliases.length>r?t.aliases[r-1].createdAt:null;return a?`${n}${m({limit:r+1,teamId:u?.id,until:a},i)}`:null},e=>(0,a.fetchAPI)(e,{throwOnHTTPError:!0}),n),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,r))):[],[h.data,r]),f=!!h.data&&!h.error,g=!!(h.data&&0===p.length),x=!!(h.data&&h.size>h.data.length),y=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=r);return[h,{aliases:p,initialDataLoaded:f,isEmpty:g,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:x,isReachingEnd:y}]}function m(e,t){let n=(0,l.encode)(e,!1),i=t?`&${t}`:"";return n?`?${n}${i}`:`?${i}`}},7039668:e=>{"use strict";e.s({default:()=>n});var t=e.i(6530772);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[n,i]=(0,t.useState)(!1),r=window.location.hash,l=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==l||n||i(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[n,l]),r!==l||n||(i(!0),window.history.replaceState(null,""," ")),r!==l&&n&&(window.location.hash=l),[n,i]}},8328767:e=>{"use strict";e.s({useRollingRelease:()=>r,useSuspenseRollingRelease:()=>i});var t=e.i(3521787),n=e.i(1654051);function i(e){let{teamIdOrSlug:t,projectSlug:n}=e;return r({teamIdOrSlug:t,projectSlug:n},{suspense:!0,revalidateOnMount:!1})}function r(e,i){let{teamIdOrSlug:r,projectSlug:l}=e,a=!r||!l,o=(0,t.default)(()=>a?null:(0,n.getRollingReleaseEndpoint)(r,l),n.rollingReleaseFetcher,i);return{...o,skipped:a,isLoading:!a&&o.isLoading}}},8271524:e=>{"use strict";e.s({useIsActive:()=>n});var t=e.i(6530772);function n(){let{timeout:e=3e4,debounce:n=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[i,r]=(0,t.useState)(!0),l=(0,t.useRef)(void 0);return(0,t.useEffect)(()=>{var t;let i,a=()=>r(!1),[o,s]=(t=()=>{r(!0),clearTimeout(l.current),l.current=setTimeout(a,e)},[function(){for(var e=arguments.length,r=Array(e),l=0;l<e;l++)r[l]=arguments[l];i&&clearTimeout(i),i=setTimeout(()=>t(...r),n)},()=>{i&&clearTimeout(i)}]),d=new AbortController,{signal:c}=d;return l.current=setTimeout(a,e),window.addEventListener("focusin",o,{signal:c}),window.addEventListener("mousemove",o,{signal:c,passive:!0}),window.addEventListener("touchstart",o,{signal:c,passive:!0}),window.addEventListener("keydown",o,{signal:c}),()=>{d.abort(),s(),clearTimeout(l.current)}},[e,n]),i}},4896100:e=>{"use strict";e.s({DEPLOYMENTS_PROJECT_API_PARAMS:()=>n,useDeploymentsPageRefreshInterval:()=>i});var t=e.i(8271524);let n={apiVersion:"v10",latestDeployments:10,activeBranches:!0,fetchParams:{rollbackInfo:!0}};function i(){return(0,t.useIsActive)()?8e3:3e4}},7696797:e=>{"use strict";e.s({Attribute:()=>l});var t=e.i(6645307),n=e.i(1235226),i=e.i(5163670),r=e.i(5610210);function l(e){let{title:n,children:i,className:a,...o}=e;return(0,t.jsxs)("div",{className:(0,r.clsx)("flex flex-col gap-1",a),...o,children:[n?(0,t.jsx)(l.Title,{children:n}):null,i]})}l.Title=function(e){let{children:n}=e;return(0,t.jsx)("span",{className:"text-label-14 text-gray-900",children:n})},l.Item=function(e){let{children:i,Icon:r,mono:l=!1,className:a,...o}=e;return(0,t.jsxs)("div",{className:(0,n.twMerge)("flex h-5 items-center gap-2 whitespace-nowrap [&>*]:text-ellipsis",l?"text-label-13-mono":"text-label-14",a),...o,children:[r?(0,t.jsx)(r,{className:"flex-none",color:"gray-900"}):null,i]})},l.ItemSkeleton=function(e){let{width:n=128}=e;return(0,t.jsx)(l.Item,{children:(0,t.jsx)(i.Skeleton,{height:16,width:n})})}},6858714:[e=>{"use strict";e.s({ChooseDeploymentList:()=>L,REASON_MAX_CHARACTER_LENGTH:()=>E,RollbackDescriptionCard:()=>R,RollbackDescriptionTextarea:()=>O,defaultDeploymentExpiration:()=>A,generateDeploymentRetentionRequestBody:()=>k,getDaysFromOption:()=>S,getDeploymentId:()=>P,getMostRecentlyPromotedDeployment:()=>N,isDeleted:()=>C,retentionOptions:()=>w,useIsUndoRollback:()=>I},6858714);var t=e.i(6645307),n=e.i(8084653),i=e.i(5674541),r=e.i(7918027),l=e.i(1766200);e.s({DeploymentCardSmall:()=>v},1000863);var a=e.i(3921802),o=e.i(889716),s=e.i(2362802),d=e.i(869010),c=e.i(3920197),u=e.i(3138389),m=e.i(9385465),h=e.i(2774739),p=e.i(5610210),f=e.i(587741),g=e.i(5196742),x=e.i(1628584),y=e.i(6700141);function j(e){let{isForm:n,children:i,className:r}=e;return n?(0,t.jsx)("label",{className:r,children:i}):(0,t.jsx)("div",{className:r,children:i})}function v(e){let{deployment:i,isForm:r,isPromote:l,isPreviousDeployment:v,isProductionDeployment:b,isRolledBackDeployment:T,selectedDeployment:A,setSelectedDeployment:w,ariaLabel:S="Rollback Deployment"}=e,D=(0,h.useAgo)(i.createdAt||0),k="number"==typeof i.aliasAssigned?i.aliasAssigned:0,I=k>0,P=(0,h.useAgo)(k),C=(0,f.useDeploymentLink)(i),R=(0,g.getGitInfoFromDeployment)(i),{value:L}=(0,y.useEnableNewInstantRollbackFlow)();L||(T=!1);let N=b||v||T;v&&T&&(v=!1);let E="Preview";if("target"in i)switch(i.target){case"staging":E="Staging";break;case"production":E="Production";break;default:E="Preview"}else E="Production";let O="uid"in i?i.uid:i.id,_=null;l?R?.commitRef&&(_=(0,t.jsxs)(o.Stack,{align:"center",direction:"row",gap:.5,children:[(0,t.jsx)(u.GitBranch,{color:"gray-900"}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",monospace:!0,style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:R.commitRef,truncate:!0,wrap:!1,children:R.commitRef}),(0,t.jsxs)(n.Text,{as:"span",className:"flex items-center gap-1",color:"gray-900",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},truncate:!0,wrap:!1,children:["Staged"," ",D," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(x.CreatorAvatar,{deployment:i,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{className:"font-medium",children:!i.meta?.originalDeploymentId&&i.creator?.username?`@${i.creator.username}`:R.commitAuthorLogin})]})]})):_=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,style:{marginRight:"4px"},children:E}),R?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)(n.Text,{as:"span",className:"max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",monospace:!0,title:R.commitRef,children:R.commitRef}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(x.CreatorAvatar,{deployment:i,size:20}),(0,t.jsx)(n.Text,{as:"span",className:"max-w-[140px] truncate",color:"gray-900",truncate:!0,weight:500,children:!i.meta?.originalDeploymentId&&i.creator?.username?`@${i.creator.username}`:R.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(n.Text,{as:"span",color:"gray-900",size:14,children:["Deployed"," "]}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,children:D}),(0,t.jsxs)(n.Text,{as:"span",color:"gray-900",size:14,children:[","," "]}),I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Text,{as:"span",color:"gray-900",size:14,children:["promoted"," "]}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,children:P})]}):(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,children:"never promoted"})]})]});let M=null;return r||(M=l?(0,t.jsx)(d.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):b?(0,t.jsx)(c.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(m.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(j,{className:(0,p.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":b,"bg-[var(--geist-background)]":!b}),isForm:r,children:[r?(0,t.jsx)("input",{"aria-label":S,checked:A?.uid===O,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in i&&"type"in i&&w&&w(i)},type:"radio",value:O}):M,(0,t.jsxs)("div",{style:{width:N?"initial":"100%",minWidth:0},children:[(0,t.jsx)(s.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:C,target:"_blank",children:(0,t.jsx)(n.Text,{as:"span",title:i.url,truncate:1,weight:500,children:i.url})}),R?.commitMessage?(0,t.jsxs)(n.Text,{as:"p",className:"break-words",color:"gray-900",size:14,title:R.commitMessage,truncate:1,children:[R.commitSha.substring(0,7)," ",R.commitMessage]}):null,_]}),b?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,v?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,T?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}var b=e.i(5300522),T=e.i(5378884);function A(){return{expirationDays:36500,expirationDaysProduction:36500,expirationDaysCanceled:30,expirationDaysErrored:36500}}let w=[{days:36500,label:"Unlimited",value:"unlimited"},{days:365,label:"1 year",value:"1y"},{days:180,label:"180 days",value:"6m"},{days:90,label:"90 days",value:"3m"},{days:60,label:"60 days",value:"2m"},{days:30,label:"30 days",value:"1m"},{days:7,label:"1 week",value:"1w"},{days:1,label:"1 day",value:"1d"}];function S(e){for(let{days:t}of w)if(t===e)return t;return null}function D(e){if("number"!=typeof e)return null;for(let{days:t,value:n}of w)if(t===e)return n;return null}function k(e){let t={},n=D(e.expirationDays);n&&(t.expiration=n);let i=D(e.expirationDaysCanceled);i&&(t.expirationCanceled=i);let r=D(e.expirationDaysErrored);r&&(t.expirationErrored=r);let l=D(e.expirationDaysProduction);return l&&(t.expirationProduction=l),t}let I=e=>{let{projectId:t,deployment:n}=e,{data:i}=(0,l.default)({projectId:t,target:"production",limit:1}),r=i?.deployments[0];return void 0!==n&&r?.uid===P(n)};function P(e){return"id"in e?e.id:"uid"in e?e.uid:void 0}function C(e){return void 0!==e.deleted}function R(e){let{rollbackDescription:i,project:r}=e,l=(0,h.useAgo)(i.createdAt);return(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsx)(n.Text,{className:"break-words",color:"gray-900",children:i.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(b.LinkParser,{text:i.description}),"”"]}):(0,t.jsx)(n.Text,{children:"No rollback explanation provided"})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)(n.Text,{children:"Rolled back by"}),i.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.PrincipalAvatar,{size:20,principalId:i.userId,principal:{type:"user",uid:i.userId,username:i.username}}),(0,t.jsxs)(n.Text,{weight:500,children:["@",i.username]}),r?.lastAliasRequest!==void 0&&(0,t.jsx)(n.Text,{children:l})]}):null]})]})}function L(e){let{deployments:n,previousDeployment:r,rolledBackDeploymentId:l,productionDeployment:a,selectedDeployment:o,setSelectedDeployment:s,swr:d,ariaLabel:c}=e;return(0,t.jsxs)(t.Fragment,{children:[n.map(e=>a.id!==e.uid&&(0,t.jsx)(v,{deployment:e,isForm:!0,isPreviousDeployment:r?.uid===e.uid,isRolledBackDeployment:l===e.uid,selectedDeployment:o,setSelectedDeployment:s,ariaLabel:c},e.uid)),!d.isReachingEnd&&(0,t.jsx)(i.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})}function N(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t}let E=250;function O(e){let{value:n,onChange:i,id:l}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(r.Textarea,{autoFocus:!0,className:"min-h-24 text-base",error:n.length>=E?`Reason cannot be longer than ${E} characters.`:void 0,id:l,onChange:e=>i(e.target.value),placeholder:"Production is not behaving as expected...",required:!0,value:n})})}},[1000863]],1562781:[e=>{"use strict";e.s({default:()=>G,usePromoteDeployment:()=>V,usePromoteTooltip:()=>H},1562781);var t=e.i(6645307),n=e.i(6530772),i=e.i(7315479),r=e.i(5535439),l=e.i(2362802),a=e.i(8247297),o=e.i(1917237),s=e.i(1268665),d=e.i(8934201),c=e.i(8158100),u=e.i(5163670),m=e.i(8811733),h=e.i(889716),p=e.i(8084653),f=e.i(584439),g=e.i(5528554),x=e.i(8554037),y=e.i(1164214),j=e.i(6649026),v=e.i(1183506),b=e.i(9336536),T=e.i(1316720),A=e.i(5454140),w=e.i(3514588),S=e.i(7320579),D=e.i(6700141),k=e.i(878537),I=e.i(3184563),P=e.i(587741),C=e.i(9505396);function R(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:n=null,aliasAssignedAt:i,buildingAt:r,created:l=e.createdAt,createdAt:a,creator:o,name:s,ready:d,state:c="BUILDING",readyState:u,readySubstate:m,target:h=null,uid:p=e.id,url:f,isRollbackCandidate:g="production"===e.target}=e;return{aliasAssigned:t,aliasError:n,aliasAssignedAt:i,buildingAt:r,created:l,createdAt:a,creator:{email:"",githubLogin:"",...o},name:s,ready:d,state:c,readyState:u,readySubstate:m,target:h,type:"LAMBDAS",uid:p,url:f,isRollbackCandidate:g}}e.s({asListDeployment:()=>R},594689);var L=e.i(9533270),N=e.i(6858714),E=e.i(44994),O=e.i(5300522),_=e.i(4896100),M=e.i(2782408),B=e.i(1000863),$=e.i(8371532),F=e.i(8328767),W=e.i(2240289);function H(e){let t=e?.name,{deployment:i,isLoading:r}=(0,I.useProjectProductionDeployment)(t);return(0,n.useMemo)(()=>{let t=R(e);return t?r?"Loading...":t.uid===i?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"":""},[e,r,i?.id])}function z(e){let{title:n}=e;return(0,t.jsx)(d.Modal.Header,{children:(0,t.jsx)(d.Modal.Title,{center:!0,children:n})})}function U(e){let{deploymentId:n}=e,i=(0,x.useCiChecksAndPoliciesFlag)(),{data:r,isLoading:a}=(0,T.useProjectCheckRuns)({deploymentId:n,enableCiChecksAndPolicies:i});if(!i)return null;if(a)return(0,t.jsx)(u.Skeleton,{});if(r?.runs.every(e=>"succeeded"===e.conclusion))return null;let o=r?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(c.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",o.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:o.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(l.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}function G(e,i){let{onDeploymentPromoted:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[u,f]=(0,n.useState)(!1),[x,j]=(0,n.useState)(null),{team:v}=(0,w.useTeam)(),b=e??x?.name,{data:T}=(0,W.useProject)(b,O.INSTANT_ROLLBACK_PROJECT_API_PARAMS),S=i??T,P=(0,L.useShowIgnoreBuildStep)({project:S,deployment:x}),[R,E]=(0,n.useState)($.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),{value:_}=(0,D.useEnableNewInstantRollbackFlow)(),M=(0,n.useCallback)(()=>{f(!1)},[]),{error:H,loading:G,promote:Y,setError:K,setLoading:q}=V({deployment:x,useIgnoreBuildStep:R,project:S,onCurrentDeploymentPromoted:(0,n.useCallback)(()=>{M(),r?.()},[M,r])}),{user:J}=(0,A.useUser)(),{data:X}=(0,F.useRollingRelease)({teamIdOrSlug:v?.slug,projectSlug:b}),Q=S?.rollingRelease?.stages!==void 0&&S.rollingRelease.stages.length>0,Z=X?.rollingRelease?.state==="ACTIVE",ee=X?.rollingRelease?.canaryDeployment?.id,et=Z&&ee===x?.uid,en=Q&&!Z&&x?.target==="production",ei=Q&&Z&&x?.target==="production",er=en&&S.rollingRelease?.stages!==void 0?S.rollingRelease.stages[0]?.targetPercentage:null,{data:el}=(0,C.useProjectDomains)(b,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),ea=(0,n.useCallback)(e=>{j(e),f(!0)},[]),eo=(0,n.useCallback)(()=>{q(!1),j(null),K(void 0)},[K,q]),{deployment:es,isLoading:ed,rollbackDescription:ec,deploymentIsStale:eu}=(0,I.useProjectProductionDeployment)(S?.name),{andMoreDomains:em,remainingDomains:eh}=(0,n.useMemo)(()=>{if(!el)return{andMoreDomains:!1,remainingDomains:[]};let e=el.length>2,t=e?el.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[el]),ep=(0,n.useMemo)(()=>{if(!S||!x)return(0,t.jsx)(k.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(s.LoadingDots,{size:4})});let e=!!(el&&el.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===x.target?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:x,isPromote:!0,selectedDeployment:null})}),en?(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",er,"%."]}):null,ei?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,en||ei||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},weight:400,children:"It will be aliased to the following domains:"}),(0,t.jsx)(h.Stack,{gap:2,style:{paddingLeft:12},children:el?.slice(0,2).map(e=>{let{name:n}=e;return(0,t.jsx)(p.Text,{as:"p",children:(0,t.jsxs)(h.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(g.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:n.startsWith("*")?n:(0,t.jsx)(l.Link,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${n}`,variant:"highlight",children:n})})]})},n)})}),em?(0,t.jsxs)(p.Text,{as:"p",className:"mt-6 mb-4",children:["...and ",eh.length," more"]}):null]}),!en&&!e&&(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(l.Link,{href:`/${v?v.slug:J?.username}/${encodeURIComponent(S.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),S.link&&x.gitSource?(0,t.jsx)(U,{deploymentId:x.id}):null,P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(a.Checkbox,{checked:R,fullWidth:!0,onChange:()=>{E(!R)},children:"Use project's Ignore Build Step"})]}):null,et?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:"This will complete the rolling release for this deployment."})})})}):null,eu?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:en?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,_&&ec?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(N.RollbackDescriptionCard,{rollbackDescription:ec,project:S})]}):null]})},[em,eh,el,S,v,J,x,R,P,eu,ec,_,er,en,ei,et]),ef=(0,n.useMemo)(()=>(0,t.jsx)(d.Modal.Action,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:G,onClick:Y,children:x&&"target"in x&&"production"===x.target?"Promote":"Promote to Production"}),[Y,G,x]);return{modal:(0,n.useMemo)(()=>(0,t.jsxs)(d.Modal.Modal,{active:u,"data-testid":(0,y.tid)("deployments","promote-to-production-overlay"),onAnimationDone:eo,onClickOutside:M,sticky:!0,width:"500px",children:[(0,t.jsxs)(d.Modal.Body,{children:[(0,t.jsx)(z,{title:ei?"Queue for Promotion":x&&"target"in x&&"production"!==x.target?"Promote to Production":"Promote"}),ep,H?(0,t.jsx)(o.Error,{error:H}):null]}),(0,t.jsxs)(d.Modal.Actions,{children:[(0,t.jsx)(d.Modal.Action,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:M,type:"secondary",children:"Cancel"}),ef]})]}),[u,eo,M,ep,H,ef,ei,x]),close:M,open:ea}}let V=e=>{let{deployment:t,project:l,useIgnoreBuildStep:a,onCurrentDeploymentPromoted:o}=e,s=(0,f.useToasts)(),d=(0,r.useRouter)(),{team:c}=(0,w.useTeam)(),{user:u}=(0,A.useUser)(),{mutate:m}=(0,S.useSWRConfig)(),[h,p]=(0,n.useState)(!1),[g,x]=(0,n.useState)(void 0),y=(0,L.useShowIgnoreBuildStep)({project:l,deployment:t});return{promote:(0,n.useCallback)(async()=>{if(t&&l){p(!0),x(void 0);try{let e,n=c?.id,i="Promoted Deployment successfully.";if("production"===t.target)await (0,v.fetchAPI)(`${(0,b.API_DEPLOYMENT_PROMOTE)(l.id,t.uid||t.id)}${(0,j.encode)({teamId:n})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,P.pathFromDeployment)(t,{user:u,team:c});else{let r=await (0,v.fetchAPI)(`${(0,b.API_DEPLOYMENTS)("v13")}${(0,j.encode)({teamId:n,skipIgnoreBuildStep:y&&!a?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:l.name,target:"production"}),throwOnHTTPError:!0});e=(0,P.pathFromDeployment)(r,{user:u,team:c});let o=t.uid||t.id;i="production"===t.target?o===r.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}c&&(m((0,E.getProjectKey)(l.name,{...O.INSTANT_ROLLBACK_PROJECT_API_PARAMS,teamId:c.slug})),m((0,E.getProjectKey)(l.name,{..._.DEPLOYMENTS_PROJECT_API_PARAMS,teamId:c.slug})),await m((0,M.getProjectProductionDeploymentKey)({projectIdOrName:l.id,teamId:c.slug}))),s.success({text:i,key:"production-deployment"}),e&&(e===location.pathname?o?.():d.push(e))}catch(e){x((0,i.normalizeError)(e))}finally{p(!1)}}},[t,l,d,y,c,s,a,u,m,o]),loading:h,setLoading:p,error:g,setError:x}}},[594689]]}]);

//# sourceMappingURL=e8e0e489a1fd9d18.js.map
//# debugId=f44d214d-0081-5377-bc8a-2f62cd8601f6
