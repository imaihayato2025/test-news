
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="aff3c3b5-a5d7-57ab-bfd2-4e90e456c22e")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{5012192:[e=>{"use strict";e.s({QueryBuilderDrawer:()=>e2},5012192);var t=e.i(6645307),r=e.i(7525208),i=e.i(7384398);e.s({useDefaultWidgetTitle:()=>p},819765);var a=e.i(8279544),l=e.i(5534034),s=e.i(1285094),n=e.i(6753602),o=e.i(3514588),d=e.i(3585235),u=e.i(226017);let c=()=>{let{can:e}=(0,d.default)(),{team:t}=(0,o.useTeam)(),r=(0,u.useServerFlag)("bot-id-ui",!1);return t?{isReady:!0,accessibleMetrics:l.queryBuilderEvents.filter(i=>("botIdCheck"!==i||!!r)&&(0,s.canAccessEvent)({event:i,team:t,can:e})).flatMap(e=>(0,s.getAggregableMeasures)(e).map(t=>({id:`${e}.${t}`,group:"label"in n.AllEvents[e]?n.AllEvents[e].label:e,label:(0,a.labelForMeasure)(e,t),type:"string"})))}:{isReady:!1,accessibleMetrics:[]}};function p(e){let{accessibleMetrics:t}=c();return t.find(t=>{let{id:r}=t;return r===e?.metric})?.label??""}e.s({useNotebookOperations:()=>O},4740724);var m=e.i(6005342),g=e.i(9336536),y=e.i(4418725),b=e.i(3409191),x=e.i(7573892),h=e.i(9802771),f=e.i(6530772),v=e.i(7320579),j=e.i(4374461),w=e.i(534184),N=e.i(8757700);function O(e){let{mutate:t}=(0,v.useSWRConfig)(),r=(0,y.useTeamSlug)()??"",{team:i}=(0,o.useTeam)(),a=i?.id,l=i?.billing?.plan??"hobby",s=(0,w.buildSWRKey)(g.API_NOTEBOOK,{id:e?.id,teamSlug:r}),n=(0,w.buildSWRKey)(g.API_NOTEBOOKS,{teamSlug:r}),{trigger:d,isMutating:u}=(0,j.default)(s,async(t,i)=>{let{arg:a}=i,l=a.id??e?.id;if(!l)throw Error("Notebook ID is required to save a notebook");return(0,m.parseNotebook)(await (0,b.typedFetchData)(g.API_NOTEBOOK,"put",{id:l,slug:r},{title:a.title,variables:(0,m.serializeVariables)(a.variables)},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:c,isMutating:p}=(0,j.default)(s,async(t,i)=>{let{arg:a}=i,l=a?.id??e?.id;if(!l)throw Error("Notebook ID is required to delete a notebook");return(0,b.typedFetchData)(g.API_NOTEBOOK,"delete",{id:l,slug:r},{throwOnHTTPError:!0})},{revalidate:!1}),{trigger:O,isMutating:k}=(0,j.default)(s,async(t,i)=>{let{arg:a}=i,l=a?.id??e?.id;if(!l)throw Error("Notebook ID is required to share a notebook");return(0,m.parseNotebook)(await (0,b.typedFetchData)(g.API_NOTEBOOK_SHARE,"put",{id:l,slug:r},{},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:C,isMutating:E}=(0,j.default)(s,async(t,i)=>{let{arg:a}=i,l=a.notebookId??e?.id;if(!l)throw Error("Notebook ID is required to save a notebook widget");let{id:s,query:n,...o}=a.widget;return(0,m.parseNotebook)(await (0,b.typedFetchData)(g.API_NOTEBOOK_WIDGET,"put",{id:l,slug:r,widgetId:s},{query:(0,N.serializeQuery)(n),...o},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:T,isMutating:S}=(0,j.default)(s,async(t,i)=>{let{arg:a}=i,l=a.notebookId??e?.id;if(!l)throw Error("Notebook ID is required to remove a notebook widget");return(0,m.parseNotebook)(await (0,b.typedFetchData)(g.API_NOTEBOOK_WIDGET,"delete",{id:l,slug:r,widgetId:a.id},{throwOnHTTPError:!0}))},{revalidate:!1}),A=(0,f.useCallback)(async e=>(await Promise.all([t((0,w.buildSWRKey)(g.API_NOTEBOOK,{id:e.id,teamSlug:r}),e),t((0,w.buildSWRKey)(g.API_NOTEBOOKS,{teamSlug:r}),(0,w.updateCachedList)(e))]),e),[r,t]);return{saveNotebook:async e=>{let t=await A(await d(e,{optimisticData:(0,w.updateCachedNotebook)(e),rollbackOnError:!0}));return x.analytics.track(h.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:a,plan:l,operation:"title_edited",source:"notebook-details-page"}),t},deleteNotebook:async r=>{await c(r),x.analytics.track(h.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_DELETED,{teamId:a,plan:l,source:"notebook-details-page"});let i=r?.id??e?.id;return await t(n,(0,w.updateCachedList)({id:i},!1)),null},shareNotebook:async e=>{let t=A(await O(e));return x.analytics.track(h.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:a,plan:l,operation:"notebook_shared",source:"notebook-details-page"}),t},saveWidget:async(e,t)=>{let r=await A(await C(e,{optimisticData:(0,w.updateCachedNotebook)({},e.widget),rollbackOnError:!0}));return x.analytics.track(h.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:a,plan:l,operation:"new"===e.widget.id?"widget_added":"widget_edited",source:t??"notebook-details-page"}),r},removeWidget:async e=>{let t=await A(await T(e,{optimisticData:(0,w.updateCachedNotebook)({},null,e.id),rollbackOnError:!0}));return x.analytics.track(h.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:a,plan:l,operation:"widget_removed",source:"notebook-details-page"}),t},isSaving:u||p||k||E||S}}var k=e.i(4775302),C=e.i(986386),E=e.i(2385909),T=e.i(5674541),S=e.i(555528),A=e.i(584439),I=e.i(5535439);let D="new-notebook";function B(e){let{query:a}=e,{hasObservabilityPlusAccess:l,ready:s}=(0,C.useHasObservabilityPlus)(),n=!s||!l,{notebooks:d}=(0,k.useNotebooks)(),{createNotebook:u,isSaving:c}=(0,i.useCreateNotebook)(),{saveWidget:g,isSaving:y}=O(),[b,x]=(0,f.useState)(!1),{team:h}=(0,o.useTeam)(),v=(0,A.useToasts)(),j=(0,I.useRouter)(),w=p(a),N=(0,f.useMemo)(()=>d.map(e=>({...e,group:h&&e.contributors.includes(h.id)?"Team":"Personal"})),[d,h]),B=(0,f.useCallback)(e=>{(async()=>{try{if(!h)throw Error("Team not found");x(!1);let t=e.id,r={id:"new",query:a,title:w};t===D?t=(await u({title:e.title,widget:r},"query-builder")).id:await g({notebookId:t,widget:r},"query-builder"),j.push(`/${h.slug}/~/observability/notebooks/${t}`)}catch(e){v.error({preserve:!0,text:(0,t.jsxs)(t.Fragment,{children:["Failed to add query to the notebook.",(0,t.jsx)("br",{}),(0,m.extractError)(e)]})})}})()},[u,g,w,a,v,j,h]),q=(0,t.jsx)(T.Button,{disabled:n,loading:y||c,onClick:()=>x(!0),size:"medium",type:"default",typeName:"button",children:"Add to Notebook"});return n?(0,t.jsx)(S.Tooltip,{text:"Unlock all advanced query features with Observability Plus",children:q}):(0,t.jsxs)(E.Root,{modal:!0,onOpenChange:x,open:b,children:[(0,t.jsx)(E.Anchor,{className:"flex",children:(0,t.jsx)(E.Trigger,{asChild:!0,children:q})}),(0,t.jsx)(E.Portal,{children:(0,t.jsx)(E.Content,{align:"end",onCloseAutoFocus:()=>x(!1),sideOffset:8,children:(0,t.jsx)(r.CommandMenu,{getId:P,getValue:_,label:"notebook",onChange:B,options:N,parseNewValue:R,renderItem:M,reverse:!0})})})]})}function R(e){return{id:D,title:e,group:"Personal"}}function P(e){return e.id}let _=e=>{let{title:t,group:r}=e;return`${t}${r?` ${r}`:""}`};function M(e){return(0,t.jsx)("div",{className:"flex w-full items-center gap-2 px-2 py-1.5",children:(0,t.jsx)("span",{children:e.title})})}var q=e.i(8188445),F=e.i(8084653),V=e.i(4910081),H=e.i(3979315),L=e.i(4746738),Q=e.i(6527079),z=e.i(2615772),K=e.i(9443759),U=e.i(9118498);e.s({QueryBuilder:()=>eX},9763226);var $=e.i(3602900);e.i(7642531);var G=e.i(5450820),W=e.i(9643821),Y=e.i(7795726),Z=e.i(631755),J=e.i(3387593),X=e.i(5163670),ee=e.i(4946541),et=e.i(6948956),er=e.i(6895406);let ei=(0,er.withNewIcon)('<path fill="currentColor" fill-rule="evenodd" d="M1 1v11.75A2.25 2.25 0 0 0 3.25 15H15v-1.5H3.25a.75.75 0 0 1-.75-.75V1H1Zm8.5 2.75V3H8v9h1.5V3.75ZM6 8v4H4.5V8H6Zm7-1.25V6h-1.5v6H13V6.75Z" clip-rule="evenodd"/>');var ea=e.i(2934175),el=e.i(318846),es=e.i(6439332),en=e.i(240708),eo=e.i(3140751),ed=e.i(1085429),eu=e.i(3150448),ec=e.i(7710936);e.s({DateRangeSelect:()=>eb},8994603);var ep=e.i(6606445),em=e.i(1748110),eg=e.i(1265902),ey=e.i(2567082);function eb(e){let{value:r,onChange:i,disabled:a,trackEvents:l,enableVariables:s,variables:n}=e,{start:o,end:d}=(0,N.fromTimeToRange)(r),u=(0,em.subDays)(new Date,90),c=(0,N.getTimeRangePresets)(!0,s?{[m.TIME_VARIABLE]:{start:new Date,end:new Date,text:`Notebook (${(0,N.printTime)(n?.time)})`}}:void 0),p=Object.keys(c).findIndex(e=>e===r);return(0,t.jsx)(eg.Calendar,{allowClear:!1,compact:!0,minValue:u,disabled:a,onChange:(e,t)=>{let r=new Date(e.start),a=new Date(e.end),s=t||(0,ey.default)(a.getTime()-r.getTime());l&&(0,ep.track)("Query Builder Changed Date Range Period",{period:s}),t?i(t):i({from:r,to:a})},popoverAlignment:"center",presetIndex:p,presets:c,value:{start:o,end:d},width:"210px"},"date-range-select-query-builder")}var ex=e.i(8382218),eh=e.i(6157709);let ef=(0,er.withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M6.89531 13.7603C6.72984 13.8785 6.5 13.7602 6.5 13.5569V10.75C6.5 9.7835 5.7165 9 4.75 9H2.5V2.5H12.1884C12.762 2.5 13.262 2.89037 13.4011 3.44683L14.4011 7.44683C14.5984 8.23576 14.0017 9 13.1884 9H9.25H8.5V9.75V12.4854C8.5 12.5662 8.46101 12.6419 8.39531 12.6889L6.89531 13.7603ZM5 13.5569C5 14.9803 6.6089 15.8082 7.76717 14.9809L9.26717 13.9095C9.72706 13.581 10 13.0506 10 12.4854V10.5H13.1884C14.9775 10.5 16.2903 8.81868 15.8563 7.08303L14.8563 3.08303C14.5503 1.85882 13.4503 1 12.1884 1H1.75H1V1.75V9.75V10.5H1.75H4.75C4.88807 10.5 5 10.6119 5 10.75V13.5569Z" fill="currentColor"/>');var ev=e.i(2921318),ej=e.i(5485417);function ew(e){let{onGeneratedQuery:r,query:i,disabled:a}=e,l=(0,A.useToasts)(),{team:n}=(0,o.useTeam)(),d=(0,f.useRef)(null),[u,c]=(0,f.useState)(""),{isGenerating:p,generate:m,error:y}=(e=>{let{onSuccess:t,query:r}=e,[i,a]=(0,f.useState)(!1),[l,n]=(0,f.useState)(null),{team:d}=(0,o.useTeam)(),u=(0,A.useToasts)();return{isGenerating:i,generate:(0,f.useCallback)(async e=>{if(!e.trim())return;a(!0);let i=new URLSearchParams({previousQuery:JSON.stringify(r),prompt:e}).toString();try{let e=await fetch(`${g.API_OBSERVABILITY_QUERY_GENERATION}?${i}`),r=await e.json(),a=r.rollups.value,l=(0,s.getGroupableDimensions)(r.event),o=r.groupBy?.filter(e=>l.includes(e))??[];n(null),t({metric:`${r.event}.${a.measure}`,by:o,filter:r.filter??"",aggregation:a.aggregation,time:r.range??{from:new Date(r.startTime),to:new Date(r.endTime)}})}catch(t){let e="Error generating query";u.error(e),n(e)}finally{a(!1),x.analytics.track(h.AnalyticsEvent.QUERY_BUILDER_GENERATED_QUERY,{prompt:e,plan:d?.billing?.plan??"hobby"})}},[t,r,d,u]),error:l}})({query:i,onSuccess:e=>{r(e),d.current={query:JSON.stringify(e),prompt:u},c("")}}),b=async()=>{u.trim()&&await m(u)};return(0,t.jsx)(eN,{variant:"inline",disabled:a,query:u,error:y,setQuery:c,isGenerating:p,onNegativeFeedback:()=>{x.analytics.track(h.AnalyticsEvent.QUERY_BUILDER_FEEDBACK,{feedback:"badly-generated-query",plan:n?.billing?.plan??"hobby",prompt:d.current?.prompt??"",generatedQuery:d.current?.query??""}),l.success("Thank you for the feedback!")},onSubmit:()=>void b()})}function eN(e){let{query:r,error:i,setQuery:a,onSubmit:l,enableHotkey:s=!0,isGenerating:n,disabled:o,variant:d="full",onNegativeFeedback:u}=e,c=(0,f.useRef)(null),[p,m]=(0,f.useState)(!1),g=p&&!n&&!i,y="query-builder-input";return(0,ev.useHotkey)(()=>{c.current&&s&&c.current.focus()},"/"),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(r),m(!0)},children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:y,children:"Prompt"}),(0,t.jsx)(Z.Input,{className:"h-12 rounded-lg",id:y,innerWrapperClassName:(0,K.cn)("bg-background-100 shadow h-12 font-sans text-[14px] relative z-10 border-gray-200 focus:border-gray-600 rounded-lg overflow-hidden mx-auto","inline"===d&&"h-10 shadow-border rounded-md",{"bg-gray-100":n}),name:y,disabled:n||o,onChange:e=>{a(e.target.value),m(!1)},placeholder:"Show me requests by host...",prefix:(0,t.jsx)(eh.Sparkles,{size:"inline"===d?14:20}),prefixStyling:!1,ref:c,suffix:(0,t.jsxs)("div",{className:(0,K.cn)("flex h-full gap-2","inline"===d?"!pr-1":"!pr-2.5"),children:[s?(0,t.jsx)(ex.Kbd,{className:(0,K.cn)("mr-1","inline"===d&&"mr-1.5",g&&"mr-0.5",0!==r.trim().length&&"hidden"),small:!0,children:"/"}):null,g?(0,t.jsx)(T.Button,{"aria-label":"Not what I expected",className:"!px-0",size:"small",type:"secondary",onClickCapture:e=>{e.preventDefault()},onClick:()=>{m(!1),u()},children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Not what I expected"}),(0,t.jsx)(ef,{})]})}):null,(0,t.jsx)(T.Button,{"aria-label":"Build It",className:(0,K.cn)("!px-0","inline"===d&&"disabled:hidden"),disabled:0===r.trim().length||n,size:"small",typeName:"submit",children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Generate Query"}),(0,t.jsx)(ej.ArrowRight,{})]})})]}),suffixContainer:!1,suffixStyling:!1,typeName:"text",value:r})]})}var eO=e.i(4100974),ek=e.i(1238354),eC=e.i(7550201),eE=e.i(1863837),eT=e.i(8551999),eS=e.i(6563995),eA=e.i(2193315),eI=e.i(36632),eD=e.i(3431702),eB=e.i(1605003);let eR=e=>{let{observabilityConfiguration:t}=(0,C.useHasObservabilityPlus)(),r=(0,y.useTeamSlug)(),{data:i,updateSearch:a,search:l}=(0,eD.default)({limit:10,latestDeployments:null},{},r??void 0);return{decorate:(0,f.useCallback)(async e=>[...e,...i?.projects.map(e=>{let{id:t,name:r}=e;return{id:t,value:t,label:r}})??[]].map(e=>t?.observabilityPlus.excludedProjects?.some(t=>t.id===e.id)?{...e,disabled:!0,tooltip:"Excluded from Observability Plus"}:e),[t,i]),triggerMutation:async e=>{l!==e.text&&a(e.text)},dimensionId:"projectId"}},eP=e=>{let{trigger:t}=(0,eA.useDeploymentBadgeResolverMutation)(e);return{decorate:(0,f.useCallback)(async e=>{try{let r=await t();return(0,eS.applyBadgesToDeploymentIds)(e,r)}catch{return e}},[t]),triggerMutation:()=>t().catch(()=>{}),dimensionId:"deploymentId"}},e_=e=>{let{event:t,measure:r}=(0,eT.splitEventAndMeasure)(e),i=(0,ek.useSonarQueryScope)(),{hasObservabilityPlusAccess:a}=(0,C.useHasObservabilityPlus)();return{decorate:async(e,l)=>{let{dimension:s,text:n}=l;return i?[...e,...await eM({event:t,measure:r,column:s.id,reason:a?"observability_query_builder_plus":"observability_query_builder_free",text:n,...i})]:[]},dimensionId:null}};async function eM(e){let{event:t,measure:r,column:i,ownerId:a,reason:s,text:o}=e,d={minutes:5},u=(0,eE.startOfDuration)(new Date(Date.now()-36e5),d),c=(0,eE.endOfDuration)(new Date,d),p=eT.labelColumnByColumn.get(i),m=l.staticDimensionValues.find(e=>e.dimensions.includes(i))?.values,g="number"===n.AllDimensions[i].type;if(m)return m.map(e=>({id:e.id.toString(),value:e.id,..."label"in e?{label:e.label}:{}})).sort((e,t)=>String(e.id).localeCompare(String(t.id)));let y=o?`contains(${p||i},'${o}')`:void 0;return(await (0,eC.getSonarData)({event:t,scope:{type:"owner",ownerId:a},reason:s,startTime:u,endTime:c,rollups:{value:{measure:r,aggregation:"sum"}},filter:y,granularity:d,groupBy:p?[i,p]:[i],limit:10,tailRollup:"truncate",summaryOnly:!0})).summary.map(e=>{let t=g?Number.parseFloat(e[i]):e[i];return{id:t.toString(),label:p?e[p]:void 0,value:t}})}var eq=e.i(400453),eF=e.i(5610210),eV=e.i(4652282);let eH="!ring-1 ring-gray-400 outline-offset-2 outline-[var(--ds-focus-color)] outline-2 overflow-visible focus:outline";function eL(e){let{className:r,dimensions:i,values:a,onChange:l,isLoading:s,disabled:n,id:o}=e,[d,u]=(0,f.useReducer)(ez,{values:a,dimensions:i},eQ);(0,f.useEffect)(()=>{u({type:"updateProps",dimensions:i,values:a})},[i,a]);let c=d.values.length>0;return(0,t.jsxs)("fieldset",{id:o,className:(0,eF.clsx)("tailwind-preflight flex flex-row items-center gap-2",r),children:[d.values.map((e,r)=>(0,t.jsxs)(f.Fragment,{children:[(0,t.jsx)(W.SingleFilterPopoverBox,{className:(0,eF.clsx)("!p-1",eH,!n&&"!rounded-l"),disabled:n,label:"dimension",onChange:e=>u({type:"change",value:e,index:r,onChange:l}),onOpenChange:e=>u({type:"toggle",open:e,index:r}),open:d.open[r],options:d.remaining,rounded:n,value:e}),n?null:(0,t.jsx)(T.Button,{"aria-label":`Remove ${e.label}`,className:(0,eF.clsx)("-ml-2 !px-0.5 !text-gray-900 hover:!text-gray-1000",eH),onClick:()=>u({type:"remove",index:r,onChange:l}),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(el.CrossSmall,{size:"small"})})]},e.id)),!n&&(0,t.jsx)(W.SingleFilterPopoverBox,{className:"border !p-1",isLoading:s,label:"dimension",onChange:e=>u({type:"add",value:e,onChange:l}),onOpenChange:e=>u({type:"toggle",open:e}),open:d.openAdd,options:d.remaining,rounded:!0,children:(0,t.jsx)(T.Button,{"aria-label":"Add dimension",className:"!text-gray-900 data-[state='open']:!bg-gray-100 hover:!text-gray-1000",size:"small",type:"tertiary",...c?{shape:"square",svgOnly:!0,children:(0,t.jsx)(eV.Plus,{})}:{prefix:(0,t.jsx)(eV.Plus,{}),children:"Group by"}})})]})}function eQ(e){let{values:t,dimensions:r}=e;return{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:eK(r,t),allDimensions:r}}function ez(e,t){switch(t.type){case"toggle":if(void 0===t.index)return{...e,openAdd:t.open};return t.index<0||t.index>=e.values.length?{...e}:{...e,open:[...e.open.slice(0,t.index),t.open,...e.open.slice(t.index+1)]};case"updateProps":{let{dimensions:r}=t,i=t.values.filter(e=>{let{id:t}=e;return r.some(e=>e.id===t)});return{...e,remaining:eK(r,i),values:i,allDimensions:r}}case"add":return{...e,...eU(e.allDimensions,[...e.values,t.value],t.onChange)};case"change":{let{index:r,value:i,onChange:a}=t;if(r<0||r>=e.values.length)return e;return{...e,...eU(e.allDimensions,[...e.values.slice(0,r),i,...e.values.slice(r+1)],a)}}case"remove":{let{index:r,onChange:i}=t;return{...e,...eU(e.allDimensions,[...e.values.slice(0,r),...e.values.slice(r+1)],i)}}default:return e}}function eK(e,t){return e.filter(e=>{let{id:r}=e;return!t.some(e=>e.id===r)})}function eU(e,t,r){return setTimeout(()=>r?.(t),0),{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:eK(e,t)}}var e$=e.i(8158100),eG=e.i(1573239);e.i(9576255);var eW=e.i(329718);function eY(){let{team:e}=(0,o.useTeam)(),r=(0,eW.useOpenEnableModal)(),[,i]=(0,U.useQueryBuilderQueryState)(),a=e?.billing?.plan==="hobby"?"Upgrade to Pro":"Get Observability Plus";return(0,t.jsx)("div",{className:"-mt-1 pb-3",children:(0,t.jsx)(e$.Note,{action:(0,t.jsx)(T.Button,{size:"small",onClick:()=>{x.analytics.track(h.AnalyticsEvent.OBSERVE_FEATURE_SEPARATION,{plan:e?.billing?.plan??"hobby",page:"query-builder",type:"modal_opened"}),r({from:"observability",via:"query-builder"}),i({builder:!1})},children:a}),variant:"contrast",fill:!0,icon:(0,t.jsx)(eG.LockClosedSmall,{}),type:"secondary",className:"!rounded-md !pr-1.5",size:"small",children:(0,t.jsxs)("p",{children:["Read-only mode."," ",(0,t.jsx)("span",{className:"font-medium",children:"Unlock custom queries"})," by upgrading to"," ",e?.billing?.plan==="hobby"?"Pro and Observability Plus":"Observability Plus","."]})})})}function eZ(e){let{children:r,className:i,htmlFor:a,...l}=e;return(0,t.jsx)("label",{className:(0,K.cn)("text-sm font-medium text-gray-800",i),htmlFor:a,...l,children:r})}function eJ(e){let{shouldShowAIQuery:r,isObservabilityPlusReady:i,hasObservabilityPlusAccess:a,setQuery:l,sonarQuery:s}=e;return r?!i||a?(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(ew,{onGeneratedQuery:l,query:s})}):(0,t.jsx)(eY,{}):a?null:(0,t.jsx)(eY,{})}function eX(e){let{query:r,setQuery:i,Actions:a,Title:l,variables:s,enableVariables:o}=e,[d,p]=(0,f.useState)(!1),[g,y]=(0,f.useState)(!1),[b,x]=(0,f.useState)(!1),{hasObservabilityPlusAccess:h,ready:v}=(0,C.useHasObservabilityPlus)(),j=(0,u.useServerFlag)("show-o11y-ai-query",!0),{isReady:w,accessibleColumns:N}=(0,eO.useAccessibleDimensions)(r.metric.split(".")[0]),{accessibleMetrics:O,isReady:k}=c(),E=[...n.AllAggregations],S=(e=>{let t=(0,A.useToasts)(),{decorate:r,triggerMutation:i}=function(e,t){let r=t.map(t=>t(e)),i=(0,f.useRef)(r);i.current=r;let a=e=>i.current.filter(t=>null===t.dimensionId||t.dimensionId===e.dimension.id);return{decorate:async(e,t)=>{let r=e;for(let e of a(t))r=await e.decorate(r,t);return r},triggerMutation:e=>Promise.all(a(e).map(t=>t.triggerMutation?.(e)))}}(e,[e_,eR,eP]);return async e=>{let{dimension:a,text:l}=e;try{i({dimension:a,text:l});let e=await r([],{dimension:a,text:l});return(0,eB.default)(e,"id")}catch(e){return t.error(`Error fetching dimension values. ${(0,eI.isError)(e)?e.message:""}`),[]}}})(r),{event:I,measure:D}=(0,eT.splitEventAndMeasure)(r),B=(0,f.useMemo)(()=>O.find(e=>e.id===r.metric),[O,r.metric]),R=(0,f.useMemo)(()=>N.filter(e=>n.AllDimensions[e.id].events.includes(I)),[N,I]),P=(0,f.useMemo)(()=>({dimensions:R,operators:ec.operators,resolveValues:S,defaultSingleOperator:ec.defaultSingleOperator,defaultMultiOperator:ec.defaultMultiOperator,defaultArrayOperator:ec.defaultArrayOperator}),[R,S]),_=(0,f.useMemo)(()=>E.filter(e=>(0,Y.isValidAggregation)(D,e)&&"unique"!==e).map(e=>({id:e,label:eu.aggregationMappings[e].label,type:"string",icon:()=>eu.aggregationMappings[e].icon})),[E,D]),M=(0,f.useMemo)(()=>_.find(e=>e.id===r.aggregation),[_,r.aggregation]),q=(0,f.useMemo)(()=>(0,eT.toSonarQuery)(r),[r]),F=(0,f.useMemo)(()=>(0,eT.parseFilters)(r.filter),[r.filter]),V=0===F.length&&r.filter,H=(0,f.useMemo)(()=>r.by.map(e=>R.find(t=>t.id===e)).filter(e=>void 0!==e),[r.by,R]),L=(0,f.useMemo)(()=>(0,m.replaceVariables)(r,s),[r,s]),Q=(0,f.useCallback)(e=>i({filter:(0,eT.serializeFilters)(e)}),[i]),z=(0,f.useCallback)(e=>i({by:e.map(e=>{let{id:t}=e;return t})}),[i]),U=!k||!h,Z=(0,f.useRef)(null),ee=(0,f.useCallback)(()=>{Z.current&&x(Z.current.scrollTop>40)},[]),er=(0,f.useCallback)(()=>{Z.current&&Z.current.scrollTo({top:0,behavior:"smooth"})},[]);return(0,t.jsxs)("div",{ref:Z,className:"relative flex h-full flex-col overflow-y-auto overflow-x-hidden",onScroll:ee,children:[(0,t.jsxs)("div",{className:"sticky left-0 top-0 z-10 mb-px flex items-center justify-between gap-3 bg-background-100 p-4 pb-2",style:{background:"linear-gradient(to bottom, var(--ds-background-100) 0%, var(--ds-background-100) 80%, transparent 100%)"},children:[(0,t.jsx)("div",{className:"flex flex-1 items-center justify-start gap-2",children:l}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(T.Button,{"aria-label":"Scroll to top",onClick:er,type:"tertiary",svgOnly:!0,"aria-hidden":!b,shape:"square",className:(0,K.cn)("transition-all duration-200",b?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),tabIndex:b?0:-1,children:(0,t.jsx)(et.ArrowUp,{size:16})}),a]})]}),(0,t.jsxs)("div",{className:"sticky left-0 z-[4] px-4 py-0",children:[(0,t.jsx)(eJ,{shouldShowAIQuery:j,isObservabilityPlusReady:v,hasObservabilityPlusAccess:h,setQuery:i,sonarQuery:q}),(0,t.jsxs)("div",{className:"-mx-4 flex flex-col-reverse items-start gap-2 px-4 pb-0 md:flex-row md:gap-3",children:[(0,t.jsxs)(J.Scroller,{childrenContainerClassName:"p-px gap-2 flex",overflow:"x",width:"100%",children:[(0,t.jsxs)("div",{className:"flex min-w-[300px] shrink-0 flex-row gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(eZ,{htmlFor:"metric",children:"Visualize"}),(0,t.jsx)(W.SingleFilterPopoverBox,{id:"metric",className:"!px-2 !py-4",disabled:U,label:"metric",onChange:e=>{i({metric:e.id,aggregation:"sum"}),p(!1)},onOpenChange:p,open:d,options:O,prefix:(0,t.jsx)(es.Database,{color:"gray-900"}),rounded:!0,suffix:(0,t.jsx)(ea.ChevronUpDown,{color:"gray-800"}),value:B})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(eZ,{htmlFor:"aggregation",className:"opacity-0",children:"Aggregate"}),(0,t.jsx)(W.SingleFilterPopoverBox,{id:"aggregation",className:"!px-2 !py-4",disabled:U,label:"aggregation",onChange:e=>{i({aggregation:e.id}),y(!1)},onOpenChange:y,open:g,options:_,rounded:!0,suffix:(0,t.jsx)(ea.ChevronUpDown,{color:"gray-800"}),value:M})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(eZ,{htmlFor:"by",className:(0,K.cn)("transition-all duration-75",H.length>0?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:"Group By"}),(0,t.jsx)(eL,{id:"by",dimensions:R,disabled:U,isLoading:!w,onChange:z,values:H})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-end gap-x-1 md:pt-[22px]",children:(0,t.jsx)(eb,{disabled:U,value:r.time,onChange:e=>i({time:e}),trackEvents:!0,variables:s,enableVariables:o})})]}),V?(0,t.jsx)(e0,{setQuery:i,query:r}):null,U&&0===F.length||V?null:(0,t.jsxs)("div",{className:(0,K.cn)("flex flex-col gap-1.5 px-px mt-2"),children:[(0,t.jsx)(eZ,{htmlFor:"filter",children:"Filter"}),(0,t.jsxs)("div",{className:"flex flex-row items-center gap-5",children:[(0,t.jsx)("span",{className:"flex-1",children:w?(0,t.jsx)(G.FilterBar,{config:P,disabled:U,filters:F,onChange:Q}):(0,t.jsx)(X.Skeleton,{height:32,width:100})}),(0,t.jsx)(e5,{value:r.viewType,onChange:e=>i({viewType:e})})]})]})]}),(0,t.jsx)("div",{className:"mt-4 h-px shrink-0 border-t border-gray-400 bg-gray-400"}),(0,t.jsx)($.SonarContextProvider,{children:(0,t.jsx)(eq.ResultsChart,{query:L,sticky:!0,setQuery:i,showTable:r.by.length>0,readOnly:U,scrollerRef:Z})})]})}function e0(e){let{setQuery:r,query:i}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-row items-center gap-2 py-2",children:[(0,t.jsx)(S.Tooltip,{text:"Invalid or unsupported filter saved",children:(0,t.jsx)(ed.Question,{size:16})}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center",children:[(0,t.jsx)(S.Tooltip,{className:"w-full",text:i.filter,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(Z.Input,{"aria-label":"Invalid or unsupported filter saved",className:"w-full overflow-visible outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0},value:i.filter})})}),(0,t.jsx)(T.Button,{"aria-label":"Clear filter",className:"overflow-visible !border-l-0 outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",onClick:()=>r({filter:""}),size:"medium",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",children:(0,t.jsx)(el.CrossSmall,{size:20})})]})]})}let e1=[{type:"line",icon:(0,t.jsx)(en.LineChart,{})},{type:"area",icon:(0,t.jsx)(ei,{})},{type:"table",icon:(0,t.jsx)(eo.MenuAlt,{})}];function e5(e){let{value:r="line",onChange:i}=e;return(0,t.jsx)(ee.Switch,{name:"view",size:"small",children:e1.map(e=>{let{type:a,icon:l}=e;return(0,t.jsx)(ee.Switch.Control,{checked:r===a,icon:l,value:a,onChange:()=>i(a)},a)})})}function e2(){let[e,r]=(0,U.useQueryBuilderQueryState)(),{hasObservabilityPlusAccess:i,ready:a}=(0,C.useHasObservabilityPlus)(),l=e.fullScreen??!1;return(0,t.jsx)(V.Sheet,{onOpenChange:e=>r({builder:e}),open:e.builder,children:(0,t.jsx)(V.SheetContent,{className:(0,K.cn)("m-3 h-[calc(100%-1.5rem)] w-[calc(100%-1.5rem)] overflow-visible rounded-[1rem] bg-white p-0 lg:w-3/4 sm:max-w-[auto]",l&&"!w-[calc(100%-1.5rem)]"),onEscapeKeyDown:e=>{e.target instanceof HTMLInputElement&&e.preventDefault()},side:"right",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden rounded-[1rem]",children:[(0,t.jsx)(eX,{Actions:(0,t.jsx)(e4,{fullScreen:l,setFullScreen:e=>r({fullScreen:e})}),query:e,setQuery:r,Title:(0,t.jsx)(e3,{})}),a&&i?(0,t.jsx)("section",{className:"flex justify-end border-t bg-background-200 p-3",children:(0,t.jsx)(B,{query:e})}):null]})})})}function e3(){let e=(0,A.useToasts)();return(0,t.jsxs)(V.SheetHeader,{children:[(0,t.jsx)(V.SheetTitle,{className:"hidden"}),(0,t.jsxs)("div",{className:"sticky top-0 z-10 flex items-center gap-2 bg-background-100 pl-2",children:[(0,t.jsx)(F.Text,{className:"text-nowrap",variant:"heading-20",children:"Run Query"}),(0,t.jsx)(T.Button,{"aria-label":"Copy to clipboard",className:"!px-1.5",onClick:()=>{(0,q.copyToClipboard)(window.location.href),e.message("URL copied to clipboard!")},size:"small",svgOnly:!0,shape:"square",type:"tertiary",children:(0,t.jsx)(z.Link,{color:"gray-800"})})]})]})}function e4(e){let{fullScreen:r,setFullScreen:i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.Button,{"aria-label":r?"Minimize":"Expand",onClick:()=>i(!r),svgOnly:!0,className:"hidden lg:block",shape:"square",type:"tertiary",children:r?(0,t.jsx)(S.Tooltip,{text:"Minimize",position:"bottom",children:(0,t.jsx)(Q.FullscreenClose,{})}):(0,t.jsx)(S.Tooltip,{text:"Expand",position:"bottom",children:(0,t.jsx)(L.Fullscreen,{})})}),(0,t.jsx)(V.SheetClose,{asChild:!0,children:(0,t.jsx)(T.Button,{"aria-label":"Close",shape:"square",size:"medium",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(H.Cross,{})})})]})}},[819765,4740724,8994603,9763226]]}]);

//# sourceMappingURL=bb9949065972d08f.js.map
//# debugId=aff3c3b5-a5d7-57ab-bfd2-4e90e456c22e
