
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="29d618fd-7d4b-5bd2-88bc-419c17f84f3e")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{6041693:e=>{"use strict";e.s({ElasticConcurrency:()=>R},6041693);var t=e.i(6645307),r=e.i(6530772),n=e.i(9495609),i=e.i(8084653),a=e.i(8811733),s=e.i(584439),l=e.i(5163670),o=e.i(889716),d=e.i(5249128),c=e.i(3921802),u=e.i(1379429),g=e.i(534589),h=e.i(3585235),p=e.i(5785123),m=e.i(2362802),f=e.i(7315479),x=e.i(3514588),j=e.i(5535439),y=e.i(2240289),b=e.i(6958389),v=e.i(6025740),w=e.i(5610210),k=e.i(604868),S=e.i(3326412),P=e.i(6700141);function T(e,t){return e?.resourceConfig?.buildEntitlements?.enhancedBuilds||t?"enhanced":"standard"}let C={standard:{memory:8,cpu:4,label:"Standard performance",description:"Cost-effective option for lightweight apps and APIs"},enhanced:{memory:16,cpu:8,label:"Enhanced performance",description:"Increased compute, ideal for large applications"},turbo:{memory:60,cpu:30,label:"Turbo performance",description:"Optimized for Turbopack builds which take advantage of multiple cores"}};function R(){let{project:g}=(0,j.useParams)()??{},{data:m,isLoading:R,mutate:D}=(0,y.useProject)(String(g)),N=(0,h.default)(),{team:E,isLoading:B}=(0,x.useTeam)(),z=(0,k.useIsMobile)(),[A,_]=(0,r.useState)({checked:!1,selectedBuildMachine:"standard",defaultBuildMachine:"standard",saving:!1,dirty:!1,error:null}),{isReady:L,value:F}=(0,S.useProAndEntOnDemandTurboBuilds)(),O=L&&F,{value:I}=(0,P.useEnhancedBuilds)(),$=(0,r.useCallback)(()=>m?.resourceConfig?.buildMachineType==="turbo"?"turbo":"enhanced"===T(E,I)||m?.resourceConfig?.buildMachineType==="enhanced"?"enhanced":"standard",[m,E,I]);(0,r.useEffect)(()=>{let e="standard",t="standard",r=!1;E&&(t=T(E,I)),m&&(r=!!m.resourceConfig?.elasticConcurrencyEnabled,e=$()),_(n=>({...n,selectedBuildMachine:e,checked:r,defaultBuildMachine:t}))},[m,E,$,I]);let V=(0,s.useToasts)();async function H(){if(E&&void 0!==m&&void 0!==m.accountId&&A.dirty&&!A.saving)try{_(e=>({...e,saving:!0,error:null}));let{updateProjectSettingsV9:r}=await e.r(1176725)(e.i),n={resourceConfig:{elasticConcurrencyEnabled:A.checked}};A.checked&&(n.resourceConfig={...n.resourceConfig,buildMachineType:"standard"===A.selectedBuildMachine?null:A.selectedBuildMachine});let i=m.resourceConfig?.elasticConcurrencyEnabled,a=m.resourceConfig?.buildMachineType,s=await r(String(g),E.id,n),l=s.resourceConfig?.elasticConcurrencyEnabled,o=s.resourceConfig?.buildMachineType,d=A.checked?"Enabled":"Disabled";if(i!==l)V.success(`${d} On-Demand Concurrent Builds successfully.`);else{var t;let e=q()[0];a!==o&&V.success(`Build machine set to ${(t=o||e).charAt(0).toUpperCase()+t.slice(1)}.`)}await D(),_(e=>({...e,saving:!1,dirty:!1}))}catch(e){_(t=>({...t,saving:!1,error:(0,f.errorToString)(e)}))}}function U(e,t){return void 0===e||e!==t}function q(){return O?"enhanced"===A.defaultBuildMachine?["enhanced","turbo"]:["standard","enhanced","turbo"]:"enhanced"===A.defaultBuildMachine?["enhanced"]:["standard","enhanced"]}function W(e){return A.checked&&e===A.selectedBuildMachine}let Y=function(e){let{value:t}=(0,P.useEnhancedBuilds)(),{isReady:r,value:n}=(0,S.useProAndEntOnDemandTurboBuilds)();return!!("enhanced"!==T(e,t)||r&&n)}(E),G=R||N.isLoading||B,Z=N.isLoading?void 0:N.can(p.Action.Update,p.Resource.ConcurrentBuilds),{enabled:J,disabledReason:K}=(0,v.useOnDemandConcurrentBuilds)(E,Z??!1);return(0,t.jsx)(b.ProjectSettingsFieldset,{description:Y?"Instantly scale build capacity to skip the queue, even if all build slots are in use. You can also choose a larger build machine; charges apply per minute if it exceeds your team's pre-committed concurrency.":"Instantly scale build capacity to skip the queue, even if all build slots are in use. Charges apply per minute if it exceeds your team's pre-committed concurrency.",disabled:G||!J,error:A.error,highlightNote:!Z,note:(0,t.jsx)(M,{disabledReason:K,loading:G}),onSave:H,saveDisabled:!A.dirty,saveLoading:A.saving,title:"On-Demand Concurrent Builds",type:"default",children:G?(0,t.jsx)(l.Skeleton,{height:30,width:128}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Toggle,{checked:A.checked,onChange:function(e){_(t=>{var r;return{...t,checked:e,selectedBuildMachine:A.defaultBuildMachine,dirty:(r=A.selectedBuildMachine,$()!==r||U(m?.resourceConfig?.elasticConcurrencyEnabled,e))}})},size:"large"}),(0,t.jsx)(a.Spacer,{inline:!0,x:.5}),(0,t.jsx)(i.Text,{as:"span",children:A.checked?"Enabled":"Disabled"}),Y?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Spacer,{y:.5}),(0,t.jsx)(o.Stack,{className:"w-full",direction:"column",gap:4,id:"enhanced-builds",children:(0,t.jsx)(d.RadioGroup,{onChange:function(e){_(t=>{var r;return{...t,selectedBuildMachine:e,dirty:U(m?.resourceConfig?.elasticConcurrencyEnabled,A.checked)||(r=e,$()!==r)}})},value:A.selectedBuildMachine,disabled:!A.checked,children:(0,t.jsx)(o.Stack,{gap:z?2:4,children:q().map(e=>{let{memory:r,cpu:n,label:s,description:g}=C[e],h=n<=1;return(0,t.jsx)(l.Skeleton,{show:!1,children:(0,t.jsx)(u.Card,{className:(0,w.clsx)("border p-0 pl-4",{"border-solid border-[var(--ds-blue-700)]":W(e)}),gap:2,padding:4,secondary:W(e),children:(0,t.jsx)(d.RadioGroup.Item,{className:"items-center",fullWidth:!0,value:e,children:(0,t.jsxs)(o.Stack,{className:"p-4 pl-2",direction:"column",justify:"space-between",children:[(0,t.jsxs)(o.Stack,{direction:z?"column":"row",justify:"flex-start",children:[(0,t.jsx)(i.Text,{weight:500,children:s}),(0,t.jsxs)(o.Stack,{className:(0,w.clsx)({"mb-1 mt-1":z}),direction:"row",children:[(0,t.jsx)(a.Spacer,{x:+!z}),A.defaultBuildMachine===e?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(c.Badge,{className:"w-fit p-2 normal-case",size:"sm",variant:W(e)?"blue":"gray",children:"Default"})}):null,A.defaultBuildMachine===e&&(0,t.jsx)(a.Spacer,{x:z?.25:.5}),(0,t.jsxs)(c.Badge,{className:"w-fit p-2 normal-case",size:"sm",variant:W(e)?"blue-subtle":"gray-subtle",children:[n," vCPU",h?"":"s"]}),(0,t.jsx)(a.Spacer,{x:z?.25:.5}),(0,t.jsxs)(c.Badge,{className:"w-fit p-2",size:"sm",variant:W(e)?"blue-subtle":"gray-subtle",children:[r," GB Memory"]})]})]}),(0,t.jsx)(i.Text,{color:"gray-900",children:A.defaultBuildMachine===e?g:`${g}, builds will be charged on demand per minute`})]})})},e)},e)})})})})]}):null]})})}function M(e){return e.loading?(0,t.jsx)(l.Skeleton,{boxHeight:32,vcenter:!0,width:200}):"no-permission"===e.disabledReason?(0,t.jsx)(t.Fragment,{children:"You need additional permissions to manage your project's On-Demand Concurrent Builds."}):"hobby-plan"===e.disabledReason?(0,t.jsxs)(i.Text,{children:["This feature is available on the"," ",(0,t.jsx)(m.Link,{external:!0,href:"/pricing",tab:!0,type:"highlight",children:"Pro plan"})]}):"enterprise-non-unbundled"===e.disabledReason?(0,t.jsxs)(i.Text,{children:["To enable On-Demand Concurrent Builds"," ",(0,t.jsx)(m.Link,{external:!0,href:g.CONTACT_SALES_DASHBOARD_HREF,type:"highlight",children:"Contact Sales"})]}):"pro-non-active"===e.disabledReason?(0,t.jsx)(i.Text,{children:"Upgrade to Pro to enable On-Demand Concurrent Builds."}):(0,t.jsxs)(t.Fragment,{children:["Learn more about"," ",(0,t.jsx)(m.Link,{external:!0,href:"/docs/deployments/managing-builds#on-demand-concurrent-builds",type:"highlight",children:"On-Demand Concurrent Builds"})]})}},4275890:e=>{"use strict";e.s({PrioritizeProductionBuilds:()=>y});var t=e.i(6645307),r=e.i(5535439),n=e.i(6530772),i=e.i(7315479),a=e.i(5163670),s=e.i(8811733),l=e.i(8084653),o=e.i(9495609),d=e.i(584439),c=e.i(2362802),u=e.i(1164214),g=e.i(3514588),h=e.i(3585235),p=e.i(5785123),m=e.i(2408607),f=e.i(5747252),x=e.i(2240289),j=e.i(6958389);function y(){let{project:e}=(0,r.useParams)()||{},{data:y,mutate:b}=(0,x.useProject)(String(e),{apiVersion:"v9"}),{team:v,isReady:w}=(0,g.useTeam)(),{can:k,isLoading:S}=(0,h.default)(),P=!!y?.productionDeploymentsFastLane,[T,C,R]=(0,f.default)(P),[M,D]=(0,n.useState)(!1),[N,E]=(0,n.useState)(null),B=S?void 0:k(p.Action.Update,p.Resource.Project),z=(0,d.useToasts)(),A=!y||!e||!w||S,_=!A&&B&&T!==P;async function L(){if(!A){D(!0),E(null);try{await (0,m.updateProjectSettingsV9)(e,v?.id,{productionDeploymentsFastLane:T}),z.success("Updated Prioritize Production Builds successfully."),R(),await b()}catch(e){E((0,i.errorToString)(e))}finally{D(!1)}}}return(0,t.jsx)(j.ProjectSettingsFieldset,{description:"Builds for Production environment will be prioritized over Pre-Production environments.",disabled:A||!B,error:N,highlightNote:!A&&!B,note:A?(0,t.jsx)(a.Skeleton,{boxHeight:32,vcenter:!0,width:200}):(0,t.jsx)(l.Text,{color:"gray-900",children:B?(0,t.jsxs)(t.Fragment,{children:["Learn more about"," ",(0,t.jsx)(c.Link,{external:!0,href:"/docs/deployments/concurrent-builds#prioritize-production-builds",type:"highlight",children:"Prioritize Production Builds"})]}):(0,t.jsx)(l.Text,{color:"gray-900",children:"You need additional permissions to manage your project's prioritize production builds setting."})}),onSave:L,saveDisabled:!_,saveLoading:M,title:"Prioritize Production Builds",type:"default",children:A?(0,t.jsx)(a.Skeleton,{height:30,width:128}):(0,t.jsxs)("label",{"data-testid":(0,u.tid)("production-deployments-fastlane","checkbox"),style:{cursor:"pointer"},children:[(0,t.jsx)(o.Toggle,{checked:T,onChange:()=>C(!T),size:"large"}),(0,t.jsx)(s.Spacer,{inline:!0,x:.5}),(0,t.jsx)(l.Text,{as:"span",children:T?"Enabled":"Disabled"})]})})}},2177835:e=>{"use strict";e.s({default:()=>C});var t=e.i(6645307),r=e.i(5535439),n=e.i(6530772),i=e.i(7315479),a=e.i(8158100),s=e.i(6921100),l=e.i(5163670),o=e.i(889716),d=e.i(8084653),c=e.i(584439),u=e.i(2362802),g=e.i(3277953),h=e.i(3514588),p=e.i(3585235),m=e.i(5785123),f=e.i(878537),x=e.i(2240289),j=e.i(2408607),y=e.i(5747252),b=e.i(6958389),v=e.i(5688201),w=e.i(3184563),k=e.i(5938635),S=e.i(1064060);function P(e){let{discontinueDate:t}=e,r=Date.now();return void 0!==t&&t.getTime()<=r}function T(e){let{selectedOption:{range:r,discontinueDate:n,link:i,warning:s}}=e;if(n){let e=(0,t.jsx)(u.Link,{external:!0,href:i,type:"highlight",children:new Intl.DateTimeFormat("en-US",{dateStyle:"long"}).format(n)});return(0,t.jsx)(a.Note,{fill:!0,label:!1,type:"warning",variant:"contrast",children:P({discontinueDate:n})?(0,t.jsxs)(t.Fragment,{children:["Node.js ",r," is discontinued since ",e,". Please upgrade to create new builds."]}):(0,t.jsxs)(t.Fragment,{children:["Node.js ",r," is deprecated. New builds will be disabled on ",e,"."]})})}if(s)return(0,t.jsx)(a.Note,{fill:!0,label:!1,type:"warning",variant:"contrast",children:s})}function C(){let{project:e}=(0,r.useParams)()||{};if(Array.isArray(e))throw Error("Expected query.project to be string but found array");let{data:a,mutate:C}=(0,x.useProjectV8)(e),{data:R,isLoading:M}=(0,w.useProjectProductionDeployment)(a?.id),{data:D,isLoading:N}=(0,k.default)(R?.deployment.id),{team:E,isReady:B}=(0,h.useTeam)(),{can:z,isLoading:A}=(0,p.default)(),_=[{major:22,range:"22.x"},{major:20,range:"20.x"},{major:18,range:"18.x",discontinueDate:new Date("2025-09-01"),link:"/changelog/node-js-18-is-being-deprecated"},{major:16,range:"16.x",discontinueDate:new Date("2025-01-31"),link:"/changelog/node-js-16-deprecation"},{major:14,range:"14.x",discontinueDate:new Date("2023-08-15"),link:"/changelog/node-js-14-and-16-are-being-deprecated"},{major:12,range:"12.x",discontinueDate:new Date("2022-10-03"),link:"/changelog/node-js-12-is-being-deprecated"},{major:10,range:"10.x",discontinueDate:new Date("2021-04-20"),link:"/changelog/node-js-10-is-being-deprecated"},{major:8,range:"8.x",discontinueDate:new Date("2020-01-06")}],L=a?.nodeVersion||_[0].range,[F,O,I]=(0,y.default)(L),$=_.find(e=>F===e.range)||_[0],[V,H]=(0,n.useState)(!1),[U,q]=(0,n.useState)(null),W=(0,c.useToasts)(),Y=!a||!B||A,G=z(m.Action.Update,m.Resource.Project),Z=!Y&&e&&G&&F!==L,J=(0,n.useMemo)(()=>void 0!==a&&D?.projectSettings!==void 0&&a.nodeVersion!==D.nodeVersion,[D,a]),K=(0,n.useMemo)(()=>D?.url?(0,t.jsx)(u.Link,{href:D.inspectorUrl,variant:"highlight",children:D.url}):null,[D]),Q=(0,n.useMemo)(()=>e=>{let{range:t,discontinueDate:r}=e;return t===$.range||!P({discontinueDate:r})},[$]);return(0,t.jsxs)(b.ProjectSettingsFieldset,{description:"The version of Node.js that is used in the Build Step and for Serverless Functions. A new Deployment is required for your changes to take effect.",disabled:Y||!G,error:U,highlightNote:!Y&&!G,note:Y?(0,t.jsx)(l.Skeleton,{boxHeight:32,vcenter:!0,width:200}):G?(0,t.jsxs)(d.Text,{color:"gray-900",children:["Learn more about"," ",(0,t.jsx)(u.Link,{external:!0,href:"/docs/functions/serverless-functions/runtimes/node-js#node.js-version",type:"highlight",children:"Node.js Version"})]}):(0,t.jsx)(d.Text,{lineHeight:32,color:"gray-900",children:"You need additional permissions to manage your project's node version."}),onSave:async()=>{if(Z){H(!0);try{q(null),await (0,j.default)(e,E?.id,{nodeVersion:F}),W.success("Updated Node.js Version successfully."),I(),await C()}catch(e){q((0,i.errorToString)(e))}H(!1)}},saveDisabled:!Z,saveLoading:V,title:"Node.js Version",children:[(0,t.jsx)(f.default,{direction:["column","row","row"],gap:.5,children:(0,t.jsx)(f.default,{children:(0,t.jsx)(l.Skeleton,{show:Y,children:J?(0,t.jsxs)(o.Stack,{className:v.default.multipleDeploymentSettingStack,gap:3,children:[(0,t.jsxs)(o.Stack,{align:"center",direction:"row",gap:1,children:[(0,t.jsx)(g.Warning,{className:`${v.default.warningMessageIcon} geist-hide-on-mobile`}),(0,t.jsx)(d.Text,{className:v.default.warningMessageMainText,weight:600,children:"Configuration Settings in the current Production deployment differ from your current Project Settings."})]}),(0,t.jsx)(S.Dropdown,{deploymentLink:K,title:"Production Overrides",children:(0,t.jsx)(s.Select,{disabled:!0,value:D?.nodeVersion,children:_.filter(Q).map(e=>(0,t.jsx)("option",{value:e.range,children:e.range},e.range))})}),(0,t.jsx)(S.Dropdown,{title:"Project Settings",children:(0,t.jsx)(s.Select,{disabled:Y,onChange:e=>O(e.target.value),value:F,children:_.filter(Q).map(e=>(0,t.jsx)("option",{disabled:P(e),value:e.range,children:e.range},e.range))})})]}):(0,t.jsx)(s.Select,{disabled:Y,onChange:e=>O(e.target.value),value:F,children:_.filter(Q).map(e=>(0,t.jsx)("option",{disabled:P(e),value:e.range,children:e.range},e.range))})})})}),(0,t.jsx)(f.default,{style:{marginTop:12},children:(0,t.jsx)(T,{selectedOption:$})})]})}},751857:e=>{e.v({ujpjic:"root-directory-module__OnK_2q__ujpjic"})},4387991:e=>{"use strict";e.s({RootDirectory:()=>v});var t=e.i(6645307),r=e.i(5610210),n=e.i(5535439),i=e.i(6530772),a=e.i(5163670),s=e.i(889716),l=e.i(8084653),o=e.i(9495609),d=e.i(555528),c=e.i(584439),u=e.i(2362802),g=e.i(3514588),h=e.i(3585235),p=e.i(5785123),m=e.i(1857280),f=e.i(2240289),x=e.i(2408607),j=e.i(5747252),y=e.i(6958389),b=e.i(751857);function v(){let{project:e}=(0,n.useParams)()||{},{data:v,mutate:w}=(0,f.useProjectV8)(e),{team:k,isReady:S}=(0,g.useTeam)(),{can:P,isLoading:T}=(0,h.default)(),C=v?.rootDirectory||"",R=!!v?.sourceFilesOutsideRootDirectory,[M,D,N]=(0,j.default)(C),[E,B,z]=(0,j.default)(R),A=!!v?.enableAffectedProjectsDeployments,[_,L,F]=(0,j.default)(A),O=M.length>0,I=v?.link?.type==="github",[$,V]=(0,i.useState)(!1),[H,U]=(0,i.useState)(null),q=(0,c.useToasts)(),W=!v||!S||T,Y=P(p.Action.Update,p.Resource.Project),G=E!==R,Z=M!==C,J=_!==A,K=!W&&e&&Y&&(G||Z||J);return(0,t.jsx)(y.ProjectSettingsFieldset,{description:"The directory within your project, where your code is located. Leave this field empty if your code is not located in a subdirectory.",disabled:W||!Y,error:H,highlightNote:!W&&!Y,note:W?(0,t.jsx)(a.Skeleton,{boxHeight:32,vcenter:!0,width:200}):Y?(0,t.jsxs)(l.Text,{color:"gray-900",children:["Learn more about"," ",(0,t.jsx)(u.Link,{external:!0,href:"/docs/deployments/configure-a-build#root-directory",type:"highlight",children:"Root Directory"})]}):(0,t.jsx)(l.Text,{lineHeight:32,color:"gray-900",children:"You need additional permissions to manage your project's root directory."}),onSave:async()=>{if(K){V(!0);try{U(null),await (0,x.default)(e,k?.id,{rootDirectory:M||null,sourceFilesOutsideRootDirectory:E,enableAffectedProjectsDeployments:_}),q.success("Updated Root Directory successfully."),N(),z(),F(),await w()}catch(e){U(e.message)}V(!1)}},saveDisabled:!K,saveLoading:$,title:"Root Directory",children:W?(0,t.jsxs)(s.Stack,{align:"flex-start",gap:4,children:[(0,t.jsx)(a.Skeleton,{height:36,width:300}),(0,t.jsx)(a.Skeleton,{height:20,width:"100%"})]}):(0,t.jsxs)(s.Stack,{align:"flex-start",gap:4,children:[(0,t.jsx)(m.default,{disabled:$,maxWidth:"100%",onChange:D,placeholder:"",value:M||"",width:"300px"}),(0,t.jsxs)("label",{className:b.default.ujpjic,children:[(0,t.jsxs)(l.Text,{color:"inherit",children:["Include files outside the root directory in the"," ",(0,t.jsx)(u.Link,{external:!0,href:"/docs/deployments/build-step",tab:!0,type:"highlight",children:"Build Step"}),"."]}),(0,t.jsx)(o.Toggle,{"aria-labelledby":"label-for-include-files-outside-root-directory-enabled-toggle",checked:E,direction:"label-first",onChange:()=>B(!E),size:"large",children:(0,t.jsx)(l.Text,{id:"label-for-include-files-outside-root-directory-enabled-toggle",transform:"none",weight:500,children:E?"Enabled":"Disabled"})})]}),(0,t.jsx)("hr",{className:"geist-hr-reset w-full"}),(0,t.jsxs)("label",{className:(0,r.clsx)(b.default.ujpjic,{"geist-disabled":!O}),children:[(0,t.jsxs)(l.Text,{color:"inherit",children:[(0,t.jsx)(u.Link,{external:!0,href:"/docs/monorepos#skipping-unaffected-projects",tab:!0,type:"highlight",children:"Skip deployments"})," ","when there are no changes to the root directory or its dependencies."]}),I?(0,t.jsx)(o.Toggle,{"aria-labelledby":"label-for-enable-affected-projects-deployments",checked:_,direction:"label-first",disabled:!O||!I,onChange:()=>L(!_),size:"large",children:(0,t.jsx)(l.Text,{id:"label-for-enable-affected-projects-deployments",transform:"none",weight:500,children:_?"Enabled":"Disabled"})}):(0,t.jsx)(d.Tooltip,{text:"Deployment skipping is currently only available for projects connected to GitHub.",children:(0,t.jsx)(o.Toggle,{"aria-labelledby":"label-for-enable-affected-projects-deployments",checked:_,direction:"label-first",disabled:!O||!I,onChange:()=>L(!_),size:"large",children:(0,t.jsx)(l.Text,{id:"label-for-enable-affected-projects-deployments",transform:"none",weight:500,children:_?"Enabled":"Disabled"})})})]})]})})}},7247968:e=>{"use strict";e.s({FrameworkSettings:()=>x});var t=e.i(6645307),r=e.i(6530772),n=e.i(8924811),i=e.i(674684),a=e.i(878537),s=e.i(2448773),l=e.i(3585235),o=e.i(5785123),d=e.i(5175803),c=e.i(6921100),u=e.i(5163670),g=e.i(8811733),h=e.i(1064060),p=e.i(5751047),m=e.i(2657021),f=e.i(2240289);function x(){let e=(0,i.useRouter)(),{data:a}=(0,p.useFrameworks)(),{project:d}=e.query,{data:g}=(0,f.useProject)(Array.isArray(d)?d[0]:d),[x,y]=(0,r.useState)(""),{can:b,isLoading:v}=(0,l.default)(),w=b(o.Action.Update,o.Resource.Project);(0,r.useEffect)(()=>{g&&y(g.framework??"other")},[g]);let k=(0,r.useMemo)(()=>a?a.find(e=>e.slug===x||!e.slug&&"other"===x):null,[a,x]),S=(0,r.useMemo)(()=>k?(0,t.jsx)(j,{logo:k.logo,name:k.name}):null,[k]);return(0,t.jsx)(h.BuildDevelopmentSettings,{framework:k,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.default,{h5:!0,noMargin:!0,style:{marginBottom:5,fontSize:12,fontWeight:500,userSelect:"none",cursor:"default"},type:"secondary",children:"Framework Preset"}),(0,t.jsx)(u.Skeleton,{height:40,width:"100%",children:S?(0,t.jsx)(c.Select,{disabled:!g||v||!w,name:"framework",onChange:e=>{e.target.value!==x&&y(e.target.value)},prefix:k&&k.logo?(0,t.jsx)(n.default,{alt:`${k.name} logo`,className:"bg-white/75 rounded-full shadow-border shadow-background-100 dark:bg-foreground dark:shadow-foreground",height:"20",src:k.logo,width:"20"}):null,value:x,children:(0,t.jsx)(m.FrameworkOptionList,{frameworks:a??null})}):null})]})})}function j(e){return(0,t.jsxs)(a.default,{row:!0,style:{fontSize:14},vcenter:!0,children:[e.logo?(0,t.jsx)(d.Avatar,{size:24,url:e.logo}):(0,t.jsx)("span",{className:"geist-avatar",style:{textAlign:"center",lineHeight:1.5,fontWeight:"600",color:"#333",userSelect:"none",width:24,height:24},children:e.name}),(0,t.jsx)(g.Spacer,{x:.5}),(0,t.jsx)("span",{children:e.name})]})}},3164643:e=>{"use strict";e.s({RollingReleases:()=>ew},3164643);var t=e.i(6645307),r=e.i(889716),n=e.i(9495609),i=e.i(631755),a=e.i(5674541),s=e.i(8084653),l=e.i(555528),o=e.i(584439),d=e.i(4983656),c=e.i(36632),u=e.i(9240532),g=e.i(611347),h=e.i(6531164),p=e.i(7238633),m=e.i(1755874),f=e.i(8350390),x=e.i(6530772),j=e.i(2362802),y=e.i(4652282),b=e.i(4707420),v=e.i(5165976),w=e.i(3509620),k=e.i(3159315),S=function(e,t,r){if(e&&"reportValidity"in e){var n=(0,k.get)(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},P=function(e,t){var r=function(r){var n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?S(n.ref,r,e):n.refs&&n.refs.forEach(function(t){return S(t,r,e)})};for(var n in t.fields)r(n)},T=function(e,t){t.shouldUseNativeValidation&&P(e,t);var r={};for(var n in e){var i=(0,k.get)(t.fields,n);(0,k.set)(r,n,Object.assign(e[n],{ref:i&&i.ref}))}return r},C=function(e,t){for(var r={};e.length;){var n=e[0],i=n.code,a=n.message,s=n.path.join(".");if(!r[s])if("unionErrors"in n){var l=n.unionErrors[0].errors[0];r[s]={message:l.message,type:l.code}}else r[s]={message:a,type:i};if("unionErrors"in n&&n.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var o=r[s].types,d=o&&o[n.code];r[s]=(0,k.appendErrors)(s,t,r,i,d?[].concat(d,n.message):n.message)}e.shift()}return r},R=e.i(2068621),M=e.i(4374461),D=e.i(1183506),N=e.i(9336536),E=e.i(2240289),B=e.i(663357),z=e.i(3277953),A=e.i(7378033),_=e.i(9326250),L=e.i(1164214),F=e.i(5535439),O=e.i(3585235),I=e.i(5785123),$=e.i(8934201),V=e.i(8679640),H=e.i(4434145);function U(e){let{open:n,onConfirm:i,onCancel:a,teamSlug:l,projectSlugOrId:o,billingPlan:d}=e;return(0,t.jsxs)($.Modal.Modal,{active:n,onClickOutside:a,children:[(0,t.jsxs)($.Modal.Body,{children:[(0,t.jsx)($.Modal.Header,{children:(0,t.jsx)($.Modal.Title,{children:"Enable Rolling Releases"})}),(0,t.jsxs)(r.Stack,{gap:4,children:[(0,t.jsx)(s.Text,{children:"We highly recommend enabling Skew Protection when using rolling releases. Skew Protection ensures that every user, whether they get the prior deployment or the release candidate, communicates with the backend code from the matching deployment."}),(0,t.jsxs)(s.Text,{children:["You can proceed without Skew Protection, but this may lead to version skew issues. You can enable Skew Protection later in deployment settings"," ",(0,t.jsx)(j.Link,{href:`/${l}/${o}/settings/advanced#skew-protection`,target:"_blank",type:"highlight",children:"here"}),"."]}),(0,t.jsxs)("div",{className:"grid grid-cols-[1fr,auto,1fr] items-center gap-1",children:[(0,t.jsxs)(r.Stack,{className:"h-full rounded border border-solid border-gray-alpha-400 p-3",gap:1,justify:"space-between",children:[(0,t.jsx)(s.Text,{color:"gray-900",children:"Current"}),(0,t.jsx)(s.Text,{children:"Disabled"})]}),(0,t.jsx)("div",{className:"flex rotate-90 items-center justify-center md:rotate-0",children:(0,t.jsx)(V.ChevronRightSmall,{color:"gray-900"})}),(0,t.jsxs)(r.Stack,{className:"h-full rounded border border-solid border-gray-alpha-400 p-3",gap:1,justify:"space-between",children:[(0,t.jsx)(s.Text,{color:"gray-900",children:"Updated"}),(0,t.jsx)(r.Stack,{children:d?(0,t.jsxs)(s.Text,{children:["Max Age: ",(0,H.defaultSkewProtectionMaxAge)(d)]}):(0,t.jsx)(s.Text,{children:"Enabled"})})]})]}),(0,t.jsxs)(s.Text,{children:["Learn more about Skew Protection"," ",(0,t.jsx)(j.Link,{href:"/docs/skew-protection",target:"_blank",type:"highlight",children:"Skew Protection"}),"."]})]})]}),(0,t.jsxs)($.Modal.Actions,{children:[(0,t.jsx)($.Modal.Action,{onClick:a,type:"secondary",children:"Cancel"}),(0,t.jsx)($.Modal.Action,{onClick:()=>i(!1),type:"secondary",children:"Enable Without Skew Protection"}),(0,t.jsx)($.Modal.Action,{onClick:()=>i(!0),children:"Enable Both"})]})]})}var q=e.i(5168763),W=e.i(2533275),Y=e.i(4503244),G=e.i(4896100);function Z(e){let{open:n,onConfirm:i,onCancel:a,teamSlug:l,projectSlugOrId:d,rollingRelease:c}=e,[u,g]=(0,x.useTransition)(),h=(0,o.useToasts)(),p=(0,W.useAbortRollingRelease)(),m=(0,Y.useCompleteRollingRelease)(),{data:f}=(0,E.useProject)(d,G.DEPLOYMENTS_PROJECT_API_PARAMS),[y,b]=(0,x.useState)("none"),v=(0,q.getDashboardHref)(`/${d}/deployments/rolling-release`,l);return(0,t.jsxs)($.Modal.Modal,{active:n,onClickOutside:a,children:[(0,t.jsxs)($.Modal.Body,{children:[(0,t.jsx)($.Modal.Header,{children:(0,t.jsx)($.Modal.Title,{children:"Manage active rolling release"})}),(0,t.jsx)(s.Text,{size:16,children:"You have an active rolling release in progress. Disabling rolling releases will prevent new rollouts but won't affect your current active rollout."}),(0,t.jsx)("br",{}),(0,t.jsxs)(s.Text,{size:14,color:"gray-900",children:["Check the health of your canary deployment on the"," ",(0,t.jsx)(j.Link,{href:v,prefetch:!0,type:"highlight",className:"inline items-center gap-1",children:"rolling release dashboard"}),"."]})]}),(0,t.jsxs)($.Modal.Actions,{children:[(0,t.jsx)($.Modal.Action,{type:"secondary",onClick:()=>{i()},disabled:u,children:"Disable"}),(0,t.jsxs)(r.Stack,{direction:"row",gap:2,children:[(0,t.jsx)($.Modal.Action,{type:"tertiary",loading:!!u&&"abort"===y,onClick:()=>{b("abort"),g(async()=>{try{await i(),g(async()=>{try{if(!c||!f?.id)throw Error("Cannot abort rolling release");await p(l,f.id,f.name,c),g(()=>{h.success("Rolling release aborted successfully")})}catch(e){g(()=>{h.error("Failed to abort rolling release. Please try again."),b("none")})}})}catch(e){g(()=>{h.error("Failed to disable rolling releases. Please try again."),b("none")})}})},disabled:u,children:"Abort"}),(0,t.jsx)($.Modal.Action,{type:"secondary",loading:!!u&&"complete"===y,onClick:()=>{b("complete"),g(async()=>{try{await i(),g(async()=>{try{if(!c)throw Error("null rollingRelease");await m(l,d,c),g(()=>{h.success("Rolling release completed successfully")})}catch(e){g(()=>{h.error("Failed to complete rolling release. Please try again."),b("none")})}})}catch(e){g(()=>{h.error("Failed to disable rolling releases. Please try again."),b("none")})}})},disabled:u,children:"Complete Rollout"})]})]})]})}var J=e.i(3514588);e.i(501494);var K=e.i(6339279);let Q="manual-approval",X="automatic",ee="final",et=K.z.number({message:"Percentage must be a number"}).int({message:"Percentage must be an integer"}).min(0,{message:"Percentage must be greater or equal to 0"}).max(100,{message:"Percentage must be less than or equal to 100"}),er=K.z.object({_type:K.z.literal(Q),targetPercentage:et,duration:K.z.null()}),en=K.z.number({message:"Duration must be a number"}).int({message:"Duration must be an integer"}).positive({message:"Duration must be positive"}).max(1e4,{message:"Duration must be less than or equal to 10,000"}),ei=K.z.object({_type:K.z.literal(X),targetPercentage:et,duration:en}),ea=K.z.object({_type:K.z.literal(ee),targetPercentage:K.z.literal(100)}),es=K.z.discriminatedUnion("_type",[er,ei,ea]),el=K.z.array(es).min(2,{message:"At least 2 stages are required"}).max(10,{message:"Maximum of 10 stages allowed"}).superRefine((e,t)=>{let r=e[e.length-1];100!==r.targetPercentage&&t.addIssue({code:K.z.ZodIssueCode.custom,message:"The final stage must have a percentage of 100.",path:[e.length-1,"targetPercentage"]}),Object.keys(r).some(e=>"targetPercentage"!==e&&"_type"!==e)&&t.addIssue({code:K.z.ZodIssueCode.custom,message:"The final stage can only have the percentage.",path:[e.length-1]});let n=new Set;e.forEach((e,r)=>{n.has(e.targetPercentage)?t.addIssue({code:K.z.ZodIssueCode.custom,message:"Each stage must have a unique percentage.",path:[r,"targetPercentage"]}):n.add(e.targetPercentage)});for(let r=1;r<e.length;r++)e[r].targetPercentage<e[r-1].targetPercentage&&t.addIssue({code:K.z.ZodIssueCode.custom,message:"Each stage must have a higher percentage than the previous stage.",path:[r,"targetPercentage"]})}),eo=K.z.object({enabled:K.z.boolean().describe("Whether rolling releases should be enabled"),stages:el.describe("The stages of a deployment rollout."),advancementType:K.z.enum([Q,X]).describe("The type of advancement for the stages."),canaryResponseHeader:K.z.boolean().optional().describe("Whether the request served by a canary deployment should return a header indicating a canary was served."),skewProtection:K.z.boolean().optional().describe("Whether skew protection is enabled.").default(!0)});function ed(e){let{control:n,index:a,advancementType:s}=e;return(0,t.jsx)(k.Controller,{control:n,name:`stages.${a}`,render:e=>{let{field:n,fieldState:a}=e,{value:o}=n;if("final"===o._type)return(0,t.jsx)("div",{});let d=a.error,c=!!(s!==X&&!d?.duration?.message);return(0,t.jsx)(r.Stack,{direction:"column",align:"center",gap:2,children:(0,t.jsx)(l.Tooltip,{position:"right",disableTriggers:c,text:d?.duration?.message,sticky:!1,desktopOnly:!0,children:(0,t.jsx)(i.Input,{"aria-labelledby":"rolling-release-promotion-time",placeholder:"-",suffix:"min",disabled:s!==X,error:d?.duration?.message,showErrorMessage:!1,className:"w-[64px]",size:"small",onChange:e=>{let t=e.target.value;if(""===t)return n.onChange({...o,duration:null});let r=Number.parseInt(t,10);if(Number.isFinite(r))return n.onChange({...o,_type:X,duration:r})},maxLength:3,minLength:1,value:o.duration?.toString()??"",required:s===X,typeName:"text"})})})}})}var ec=e.i(5249128);function eu(e){let{control:n}=e,{fields:i,replace:a}=(0,k.useFieldArray)({control:n,name:"stages"});return(0,t.jsx)(k.Controller,{control:n,name:"advancementType",render:e=>{let{field:n}=e;return(0,t.jsxs)(r.Stack,{gap:2,direction:"row",align:"center",children:[(0,t.jsx)(s.Text,{children:"Promote to the next stage"}),(0,t.jsx)(ec.RadioGroup,{onChange:e=>{n.onChange(e),a(i.map(t=>"final"===t._type?t:e===Q?{_type:Q,targetPercentage:t.targetPercentage,duration:null}:{_type:X,targetPercentage:t.targetPercentage,duration:5}))},value:n.value,children:(0,t.jsxs)(r.Stack,{direction:"row",gap:2,align:"center",children:[(0,t.jsx)(ec.RadioGroup.Item,{className:"items-center",value:Q,children:(0,t.jsx)(s.Text,{weight:500,children:"Manually"})}),(0,t.jsx)(ec.RadioGroup.Item,{className:"items-center",value:X,children:(0,t.jsx)(r.Stack,{direction:"row",align:"center",gap:2,children:(0,t.jsx)(s.Text,{weight:500,children:"Automatically"})})})]})})]})}})}var eg=e.i(8328767),eh=e.i(3521787),ep=e.i(1654051);function em(e,t){let{teamIdOrSlug:r,projectSlug:n}=e;return(0,eh.default)(()=>(0,ep.getRollingReleaseBillingEndpoint)(r,n),ep.rollingReleaseBillingFetcher,t)}let ef=e=>{if(!e)return!1;let{availableSlots:t}=e;return"unlimited"===t||t>0};var ex=e.i(8158100),ej=e.i(6366707);function ey(e){let{teamSlug:r,projectSlug:n}=e,{data:i}=em({teamIdOrSlug:r,projectSlug:n});if(!i)return null;let{reason:a,message:s}=i;switch(a){case"plan_not_supported":return(0,t.jsx)(ex.Note,{type:"warning",children:s});case"no_available_slots":{let{enabledProjects:e}=i;if(e.includes(n))return null;let a=RegExp(`(${e.join("|")})`,"g"),l=s.split(a);return(0,t.jsx)(ex.Note,{children:l.map((n,i)=>e.includes(n)?(0,t.jsx)(j.Link,{href:(0,ej.getRollingReleaseSettingsEndpoint)({teamSlug:r,projectSlug:n}),type:"highlight",children:n},`${n}-${i+1}`):n)})}default:return null}}let eb={enabled:!1,advancementType:Q,stages:[{_type:Q,targetPercentage:10,duration:null},{_type:ee,targetPercentage:100}],skewProtection:!0,canaryResponseHeader:!1};function ev(e){var S;let{teamSlug:B,projectSlugOrId:z}=e,{can:A}=(0,O.default)(void 0,{revalidateOnFocus:!1}),F=A(I.Action.Update,I.Resource.ProjectRollingRelease),{team:$}=(0,J.useTeam)(),{data:V,mutate:H}=(0,E.useProject)(z,{apiVersion:"v9"}),{data:q}=em({teamIdOrSlug:B,projectSlug:z}),W=(0,x.useMemo)(()=>{if(!V?.rollingRelease?.stages)return eb;let e=V.rollingRelease.stages.some(e=>e.duration)?X:Q;return e===X&&V.rollingRelease.stages.filter(e=>100!==e.targetPercentage&&e.duration).reduce((e,t)=>{let{duration:r}=t;return r&&(e[r]=(e[r]||0)+1),e},{}),{enabled:!0,advancementType:e,stages:V.rollingRelease.stages.map(e=>{let{targetPercentage:t,duration:r}=e;return 100===t?{_type:ee,targetPercentage:100}:r?{_type:X,targetPercentage:t,duration:r}:{_type:Q,targetPercentage:t,duration:null}}),skewProtection:!!V.skewProtectionMaxAge,canaryResponseHeader:V.rollingRelease.canaryResponseHeader}},[V]),{control:Y,handleSubmit:G,formState:{isDirty:K,isSubmitting:et,errors:er},reset:en,getValues:ei}=(0,k.useForm)({values:W,resolver:(void 0===S&&(S={}),function(e,t,r){try{return Promise.resolve(function(t,n){try{var i=Promise.resolve(eo["sync"===S.mode?"parse":"parseAsync"](e,void 0)).then(function(t){return r.shouldUseNativeValidation&&P({},r),{errors:{},values:S.rawValues?e:t}})}catch(e){return n(e)}return i&&i.then?i.then(void 0,n):i}(0,function(e){return{values:{},errors:e.isEmpty?{}:T(C(e.errors,!r.shouldUseNativeValidation&&"all"===r.criteriaMode),r)}}))}catch(e){return Promise.reject(e)}})}),{fields:ea,insert:es,remove:el}=(0,k.useFieldArray)({control:Y,name:"stages"}),{trigger:ec}=function(e,t){let r=`${(0,N.API_PROJECTS_ROLLING_RELEASE)(t)}/config?slug=${e}`;return(0,M.default)(r,async(e,t)=>{let{arg:{enabled:n,stages:i,advancementType:a,canaryResponseHeader:s,skewProtection:l}}=t;return(0,D.fetchAPI)(r,{method:"PATCH",body:JSON.stringify({enabled:n,advancementType:a,stages:i,canaryResponseHeader:s,skewProtection:l}),throwOnHTTPError:!0})})}(B,z),[eh,ep]=(0,x.useState)(!1),[ex,ej]=(0,x.useState)(!1),ev=(0,x.useRef)(null),{data:ew,isLoading:ek}=(0,eg.useRollingRelease)({teamIdOrSlug:B,projectSlug:z}),eS=ew?.rollingRelease?.state==="ACTIVE",eP=!F||et,eT=(0,k.useWatch)({control:Y,name:"enabled"}),eC=async e=>{let{enabled:t,advancementType:r,stages:n,skewProtection:i}=e;try{let e=t?n.map(e=>e._type===ee||e._type===Q?{targetPercentage:e.targetPercentage}:{targetPercentage:e.targetPercentage,duration:e.duration}):void 0;await ec({enabled:t,advancementType:r,stages:e,skewProtection:i,canaryResponseHeader:V?.rollingRelease?.canaryResponseHeader}),o.toasts.success("Rolling release settings saved successfully."),await H(),t||en({enabled:!1,stages:eb.stages},{keepDirty:!1})}catch(e){(0,c.isError)(e)&&"CustomFetchError"===e.name?o.toasts.error(e.message):o.toasts.error("Failed to save rolling release settings. Please try again."),(0,R.captureException)(e,{attributes:{teamSlug:B,projectSlugOrId:z,envIdOrSlug:w.EnvTarget.Production}})}},eR=async e=>{if(!q)return void o.toasts.error("Unknown rolling release billing status.");let t=W.enabled,{enabled:r}=e;if(t&&!r&&eS){ev.current=e,ej(!0);return}if(!t&&r){if(!ef(q))return void o.toasts.error(q.message);if(!V?.skewProtectionMaxAge){ev.current=e,ep(!0);return}}return eC(e)},eM=(0,k.useWatch)({control:Y,name:"advancementType"}),eD=eM===X,eN=$?.billing?.plan==="hobby";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("form",{onSubmit:(0,_.promiseToCallback)(G(eR)),id:`${"rolling releases".replaceAll(" ","-")}`,children:(0,t.jsxs)(g.Fieldset,{disabled:!F||et,"data-testid":(0,L.tid)("project-settings","Rolling Releases"),children:[(0,t.jsxs)(h.FieldsetContent,{disabled:eN,children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(m.FieldsetTitle,{children:(0,t.jsx)("a",{href:`#${"rolling releases".replaceAll(" ","-")}`,style:{color:"inherit",textDecoration:"none"},children:(0,t.jsx)(u.SearchContextHighlighter,{children:"Rolling Releases"})})})}),(0,t.jsx)(f.FieldsetSubtitle,{children:"Configure rolling release settings for your production environment. Rolling releases allow you to gradually deploy changes to users by defining a percentage of traffic for each stage. Moving to each stage requires manual approval."}),(0,t.jsxs)(r.Stack,{gap:4,className:"mt-4",children:[(0,t.jsx)(ey,{teamSlug:B,projectSlug:z}),(0,t.jsx)(k.Controller,{control:Y,name:"enabled",render:e=>{let{field:{onChange:r,value:i,name:a}}=e;return(0,t.jsx)(n.Toggle,{checked:!!i,name:a,className:"flex w-full justify-end p-0",direction:"switch-first",id:"rolling-release-toggle",disabled:!eT&&!ef(q),onChange:e=>{r(e),e&&en({...eb,enabled:!0},{keepDefaultValues:!0,keepDirty:!0,keepTouched:!0,keepIsValid:!0})},size:"large",children:(0,t.jsx)("span",{className:"text-sm font-medium text-gray-1000",children:i?"Enabled":"Disabled"})})}}),eT?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)(s.Text,{size:18,weight:500,children:"Stages"}),(0,t.jsx)(s.Text,{color:"gray-900",size:14,children:"Define the percentage of traffic for each stage."}),(0,t.jsxs)(r.Stack,{direction:"row",gap:2,className:"justify-between",children:[(0,t.jsx)(eu,{control:Y}),(0,t.jsx)(l.Tooltip,{disableTriggers:ea.length<10,text:"Maximum of 10 stages allowed",children:(0,t.jsx)(a.Button,{disabled:ea.length>=10||eP,onClick:()=>{let[e,t]=ei(["stages","advancementType"]);if(e.length>=10)return void o.toasts.error("Maximum of 10 stages allowed");let r=0;if(e.length>0){let t=Math.max(0,...e.filter(e=>100!==e.targetPercentage).map(e=>e.targetPercentage||0)),n=25;t+25>=100&&(n=Math.max(1,Math.floor(25/Math.ceil(25/(100-t))))),r=Math.min(t+n,99)}t===X?es(e.length-1,{_type:X,targetPercentage:r,duration:5}):es(e.length-1,{_type:Q,targetPercentage:r,duration:null})},prefix:(0,t.jsx)(y.Plus,{size:16}),size:"small",type:"secondary",typeName:"button",children:"Add Stage"})})]})]}),(0,t.jsx)("div",{className:`grid ${eD?"grid-cols-[auto_1fr_auto_auto_auto]":"grid-cols-[auto_1fr_auto]"} items-center gap-3 overflow-x-auto p-1`,children:ea.flatMap((e,r)=>{let n=r===ea.length-1,s=1===ea.length,c="The final stage must be set to 100%",u=(0,t.jsx)(k.Controller,{control:Y,name:`stages.${r}.targetPercentage`,render:e=>{let{field:{onChange:a,value:s},fieldState:{error:o}}=e,d=!n&&!o?.message,u=n?c:o?.message;return(0,t.jsx)(l.Tooltip,{desktopOnly:!0,disableTriggers:d,text:u,children:(0,t.jsx)(i.Input,{"aria-label":`Stage ${r+1}`,disabled:eP||n,id:`stage-${r}`,error:o?.message,showErrorMessage:!1,max:100,min:0,size:"small",className:"w-[64px]",onChange:e=>{let t=e.target.value;if(""===t)return void a(0);let r=Number.parseInt(t,10);Number.isFinite(r)&&r>=0&&r<=100&&a(r)},suffix:"%",value:s.toString()})})}},`${e.id}_percentageInput`),g=(0,t.jsx)(k.Controller,{control:Y,name:`stages.${r}.targetPercentage`,render:e=>{let{field:{onChange:r,value:i}}=e;return(0,t.jsx)(l.Tooltip,{disableTriggers:!n,text:c,desktopOnly:!0,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(d.Slider,{disabled:eP||n,fullWidth:!0,max:99,min:0,onValueChange:e=>r(e[0]),step:5,value:[i]})})})}},`${e.id}_slider`),h=(0,t.jsx)(ed,{control:Y,advancementType:eM,index:r},`${e.id}_stageDuration`),p=(0,t.jsx)("div",{...n?{}:{className:"h-6 w-px bg-gray-400 "}},`${e.id}_divider`);return[u,g,...eD?[h,p]:[],n?(0,t.jsx)(l.Tooltip,{text:c,desktopOnly:!0,children:(0,t.jsx)(a.Button,{disabled:!0,shape:"square",size:"small",type:"secondary",typeName:"button",children:(0,t.jsx)(v.LockClosed,{size:16})})},`${e.id}_removeButton`):(0,t.jsx)(l.Tooltip,{disableTriggers:!s,text:"At least one stage is required.",children:(0,t.jsx)(a.Button,{disabled:ea.length<=1||eP,onClick:()=>(e=>{if(ea.length<=1)return void o.toasts.error("At least one stage is required");el(e)})(r),shape:"square",size:"small",type:"secondary",typeName:"button",children:(0,t.jsx)(b.Trash,{size:16})})},`${e.id}_removeButton`)]})}),er.stages?.message?(0,t.jsx)(s.Text,{color:"red-900",size:14,children:String(er.stages.message)}):null]})}):null]})]}),(0,t.jsx)(p.FieldsetFooter,{children:(0,t.jsxs)(r.Stack,{align:"center",className:"w-full",direction:"row",justify:"space-between",children:[(0,t.jsx)(s.Text,{color:"gray-900",children:eN?(0,t.jsxs)(t.Fragment,{children:["This feature is available on the"," ",(0,t.jsx)(j.Link,{external:!0,href:"/pricing",tab:!0,type:"highlight",children:"Pro plan"})]}):F?(0,t.jsxs)(t.Fragment,{children:["Learn more about"," ",(0,t.jsx)(j.Link,{external:!0,href:"/docs/rolling-releases",target:"_blank",type:"highlight",children:"Rolling Releases"})]}):(0,t.jsx)(t.Fragment,{children:"You need additional permissions to manage rolling releases."})}),(0,t.jsx)(a.Button,{disabled:eP||!K,loading:et||ek,size:"small",typeName:"submit",children:"Save"})]})})]})}),(0,t.jsx)(U,{open:eh,onConfirm:e=>{ep(!1);let t=ev.current;G(()=>{if(!t)return;let r=eC({...t,skewProtection:e});return ev.current=null,r})()},onCancel:()=>{ep(!1),ev.current=null},teamSlug:B,projectSlugOrId:z,billingPlan:$?.billing?.plan}),(0,t.jsx)(Z,{open:ex,onConfirm:()=>(ej(!1),G(()=>{if(!ev.current)return;let e=eC(ev.current);return ev.current=null,e})()),onCancel:()=>{ej(!1),ev.current=null},teamSlug:B,projectSlugOrId:z,rollingRelease:ew?.rollingRelease})]})}function ew(e){let{variants:r}=e,{project:n,teamSlug:i}=(0,F.useParams)()??{};return r.enableRollingReleases&&"string"==typeof n&&"string"==typeof i?(0,t.jsx)(A.ErrorBoundary,{fallback:(0,t.jsx)(B.EmptyState.Root,{description:"Please try reloading the page.",icon:(0,t.jsx)(B.EmptyState.Icon,{icon:(0,t.jsx)(z.Warning,{size:32})}),title:"Error loading rolling releases configuration"}),children:(0,t.jsx)(ev,{projectSlugOrId:n,teamSlug:i})}):null}}}]);

//# sourceMappingURL=1ceee03c84302639.js.map
//# debugId=29d618fd-7d4b-5bd2-88bc-419c17f84f3e
