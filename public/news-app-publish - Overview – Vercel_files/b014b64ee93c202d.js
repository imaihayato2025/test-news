
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0c614fc1-4527-5fda-aaf3-b090f8fb1a9f")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{7512743:e=>{e.v({button:"index-module__Tv0YBG__button",entity:"index-module__Tv0YBG__entity",inactive:"index-module__Tv0YBG__inactive"})},8940516:e=>{e.v({selected:"v3-module__AIKY9q__selected",static:"v3-module__AIKY9q__static","team-name":"v3-module__AIKY9q__team-name"})},6068086:e=>{e.v({borderBottom:"index-module__pVy5Ya__borderBottom","credit-card-card":"index-module__pVy5Ya__credit-card-card"})},953745:e=>{"use strict";e.s({UpgradeModalLoadingLayer:()=>tT},953745);var t=e.i(6645307),a=e.i(3821772),r=e.i(889716),i=e.i(8084653),n=e.i(8934201),l=e.i(6530772),s=e.i(540570),o=e.i(9910730),d=e.i(2633881),c=e.i(1164214),u=e.i(7315479),m=e.i(674684),p=e.i(503726),g=e.i(3494272),h=e.i(7150089),x=e.i(8404486),b=e.i(5943386);function f(){let{enabled:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enabled:!0},{data:t,isLoading:a,mutate:r}=(0,x.useProjectCount)(void 0,{isPaused:()=>!e}),i=t?.limit??1/0,n=t?.count??0,{isTeam:s=!1,account:o}=(0,p.useAccount)(),d=(0,b.useIsOnProTrial)(),c=(0,l.useMemo)(()=>{if(!s)return{current:"Hobby",next:"Pro"};switch(o?.billing?.plan){case"hobby":return{current:"Hobby",next:"Pro"};case"pro":if(d)return{current:"Pro Trial",next:"Pro"};return{current:"Pro",next:"Enterprise"};default:return{current:"Enterprise",next:"Enterprise"}}},[o?.billing?.plan,s,d]);return{isLoading:a,count:n,limit:i,remaining:i-n,isReached:!!(!a&&t?.reachedLimit),plan:c,mutate:r}}var y=e.i(5228306),v=e.i(277464),j=e.i(8347675);let w={hobby:"Hobby","pro-trial":"Pro Trial",pro:"Pro"},S={slug:"hobby",title:w.hobby,description:"Start for free"},C={slug:"pro-trial",title:w["pro-trial"],description:"Free for two weeks"},T={slug:"pro",title:w.pro,description:"Get started now"},k={slug:"pro",title:w.pro,description:"Upgrade your Pro Trial"};var I=e.i(5785123),M=e.i(5018995);function N(e){return!!(e.permissions?.paymentMethod?.includes(I.Action.Update)&&e.permissions.team?.includes(I.Action.Update)&&(0,M.teamIsUpgradeable)(e,{skipIntendsToGoProCheck:!0}))}function P(e){let{team:t,teamHint:a}=e;return!!a&&(a.startsWith("team_")?t.id===a:t.slug===a)}function E(e){let{eligibleTeams:t,teamHint:a,teamIdInScope:r}=e,i=t.find(e=>P({team:e,teamHint:a}));if(i)return i;let n=t.find(e=>e.id===r);if(n)return n;let l=t.find(e=>e.billing?.plan==="hobby");return l||t.at(0)}e.i(156456);var A=e.i(9371812),B=e.i(584439),_=e.i(2068621),D=e.i(5175803),O=e.i(3921802),R=e.i(5674541),F=e.i(7569501),U=e.i(1183506),L=e.i(9336536),$=e.i(480322),q=e.i(7495104),z=e.i(6434038),H=e.i(4383604),G=e.i(726129),V=e.i(5209793),Y=e.i(2240289),W=e.i(1667102),K=e.i(5599793);e.i(1508568);var Q=e.i(6589588),J=e.i(1795525);let X=(0,l.createContext)(null);X.displayName="UpgradeModalContext";let Z=()=>(0,l.useContext)(X);var ee=e.i(5119671);function et(e){let{user:c,source:u,submissionQueue:m,deferredToasts:p,progressContextRef:g,openTimeRef:h,skipTransferModalOnTeamCreate:x,teamInScope:b,router:f,skipRedirect:y,planSelector:v,mode:j,onAbandon:w,onConversionSuccess:S}=e,{goto:C,isNewDesign:T}=Z(),k=(0,s.useCloseUpgradeModal)(),I=(0,J.useOpenTransferModal)(),M=(0,o.useUpgradeModalArgs)(e=>e.teamHint);return((0,l.useEffect)(()=>{if(m.error)return void C.step(m.error.stepName);if(m.idle){let e=performance.now()-h.current;if(g.current.conversionDetails){let{type:t,team:a,priorPlan:r,newPlan:i,desiredTrialBehavior:n,actualTrialBehavior:l,cartTotal:s,existingTeamMembers:o,paidAddOns:m}=g.current.conversionDetails,{speedInsights:p,additionalConcurrentBuilds:h,previewDeploymentSuffix:v,passwordProtection:w,monitoring:C}=m??{},{newTeamMembers:T,reactivatedTeamMembers:M}=g.current.additionalTeamMembers??{newTeamMembers:0,reactivatedTeamMembers:0},N=(T+M)*ee.pricingMenu.teamSeats.price;(0,d.trackModalConverted)({mode:j,conversionType:t,source:u,actorId:c.uid,teamId:a.id,teamCreatedAt:a.createdAt,priorPlan:r,newPlan:i,desiredTrialBehavior:n,actualTrialBehavior:l,cartTotal:s+N,timeInModalMs:e,newTeamMembers:T,reactivatedTeamMembers:M,existingTeamMembers:o,speedInsights:p,additionalConcurrentBuilds:h,previewDeploymentSuffix:v,passwordProtection:w,monitoring:C}),S({type:t,team:a}),k(),"create"!==t||x?("upgrade-existing"===t||x)&&!y&&a.slug!==b?.slug&&f.push(`/${a.slug}`):I({team:a,skipScopeUpdate:!0,showSkipButton:!0,source:u})}else(0,d.trackModalAbandoned)({source:u,timeInModalMs:e,desiredTrialBehavior:v.desiredTrialBehavior,mode:j,teamHint:M}),w(!0),k();p.flush()}},[k,p,C,j,w,S,h,I,v.desiredTrialBehavior,g,f,y,x,u,m,M,b?.slug,c.uid]),T)?(0,t.jsxs)("div",{className:"flex flex-1 flex-row gap-4 items-center justify-center",children:[(0,t.jsx)(a.Spinner,{}),(0,t.jsx)(i.Text,{children:"Finishing your upgrade..."})]}):(0,t.jsx)(n.Modal.Inset,{last:!0,children:(0,t.jsxs)(r.Stack,{align:"center",gap:4,justify:"center",style:{minHeight:"288px"},children:[(0,t.jsx)(a.Spinner,{}),(0,t.jsx)(i.Text,{children:"Finishing your upgrade..."})]})})}var ea=e.i(1917237),er=e.i(7766186),ei=e.i(9802771),en=e.i(7573892),el=e.i(6494827),es=e.i(5617834),eo=e.i(6649026);async function ed(e){let{teamId:t}=e;try{return await (0,U.fetchAPI)(`${L.API_TEAMS_MEMBERS}/${t}/members/reactivate${(0,eo.encode)({teamId:t})}`,{method:"GET"})}catch(e){console.error(e)}}async function ec(e){let{teamId:t,userIds:a}=e;return(0,U.fetchAPI)(`${L.API_TEAMS_MEMBERS}/${t}/members/reactivate${(0,eo.encode)({teamId:t})}`,{method:"POST",body:JSON.stringify({userIds:a}),throwOnHTTPError:!0})}var eu=e.i(6325202),em=e.i(5610210),ep=e.i(6960707),eg=e.i(1209519),eh=e.i(7337588),ex=e.i(2145411),eb=e.i(3604170),ef=e.i(7512743);function ey(e){let{membersFromBeforeDowngrade:a,toggleMember:i,currency:n}=e,s=(0,l.useCallback)(e=>{if(e)return e.toLowerCase().replace(/^\w/,e=>e.toUpperCase())},[]);return(0,t.jsx)(r.Stack,{gap:4,children:(0,t.jsx)(r.Stack,{children:a.map(e=>{let a=e.selected;return(0,t.jsxs)(eh.Entity,{actions:(0,t.jsx)(ev,{active:a,onClick:()=>i(e.id)}),"aria-selected":a,className:(0,em.clsx)(ef.default.entity,{[ef.default.inactive]:!a}),thumbnail:(0,t.jsx)(eb.EntityThumbnail,{size:32,children:(0,t.jsx)(D.Avatar,{size:32,username:e.username})}),children:[(0,t.jsx)(ex.EntityField,{description:e.email,isFirstItem:!0,title:e.username}),(0,t.jsx)(ex.EntityField,{description:a?`${(0,eu.formatCurrency)(2e3,n)} per month`:void 0,right:!0,title:a?s(e.role):void 0})]},e.id)})})})}function ev(e){let{active:a,onClick:r}=e;return(0,t.jsx)(R.Button,{"aria-label":a?"Remove member":"Add member",className:ef.default.button,onClick:r,svgOnly:!0,title:a?"Remove member":"Add member",typeName:"button",variant:"unstyled",children:a?(0,t.jsx)(ep.MinusCircle,{align:"middle"}):(0,t.jsx)(eg.PlusCircle,{align:"middle"})})}var ej=e.i(9572024),ew=e.i(6921100),eS=e.i(631755),eC=e.i(6236262);function eT(e){let{teamMembers:a,setTeamMembers:i,defaultRole:n,enabledRoles:s}=e;return(0,l.useEffect)(()=>{0===a.length&&i([{email:"",role:n}])},[]),(0,t.jsxs)(r.Stack,{gap:4,children:[(0,t.jsx)(r.Stack,{className:"-m-2 max-h-[40vh] overflow-y-auto p-2",gap:4,children:a.map((e,r)=>(0,t.jsxs)("div",{className:"grid grid-cols-[1fr_max-content_min-content] gap-2",children:[(0,t.jsx)("div",{children:(0,t.jsx)(eS.Input,{"aria-label":"Team member email",maxLength:320,onBlur:()=>{i((0,eC.default)(a,t=>{t[r].error=(e=>{let t=e.email.trim();if(""!==t&&!(0,ej.default)(t))return"Email is invalid"})(e)}))},onChange:e=>{i((0,eC.default)(a,t=>{t[r].email=e.target.value}))},placeholder:"tom.holdplacen@gmail.com",type:e.error?"error":"default",typeName:"email",value:e.email})}),(0,t.jsx)(ew.Select,{onChange:e=>{e.preventDefault(),i((0,eC.default)(a,t=>{t[r].role=e.target.value}))},value:e.role,children:s.map(e=>(0,t.jsx)("option",{value:e.role,children:e.label},e.role))}),(0,t.jsx)(R.Button,{"aria-label":"Remove team member",onClick:()=>{i([...a.slice(0,r),...a.slice(r+1)])},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(ep.MinusCircle,{})})]},r))}),(0,t.jsx)(R.Button,{className:"self-start",onClick:()=>{i([...a,{email:"",role:n}])},prefix:(0,t.jsx)(eg.PlusCircle,{}),type:"secondary",typeName:"button",children:"Add Member"})]})}function ek(e){let{children:a,cancelButton:r,continueButton:i,skipButton:n,contained:s,title:o}=e,[d,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)(!1),{goto:{next:p},backOrCancel:g,title:h,subtitle:x,defaultCancelText:b,defaultContinueText:f,close:y,isNewDesign:v}=Z(),j=async()=>{c(!0),r?.onClick?await r.onClick():await g(y),c(!1)},w=async()=>{m(!0),n?.onClick&&await n.onClick(),m(!1)},S=async e=>{c(!0),i?.onClick?await i.onClick(e):p(),c(!1)};return(0,t.jsx)("form",{className:v?"w-full h-fit":void 0,onSubmit:e=>{e.preventDefault(),S(new FormData(e.currentTarget))},children:(0,t.jsx)(v?eI:eM,{title:o??h,subtitle:x,defaultCancelText:b,defaultContinueText:f,cancelButton:r,continueButton:i,skipButton:n,loading:d,skipping:u,onCancel:j,onSkip:w,contained:s,children:a})})}function eI(e){let{title:a,subtitle:r,defaultCancelText:i,defaultContinueText:n,cancelButton:l,continueButton:s,skipButton:o,loading:d=!1,skipping:u=!1,onCancel:m,onSkip:p,children:g,contained:h}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-6 items-center",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)("span",{className:"text-label-20 w-fit font-medium",children:a}),r?(0,t.jsx)("span",{className:"text-copy-16 w-fit",children:r}):null]}),(0,t.jsx)("div",{className:h?"bg-background-200 p-4 w-full rounded-sm border border-solid border-gray-alpha-400":"w-full",children:g}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 w-full",children:[(0,t.jsx)(R.Button,{typeName:"submit","data-testid":(0,c.tid)("upgrade-modal","save-button"),disabled:s?.disabled,loading:d,children:s?.text??n}),o?(0,t.jsx)(R.Button,{typeName:"button","data-testid":(0,c.tid)("upgrade-modal","skip-button"),disabled:o.disabled,loading:u,onClick:p,type:"tertiary",children:o.text??"Add Later"}):null,(0,t.jsx)(R.Button,{disabled:l?.disabled,onClick:()=>void m(),type:o?"secondary":"tertiary",children:l?.text??i})]})]})}function eM(e){let{title:a,subtitle:l,defaultCancelText:s,defaultContinueText:o,cancelButton:d,continueButton:u,skipButton:m,loading:p=!1,skipping:g=!1,onCancel:h,onSkip:x,children:b}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Modal.Body,{children:[(0,t.jsx)(n.Modal.Header,{children:(0,t.jsx)(n.Modal.Title,{children:a})}),l?(0,t.jsx)(i.Text,{color:"gray-800",size:14,children:l}):null,b]}),(0,t.jsxs)(n.Modal.Actions,{children:[(0,t.jsx)(n.Modal.Action,{disabled:d?.disabled,onClick:()=>void h(),type:"secondary",children:d?.text??s}),(0,t.jsxs)(r.Stack,{direction:"row",children:[m?(0,t.jsx)(n.Modal.Action,{buttonType:"button","data-testid":(0,c.tid)("upgrade-modal","skip-button"),disabled:m.disabled,loading:g,onClick:x,type:"secondary",children:m.text??"Add Later"}):null,(0,t.jsx)(n.Modal.Action,{buttonType:"submit","data-testid":(0,c.tid)("upgrade-modal","save-button"),disabled:u?.disabled,loading:p,children:u?.text??o})]})]})]})}function eN(e,t){let[a,r]=(0,l.useState)(void 0);return(0,l.useEffect)(()=>{t.error&&t.error.stepName===e&&(r(t.error),t.clearError())},[e,t]),a}let eP=async e=>{let t=await ed({teamId:e});return!t||"error"in t?[]:Object.keys(t).map(e=>({id:e,role:t[e].role,email:t[e].email,username:t[e].username,selected:!0}))};function eE(e){let{text:a}=e;return(0,t.jsxs)(i.Text,{color:"gray-900",children:[(0,t.jsx)(i.Text,{as:"span",color:"gray-1000",weight:600,children:a})," ","(Optional)"]})}function eA(e){let{user:a,team:n,submissionQueue:s,deferredToasts:o,progressContextRef:d}=e,{isNewDesign:c,goto:{next:u},close:m}=Z(),p=(0,el.usePrevious)(n),g=(0,er.useRouter)(),[h,x]=(0,l.useState)(void 0),b=eN("team-members",s),[f,y]=(0,l.useState)([]),[v,j]=(0,l.useState)([]),{teamRoles:w}=(0,es.useAvailableRolesInfo)(),S=(0,l.useMemo)(()=>w.find(e=>"VIEWER"===e.role)?"VIEWER":w.find(e=>"DEVELOPER"===e.role)?"DEVELOPER":"MEMBER",[w]),C=f.length>0;(0,l.useEffect)(()=>{n&&(p!==n||!C)&&eP(n.id).then(e=>{y(e)}).catch(console.error)},[C,y,n]);let T=(0,l.useCallback)(e=>{y(f.map(t=>t.id===e?{...t,selected:!t.selected}:t))},[y,f]),k=(0,l.useMemo)(()=>f.filter(e=>e.selected&&e.id!==a.uid).map(e=>({uid:e.id,role:e.role})),[f,a.uid]),I=(0,l.useCallback)(async()=>{if(!n||0===k.length)return;let e=await ec({teamId:n.id,userIds:k});if(en.analytics.track(ei.AnalyticsEvent.TEAM_MEMBERS_REACTIVATED,{reactivatedCount:k.length,notReactivatedCount:f.length-k.length}),void 0===e||"error"in e)throw Error("There was a problem reactivating team members.")},[k,n,f.length]),M=(0,l.useMemo)(()=>v.filter(e=>e.email&&e.email!==a.email),[v,a.email]),N=(0,l.useCallback)(e=>{let t=e??n?.id;if(t)return Promise.all(M.map(e=>(0,U.fetchAPI)(`${L.API_TEAMS_MEMBERS}/${t}/members`,{method:"POST",body:JSON.stringify({email:e.email,role:e.role}),throwOnHTTPError:!0})))},[M,n?.id]),P=(0,l.useCallback)(()=>{if(v.some(e=>e.error))return void x("There was a problem with one or more of your team members.");x(void 0),s.enqueue({stepName:"team-members",work:()=>Promise.all([N(d.current.conversionDetails?.team.id),I()]).then(()=>{d.current.additionalTeamMembers={newTeamMembers:M.length,reactivatedTeamMembers:k.length};let e=M.length+k.length;if(0===e)return;let a=1===e;o.push({text:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Text,{as:"span",weight:700,children:[`${e}`," "]}),"team ",a?"member":"members"," ",a?"has":"have"," ","been added to your team."]})})}).catch(()=>{o.push({text:"There was a problem with your team members. Please visit team settings to check on them.",action:"Go to Settings",onAction:()=>{g?.replace(`/${d.current.conversionDetails?.team.slug??n?.slug}/~/settings/members`)},cancelAction:"Dismiss",preserve:!0})})}),u()},[o,M.length,v,u,d,I,k.length,g,N,s,n?.slug]),E=c?l.Fragment:eB;return(0,t.jsx)(ek,{contained:c,cancelButton:{onClick:m,text:"Close"},continueButton:{onClick:P,text:M.length>0||k.length>0?`Add Collaborators (${(0,eu.formatCurrency)((M.length+k.length)*ee.pricingMenu.teamSeats.price,n?.billing?.currency??"USD")})`:"Skip"},children:(0,t.jsx)(E,{children:(0,t.jsx)(r.Stack,{gap:6,children:(0,t.jsxs)(r.Stack,{gap:6,children:[(0,t.jsx)(eE,{text:"Add Team Members"}),(0,t.jsx)(eT,{defaultRole:S,enabledRoles:w,setTeamMembers:e=>{let t=!1;for(let a of e)if(void 0!==a.error){x(a.error),t=!0;break}t||x(void 0),j(e)},teamMembers:v}),C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eE,{text:"Reactivate Team Members"}),(0,t.jsx)(ey,{currency:n?.billing?.currency??"USD",membersFromBeforeDowngrade:f,toggleMember:T})]}):null,h?(0,t.jsx)(ea.Error,{children:h}):null,b?(0,t.jsx)(ea.Error,{children:b.message}):null]})})})})}function eB(e){let{children:a}=e;return(0,t.jsx)(n.Modal.Inset,{last:!0,children:a})}var e_=e.i(4519408),eD=e.i(8158100),eO=e.i(6893835),eR=e.i(2362802),eF=e.i(9948746),eU=e.i(3621043),eL=e.i(5165976),e$=e.i(5973311),eq=e.i(8727559),ez=e.i(3621960);function eH(e){let{user:a,team:r,fallbackToPlan:i=!1}=e,n=r||a;if(!n||!(r?.id||a?.uid))return null;if((0,e$.isAuthenticationRequired)(n))return(0,t.jsx)(eL.LockClosed,{className:"ml-auto",color:"gray-700"});if(n.billing?.plan&&!["pro","hobby","enterprise"].includes(n.billing.plan))return(0,t.jsx)(eq.DefaultBadge,{variant:"red-subtle",children:"Legacy"});let l=(0,ez.getProPlanTeamScopeBadge)(n);return void 0!==l?l:n.billing?.status==="overdue"?(0,t.jsx)(eq.DefaultBadge,{variant:"red-subtle",children:"Overdue"}):n.softBlock?(0,t.jsx)(eq.DefaultBadge,{variant:"red-subtle",children:"Paused"}):i?(0,t.jsx)(eq.PlanBadge,{team:r,user:a}):null}var eG=e.i(8940516);let eV="create-team-sentinel",eY=["hobby","pro","enterprise"];function eW(e){let{eligibleTeams:a,ineligibleTeams:i,teamManager:n,error:s,disabled:o=!1}=e,d=(0,l.useMemo)(()=>eK(a),[a]),c=(0,l.useMemo)(()=>eK(i),[i]),u="upgrade-existing"===n.userIntent?n.team:void 0;return o&&u?(0,t.jsxs)(r.Stack,{align:"center",className:eG.default.static,direction:"row",gap:2,children:[(0,t.jsx)(D.Avatar,{size:24,teamId:u.id}),(0,t.jsx)("span",{children:u.name}),(0,t.jsx)(eH,{fallbackToPlan:!0,team:u})]}):(0,t.jsxs)(eU.Combobox,{"aria-label":"Select an eligible team",clearable:!1,errored:!!s,onChange:e=>{e===eV?n.setUserIntent("create"):n.setUserIntent("upgrade-existing",a.find(t=>t.id===e))},placeholder:"Select an eligible team",prefixIcon:u?(0,t.jsx)(D.Avatar,{size:16,teamId:u.id}):null,value:"create"===n.userIntent?eV:n.team.name,children:[(0,t.jsx)(eU.Combobox.Input,{}),(0,t.jsxs)(eU.Combobox.List,{avoidCollisions:!1,children:[(0,t.jsx)(t.Fragment,{children:eY.map(e=>{let a=d.get(e);return a?(0,t.jsx)(l.Fragment,{children:a.map(e=>(0,t.jsxs)(eU.Combobox.Option,{className:(0,em.clsx)({[eG.default.selected]:e.id===u?.id}),prefix:(0,t.jsx)(D.Avatar,{size:16,teamId:e.id}),suffix:e.id===u?.id?(0,t.jsx)(eF.Check,{className:"ml-auto"}):null,value:e.id,children:[(0,t.jsx)("span",{className:eG.default["team-name"],children:e.name}),(0,t.jsx)(eH,{fallbackToPlan:!0,team:e})]},e.id))},e):null})}),(0,t.jsx)(eU.Combobox.Option,{className:(0,em.clsx)({[eG.default.selected]:"create"===n.userIntent}),prefix:(0,t.jsx)(eg.PlusCircle,{size:16}),suffix:"create"===n.userIntent?(0,t.jsx)(eF.Check,{className:"ml-auto"}):null,value:eV,children:"Create a team"}),(0,t.jsxs)(t.Fragment,{children:[c.size>0?(0,t.jsx)(eU.Combobox.Option,{disabled:!0,hoverable:!1,selectable:!1,value:"Already Upgraded",children:"Already Upgraded"}):null,eY.map(e=>{let a=c.get(e);return a?(0,t.jsx)(l.Fragment,{children:a.map(e=>(0,t.jsxs)(eU.Combobox.Option,{className:(0,em.clsx)({[eG.default.selected]:e.id===u?.id}),disabled:!0,hoverable:!1,prefix:(0,t.jsx)(D.Avatar,{size:16,teamId:e.id}),suffix:e.id===u?.id?(0,t.jsx)(eF.Check,{className:"ml-auto"}):null,value:e.id,children:[(0,t.jsx)("span",{className:eG.default["team-name"],children:e.name}),(0,t.jsx)(eH,{fallbackToPlan:!0,team:e})]},e.id))},e):null})]})]})]})}function eK(e){let t=new Map;for(let a of e){let e=a.billing?.plan;if(!e)continue;let r=t.get(e);if(!r){t.set(e,[a]);continue}r.push(a)}return t}let eQ="select-team";function eJ(e){let{createTeam:a,upgradeTeam:n,mode:s,eligibleTeams:o,ineligibleTeams:d,planSelector:u,teamManager:m,submissionQueue:p,isScopedSession:g,apologyMessage:h}=e,{goto:x,enabledSteps:b,isNewDesign:f}=Z(),[y,v]=(0,l.useState)(void 0),j=!b.includes("payment-info"),w=(0,l.useMemo)(()=>j&&"upgrade-existing"===m.userIntent?"Upgrade":j?"Create":"Continue",[j,m.userIntent]),S=(0,l.useCallback)(()=>{if("create"===m.userIntent)return(0,eO.validateTeamName)(m.teamName)},[m]),C=eN(eQ,p),T=(0,l.useCallback)(()=>{let e=S();e?v(e):v(void 0)},[S]),k=(0,l.useCallback)(()=>{let e=S();e?v(e):(v(void 0),j&&p.enqueue({stepName:eQ,work:()=>"upgrade-existing"===m.userIntent?n():a()}),x.next())},[a,x,j,p,m.userIntent,n,S]),I=f?l.Fragment:eX;return(0,t.jsx)(ek,{contained:!0,continueButton:{onClick:k,text:w},children:(0,t.jsx)(I,{children:(0,t.jsxs)(r.Stack,{gap:6,children:[h?(0,t.jsx)(eD.Note,{fill:!0,type:"secondary",children:h}):null,(0,t.jsx)(i.Text,{children:"Continue to start collaborating on Pro with increased usage, additional security features, and support."}),"smart"===s?(0,t.jsx)(eW,{disabled:g,eligibleTeams:o,ineligibleTeams:d,teamManager:m}):null,"create"===m.userIntent?(0,t.jsx)(eS.Input,{autoFocus:!0,"data-testid":(0,c.tid)("upgrade-modal","team-name"),error:y,id:"upgrade-modal-team-name",label:"Team Name",maxLength:48,onBlur:T,onChange:e=>m.setTeamName(e.currentTarget.value),onFocus:e=>e.currentTarget.select(),value:m.teamName,width:"100%"}):null,u.showSelector?(0,t.jsx)(e_.ChoiceboxGroup,{direction:"row",label:"Select plan type",onChange:e=>{u.setSelectedPlan(e)},type:"radio",value:u.selectedPlan,children:u.validSelectorOptions.map(e=>(0,t.jsx)(e_.ChoiceboxGroup.Item,{"data-testid":(0,c.tid)("select-plan",e.slug),description:e.description,title:e.title,value:e.slug},e.slug))}):null,"hobby"!==u.selectedPlan?(0,t.jsxs)(r.Stack,{direction:"row",gap:1,children:["pro-trial"===u.selectedPlan?(0,t.jsx)(i.Text,{children:"Continuing will start a 14-day Pro plan trial."}):(0,t.jsx)(i.Text,{children:"Continuing will start a monthly Pro plan subscription."}),(0,t.jsx)(eR.Link,{external:!0,href:"/docs/plans/pro/trials",tab:!0,variant:"highlight",children:(0,t.jsx)(i.Text,{color:"inherit",children:"Learn More"})})]}):null,C?(0,t.jsx)(ea.Error,{children:C.message}):null]})})})}function eX(e){let{children:a}=e;return(0,t.jsx)(n.Modal.Inset,{last:!0,children:a})}var eZ=e.i(9024310),e0=e.i(4789498),e1=e.i(5163670),e4=e.i(974550),e2=e.i(5693066),e5=e.i(7320579),e6=e.i(9358822),e8=e.i(2544606),e3=e.i(5054449),e7=e.i(412544),e9=e.i(5687260),te=e.i(6068086);let tt="payment-info",ta=(0,e4.withStripe)(function(e){let{user:a,teamManager:n,createTeam:s,upgradeTeam:o,forceImmediateUpgrade:d,forceExpandedReceipt:c,addOn:m,submissionQueue:p,source:g}=e,h="upgrade-existing"===n.userIntent?n.team:void 0,{data:x}=(0,K.useMembersForTeam)(h),[b,f]=(0,l.useState)("now"),[v,j]=(0,l.useState)(0),{goto:w,isNewDesign:S}=Z(),[C,T]=(0,l.useState)(!1),k=(0,e3.usePaymentMethodInfo)(h?.id),{submit:I,makeDefaultBillingAddress:M,elements:N,...P}=(0,e4.useBillingForm)(),[E,A]=(0,l.useState)(),B=function(){let{team:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},{data:a}=(0,e6.useSpeedInsightsEnabledProjects)();if(a&&a.projects.length>0&&(t.speedInsights=a.projects),!e)return t;let r=e.billing?.invoiceItems;return r&&(r.concurrentBuilds&&r.concurrentBuilds.quantity>1&&(t.concurrentBuilds=r.concurrentBuilds.quantity-1),r.previewDeploymentSuffix&&r.previewDeploymentSuffix.quantity>0&&(t.previewDeploymentSuffix=e.previewDeploymentSuffix||"vercel.app"),r.passwordProtection&&r.passwordProtection.quantity>0&&(t.passwordProtection=!0),r.monitoring&&r.monitoring.quantity>0&&(t.monitoring=!0)),t}({team:h}),_=eN(tt,p);(0,l.useEffect)(()=>{if(P.error?.sendToSentry){let e=(0,u.normalizeError)(P.error).message,{additionalStripeErrorInfo:t}=P.error;(0,y.trackLifecycleError)({type:"upgrade",error:Error(`Billing form error: ${e}`),attributes:{teamId:h?.id,...t?{stripeErrorType:t.type??"unknown",stripeErrorCode:t.code??"unknown"}:{}}})}},[P.error,h?.id]);let D=(0,l.useCallback)(async e=>{try{let t;if("loading"===k.type)return;T(!0);let a="no-payment-method"!==k.type||M?void 0:(0,e2.validateAddressFormData)(e);if(a instanceof Error){A(a),T(!1);return}if(M&&"no-payment-method"===k.type){if(!N)return void A("Failed to save billing address.");let e=await N.getElement("address")?.getValue(),t=e?.value.address;if(!t)return void A("Failed to save billing address.");a={line1:t.line1,line2:t.line2??void 0,city:t.city,state:t.state,zipCode:t.postal_code,country:t.country.toLowerCase()}}A(void 0);let r=e.get("tax-id-type"),i=e.get("tax-id-value");if("string"==typeof r&&"string"==typeof i&&(t={type:r,value:i}),"create"===n.userIntent){let e=await I({assignCardToEntity:!1,shouldUseTeam:!1})??void 0;if(!e)return;await k.revalidateSources(),p.enqueue({stepName:tt,work:()=>s({paymentMethodId:e,address:a,taxId:t,cartTotal:v}),tracing:{name:"upgrade-modal-create-team",attributes:{paymentMethodId:e},flowType:"create"}}),w.next();return}if("payment-method"===k.type){p.enqueue({stepName:tt,work:()=>o({upgradeTimingOption:b,paymentMethodId:k.paymentMethodId,address:a,taxId:t,cartTotal:v,paidAddOns:B}),tracing:{name:"upgrade-modal-upgrade-team",attributes:{paymentMethodId:k.paymentMethodId,teamId:n.team.id},flowType:"upgrade"}}),w.next();return}let l=await I({assignCardToEntity:!0,shouldUseTeam:!0,teamId:n.team.id});if(!l)return;await k.revalidateSources(),p.enqueue({stepName:tt,work:()=>o({upgradeTimingOption:b,paymentMethodId:l,address:a,taxId:t,cartTotal:v,paidAddOns:B}),tracing:{name:"upgrade-modal-create-team",attributes:{paymentMethodId:l},flowType:"create"}}),w.next()}finally{T(!1)}},[v,s,N,w,M,B,k,p,I,n,o,b]);return(0,t.jsx)(ek,{continueButton:{onClick:D,text:"upgrade-existing"===n.userIntent?"Upgrade":"Create",disabled:"loading"===k.type},children:(0,t.jsxs)(e7.ReceiptAndTiming,{addOnToBeEnabled:"upgrade-existing"===n.userIntent?m:void 0,currency:h?.billing?.currency??"USD",existingTeamMembers:"upgrade-existing"===n.userIntent?x?.members:void 0,forceExpandedReceipt:c,newTeamMembers:"create"===n.userIntent?[{email:a.email,role:"OWNER"}]:[],paidAddOns:"upgrade-existing"===n.userIntent?B:void 0,setGrandTotal:j,source:g,teamManager:n,trial:!!h?.billing?.trial,trialEnd:h?.billing?.trial?.end,upgrade:"upgrade-existing"===n.userIntent?{selectedOption:b,setSelectedOption:f,forceImmediateUpgrade:d}:void 0,isNewDesign:S,children:[(0,t.jsxs)("div",{className:"w-full",children:["loading"===k.type?(0,t.jsx)(tr,{}):null,"no-payment-method"===k.type?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(r.Stack,{gap:5,className:S?"rounded-sm bg-background-200 p-4 border border-gray-alpha-400 border-solid":"",children:[(0,t.jsx)(e4.BillingForm,{breakLine:!0,makeDefaultBillingAddress:M,...P,backgroundClassName:S?void 0:"dark:bg-[#111]"}),M?null:(0,t.jsxs)(r.Stack,{gap:2,children:[(0,t.jsx)(r.Stack,{align:"center",className:te.default.borderBottom,color:"gray-900",direction:"row",children:(0,t.jsx)(i.Text,{weight:700,children:"Team Billing Address"})}),(0,t.jsx)(e9.FullBillingAddressForm,{disabled:C||P.disabled,error:E})]})]})}):null,"payment-method"===k.type?(0,t.jsxs)(r.Stack,{align:"center",className:te.default["credit-card-card"],direction:"row",gap:3,children:[(0,t.jsx)(eZ.CreditCard,{}),(0,t.jsxs)(r.Stack,{children:[(0,t.jsxs)(i.Text,{weight:600,children:[k.cardBrand," ending in"," ",k.cardLast4]}),(0,t.jsxs)(i.Text,{color:"gray-900",children:["exp. ",k.cardExpiry]}),k.userEmail?(0,t.jsx)(i.Text,{color:"gray-900",children:k.userEmail}):null]})]}):null]}),_?(0,t.jsx)(ea.Error,{children:_.message}):null]})})});function tr(){return(0,t.jsxs)(r.Stack,{gap:5,children:[(0,t.jsxs)(r.Stack,{direction:{sm:"column",md:"row"},gap:5,children:[(0,t.jsx)(r.Stack,{flex:"1",children:(0,t.jsx)(e0.Label,{value:"Card Number",children:(0,t.jsx)(e1.Skeleton,{height:40,width:"100%"})})}),(0,t.jsxs)(r.Stack,{direction:"row",gap:5,style:{minWidth:"calc(108px * 2 + var(--stack-gap))"},children:[(0,t.jsx)(r.Stack,{flex:"1",children:(0,t.jsx)(e0.Label,{value:"Expires",children:(0,t.jsx)(e1.Skeleton,{height:40,width:"100%"})})}),(0,t.jsx)(r.Stack,{flex:"1",children:(0,t.jsx)(e0.Label,{value:"CVC",children:(0,t.jsx)(e1.Skeleton,{height:40,width:"100%"})})})]})]}),(0,t.jsx)(r.Stack,{direction:"row",style:{"--small-input-width":"108px"},children:(0,t.jsx)(r.Stack,{flex:"1",children:(0,t.jsx)(e0.Label,{value:"Country",children:(0,t.jsx)(e1.Skeleton,{height:40,width:"100%"})})})})]})}var ti=e.i(4910081),tn=e.i(3979315),tl=e.i(1243142),ts=e.i(5528554),to=e.i(437915),td=e.i(8488604),tc=e.i(4382180),tu=e.i(5795004),tm=e.i(6521564),tp=e.i(8770948),tg=e.i(5366638),th=e.i(9443759),tx=e.i(1157778),tb=e.i(3521787);function tf(e){let{teamSlug:a}=e,r=(0,tb.default)(`/api/usage-summary?teamId=${a}`,e=>(0,U.default)(e,{throwOnHTTPError:!0}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateIfStale:!1}),[i,n]=(0,l.useState)(!1);if(!r.data)return null;let{data:s}=r.data,o=s?.usage&&s.usage.length>4;return s?.type!=="byProject"&&s?.usage?.length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"relative flex flex-col",children:[(0,t.jsx)("div",{className:(0,th.cn)("relative flex flex-col transition-[max-height] duration-200 ease-in-out overflow-hidden border-b border-solid border-gray-alpha-400",i?"max-h-[800px]":"max-h-[128px]"),children:(0,t.jsx)("ul",{className:"m-0 flex flex-col p-0",children:s.usage.map(e=>(0,t.jsx)(tg.SKURow,{className:"[:where(&:nth-child(odd))]:bg-gray-100",item:e,hideGauge:!1,isHobby:!0,isUpgradeHovered:!0},e.id))})}),o?(0,t.jsx)(R.Button,{className:"z-1 absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 max-smd:hidden",svgOnly:!0,"aria-label":"Show More Usage",type:"secondary",shape:"circle",size:"tiny",onClick:()=>n(e=>!e),children:(0,t.jsx)(tx.ChevronDownSmall,{className:(0,th.cn)("transition-transform duration-200 ease-in-out",{"-rotate-180":i})})}):null]}),(0,t.jsx)("p",{className:"text-label-14",children:"In addition to these features…"})]}):null}let ty=[{icon:tl.Analytics,title:"Observability tools"},{icon:td.FirewallFlame,title:"Advanced Vercel Firewall Protection"},{icon:tm.Servers,title:"Faster builds"},{icon:tc.Lightning,title:"Cold start prevention"},{icon:tu.NetworkDevice,title:"Skew Protection"},{icon:to.Dollar,title:"Spend Management"},{icon:tp.Store,title:"…and more",noCheck:!0}];function tv(e){let{teamSlug:a}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-label-14",children:"What's included on Pro"}),a?(0,t.jsx)(tf,{teamSlug:a}):null,(0,t.jsx)("ul",{className:"flex flex-col",children:ty.map(e=>(0,t.jsxs)("li",{className:"flex flex-row h-9 items-center gap-2 rounded-sm [:where(&:nth-child(odd))]:bg-gray-100 p-2",children:[(0,t.jsx)(e.icon,{color:"gray-900"}),(0,t.jsx)("span",{className:"flex-1 text-copy-14 text-gray-1000",children:e.title}),e.noCheck?null:(0,t.jsx)(ts.CheckCircleFill,{color:"blue-900"})]},e.title))})]})}function tj(e){let{user:a,eligibleTeams:r,ineligibleTeams:i,planSelector:n,teamManager:s,forceExpandedReceipt:o,forceImmediateUpgrade:d,mode:c,mutate:u,deferredToasts:m,stepState:x,router:b,progressContextRef:y,source:v,addOn:j,submissionQueue:w,isScopedSession:S,apologyMessage:C,openTimeRef:T,onConversionStart:k,onConversionSuccess:I,onConversionError:M,onAbandon:N,onImpression:P,skipTransferModalOnTeamCreate:E,skipRedirect:A,teamInScope:B,isNewDesign:_}=e,D="upgrade-existing"===s.userIntent?s.team:void 0,O=j?.type==="speedInsights"?j.additionalConfigurations.projectName:void 0,{data:R}=(0,Y.useProject)(O,{},D?.id),J=function(){let{mutate:e}=(0,e5.useSWRConfig)(),{mutate:t}=(0,p.useAccount)(),{mutate:a}=(0,g.useUpcomingUsage)({enabled:!0}),{mutate:r}=(0,h.useStripeSources)({enabled:!0}),{mutate:i}=f({enabled:!0});return(0,l.useCallback)(async n=>{let{teamId:l,projectId:s}=n;await Promise.all([t(),a(),r(),i(),s?e(`${e8.API_SPEED_INSIGHTS_PREFIX}/enabled${(0,eo.encode)({projectId:s,teamId:l})}`):Promise.resolve()])},[e,t,i,r,a])}(),{data:Z}=(0,K.useMembersForTeam)(D),ee=Z?.emailInviteCodes?.length??0,ea=(0,l.useRef)(!1);(0,l.useEffect)(()=>{!ea.current&&P&&(P?.({type:s.userIntent,team:D}),ea.current=!0)},[P,s.userIntent,D]);let er=(0,l.useCallback)(async function(){let{address:e,paymentMethodId:t,taxId:a,cartTotal:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cartTotal:0};if("create"!==s.userIntent)throw Error("Attempted to create a team when the user wanted to upgrade an existing one.");k({type:"create",team:void 0});let{teamName:i}=s;if(!i)throw Error("Team name is required.");let l=!!t,o=(0,F.default)(i),{selectedPlan:d,desiredTrialBehavior:c,actualTrialBehavior:p}=n,g=(0,q.getAttributionForEventStreaming)(),h=await (0,G.createTeam)({name:i,slug:o,source:"upgrade-modal",plan:"hobby"===d?"hobby":"pro",...l?{paymentMethodId:t}:{},bypassTrial:"pro"===d,fixSlugConflict:!0,attribution:g});if("error"in h)throw M({type:"create"}),Error(h.error.message);let x=await (0,U.fetchAPI)(`${L.API_TEAMS_V2}/${h.id}`);if(await u(),e&&(0,z.saveBillingDetails)(x.id,e,a).then(u).catch(()=>{m.push({type:"error",text:"There was a problem saving your billing address. Please visit billing settings to update it.",action:"Go to Settings",onAction:()=>{b.replace(`/${x.slug}/~/settings/billing#billing-address`)},cancelAction:"Dismiss",preserve:!0})}),j&&Q.ADD_ONS[j.type].enableFunction)try{await Q.ADD_ONS[j.type].enableFunction?.({team:x,projectId:R?.id,..."additionalConfigurations"in j?j.additionalConfigurations:{}}),J({projectId:R?.id,teamId:x.id})}catch(e){throw M({type:"create",team:x}),e}if(x.billing?.plan!=="hobby"){let e=(0,H.generateTeamSurveyModalCookie)(x.id);(0,$.setCookie)(e,"1","1d")}y.current.conversionDetails={type:"create",team:x,priorPlan:"hobby",newPlan:d,desiredTrialBehavior:c,actualTrialBehavior:p,cartTotal:r,existingTeamMembers:0}},[s,k,n,u,j,y,M,m,b,R?.id,J]),ei=(0,l.useCallback)(async function(){let e,{upgradeTimingOption:t,address:a,taxId:r,cartTotal:i,paidAddOns:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cartTotal:0};if("upgrade-existing"!==s.userIntent)throw Error("Attempted to upgrade a team when the user wanted to create a new one.");let{team:o}=s;k({type:"upgrade-existing",team:o});let{selectedPlan:d,desiredTrialBehavior:c,actualTrialBehavior:p}=n;if(o.billing?.status==="trialing"&&"now"!==t);else try{await (0,V.changePlan)({source:v,teamId:o.id,to:d})}catch(e){throw M({type:"upgrade-existing",team:o}),e}if(a&&(0,z.saveBillingDetails)(o.id,a,r).then(u).catch(()=>{m.push({text:"There was a problem saving your billing address. Please visit billing settings to update it.",action:"Go to Settings",onAction:()=>{b.replace(`/${o.slug}/~/settings/billing#billing-address`)},cancelAction:"Dismiss",preserve:!0})}),(async()=>{let e=0;do await u(),await new Promise(e=>setTimeout(e,2e3)),e++;while(o.billing?.cancelation&&e<5)})().catch(console.error),e="now"===t?"Your team has been upgraded to Pro":"pro"===d?"Your team will automatically upgrade to Pro at the end of your Trial":"Your Pro Trial has started, and will expire in 14 days",m.push({type:"success",text:e}),j&&Q.ADD_ONS[j.type].enableFunction)try{await Q.ADD_ONS[j.type].enableFunction?.({team:o,projectId:R?.id,..."additionalConfigurations"in j?j.additionalConfigurations:{}}),J({projectId:R?.id,teamId:o.id}),m.push({type:"success",text:`${Q.ADD_ONS[j.type].title} successfully enabled.`})}catch(e){throw M({type:"upgrade-existing",team:o}),e}let g=await (0,U.fetchAPI)(`${L.API_TEAMS_V2}/${o.id}`);y.current.conversionDetails={type:"upgrade-existing",team:g,priorPlan:(o.billing?.plan==="pro"&&"trialing"===o.billing.status?"pro-trial":o.billing?.plan)??"hobby",newPlan:d,desiredTrialBehavior:c,actualTrialBehavior:p,cartTotal:i,existingTeamMembers:ee+(o.billing?.invoiceItems?.teamSeats?.quantity??1)-1,paidAddOns:l?{speedInsights:l.speedInsights?.length||0,additionalConcurrentBuilds:l.concurrentBuilds??0,previewDeploymentSuffix:!!l.previewDeploymentSuffix,passwordProtection:!!l.passwordProtection,monitoring:!!l.monitoring}:void 0}},[s,k,n,m,j,y,ee,v,M,u,b,R?.id,J]);!function(e){let{isScopedSession:t,planSelector:a,stepState:r,submissionQueue:i,upgradeTeam:n}=e,s=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(s.current)return;s.current=!0;let e=new Set;t&&!a.showSelector&&e.add("select-team"),"force-trial"===a.actualTrialBehavior&&e.add("payment-info"),e.forEach(r.disableStep),e.has("select-team")&&e.has("payment-info")&&i.enqueue({stepName:r.step,work:()=>n()}),e.has(r.step)&&r.goto.next()},[])}({isScopedSession:S,planSelector:n,stepState:x,submissionQueue:w,upgradeTeam:ei}),function(e){let{planSelector:t,stepState:a}=e;(0,l.useEffect)(()=>{"pro"===t.selectedPlan?a.enableStep("payment-info"):a.disableStep("payment-info"),"hobby"!==t.selectedPlan?a.enableStep("team-members"):a.disableStep("team-members")},[t.selectedPlan,a])}({stepState:x,planSelector:n});let en=(0,l.useCallback)(()=>{x.goto.step("submitting")},[x.goto]),el=(0,l.useMemo)(()=>({...x,title:x.renderSteps({"*":_?(0,t.jsxs)(tw,{teamManager:s,children:["upgrade-existing"===s.userIntent?(0,t.jsxs)("h1",{className:"text-label-20 font-medium",children:["Upgrade ",(0,t.jsx)("b",{className:"font-semibold",children:s.team.name})," ","to Pro"]}):(0,t.jsxs)("h1",{className:"text-label-20 font-medium",children:["Create"," ",s.teamName?(0,t.jsx)("b",{className:"font-semibold",children:s.teamName}):"a team"]}),(0,t.jsx)("p",{className:"text-copy-16",children:"Unlock collaboration and improved performance with on-demand resources."})]}):(0,W.noOrphan)(`${"create"===s.userIntent?"Create a team":"Upgrade to Pro"}${j?` and ${Q.ADD_ONS[j.type].modalTitle}`:""}`),"team-members":_?(0,t.jsx)(tw,{teamManager:s,children:(0,t.jsx)("h1",{className:"text-label-20 font-medium",children:"Welcome to Pro"})}):"Welcome to Pro"}),defaultCancelText:x.isFirstEnabledStep?"Cancel":"Back",defaultContinueText:"Continue",close:en,isNewDesign:_}),[j,en,x,s.userIntent,_,s]),es=_?tC:tS;return(0,t.jsx)(X.Provider,{value:el,children:(0,t.jsx)(es,{onClose:en,teamSlug:"upgrade-existing"===s.userIntent?s.team.slug:void 0,children:x.renderSteps({"select-team":(0,t.jsx)(eJ,{apologyMessage:C,createTeam:er,eligibleTeams:r,ineligibleTeams:i,isScopedSession:S,mode:c,planSelector:n,submissionQueue:w,teamManager:s,upgradeTeam:ei}),"payment-info":(0,t.jsx)(ta,{addOn:j,createTeam:er,forceExpandedReceipt:o,forceImmediateUpgrade:d,source:v,submissionQueue:w,teamManager:s,upgradeTeam:ei,user:a}),"team-members":(0,t.jsx)(eA,{deferredToasts:m,progressContextRef:y,submissionQueue:w,team:"upgrade-existing"===s.userIntent?s.team:void 0,user:a}),submitting:(0,t.jsx)(et,{deferredToasts:m,mode:c,onAbandon:N,onConversionSuccess:I,openTimeRef:T,planSelector:n,progressContextRef:y,router:b,skipRedirect:A,skipTransferModalOnTeamCreate:E,source:v,submissionQueue:w,teamInScope:B,user:a})})})})}function tw(e){let{teamManager:a,children:r}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-6 items-center",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:["upgrade-existing"===a.userIntent&&a.team.id?(0,t.jsx)(D.Avatar,{hash:a.team.avatar,size:24,teamId:a.team.id}):null,(0,t.jsx)(O.Badge,{size:"md",variant:"blue",children:"Pro"})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2 items-center",children:r})]})}function tS(e){let{children:a,onClose:r}=e;return(0,t.jsx)(n.Modal.Modal,{active:!0,"data-testid":(0,c.tid)("team","upgrade-modal"),onClickOutside:r,width:540,children:a})}function tC(e){let{children:a,onClose:r,teamSlug:i}=e;return(0,t.jsx)(ti.Sheet,{open:!0,onOpenChange:e=>{e||r()},children:(0,t.jsxs)(ti.SheetContent,{"data-testid":(0,c.tid)("team","upgrade-modal"),className:"m-3 h-[calc(100%-1.5rem)] w-[calc(100%-1.5rem)] overflow-hidden rounded-[1rem] bg-white p-0 lg:w-3/4 sm:max-w-[auto]",side:"right",children:[(0,t.jsx)(ti.SheetClose,{asChild:!0,children:(0,t.jsx)(R.Button,{className:"absolute top-4 right-4 z-50","aria-label":"Close",shape:"square",size:"tiny",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(tn.Cross,{})})}),(0,t.jsxs)("div",{className:"flex flex-col smd:flex-row h-full overflow-y-auto smd:overflow-y-visible overscroll-contain",children:[(0,t.jsx)("div",{className:"flex flex-1 bg-background-200 border-r-gray-alpha-400 border-r border-solid p-4 smd:p-8 gap-4 flex-col smd:min-w-[360px] shrink-0 order-2 smd:order-1",children:(0,t.jsx)(tv,{teamSlug:i})}),(0,t.jsx)("div",{className:"flex flex-[2] p-4 smd:p-8 smd:overflow-y-scroll smd:overflow-x-hidden order-1 smd:order-2",children:a})]})]})})}function tT(){let e=(0,s.useCloseUpgradeModal)(),a=(0,l.useRef)(performance.now()),r=(0,o.useUpgradeModalArgs)(e=>e.isNewDesign),i=(0,o.useUpgradeModalArgs)(e=>e.source),x=(0,o.useUpgradeModalArgs)(e=>e.trialBehavior),b=(0,o.useUpgradeModalArgs)(e=>e.mode),w=(0,o.useUpgradeModalArgs)(e=>e.teamHint),I=(0,o.useUpgradeModalArgs)(e=>e.onAbandon),{loading:M,data:D}=function(){let e=(0,l.useRef)({}),{source:t,trialBehavior:a,mode:r,teamHint:i,addOn:n,forceImmediateUpgrade:s,forceExpandedReceipt:d,skipTransferModalOnTeamCreate:c,skipRedirect:x,onConversionStart:b,onConversionSuccess:w,onConversionError:I,onImpression:M,onAbandon:D,disabledSteps:O}=(0,o.useUpgradeModalArgs)(),R=(0,m.useRouter)(),{user:F,team:U,teams:L,mutate:$,isLoading:q}=(0,p.useAccount)(),z=function(e){let{disabledSteps:t}=e;return(0,A.useSteps)({steps:["select-team","payment-info","team-members","submitting"],workflowName:"upgrade-modal",immutableDisabledSteps:new Set(t)})}({disabledSteps:O}),H=function(){let e=(0,l.useRef)([]);return{push:t=>e.current.push(t),flush:()=>{e.current.forEach(e=>B.toasts.message(e)),e.current=[]}}}(),G=function(){let e=(0,l.useRef)([]),t=(0,l.useRef)(!0),[a,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(void 0),s=e=>{t.current=e,r(e)},o=(0,l.useCallback)(async()=>{let t;for(;t=e.current.shift();){let{stepName:a,work:r,tracing:i}=t;try{i?await (0,_.trace)(()=>r(),{name:i.name,attributes:i.attributes}).catch(e=>{throw(0,y.trackLifecycleError)({type:i.flowType,error:e,attributes:i.attributes}),e}):await r()}catch(t){n({stepName:a,message:(0,u.normalizeError)(t).message,cause:t}),e.current=[];break}}s(!0)},[]);return{enqueue:(0,l.useCallback)(a=>{e.current.push(a),t.current&&(s(!1),o())},[o]),idle:a,error:i,clearError:(0,l.useCallback)(()=>n(void 0),[])}}(),{mutate:V}=(0,g.useUpcomingUsage)({enabled:!0}),{mutate:Y}=(0,h.useStripeSources)({enabled:!0}),{mutate:W}=f({enabled:!0}),K=(0,l.useCallback)(async()=>{await Promise.all([$(),V(),Y(),W()]).catch(e=>{let t=(0,u.normalizeError)(e).message;(0,y.trackLifecycleError)({type:"create",error:Error(t),attributes:{userId:F?.uid??""}})})},[$,V,Y,W,F?.uid]),Q=(0,l.useMemo)(()=>L?.filter(N)??[],[L]),J=(0,l.useMemo)(()=>L?.filter(e=>!N(e))??[],[L]),{loading:X,data:Z}=function(e){let{mode:t,eligibleTeams:a,teamHint:r,teamInScope:i,teamsAreLoading:n}=e,[s,o]=(0,l.useState)("create"===t?"create":"upgrade-existing"),[d,c]=(0,l.useState)(""),[u,m]=(0,l.useState)(void 0),p=(0,l.useCallback)((e,t)=>{if(0===a.length)return o("create");if(o(e),"create"===e){m(void 0),"string"==typeof t&&c(t);return}return(c(""),"object"==typeof t&&a.find(e=>e.id===t.id))?m(t):m(E({eligibleTeams:a,teamHint:r,teamIdInScope:i?.id}))},[a,r,i?.id]),g=(0,l.useCallback)(e=>{if(a.find(t=>t.id===e.id))return m(e)},[a]);return((0,l.useEffect)(()=>{n||("upgrade-existing"===s&&a.length>0&&void 0===u?m(E({eligibleTeams:a,teamHint:r,teamIdInScope:i?.id})):"upgrade-existing"===s&&0===a.length&&void 0===u&&o("create"))},[a,r,i?.id,u,n,s]),"create"===s)?{loading:!1,data:{teamName:d,setTeamName:c,userIntent:s,setUserIntent:p}}:u?{loading:!1,data:{userIntent:s,setUserIntent:p,team:u,setTeam:g}}:{loading:!0,data:void 0}}({mode:r,eligibleTeams:Q,teamHint:i,teamInScope:U??void 0,teamsAreLoading:q}),{loading:ee,data:et}=function(e){let{mode:t,desiredTrialBehavior:a,team:r,hasHobbyTeam:i}=e,[n,s]=(0,l.useState)("pro"),{canCreateHobbyTeam:o,ready:d}=(0,v.useCanCreateHobbyTeam)(),{canCreateTrial:c,ready:u}=(0,j.useCanCreateTrial)(),{actualTrialBehavior:m,validSelectorOptions:p,showSelector:g}=(0,l.useMemo)(()=>(function(e){let{mode:t,canCreateHobbyTeam:a,hasTrialsRemaining:r,currentTeamIsTrialEligible:i,desiredTrialBehavior:n}=e;return r&&i&&"choose"===n?{actualTrialBehavior:n,showSelector:!0,validSelectorOptions:[C,T]}:r&&!i&&"choose"===n?{actualTrialBehavior:"disallow-trial",showSelector:!0,validSelectorOptions:[k]}:r&&i&&"force-trial"===n?{actualTrialBehavior:n,showSelector:!1,validSelectorOptions:[C]}:a&&"choose"===n&&"create"===t?{actualTrialBehavior:"disallow-trial",showSelector:!0,validSelectorOptions:[S,T]}:{actualTrialBehavior:"disallow-trial",showSelector:!1,validSelectorOptions:[T]}})({mode:t,canCreateHobbyTeam:o,hasTrialsRemaining:!!c,currentTeamIsTrialEligible:!!(!r||r.billing?.plan==="hobby"),desiredTrialBehavior:a}),[t,o,c,r,a]),h=(0,l.useMemo)(()=>{let e=p.find(e=>e.slug===n);return e?.slug??p[0].slug},[n,p]),x=(0,l.useMemo)(()=>{if("force-trial"===a&&a!==m)return c?i?"This team is not eligible for a Pro Trial upgrade, but you have one or more existing Hobby teams. Choose one of those to start a Pro Trial.":"You don't have an existing trial-eligible team. Create a new team to start a Pro Trial.":"Sorry, you're out of Pro Trials!"},[m,a,i,c]);return d&&u?{loading:!1,data:{selectedPlan:h,setSelectedPlan:s,showSelector:g,desiredTrialBehavior:a,actualTrialBehavior:m,validSelectorOptions:p,hasTrialsRemaining:c,userHelpMessage:x}}:{loading:!0,data:void 0}}({mode:r,desiredTrialBehavior:a,team:X||"upgrade-existing"!==Z.userIntent?void 0:Z.team,hasHobbyTeam:!!Q.find(e=>e.billing?.plan==="hobby")}),ea=!!(!X&&"upgrade-existing"===Z.userIntent&&i&&Q.find(e=>P({team:e,teamHint:i})));return q||ee||X||!F?{loading:!0,data:void 0}:{loading:!1,data:{mode:r,source:t,user:F,teamInScope:U??void 0,eligibleTeams:Q,ineligibleTeams:J,planSelector:et,teamManager:Z,isScopedSession:ea,apologyMessage:et.userHelpMessage,addOn:n,forceImmediateUpgrade:s,forceExpandedReceipt:d,stepState:z,deferredToasts:H,submissionQueue:G,mutate:K,router:R,skipTransferModalOnTeamCreate:c,skipRedirect:x,progressContextRef:e,onConversionStart:b,onConversionSuccess:w,onConversionError:I,onAbandon:D,onImpression:M}}}(),O=(0,l.useCallback)(()=>{(0,d.trackModalAbandoned)({source:i,timeInModalMs:performance.now()-a.current,desiredTrialBehavior:x,mode:b,teamHint:w}),I(),e()},[x,b,I,e,i,w]);return M?r?(0,t.jsx)(ti.Sheet,{open:!0,onOpenChange:O,children:(0,t.jsx)(ti.SheetContent,{"data-testid":(0,c.tid)("team","upgrade-modal"),className:"m-3 h-[calc(100%-1.5rem)] w-[calc(100%-1.5rem)] overflow-hidden rounded-[1rem] bg-white p-0 lg:w-3/4 sm:max-w-[auto] flex items-center justify-center",side:"right",children:(0,t.jsx)(tk,{})})}):(0,t.jsx)(n.Modal.Modal,{active:!0,"data-testid":(0,c.tid)("team","upgrade-modal"),onClickOutside:O,width:540,children:(0,t.jsx)(tk,{})}):(0,t.jsx)(tj,{openTimeRef:a,isNewDesign:r,...D})}function tk(){return(0,t.jsxs)(r.Stack,{align:"center",gap:4,justify:"center",style:{minHeight:"288px"},children:[(0,t.jsx)(a.Spinner,{}),(0,t.jsx)(i.Text,{children:"Fetching account details..."})]})}}}]);

//# sourceMappingURL=071ef6b78a8a2828.js.map
//# debugId=0c614fc1-4527-5fda-aaf3-b090f8fb1a9f
