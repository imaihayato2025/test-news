
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1ff10b7d-dc10-5a26-864d-79f3f5bbcf34")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{315365:e=>{"use strict";e.s({AdvancedCharts:()=>L,CPUThrottleChart:()=>j,CpuUsageChart:()=>P,FluidComputeCpuSaved:()=>F,FunctionComputeSaved:()=>S,FunctionStartTypeChart:()=>C,MemoryUsageChart:()=>R,TTFBChart:()=>x});var t=e.i(6645307),r=e.i(6530772),a=e.i(8084653),i=e.i(5163670),n=e.i(2362802),o=e.i(5535439),s=e.i(555528),l=e.i(6465700),u=e.i(8679640),c=e.i(9162545),m=e.i(2273091),d=e.i(3435607),g=e.i(6693115),p=e.i(5054575),h=e.i(8185977),f=e.i(284627),v=e.i(3448116),y=e.i(4603845),T=e.i(6392382);function S(e){let{contextFilter:a,variant:n="chart",onPreviewClick:s,isFluidEnabled:l,showFluidUpsell:u}=e,c=(0,o.useParams)(),{data:h,isLoading:y,isRelativeTime:S}=(0,f.useSonarQuery)({event:"serverlessFunctionBilling",rollups:{billedGbhr:{measure:"billedDurationGbhr",aggregation:"sum"},actualGbhr:{measure:"requestDurationGbhr",aggregation:"sum"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),C="Compute Saved",x=(0,r.useMemo)(()=>h?.data?h.data.map(e=>{let t=e.billedGbhr>e.actualGbhr?0:e.actualGbhr-e.billedGbhr;return{name:e.timestamp.getTime(),[C]:0===e.billedGbhr?null:(0,T.calculatePercentage)(t,e.actualGbhr)}}):[],[h?.data,C]),R=(0,r.useMemo)(()=>h?.data?h.data.map(e=>{let t=e.billedGbhr>e.actualGbhr?0:e.actualGbhr-e.billedGbhr;return{name:e.timestamp.getTime(),Saved:t,Consumed:e.billedGbhr}}):[],[h?.data]),j=(0,r.useMemo)(()=>{let{sumSaved:e,sumConsumed:t}=R.reduce((e,t)=>({sumSaved:e.sumSaved+t.Saved,sumConsumed:e.sumConsumed+t.Consumed}),{sumSaved:0,sumConsumed:0});return(0,T.calculatePercentage)(e,t+e)},[R]),P=(0,r.useMemo)(()=>[0,Math.max(...R.map(e=>e.Consumed))],[R]),L=(0,r.useMemo)(()=>{let e=["Consumed"],t=(h?.summary[0]?.billedGbhr??0)-(h?.summary[0]?.actualGbhr??0);return(l||t>.001)&&e.push("Saved"),e},[h?.summary,l]),w=(0,g.numberFormat)({significantDigits:2,maximumFractionDigits:2,roundingPriority:"morePrecision",suffix:" GB-hrs"}),E=(0,r.useMemo)(()=>{if(l)return"Fluid"},[l]);return"gbhrs"===n?(0,t.jsx)(m.LineChart,{categories:L,data:R,formatValue:e=>w(e||0),getColor:e=>"Saved"===e?"var(--ds-pink-700)":"var(--ds-blue-700)",isLoading:y,isRelativeTime:S,lineType:"linear",showRollup:!0,title:null,yAxisDomain:P}):"preview"===n?u?(0,t.jsx)(b,{params:c,variant:"compact"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.ChartCard,{onClick:s,size:"tiny",children:(0,t.jsx)(v.PreviewTileContent,{isLoading:y,label:"Compute Model",value:E||""})}),(0,t.jsx)(d.ChartCard,{onClick:s,size:"tiny",children:(0,t.jsx)(v.PreviewTileContent,{isLoading:y,label:"Compute Saved",subLabel:"%",value:(0,p.formatPercentage)(j||0)})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.ChartCard,{size:"small",children:u?(0,t.jsx)(b,{params:c}):(0,t.jsx)(m.LineChart,{categories:[C],data:x,formatValue:p.formatPercentage,getColor:()=>"var(--ds-pink-700)",isLoading:y,isRelativeTime:S,rollupConfig:{method:"avg",showTrend:!1,getValue:e=>j},showRollup:!0,title:E||(0,t.jsx)(i.Skeleton,{className:"mt-1",height:16,width:100})})}),(0,t.jsx)(d.ChartCard,{size:"small",children:(0,t.jsx)(m.LineChart,{categories:L,data:R,formatValue:e=>w(e||0),getColor:e=>"Saved"===e?"var(--ds-pink-700)":"var(--ds-blue-700)",isLoading:y,isRelativeTime:S,showRollup:!0,title:l?"GB-Hours Saved":"GB-Hours Usage",yAxisDomain:P})})]})}function b(e){let{params:r,variant:i="full"}=e;return"compact"===i?(0,t.jsxs)(d.ChartCard,{className:"col-span-2 flex flex-row items-center gap-1 py-0.5",size:"tiny",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(a.Text,{className:"font-medium",children:"Configure Fluid"}),(0,t.jsx)(a.Text,{className:"text-xs text-gray-900",children:"Optimize performance & reduce cost"})]}),(0,t.jsx)("div",{className:"flex flex-row gap-6",children:(0,t.jsx)(n.ButtonLink,{"aria-label":"Configure Fluid",href:`/${r.teamSlug}/${r.project}/settings/functions`,shape:"square",size:"tiny",svgOnly:!0,type:"secondary",children:(0,t.jsx)(u.ChevronRightSmall,{})})})]}):(0,t.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2",children:[(0,t.jsx)(a.Text,{className:"font-medium",children:"Optimize Performance with Fluid compute"}),(0,t.jsx)(a.Text,{className:"mb-2 text-center text-sm text-gray-900",children:"Fluid compute will automatically optimize performance and reduce cost."}),(0,t.jsxs)("div",{className:"flex flex-row gap-6",children:[(0,t.jsx)(n.ButtonLink,{href:`/${r.teamSlug}/${r.project}/settings/functions`,size:"small",children:"Configure Fluid"}),(0,t.jsx)(n.Link,{external:!0,href:"/docs/fluid-compute",variant:"highlight",children:"Learn More"})]})]})}function C(e){let{contextFilter:r,variant:a="chart"}=e,{data:i,isLoading:n,isRelativeTime:o,builderQuery:s}=(0,f.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{total:{measure:"count",aggregation:"sum"},value:{measure:"count",aggregation:"percent"}},groupBy:["functionStartType"],contextFilter:r}),l=(0,h.useTimeseriesData)(i,{filter:e=>"unknown"!==e.functionStartType&&""!==e.functionStartType,category:e=>({cold:"Cold",prewarmed:"Prewarmed",hot:"Hot"})[e.functionStartType]||e.functionStartType,value:e=>e.total&&"number"==typeof e.total&&0===e.total||0===e.value?null:e.value});if("preview"===a){let e=i?.summary.find(e=>"cold"===e.functionStartType)?.value;return(0,t.jsx)(v.PreviewTileContent,{isLoading:n,label:"Cold Start",subLabel:"%",value:"number"==typeof e?(0,T.formatPercentageChart)(e):"-"})}return(0,t.jsx)(m.LineChart,{builderQuery:s?.value,data:l??[],formatValue:T.formatPercentageChart,getColor:e=>"Cold"===e?"var(--ds-blue-700)":"Prewarmed"===e?"var(--ds-pink-700)":"Unknown"===e?"var(--ds-gray-600)":"var(--ds-amber-700)",isLoading:n,isRelativeTime:o,placeholderKeys:["Hot","Cold","Prewarmed"],rollupConfig:{method:"avg",interpretation:"increaseNegative",showTrend:!0,getValue:e=>i?.summary.find(t=>t.functionStartType===e.toLowerCase())?.value??null},showRollup:!0,title:"Start Type",yAxisDomain:[0,100]})}function x(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,f.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{avgTtfb:{measure:"ttfbMs",aggregation:"avg"},p75Ttfb:{measure:"ttfbMs",aggregation:"p75"},p95Ttfb:{measure:"ttfbMs",aggregation:"p95"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>({name:e.timestamp.getTime(),Average:e.avgTtfb,P75:e.p75Ttfb,P95:e.p95Ttfb})):[],[n?.data]);if("preview"===i){let e=(0,y.createRollupCalculator)(u,"P75")("avg");return(0,t.jsx)(v.PreviewTileContent,{isLoading:o,label:"Time to First Byte",subLabel:"P75",value:e?(0,p.formatDuration)(e):"-"})}return(0,t.jsx)(m.LineChart,{builderQuery:l?.avgTtfb,categories:["Average","P75","P95"],data:u,formatValue:p.formatDuration,getColor:e=>"Average"===e?"var(--ds-gray-800)":"P75"===e?"var(--ds-blue-600)":"var(--ds-blue-800)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:"Time to First Byte"})}function R(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,f.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{p75Memory:{measure:"peakMemoryMb",aggregation:"p75"},p95Memory:{measure:"peakMemoryMb",aggregation:"p95"},avgMemory:{measure:"peakMemoryMb",aggregation:"avg"},provisioned:{measure:"provisionedMemoryMb",aggregation:"max"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>{let{timestamp:t,avgMemory:r,p75Memory:a,p95Memory:i}=e;return{name:t.toISOString(),Average:r,P75:a,P95:i}}):[],[n?.data]),d=n?.data?.[n.data.length-1]?.provisioned??0,g=.85*d;if("preview"===i){let e=(0,y.createRollupCalculator)(u,"Average")("avg");return(0,t.jsx)(v.PreviewTileContent,{isLoading:o,label:"Memory Usage",subLabel:"Avg",suffix:d?`/ ${(0,p.formatBytes)(1e3*d*1e3)}`:void 0,value:e?(0,p.formatBytes)(1e3*e*1e3):"-"})}return(0,t.jsx)(m.LineChart,{builderQuery:l?.maxMemory,customChartContent:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.ReferenceLine,{stroke:"var(--ds-red-600)",strokeDasharray:"6 3",strokeOpacity:.6,x:u[u.length-1]?.name,y:d}),(0,t.jsx)(c.ReferenceLine,{stroke:"var(--ds-amber-600)",strokeDasharray:"3 6",strokeOpacity:.8,x:u[u.length-1]?.name,y:g})]}),data:u,disableLegend:!0,formatValue:e=>0===e?"0":(0,p.formatBytes)(1e3*e*1e3),getColor:e=>"P75"===e?"var(--ds-blue-600)":"P95"===e?"var(--ds-blue-800)":"Average"===e?"var(--ds-gray-800)":"var(--ds-gray-700)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:"Memory Usage",yAxisDomain:[0,d]})}function j(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,f.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{Average:{measure:"cpuThrottlePercent",aggregation:"avg"},P75:{measure:"cpuThrottlePercent",aggregation:"p75"},P95:{measure:"cpuThrottlePercent",aggregation:"p95"}},filter:"isAdditionalRequest eq 0",tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>{let{timestamp:t,P75:r,Average:a,P95:i}=e;return{name:t.toISOString(),Average:a,P75:r,P95:i}}):[],[n?.data]);if("preview"===i){let e=(0,y.createRollupCalculator)(u,"P75")("avg");return(0,t.jsx)(v.PreviewTileContent,{isLoading:o,label:"CPU Throttle",subLabel:"P75",value:e?(0,p.formatPercentage)(e):"â€“"})}return(0,t.jsx)(m.LineChart,{builderQuery:l?.cpuThrottleMsAvg,data:u,disableLegend:!0,formatValue:e=>(0,p.formatPercentage)(e),getColor:e=>"Average"===e?"var(--ds-gray-800)":"P75"===e?"var(--ds-blue-600)":"var(--ds-blue-800)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 font-medium",children:["CPU Throttle",(0,t.jsx)(w,{})]})})}function P(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,f.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{Average:{measure:"functionCpuTimeMs",aggregation:"avg"},P75:{measure:"functionCpuTimeMs",aggregation:"p75"},P95:{measure:"functionCpuTimeMs",aggregation:"p95"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>{let{timestamp:t,P75:r,Average:a,P95:i}=e;return{name:t.toISOString(),Average:a,P75:r,P95:i}}):[],[n?.data]);if("preview"===i){let e=(0,y.createRollupCalculator)(u,"P75")("avg");return(0,t.jsx)(v.PreviewTileContent,{isLoading:o,label:"Active CPU",subLabel:"P75",value:e?(0,p.formatDuration)(e):"â€“"})}return(0,t.jsx)(m.LineChart,{builderQuery:l?.cpuThrottleMsAvg,data:u,disableLegend:!0,formatValue:e=>(0,p.formatDuration)(e),getColor:e=>"Average"===e?"var(--ds-gray-800)":"P75"===e?"var(--ds-blue-600)":"var(--ds-blue-800)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 font-medium",children:["Active CPU",(0,t.jsx)(E,{})]})})}function L(e){let{contextFilter:r,variant:a="chart",onPreviewClick:i}=e,n="preview"===a?"tiny":"small",o="preview"===a?i:void 0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(P,{contextFilter:r,variant:a})}),(0,t.jsx)(d.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(R,{contextFilter:r,variant:a})}),(0,t.jsx)(d.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(j,{contextFilter:r,variant:a})}),(0,t.jsx)(d.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(x,{contextFilter:r,variant:a})}),(0,t.jsx)(d.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(C,{contextFilter:r,variant:a})})]})}function w(){return(0,t.jsx)(s.Tooltip,{maxWidth:"300px",text:(0,t.jsx)(t.Fragment,{children:"The percentage of time that the function instance is forced to wait because there is no CPU available. High percentages indicate the function instance is CPU starved. Increasing the memory size or improving the code performance may lower this value."}),children:(0,t.jsx)(n.Link,{external:!0,href:"/docs/functions/configuring-functions/memory",icon:!1,children:(0,t.jsx)(l.InformationFillSmall,{})})})}function E(){return(0,t.jsx)(s.Tooltip,{maxWidth:"300px",text:(0,t.jsx)(t.Fragment,{children:"The time your code actively runs on the function instance."}),children:(0,t.jsx)(n.Link,{external:!0,href:"/docs/fluid-compute/pricing#how-pricing-works",icon:!1,children:(0,t.jsx)(l.InformationFillSmall,{})})})}function F(){let{data:e,isLoading:a,isRelativeTime:i}=(0,f.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{cpuTimeMs:{measure:"functionCpuTimeMs",aggregation:"sum"}},tailRollup:"truncate",summaryOnly:!1}),n=(0,r.useMemo)(()=>e?.data?e.data.map(e=>{let{timestamp:t,cpuTimeMs:r}=e;return{name:t.toISOString(),"Active CPU":r}}):[],[e?.data]);return(0,t.jsx)(m.LineChart,{data:n,getColor:()=>"var(--ds-blue-700)",isLoading:a,isRelativeTime:i,placeholderKeys:["Active CPU"],formatValue:e=>(0,p.formatDuration)(e),lineType:"linear",showRollup:!0,title:null})}},3448116:e=>{"use strict";e.s({PreviewTileContent:()=>a});var t=e.i(6645307),r=e.i(5163670);function a(e){let{label:a,value:i,suffix:n,subLabel:o,maxValue:s,icon:l,isLoading:u=!1}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1 text-xs",children:[(0,t.jsx)("span",{className:"truncate text-gray-900",children:a}),l,o?(0,t.jsx)("span",{className:"text-gray-700",children:o}):null]}),(0,t.jsxs)("div",{className:"flex items-baseline tabular-nums",children:[(0,t.jsx)("span",{className:"truncate text-sm font-medium text-gray-1000",title:i.toString(),children:u?(0,t.jsx)(r.Skeleton,{className:"mt-1",height:16,width:30}):(0,t.jsxs)(t.Fragment,{children:[i,n?(0,t.jsx)("span",{className:"ml-1 font-normal text-gray-700",children:n}):null]})}),s?(0,t.jsxs)("span",{className:"mt-1 truncate text-sm text-gray-500",children:["/ ",s]}):null]})]})}},6216399:e=>{"use strict";e.s({ErrorRate:()=>s});var t=e.i(6645307),r=e.i(6530772),a=e.i(2273091),i=e.i(284627),n=e.i(6392382),o=e.i(4645627);function s(e){let{contextFilter:s,type:l="serverless",title:u,hideXAxis:c=!1}=e,{data:m,isLoading:d,isRelativeTime:g,builderQuery:p}=(0,i.useSonarQuery)({event:"serverless"===l?"serverlessFunctionInvocation":"edgeFunctionInvocation",rollups:{total:{measure:"count",aggregation:"sum"},errors:{measure:"count",aggregation:"sum",filter:"serverless"===l?o.SERVERLESS_DEFAULT_ERROR_FILTER:o.HTTP_STATUS_DEFAULT_ERROR_FILTER},timeouts:{measure:"count",aggregation:"sum",filter:"serverless"===l?o.SERVERLESS_TIMEOUT_FILTER:o.HTTP_STATUS_TIMEOUT_FILTER}},limit:500,tailRollup:"truncate",summaryOnly:!1,contextFilter:s},{demoConfig:{rollups:{total:{base:1e3,variation:1},errors:{base:10,variation:5},timeouts:{base:0,variation:0}}},builderQueryFilter:"serverless"===l?o.SERVERLESS_ERROR_BUILDER_QUERY:o.HTTP_STATUS_ERROR_BUILDER_QUERY}),h=(0,r.useMemo)(()=>m?.data?m.data.map(e=>{let{timestamp:t,errors:r,timeouts:a,total:i}=e;return{name:t.toISOString(),Error:0===i?null:(0,n.calculatePercentage)(r,i),Timeout:0===i?null:(0,n.calculatePercentage)(a,i)}}):[],[m?.data]),f=Math.max(...h.flatMap(e=>[e.Error||0,e.Timeout||0]));return(0,t.jsx)(a.LineChart,{builderQuery:p?.total,data:h,formatValue:n.formatPercentageChart,getColor:e=>"Error"===e?"var(--geist-error)":"Timeout"===e?"var(--geist-warning)":"var(--geist-success)",hideXAxis:c,isLoading:d,isRelativeTime:g,placeholderKeys:["Error","Timeout"],rollupConfig:{method:"avg",interpretation:"increaseNegative",showTrend:!0},showRollup:!0,title:null===u?null:u||"Error Rate",yAxisDomain:[0,Math.max(5,f)]})}},714511:[e=>{"use strict";e.s({subMinutes:()=>i},714511),e.s({addMinutes:()=>a},5143317);var t=e.i(5701118),r=e.i(7831155);function a(e,a,i){let n=(0,r.toDate)(e,i?.in);return n.setTime(n.getTime()+a*t.millisecondsInMinute),n}function i(e,t,r){return a(e,-t,r)}},[5143317]],284627:e=>{"use strict";e.s({useBuildDiagnostics:()=>L,useSonarLiveQuery:()=>P,useSonarQuery:()=>j},284627);var t=e.i(6530772),r=e.i(3521787),a=e.i(1183506),i=e.i(9336536),n=e.i(1863837),o=e.i(1740078),s=e.i(5701118),l=e.i(2282870),u=e.i(5143317),c=e.i(2671602),m=e.i(1802833),d=e.i(714511),g=e.i(3345839),p=e.i(7550201),h=e.i(8757700),f=e.i(870804),v=e.i(8072229),y=e.i(1238354),T=e.i(5535439),S=e.i(5534034),b=e.i(8551999),C=e.i(1285094),x=e.i(3025798);let R=e=>(r,a,i)=>{let n=(0,t.useRef)(void 0),o=e(r,a,i);(0,t.useEffect)(()=>{void 0!==o.data&&Array.isArray(r)&&r[1]&&(n.current=o.data)},[o.data,r]);let s=(0,t.useCallback)(()=>{n.current=void 0},[]);Array.isArray(r)&&!r[1]&&(n.current=void 0);let l=void 0===o.data?n.current:o.data,u=void 0===o.data&&void 0!==n.current;return Object.assign(o,{currentData:l,isLagging:u,resetLaggy:s})};function j(e,r){let a=(0,t.useMemo)(()=>{if(e)return{...e}},[e]),i=function(){let e=(0,T.useSearchParams)();return(0,t.useCallback)(t=>{let{rollups:r,by:a,event:i,filter:n}=t;if(!r||!i||!S.queryBuilderEvents.includes(i))return;let o=(0,C.getGroupableDimensions)(i);if(n&&(0,b.parseFilters)(n).some(e=>!o.includes(e.dimension)))return;a=a?.filter(e=>o.includes(e));let s=e?.get("period"),l=e?.get("from"),u=e?.get("to"),c=l&&u?{from:new Date(1e3*Number(l)),to:new Date(1e3*Number(u))}:s;return Object.entries(r).reduce((e,t)=>{let[r,o]=t,{measure:s,aggregation:l}=o;return e[r]={metric:`${i}.${s}`,by:a||[],filter:n||"",aggregation:l,time:c||""},e},{})},[e])}(),{start:d,end:x,isRelativeTime:R}=(0,v.useRangeFromQueryState)(),[{environment:j}]=(0,v.useSonarQueryState)(),P=(0,y.useSonarQueryScopeWithSlug)(),L=(0,y.useSonarQueryScope)(),w=(0,f.useShouldShowDemoData)();a&&!a.scope&&(a.scope=P),a&&(a.granularity=a.granularity||(0,h.getGranularityFromDuration)(Math.round(x.getTime()-d.getTime()),a.lowGranularity),a.startTime=(0,n.startOfDuration)(a.startTime||d,a.granularity),a.endTime=(0,n.endOfDuration)(a.endTime||x,a.granularity)),a&&!a.reason&&(a.reason="observability_chart");let E=r?.noEnvironmentFilter===!0,F=r?.builderQueryFilter||a?.filter;if(a&&"all"!==j&&!E&&(a.filter=(0,c.andFilterStrings)(`environment eq '${j}'`,a.filter),F=(0,c.andFilterStrings)(`environment eq '${j}'`,F)),a&&(a.filter=(0,c.andFilterStrings)(a.filter,(0,c.serializeObjectFilter)(a.contextFilter)),F=(0,c.andFilterStrings)(F,(0,c.serializeObjectFilter)(a.contextFilter)),L?.type==="project"&&(F=(0,c.andFilterStrings)(`projectId eq '${L.projectIds[0]}'`,F)),r?.useQueryCache))try{{let e=new URLSearchParams(window.location.search).get("queryId");e&&(a.queryId=e)}}catch(e){}let M=i({event:a?.event,rollups:a?.rollups,by:a?.groupBy?.filter(e=>"projectName"!==e),filter:F}),O=a?.granularity&&R?(0,m.milliseconds)(a.granularity):0,I=!!((r?.showDemoData||w)&&r?.demoConfig),A=(0,t.useMemo)(()=>!a||I?null:JSON.stringify(a),[a,I]),{isLoading:D,..._}=(0,g.useIsomorphicSWR)(A,async()=>{if(a?.scope)return(0,p.getSonarData)(a)},{refreshInterval:r?.disableRefetch===!0?0:O,revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateIfStale:!1,keepPreviousData:!0,errorRetryCount:0,ssr:{timeout:4e3}}),U=(0,t.useMemo)(()=>(r?.showDemoData||w)&&r?.demoConfig?function(e,t){let{startTime:r,endTime:a,granularity:i,groupBy:n=[]}=e,c=function(e,t,r){let a=(0,l.differenceInMilliseconds)(e,t)/s.millisecondsInMinute;return(0,o.getRoundingMethod)(void 0)(a)}(a,r),m=i.minutes||15,d=Math.ceil(c/m/("lowGranularity"in e?4:1)),g=[],p=[],h=Object.keys(t.rollups),f=0,v=e=>!!e&&"object"==typeof e&&"base"in e&&"variation"in e&&"number"==typeof e.base&&"number"==typeof e.variation,y=(e=>{if(0===e.length)return[{}];let r=[{}];for(let a of e){let e=[];if(t.groupValues?.[a])e=t.groupValues[a];else{let r=new Set;for(let e of Object.values(t.rollups))if(!v(e)&&e.groupConfigs){let t=e.groupConfigs;t[a]&&Object.keys(t[a]).forEach(e=>{r.add(e)})}e=Array.from(r)}if(0===e.length)throw Error(`No values found for group field "${a}". Please provide groupValues or groupConfigs for this field.`);let i=[];for(let t of r)for(let r of e)i.push({...t,[a]:r});r=i}return r})(n),T=e.rollups;for(let e of y){let a={...e},i={};for(let a=0;a<d;a++){let n=(0,u.addMinutes)(r,a*m),o={timestamp:n,...e};for(let r of h){let a,s=t.rollups[r],l=T[r];if(void 0===s)continue;if(v(s))a=s;else for(let[t,r]of(a=s.defaultConfig,Object.entries(e)))if(s.groupConfigs?.[t]?.[r]){a=s.groupConfigs[t][r];break}let{base:u=0,variation:c=0,diurnalPattern:m=!1}=a,d=u+(Math.random()-.5)*c;m&&(d*=1+.3*Math.sin(n.getHours()/24*Math.PI*2)),a.allowNegative||(d=Math.max(0,d));let g=l?.aggregation;"sum"===g?d=Math.round(d):"avg"===g||("p75"===g?d+=Math.random()*c*.5:d=Math.round(d)),o[r]=d,i[r]||(i[r]=[]),i[r].push(d),f+=d}g.push(o)}for(let e of h){let t=i[e],r=T[e],n=r?.aggregation,o=null;if(t&&0!==t.length)switch(n){case"avg":o=t.reduce((e,t)=>e+t,0)/t.length;break;case"p75":{t.sort((e,t)=>e-t);let e=Math.floor(.75*(t.length-1));o=t[e]||0;break}default:o=t.reduce((e,t)=>e+t,0)}else o=null;a[e]=o||0}p.push(a)}return{data:e.summaryOnly?void 0:g,summary:p,statistics:{rowsRead:f,bytesRead:46*f,dbTimeSeconds:.1+.1*Math.random(),engineTimeSeconds:.1+.1*Math.random(),queryTable:"demo"}}}(a,r.demoConfig):void 0,[r?.showDemoData,w,a]);return U?{..._,isRelativeTime:!0,data:U,isLoading:!1}:{..._,builderQuery:M,isRelativeTime:R,isLoading:D||_.isValidating||!a?.scope}}function P(e,t){let a=(0,y.useSonarQueryScope)();return e&&!e.scope&&(e.scope=a),(0,r.default)(e?[e,t]:null,async e=>{let[r]=e;if(t){let e=new Date,t=(0,n.endOfDuration)((0,d.subMinutes)(e,1),{seconds:10});r.startTime=(0,n.startOfDuration)(new Date(e.getTime()-6e5),{seconds:10}),r.endTime=t}if(r.scope)return(0,p.getSonarData)(r)},{refreshInterval:e?.granularity&&t?(0,m.milliseconds)({seconds:8}):0,revalidateOnFocus:!1,revalidateOnReconnect:!1,use:[R],onErrorRetry:(e,t,r,a,i)=>{let{retryCount:n}=i;401!==e.status&&403!==e.status&&(n>=3||setTimeout(()=>void a({retryCount:n}),2500))}})}function L(){let e=(0,v.useRangeFromQueryState)(),t=(0,y.useSonarQueryScope)(),[{environment:o}]=(0,v.useSonarQueryState)(),s={minutes:15},l={from:(0,n.startOfDuration)(e.start,s),to:(0,n.endOfDuration)(e.end,s),scope:t,environment:o};return{isRelativeTime:e.isRelativeTime,...(0,r.default)(l,async e=>{if(e.scope)return await (0,a.fetchAPI)(`${i.API_OBSERVABILITY_BUILD_DIAGNOSTICS}?${(0,x.stringify)((0,p.getSonarTeamParam)(e.scope))}`,{method:"POST",body:JSON.stringify(e),throwOnHTTPError:!0})},{refreshInterval:0,revalidateOnFocus:!1,revalidateOnReconnect:!1})}}},4645627:e=>{"use strict";e.s({HTTP_STATUS_DEFAULT_ERROR_FILTER:()=>r,HTTP_STATUS_ERROR_BUILDER_QUERY:()=>i,HTTP_STATUS_ERROR_FILTER:()=>t,HTTP_STATUS_TIMEOUT_FILTER:()=>a,SERVERLESS_DEFAULT_ERROR_FILTER:()=>s,SERVERLESS_ERROR_BUILDER_QUERY:()=>l,SERVERLESS_ERROR_FILTER:()=>n,SERVERLESS_TIMEOUT_FILTER:()=>o,SUPPORTED_DETAIL_PAGES:()=>u});let t="httpStatus ge 500 or httpStatus eq -1",r=`(${t}) and httpStatus ne -1 and httpStatus ne 504`,a="httpStatus eq -1 or httpStatus eq 504",i="httpStatus ge 500 and httpStatus ne 504",n="errorCode ne '' or httpStatus ge 500",o="httpStatus eq 504 or errorCode eq 'timeout'",s="(errorCode ne '' and errorCode ne 'timeout') or httpStatus ge 500 and httpStatus ne 504",l="httpStatus ge 500",u=["route","requestPath","botId","botCategory"]},8211874:e=>{"use strict";function t(e,t,r){return{event:"incomingRequest",rollups:r??{requests:{measure:"count",aggregation:"sum"},cachedResponses:{measure:"count",aggregation:"sum",filter:"cacheResult eq 'HIT' or cacheResult eq 'STALE'"}},...t&&{filter:t},..."botId"===e&&{filter:"botId ne ''"},..."botCategory"===e&&{filter:"botCategory ne ''"},groupBy:[e],limit:100,tailRollup:"truncate",summaryOnly:!1,lowGranularity:!0}}function r(e,t){return{event:e,rollups:{value:{measure:"count",aggregation:"sum"}},groupBy:["httpStatus"],..."outgoingRequest"===e&&{filter:"fetchType eq 'origin'"},..."functionExecution"===e&&{filter:"cause ne 'middleware'"},limit:25,tailRollup:"truncate",summaryOnly:!1,contextFilter:t}}function a(e,t,r){return{event:e,rollups:{value:{measure:"count",aggregation:"sum"}},groupBy:[t],..."outgoingRequest"===e&&{filter:"fetchType eq 'origin'"},limit:25,tailRollup:"truncate",summaryOnly:!1,contextFilter:r}}function i(){return{event:"firewallAction",rollups:{requests:{measure:"count",aggregation:"sum"}},filter:"wafAction ne 'allow'",groupBy:["wafAction"],limitRanking:"top_by_summary",orderBy:"requests",limit:30,tailRollup:"others",summaryOnly:!1}}function n(e,t){return{event:"middlewareInvocation",rollups:{requests:{measure:"count",aggregation:"sum"}},groupBy:[e],filter:t,limit:100,tailRollup:"truncate",summaryOnly:!1,lowGranularity:!0}}e.s({getFirewallActions:()=>i,getIncomingRequestsByQuery:()=>t,getMiddlewareInvocationsByAction:()=>n,getQueryByByStatusCode:()=>r,getQueryEventGroupBy:()=>a})},8766556:e=>{"use strict";e.s({StatusCode:()=>u});var t=e.i(6645307),r=e.i(2273091),a=e.i(3435607),i=e.i(9822833),n=e.i(284627),o=e.i(8185977),s=e.i(5054575),l=e.i(8211874);function u(e){let{title:u,emptyState:c,event:m,contextFilter:d,hideXAxis:g=!1,CustomWrapper:p}=e,{data:h,isLoading:f,isRelativeTime:v,builderQuery:y}=(0,n.useSonarQuery)((0,l.getQueryByByStatusCode)(m,d),{demoConfig:{rollups:{value:{defaultConfig:{base:1e3,variation:1},groupConfigs:{httpStatus:{200:{base:3e3,variation:300,diurnalPattern:!0},400:{base:200,variation:30,diurnalPattern:!0},500:{base:40,variation:10}}}}}}}),T=(0,o.useTimeseriesData)(h,{filter:e=>void 0!==e.httpStatus&&"0"!==e.httpStatus,category:e=>-1===Number(e.httpStatus)?"Timeout":`${e.httpStatus.charAt(0)}XX`}),S=(0,o.useSum)(h),b=(0,t.jsx)(r.LineChart,{builderQuery:y?.value,data:T??[],emptyState:c,getColor:i.getStatusColors,headerHeight:null===u?40:60,hideXAxis:g,isLoading:f,isRelativeTime:v,lineType:"step",title:null===u?null:(0,t.jsx)(a.LargeLegendValue,{isLoading:f,title:u,valueString:(0,s.formatNumberCompact)(S??0)})});return p?(0,t.jsx)(p,{children:b}):b}}}]);

//# sourceMappingURL=3e9cd4143735bd00.js.map
//# debugId=1ff10b7d-dc10-5a26-864d-79f3f5bbcf34
