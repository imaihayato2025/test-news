
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f54db345-8ab7-5d75-84fc-b7a8c3820c08")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{6457153:e=>{e.v({glow:"fieldset-wrapper-module__UuFOOa__glow",wrapper:"fieldset-wrapper-module__UuFOOa__wrapper"})},1336502:e=>{e.v({tableContainer:"index-module__BmqzpG__tableContainer"})},9701677:e=>{e.v({container:"index-module__Jk-AeG__container",titleContent:"index-module__Jk-AeG__titleContent"})},4955104:e=>{e.v({capitalize:"directory-sync-module___l4INa__capitalize",circleIcon:"directory-sync-module___l4INa__circleIcon",circleIconSmall:"directory-sync-module___l4INa__circleIconSmall"})},4196468:e=>{e.v({emptyAvatar:"protected-git-scopes-module__EVMbda__emptyAvatar",iconOverlay:"protected-git-scopes-module__EVMbda__iconOverlay",iconUnderlay:"protected-git-scopes-module__EVMbda__iconUnderlay",iconWrapper:"protected-git-scopes-module__EVMbda__iconWrapper"})},5184832:e=>{e.v({capitalize:"security-module__67VUbq__capitalize",circleIcon:"security-module__67VUbq__circleIcon",hbsbyw:"security-module__67VUbq__hbsbyw",hwdneq:"security-module__67VUbq__hwdneq",jfrghs:"security-module__67VUbq__jfrghs",jfuqpw:"security-module__67VUbq__jfuqpw",kolchb:"security-module__67VUbq__kolchb",legdbp:"security-module__67VUbq__legdbp",minWidth0:"security-module__67VUbq__minWidth0",smmyof:"security-module__67VUbq__smmyof"})},6703107:e=>{"use strict";e.s({Security:()=>iA},6703107);var i=e.i(6645307),t=e.i(7315479),s=e.i(7573892),n=e.i(9802771),r=e.i(6112807),l=e.i(595691),o=e.i(5528554),a=e.i(5165976),c=e.i(5124754),d=e.i(6530772),u=e.i(6531164),h=e.i(611347),g=e.i(7238633),x=e.i(8350390),p=e.i(5175803),m=e.i(5674541),j=e.i(1265902),f=e.i(2254575),b=e.i(1917237),y=e.i(653558),v=e.i(2733203),S=e.i(1190215),A=e.i(4105925),T=e.i(8934201),w=e.i(5163670),k=e.i(889716),I=e.i(8084653),C=e.i(9495609),M=e.i(584439),E=e.i(2362802),_=e.i(1164214),P=e.i(6649026),F=e.i(1183506),L=e.i(9336536),N=e.i(5973311),R=e.i(3514588),O=e.i(5454140),D=e.i(604868),B=e.i(534589),G=e.i(4660147),z=e.i(3326412),V=e.i(3585235),$=e.i(5785123),H=e.i(9362924),U=e.i(4162978),q=e.i(5019368),W=e.i(5610210),Y=e.i(6457153);let J=e=>{let{children:t,...s}=e;return(0,i.jsx)("section",{...s,className:(0,W.clsx)(s.className,Y.default.wrapper),children:t})};var K=e.i(6958389),X=e.i(8653422),Z=e.i(654868),Q=e.i(5744013);function ee(e,i,t){return!!e&&("webAnalytics"===i&&t?e.billing?.invoiceItems?.webAnalytics?.tier===t:"enabledInvoiceItems"in e&&(e.enabledInvoiceItems?.[i]?.enabled||!1))}var ei=e.i(260979),et=e.i(978429),es=e.i(1177611),en=e.i(5747252),er=e.i(7981702),el=e.i(8448595),eo=e.i(503726),ea=e.i(7337588),ec=e.i(2145411),ed=e.i(1343577);let eu=function(){let{team:e,isLoading:s,mutate:n}=(0,eo.useAccount)(),{can:r,isLoading:l}=(0,V.default)(),o=r($.Action.Update,$.Resource.Team),[a,c]=(0,d.useState)(!!e?.hideIpAddresses),[p,m]=(0,d.useState)(!!e?.hideIpAddressesInLogDrains);(0,d.useEffect)(()=>{c(!!e?.hideIpAddresses),m(!!e?.hideIpAddressesInLogDrains)},[e]);let[j,f]=(0,d.useState)(null),[b,y]=(0,d.useState)(!1),v=(0,M.useToasts)(),S=(0,d.useCallback)(async i=>{if(c(i),!b&&e)try{f(null),y(!0);let t=await (0,F.fetchAPI)(`${L.API_TEAMS}/${e.id}`,{method:"PATCH",body:{hideIpAddresses:i}});if(t.error)throw Error(t.error.message??"An unexpected error occurred. Please try again later.");n(),v.success({text:"Your team's IP address setting has been updated.",key:"ip-visibility-toggle-success"})}catch(e){f((0,t.errorToString)(e)),c(!i)}finally{y(!1)}},[e,n,b,v,c]),A=(0,d.useCallback)(async i=>{if(m(i),!b&&e)try{f(null),y(!0);let t=await (0,F.fetchAPI)(`${L.API_TEAMS}/${e.id}`,{method:"PATCH",body:{hideIpAddressesInLogDrains:i}});if(t.error)throw Error(t.error.message??"An unexpected error occurred. Please try again later.");n(),v.success({text:"IP address visibility in your team's Log Drains has been updated.",key:"ip-visibility-log-drains-toggle-success"})}catch(e){f((0,t.errorToString)(e)),m(!i)}finally{y(!1)}},[e,b,v,n,m]),T=(0,H.useDisabled)()||l||!o||s;return(0,i.jsx)("form",{"data-testid":(0,_.tid)("security-page","hide-ip-addresses-form"),children:(0,i.jsxs)(h.Fieldset,{disabled:T,children:[(0,i.jsxs)(u.FieldsetContent,{children:[(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsx)(ed.FieldsetTitle,{id:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.hideIpAddresses,children:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.hideIpAddresses}),(0,i.jsx)(x.FieldsetSubtitle,{children:"IP addresses may be considered personal information under certain data protection laws. Display or hide IP addresses in the Vercel Dashboard and Log Drains."})]}),(0,i.jsx)(ea.Entity,{"data-testid":(0,_.tid)("security-page","ip-visibility-monitoring"),children:(0,i.jsx)(ec.EntityField,{children:(0,i.jsx)("label",{htmlFor:"toggle-env-var-policy",style:{cursor:"pointer"},children:(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:2,justify:"space-between",children:[(0,i.jsxs)(k.Stack,{children:[(0,i.jsxs)(I.Text,{as:"span",color:"inherit",weight:600,children:["IP addresses are currently"," ",a?"hidden":"visible"," in the Vercel Dashboard."]}),(0,i.jsx)(I.Text,{as:"span",color:"inherit",children:a?(0,i.jsxs)(i.Fragment,{children:["Enabling this setting will show IP addresses in the Vercel Dashboard.",(0,i.jsx)("br",{}),"After enabling, IP addresses may appear in Firewall data, Observability and in Monitoring queries"]}):(0,i.jsxs)(i.Fragment,{children:["Disabling this setting will hide IP addresses the Vercel Dashboard.",(0,i.jsx)("br",{}),"After disabling, IP addresses will no longer appear in Firewall data, Observability and in Monitoring queries."]})})]}),(0,i.jsx)(C.Toggle,{checked:!a,"data-testid":(0,_.tid)("security-page","ip-visibility-monitoring-toggle"),disabled:!o,id:"toggle-env-var-policy",onChange:()=>{S(!a)},size:"large"})]})})})}),(0,i.jsx)(ea.Entity,{children:(0,i.jsx)(ec.EntityField,{children:(0,i.jsx)("label",{htmlFor:"toggle-env-var-policy",style:{cursor:"pointer"},children:(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:2,justify:"space-between",children:[(0,i.jsxs)(k.Stack,{children:[(0,i.jsxs)(I.Text,{as:"span",color:"inherit",weight:600,children:["IP addresses are currently"," ",p?"hidden":"visible"," in your Log Drains."]}),(0,i.jsx)(I.Text,{as:"span",color:"inherit",children:p?(0,i.jsx)(i.Fragment,{children:"Show IP addresses in Log Drains by enabling this setting."}):(0,i.jsx)(i.Fragment,{children:"Hide IP addresses from Log Drains by disabling this setting."})})]}),(0,i.jsx)(C.Toggle,{checked:!p,disabled:!o,onChange:()=>{A(!p)},size:"large"})]})})})})]}),(0,i.jsx)(g.FieldsetFooter,{disabled:!1,highlight:!o,children:(0,i.jsx)(g.FieldsetFooter.Status,{children:j&&j?(0,i.jsx)(el.ErrorText,{children:j}):o?(0,i.jsxs)("span",{children:["For more information, visit our"," ",(0,i.jsx)(E.Link,{external:!0,href:"https://vercel.com/legal/privacy-policy",variant:"highlight",children:"Privacy Notice"})]}):l?(0,i.jsx)(w.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):"You need additional permissions to manage your team's IP address visibility."})})]})})};var eh=e.i(1155472),eg=e.i(631755),ex=e.i(4789498),ep=e.i(8158100),em=e.i(1755874),ej=e.i(4652282),ef=e.i(5729015),eb=e.i(5535439),ey=e.i(7930728),ev=e.i(8700049),eS=e.i(9185154),eA=e.i(7284756),eT=e.i(476315),ew=e.i(2567082),ek=e.i(8735078),eI=e.i(3004270);let eC=()=>{let[e,i]=(0,d.useState)(!1);return[e,(0,d.useCallback)(()=>i(!0),[]),(0,d.useCallback)(()=>i(!1),[])]};var eM=e.i(1336502);function eE(){return null}function e_(e){let{canWriteTable:t,disabled:s,triggerRefetch:n}=e,[r,l]=(0,d.useState)(void 0),{isLoading:o,data:a,mutate:c}=(0,eI.useIPBlocking)({limit:128,offset:r},{refreshInterval:s?0:(0,ew.default)("5m"),isPaused:()=>s});(0,d.useEffect)(()=>{n||c().catch(eE)},[n,c]);let u=(0,d.useMemo)(()=>{let e=(0,eA.default)(a?.result||[],"domain");return Object.keys(e).map(i=>{let t=e[i];return 1===t.length?{...t[0]}:{domain:`${i} (${t.length})`,subRows:t}})},[a?.result]),h=[{Header:"Host",accessor:"domain",ellipsis:!0,expandable:!0},{Header:"IP Address",accessor:"ip",fixedWidth:150,align:"right"},{Header:"Note",accessor:"note",align:"right"},{Header:"Created",accessor:"createdAt",align:"right",fixedWidth:140,Cell:e=>{if(!("createdAt"in e.cell.row.original))return null;let t=new Date(e.cell.row.original.createdAt),s=(0,ey.formatDistanceToNowStrict)(t,{addSuffix:!0,roundingMethod:"floor"});return(0,i.jsx)(i.Fragment,{children:s})}},{Header:"",accessor:"_",fixedWidth:32,disableSortBy:!0,Cell:e=>(0,i.jsx)(eP,{canWriteTable:t,cell:e.cell,refetch:()=>void c().catch(eE)})}];return(0,i.jsx)(k.Stack,{className:eM.default.tableContainer,direction:"column",gap:3,children:o&&void 0===r?(0,i.jsx)(w.Skeleton,{width:"100%"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ek.default,{caption:"Your IP Blocking rules.",columns:h,data:u,empty:"Your team has no IP Blocking rules.",fixed:!0,sortable:!0}),u.length>0&&a?.pagination.next?(0,i.jsx)(eS.LoadMoreButton,{loading:o,noGap:!0,onClick:()=>{l(a.pagination.next)}}):null]})})}function eP(e){let{cell:t,canWriteTable:s,refetch:n}=e,[r,l,o]=eC(),a=t.row.original,{trigger:c,isMutating:d}=(0,eI.useUnblockIPBlockRule)(a.id),u=(0,M.useToasts)();return"subRows"in a?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(S.MenuContainer,{children:[(0,i.jsx)(v.MenuButton,{"aria-label":"Menu",shape:"square",size:"small",type:"tertiary",children:(0,i.jsx)(eT.MoreVertical,{})}),(0,i.jsx)(y.Menu,{children:(0,i.jsx)(A.MenuItem,{disabled:!s,onClick:()=>{l()},type:"error",children:"Delete Rule"})})]}),(0,i.jsxs)(T.Modal.Modal,{active:r,onClickOutside:o,children:[(0,i.jsx)(T.Modal.Body,{children:(0,i.jsxs)(T.Modal.Header,{children:[(0,i.jsx)(T.Modal.Title,{children:"Delete Rule"}),(0,i.jsxs)(T.Modal.Subtitle,{children:["You are about to unblock requests from"," ",(0,i.jsx)(ev.InlineCode,{children:a.ip})," from making requests to"," ",(0,i.jsx)(ev.InlineCode,{children:a.domain}),"."]})]})}),(0,i.jsxs)(T.Modal.Actions,{children:[(0,i.jsx)(T.Modal.Action,{onClick:o,type:"secondary",children:"Cancel"}),(0,i.jsx)(T.Modal.Action,{loading:d,onClick:async()=>{try{await c(a.id),o(),u.success(`Successfully deleted IP Block rule from ${a.ip} for ${a.domain}.`),n()}catch{}},children:"Delete Rule"})]})]})]})}var eF=e.i(9701677);function eL(){let e=(0,eb.useRouter)(),{value:t}=(0,z.useIPBlockingTeamFlag)(),{can:s,isLoading:n}=(0,V.default)(),[r,l,o]=eC(),{team:a}=(0,eo.useAccount)(),c=(0,d.useCallback)(()=>{o()},[o]),[p,j]=(0,d.useState)(""),[f,b]=(0,d.useState)(""),y=ef.default.isIP(p),v=y&&""!==f,[S,A]=(0,d.useState)(!1),[I,C]=(0,d.useState)(void 0),M=s($.Action.Read,$.Resource.IpBlocking),_=s($.Action.Read,$.Resource.IpBlocking),P=M||_,F=s($.Action.All,$.Resource.IpBlocking),{isMutating:L,trigger:N,data:R}=(0,eI.useAddIPBlockRule)({newRule:{ip:p,domain:f}}),O=async()=>{await N({domain:f,ip:p})},D=(0,d.useCallback)(()=>{e.push(`/dashboard/${a?.slug||""}/monitoring?title=Blocked Requests from ${p} on ${f}&visualize=sum%28blocked_requests%29&where=host+%3D+%27${f}%27+and+public_ip+%3D+%27${p}%27&groupBy=host%2Cpublic_ip`)},[f,p,e,a?.slug]);if((0,d.useEffect)(()=>{eN(R)?C(R):void 0!==R&&C(!1)},[R]),!0!==t)return null;let G=a?.billing?.plan==="enterprise",U=n||!P||!G;return(0,i.jsxs)(H.DisabledContext.Provider,{value:U,children:[(0,i.jsx)(J,{className:eF.default.container,id:"ip-blocking",children:(0,i.jsxs)(h.Fieldset,{disabled:!G||!M||!F||!P,children:[(0,i.jsxs)(u.FieldsetContent,{children:[(0,i.jsx)(em.FieldsetTitle,{id:"ip-blocking-title",children:(0,i.jsxs)(k.Stack,{className:eF.default.titleContent,direction:"row",justify:"space-between",children:[(0,i.jsx)(k.Stack,{direction:"row",gap:2,children:(0,i.jsx)("span",{children:"IP Blocking"})}),(0,i.jsx)("div",{children:(0,i.jsx)(m.Button,{disabled:!F,onClick:l,size:"small",suffix:(0,i.jsx)(ej.Plus,{}),type:"secondary",children:"Create New Rule"})})]})}),(0,i.jsx)(x.FieldsetSubtitle,{children:"Configure the IP addresses that Vercel should block requests from. Blocked requests will not contribute to your bill."}),(0,i.jsx)(e_,{canWriteTable:F,disabled:U,triggerRefetch:r})]}),(0,i.jsx)(g.FieldsetFooter,{disabled:!1,highlight:!G||!M||!F||!P,children:n?(0,i.jsx)(w.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):G?P&&F?(0,i.jsxs)("span",{children:["Learn more about ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/security/vercel-waf/ip-blocking",variant:"highlight",children:"IP Blocking"})]}):(0,i.jsx)("span",{children:"You need additional permissions to manage your team's IP Blocking."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{children:["IP Blocking is available on the"," ",(0,i.jsx)(E.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,i.jsx)(g.FieldsetFooter.Actions,{children:(0,i.jsx)(E.ButtonLink,{href:B.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]})})]})}),(0,i.jsx)(T.Modal,{active:r,disableFocusTrap:!0,onAnimationDone:()=>{b(""),j(""),A(!1),C(void 0)},onClickOutside:c,children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),O()},children:[(0,i.jsxs)(T.Modal.Body,{children:[(0,i.jsxs)(T.Modal.Header,{children:[(0,i.jsx)(T.Modal.Title,{children:"Create New IP Block Rule"}),(0,i.jsx)(T.Modal.Subtitle,{children:"An IP Block Rule will block all requests from an IP Address for a host."})]}),(0,i.jsxs)(k.Stack,{gap:4,children:[(0,i.jsxs)(k.Stack,{gap:3,children:[(0,i.jsx)(ex.Label,{id:"ip-address",value:"IP Address",children:(0,i.jsx)(eg.Input,{autoFocus:!0,disabled:!1===I,error:!y&&S?"Please enter a valid IPv4 address.":void 0,id:"ip-address",onBlur:()=>A(p.length>0),onChange:e=>{j(e.target.value)},pattern:"[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}",placeholder:"127.0.0.1",required:!0,value:p,width:"100%"})}),(0,i.jsx)(ex.Label,{id:"host",value:"Host",children:(0,i.jsx)(eg.Input,{disabled:!1===I,id:"host",onBlur:()=>A(f.length>0),onChange:e=>{b(e.target.value)},placeholder:"example.com",required:!0,value:f,width:"100%"})})]}),eN(I)?(0,i.jsx)(ep.Note,{type:"error",children:I.error.message}):null,!1===I?(0,i.jsx)(ep.Note,{label:!1,type:"success",children:"Rule created."}):null]})]}),(0,i.jsxs)(T.Modal.Actions,{children:[!1!==I&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"}),(0,i.jsx)(T.Modal.Action,{buttonType:"submit",disabled:!v,loading:L,children:"Create IP Block Rule"})]}),!1===I&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.Modal.Action,{buttonType:"button",onClick:c,type:"secondary",children:"Close"}),(0,i.jsx)(T.Modal.Action,{buttonType:"button",onClick:D,children:"View in Monitoring"})]})]})]})})]})}let eN=e=>void 0!==e&&!1!==e&&"error"in e;var eR=e.i(9240532),eO=e.i(7918027);let eD={hostname:"",rule:"",note:""};function eB(e){let{rule:t,hostname:s}=e,{team:n}=(0,eo.useAccount)(),r=`/dashboard/${n?.slug||""}/monitoring?title=Blocked Requests from ${t} on ${s}&visualize=sum%28blocked_requests%29&where=host+%3D+%27${s}%27+and+public_ip+%3D+%27${t}%27&groupBy=host%2Cpublic_ip`;return(0,i.jsx)(E.ButtonLink,{href:r,children:"View Rule in Monitoring"})}function eG(e){var t;let{active:s,close:n}=e,[r,l]=(0,d.useState)({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:null}),[o,a]=(0,d.useState)({...eD}),{isMutating:c,trigger:u,error:h}=(0,eI.useAddIPBlockRuleV2)(),g=()=>{n(),l({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:null}),a({...eD})},{isValid:x,errorMsg:p}=function(e){if(ef.default.isIP(e))return{isValid:!0,errorMsg:""};if(ef.default.isIPRange(e)){let[i,t]=e.split("/"),s=Number.parseInt(t,10);return i.includes(".")?s<16?{isValid:!1,errorMsg:"IPv4 CIDR cannot have a net mask less than /16"}:{isValid:!0,errorMsg:""}:s<48?{isValid:!1,errorMsg:"IPv6 CIDR cannot have a net mask less than /48"}:{isValid:!0,errorMsg:""}}return{isValid:!1,errorMsg:"Please enter a valid IP address or CIDR."}}(o.rule),m=(t=o.hostname,/^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(?:\.(?!-)[A-Za-z0-9-]{1,63}(?<!-))*$/.test(t)),j=o.note.length<=500,{showErrors:f,succeeded:b}=r;return(0,i.jsx)(T.Modal,{active:s,disableFocusTrap:!0,onAnimationDone:()=>{a({...eD})},onClickOutside:g,children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u(o).then(()=>{l({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:!0})}).catch(()=>{l({showErrors:{ip:!0,hostname:!0,notes:!0},succeeded:!1})})},children:[(0,i.jsxs)(T.Modal.Body,{children:[(0,i.jsxs)(T.Modal.Header,{children:[(0,i.jsx)(T.Modal.Title,{children:"Configure New Domain Protection"}),(0,i.jsx)(T.Modal.Subtitle,{children:"Configure the Advanced Firewall for a domain associated with your team's projects."})]}),(0,i.jsxs)(k.Stack,{gap:4,children:[(0,i.jsxs)(k.Stack,{gap:3,children:[(0,i.jsx)(ex.Label,{id:"ip-address",value:"IP Address or CIDR",children:(0,i.jsx)(eg.Input,{autoFocus:!0,disabled:!0===b,error:!x&&f.ip?p:void 0,id:"ip-address",onBlur:()=>l({...r,showErrors:{...r.showErrors,ip:o.rule.length>0}}),onChange:e=>{a({...o,rule:e.target.value})},placeholder:"127.0.0.1/24",required:!0,value:o.rule,width:"100%"})}),(0,i.jsx)(ex.Label,{id:"host",value:"Host",children:(0,i.jsx)(eg.Input,{disabled:!0===b,error:!m&&f.hostname?`Hostname is invalid ${o.hostname.startsWith("*")?"(wildcard not supported.)":""}`:void 0,id:"host",onBlur:()=>l({...r,showErrors:{...r.showErrors,hostname:o.hostname.length>0}}),onChange:e=>{a({...o,hostname:e.target.value})},placeholder:"example.com",required:!0,value:o.hostname,width:"100%"})}),(0,i.jsx)(ex.Label,{id:"note",value:"Note",children:(0,i.jsx)(eO.Textarea,{error:!j&&f.notes?"Note cannot be longer than 500 characters":void 0,id:"note",onBlur:()=>l({...r,showErrors:{...r.showErrors,notes:o.note.length>0}}),onChange:e=>{a({...o,note:e.target.value})},placeholder:"Add an optional reason for the block rule",rows:3,value:o.note})})]}),h?(0,i.jsx)(ep.Note,{type:"error",children:h.message}):null,b?(0,i.jsx)(ep.Note,{label:!1,type:"success",children:"Rule created."}):null]})]}),(0,i.jsx)(T.Modal.Actions,{children:b?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.Modal.Action,{buttonType:"button",onClick:g,type:"secondary",children:"Close"}),(0,i.jsx)(eB,{hostname:o.hostname,rule:o.rule})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.Modal.Action,{disabled:c,onClick:g,type:"secondary",children:"Cancel"}),(0,i.jsx)(T.Modal.Action,{buttonType:"submit",disabled:!(x&&m),loading:c,children:"Create IP Block Rule"})]})})]})})}function ez(){let{value:e}=(0,z.useIPBlockingTeamFlag)(),{can:t,isLoading:s}=(0,V.default)(),[n,r,l]=eC(),{team:o}=(0,eo.useAccount)(),a=t($.Action.Read,$.Resource.IpBlocking),c=t($.Action.Read,$.Resource.IpBlocking),d=a||c,p=t($.Action.All,$.Resource.IpBlocking);if(!0!==e)return null;let j=o?.billing?.plan==="enterprise",f=s||!d||!j;return(0,i.jsxs)(H.DisabledContext.Provider,{value:f,children:[(0,i.jsx)(J,{className:eF.default.container,id:"ip-blocking",children:(0,i.jsxs)(h.Fieldset,{disabled:!j||!a||!p||!d,children:[(0,i.jsxs)(u.FieldsetContent,{children:[(0,i.jsx)(em.FieldsetTitle,{id:"ip-blocking-title",children:(0,i.jsxs)(k.Stack,{className:eF.default.titleContent,direction:"row",justify:"space-between",children:[(0,i.jsx)(k.Stack,{direction:"row",gap:2,children:(0,i.jsx)("span",{children:(0,i.jsx)(eR.SearchContextHighlighter,{children:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.ipBlocking})})}),(0,i.jsx)("div",{children:(0,i.jsx)(m.Button,{disabled:!p,onClick:r,size:"small",suffix:(0,i.jsx)(ej.Plus,{}),type:"secondary",children:"Create New Rule"})})]})}),(0,i.jsx)(x.FieldsetSubtitle,{children:"Configure the IP addresses and CIDRs that Vercel should block requests from. Blocked requests will not contribute to your bill."}),(0,i.jsx)(e_,{canWriteTable:p,disabled:f,triggerRefetch:n})]}),(0,i.jsx)(g.FieldsetFooter,{disabled:!1,highlight:!j||!a||!p||!d,children:s?(0,i.jsx)(w.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):j?d&&p?(0,i.jsxs)("span",{children:["Learn more about ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/security/vercel-waf/ip-blocking",variant:"highlight",children:"IP Blocking"})]}):(0,i.jsx)("span",{children:"You need additional permissions to manage your team's IP Blocking."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{children:["IP Blocking is available on the"," ",(0,i.jsx)(E.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,i.jsx)(g.FieldsetFooter.Actions,{children:(0,i.jsx)(E.ButtonLink,{href:B.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]})})]})}),(0,i.jsx)(eG,{active:n,close:l})]})}function eV(){let{value:e}=(0,z.useCIDRBlockingTeamFlag)();return e?(0,i.jsx)(ez,{}):(0,i.jsx)(eL,{})}var e$=e.i(6458203),eH=e.i(8418504),eU=e.i(7095283),eq=e.i(4283941),eW=e.i(3821772),eY=e.i(555528),eJ=e.i(7078371),eK=e.i(9630325),eX=e.i(2774739),eZ=e.i(969352),eQ=e.i(7057043),e0=e.i(5617834),e1=e.i(6921100);function e2(e){let{value:t,onChange:s,disabled:n,placeholder:r}=e,{teamRoles:l}=(0,e0.useAvailableRolesInfo)(),{accessGroups:o}=(0,eQ.useAccessGroups)();return(0,i.jsxs)(e1.Select,{disabled:n,onChange:e=>{s(e.target.value)},placeholder:t?void 0:r,size:"small",value:t,width:180,children:[(0,i.jsx)("option",{disabled:!0,children:"Roles"}),l.map(e=>{let{role:t,label:s,description:n}=e;return(0,i.jsx)("option",{title:n,value:t,children:s},t)}),(0,i.jsx)("option",{disabled:!0,children:"─"}),(0,i.jsx)("option",{disabled:!0,children:"Access Groups"}),o?.map(e=>{let{accessGroupId:t,name:s}=e;return(0,i.jsx)("option",{value:t,children:s},t)})]})}var e5=e.i(4955104);function e3(){let{team:e,mutate:s}=(0,R.useTeam)(),{user:n}=(0,O.useUser)(),{can:r}=(0,V.default)(),l=r($.Action.Update,$.Resource.SamlConfig),a=r($.Action.Read,$.Resource.SamlConfig),u=(0,e0.useAvailableRolesInfo)(),{value:h}=(0,z.useHasNewRBAC)(),g=(0,D.useIsMobile)(),x=(0,M.useToasts)(),[j,w]=(0,d.useState)(!1),[C,E]=(0,d.useState)(null),[_,B]=(0,d.useState)(!1),[G,H]=(0,d.useState)(!1),[U,q]=(0,d.useState)(!1),W=(0,d.useRef)(e?.saml?.roles||{}),[Y,J]=(0,d.useState)(()=>e?.saml?.roles||{}),K=(0,d.useRef)(null),X=(0,N.isDSyncConfigured)(e),Z="VIEWER",ee=`Default: ${(0,eq.default)(Z)}`;(0,d.useEffect)(()=>{let i=e?.saml?.roles||{};W.current=i,J(i)},[e]);let{data:ei}=(0,eU.default)((i,t)=>{if(!e||!X||!a)return null;let s=`${L.API_TEAMS}/${e.id}/dsync/groups`;if(!t)return s;let n=t.pagination.before;return n?`${s}?before=${n}`:null},e=>(0,F.fetchAPI)(e,{throwOnHTTPError:!0}),{revalidateOnFocus:!1,refreshInterval:0,initialSize:500}),{data:et,isLoading:es}=(0,eU.default)((i,t)=>{if(!(X&&e&&a)||!_)return null;let s=`${L.API_TEAMS}/${e.id}/dsync/users`;if(!t)return s;let n=t.pagination.before;return n?`${s}?before=${n}`:null},e=>(0,F.fetchAPI)(e,{throwOnHTTPError:!0}),{revalidateOnFocus:!1,refreshInterval:0,initialSize:3e3}),{accessGroups:en}=(0,eQ.useAccessGroups)(),er=et?.reduce((e,i)=>i?e.concat(i.users):e,[]),el=(0,d.useMemo)(()=>ei?.reduce((e,i)=>i?e.concat(i.groups):e,[]),[ei]);(0,d.useEffect)(()=>{if(!el)return;let e=el.reduce((e,i)=>(i.predefinedRole&&(e[i.id]=i.predefinedRole),e),{});J(i=>{let t={...i,...e};return W.current=t,t})},[el]);let{lastReceivedWebhookEvent:eo,type:ea}=e?.saml?.directory||{},ec=(0,eX.useAgo)(eo),ed=ea&&eJ.DirectorySyncType[ea],eu=ea&&eJ.DirectorySyncLogo[ea],eh=(0,d.useMemo)(()=>er?e4(er,Y,u.teamRoles,en,!!h):[],[er,Y,u,h,en]);async function eg(){if(e&&Y){w(!0);try{await (0,F.fetchAPI)(`${L.API_TEAMS}/${e.id}`,{method:"PATCH",body:JSON.stringify({saml:{roles:Y}}),throwOnHTTPError:!0}),W.current=Y,B(!1),x.success("Directory Sync configured successfully.")}catch(e){E((0,t.normalizeError)(e))}w(!1)}}let ex=en?.reduce((e,i)=>(e[i.accessGroupId]=i.name,e),{})||{},em=(0,d.useCallback)(()=>{if(e&&l){if(K.current)return void K.current.open();try{let i=`${location.origin}/popups/saml-sso${(0,P.encode)({teamSlug:e.slug})}`,t=`${L.API_TEAMS}/${e.id}/sso/configure${(0,P.encode)({intent:"dsync",next:i,redirect:1})}`,n=e.slug;K.current=new Q.default({id:"saml-configure-popup",width:1200,height:840,url:t,callbacks:{onPoll:async e=>{let t;try{t=e.location.href}catch(e){return}if(t===i){K.current?.cancelPolling(),K.current?.close();let e=await s();if(e?.teams){let i=e.teams.find(e=>e.slug===n);(0,N.isDSyncConfigured)(i)&&(E(null),X||B(!0))}else E({message:"Failed to fetch updated Team information."});K.current=null}},onClose:()=>{K.current=null},onAbort:()=>{K.current=null},onBlocked:()=>{E({message:"The popup to configure Directory Sync could not be opened."}),K.current=null}}}),K.current.open()}catch(e){E((0,t.normalizeError)(e))}}},[l,X,s,e]),ej=()=>{B(!1)},ef=async()=>{if(e){w("removeDsync");try{await (0,F.fetchAPI)(`${L.API_TEAMS}/${e.id}/dsync`,{method:"DELETE",throwOnHTTPError:!0}),await s(),E(null),x.success("Removed Directory Sync configuration successfully.")}catch(e){E((0,t.normalizeError)(e))}w(!1),q(!1)}},eb=(0,d.useCallback)(()=>{if(l){if(X)return B(!0);em()}},[l,X,em]),ey=e?.membership?.role.toLowerCase()??"",ev=(0,d.useMemo)(()=>eh.find(e=>Object.values(e.users).find(e=>e?.connectedUserId===n?.uid)),[eh,n?.uid]),eS=ev?.role.toLowerCase()??ey,eA=[];return Object.values(Y).forEach(e=>{let i=e&&"string"!=typeof e&&"accessGroupId"in e?e.accessGroupId:null,t=en?.find(e=>e.accessGroupId===i);t&&!t.isDsyncManaged&&t.membersCount>0&&!eA.find(e=>e.accessGroupId===t.accessGroupId)&&eA.push(t)}),(0,i.jsxs)("div",{className:"tailwind-preflight",children:[(0,i.jsx)(f.Entity.List,{children:(0,i.jsx)(f.Entity,{left:(0,i.jsx)("div",{children:ea?(0,i.jsx)(p.Avatar,{size:32,src:eu}):(0,i.jsx)("div",{className:e5.default.circleIcon,children:(0,i.jsx)(e$.BookOpen,{size:16})})}),right:(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:4,children:[!g&&(0,i.jsx)(m.Button,{disabled:!l,onClick:eb,size:"small",children:"Configure"}),X?(0,i.jsx)(o.CheckCircleFill,{color:"blue-700",size:20}):null,(0,i.jsxs)(S.MenuContainer,{children:[(0,i.jsx)(v.MenuButton,{"aria-label":"Show options",disabled:!X&&!g,svgOnly:!0,type:"tertiary",children:(0,i.jsx)(c.MoreHorizontal,{})}),(0,i.jsxs)(y.Menu,{children:[X?(0,i.jsx)(A.MenuItem,{disabled:!l,onClick:()=>em(),children:"Manage"}):null,g?(0,i.jsx)(A.MenuItem,{onClick:eb,children:"Configure"}):null,X?(0,i.jsx)(A.MenuItem,{disabled:!l,onClick:()=>q(!0),type:"error",children:"Remove"}):null]})]})]}),children:(0,i.jsx)(f.Entity.Content,{description:X?"Manage the configuration with your Directory Provider.":"Provision and de-provision accounts with your directory provider.",title:(0,i.jsxs)(k.Stack,{direction:{sm:"column",md:"row",lg:"row"},gap:{sm:0,md:2,lg:2},children:[(0,i.jsx)(I.Text,{weight:600,children:ed||"Directory Sync"}),eo?(0,i.jsx)(eY.Tooltip,{cursor:"pointer",text:(0,i.jsxs)(i.Fragment,{children:["Last time a user or group event was received."," ",(0,i.jsx)("span",{style:{whiteSpace:"nowrap"},children:(0,eK.formatDateAndTime)(eo)}),"."]}),children:(0,i.jsxs)(I.Text,{color:"gray-900",children:["Last synced ",ec]})}):null]})})})}),C?(0,i.jsx)(b.Error,{className:"pt-4",error:C}):null,(0,i.jsxs)(T.Modal.Modal,{active:U,onClickOutside:()=>q(!1),children:[(0,i.jsxs)(T.Modal.Body,{children:[(0,i.jsx)(T.Modal.Title,{children:"Disconnect Directory Sync"}),(0,i.jsx)("div",{children:(0,i.jsx)(T.Modal.Subtitle,{children:"You are about to remove the Directory Sync Configuration. After removing it, changes to users and groups in your Identity Provider will not be reflected on Vercel."})}),(0,i.jsx)(T.Modal.Subtitle,{children:"Do you want to continue?"})]}),(0,i.jsxs)(T.Modal.Actions,{children:[(0,i.jsx)(T.Modal.Action,{onClick:()=>q(!1),type:"secondary",children:"Cancel"}),(0,i.jsx)(T.Modal.Action,{loading:"removeDsync"===j,onClick:ef,children:"Continue"})]})]}),(0,i.jsx)(T.Modal.Modal,{active:_,disableFocusTrap:!0,onAnimationDone:()=>{H(!1),J(W.current)},onClickOutside:ej,width:500,children:G?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(T.Modal.Body,{children:[(0,i.jsx)(T.Modal.Title,{children:"Directory Sync"}),(0,i.jsx)("div",{children:(0,i.jsx)(T.Modal.Subtitle,{children:(0,i.jsxs)(k.Stack,{gap:4,paddingBottom:4,children:[(0,i.jsx)(I.Text,{color:"gray-900",children:"Continuing will synchronize your Vercel Team Member accounts with your Directory Provider, allowing you to provision and de-provision accounts and manage permissions on Vercel."}),ey!==eS?(0,i.jsxs)(ep.Note,{fill:!0,type:"warning",children:["Based on the current assignments, your role will change from ",(0,i.jsx)("span",{className:e5.default.capitalize,children:ey})," to ",(0,i.jsx)("span",{className:e5.default.capitalize,children:eS}),"."]}):null,eA.length?(0,i.jsxs)(ep.Note,{fill:!0,type:"warning",children:["Access Groups linked to Directory Sync will have their members synced. All other members will be removed. Affected Access groups: ",eA.map(e=>e.name).join(", ")]}):null]})})}),es?(0,i.jsx)(T.Modal.Inset,{children:(0,i.jsx)(k.Stack,{align:"center",justify:"center",children:(0,i.jsxs)(k.Stack,{direction:"row",gap:3,children:[(0,i.jsx)(I.Text,{align:"center",children:"Loading Users"}),(0,i.jsx)(eW.Spinner,{})]})})}):null,eh.length?(0,i.jsxs)(T.Modal.Outset,{children:[(0,i.jsx)("hr",{className:"geist-hr-reset"}),eh.map(e=>Object.keys(e.users).length?(0,i.jsx)(eZ.Details,{title:(0,i.jsxs)(k.Stack,{direction:"row",justify:"space-between",style:{width:"100%"},children:[(0,i.jsxs)("div",{className:"font-semibold",children:[e.name," (",Object.keys(e.users).length," user",Object.keys(e.users).length>1?"s":"",")"]}),(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:2,children:[(0,i.jsx)(p.Avatar,{size:20,src:eu}),(0,i.jsx)(e7,{groups:e.groups}),(0,i.jsx)(e6,{groups:e.accessGroups})]})]}),children:Object.values(e.users).map(e=>{let t=new Set(e?.groups.map(e=>{let i=Y[e.id];return i&&"string"!=typeof i?ex[i.accessGroupId]:null}).filter(Boolean));return e?(0,i.jsxs)(eZ.Item,{children:[(0,i.jsxs)(k.Stack,{direction:"row",flex:1,children:[e.firstName?(0,i.jsxs)(I.Text,{weight:500,children:[e.firstName," ",e.lastName]}):null,e.email?(0,i.jsxs)(I.Text,{color:"gray-900",children:[e.firstName?(0,i.jsx)(i.Fragment,{children:" • "}):null,e.email]}):null]}),t.size?(0,i.jsx)(eY.Tooltip,{text:(0,i.jsxs)(k.Stack,{align:"flex-start",children:[(0,i.jsx)("strong",{children:"Access Groups"}),Array.from(t).map(e=>(0,i.jsx)("div",{className:"max-w-48 overflow-hidden truncate whitespace-nowrap",children:(0,i.jsx)(I.Text,{children:e})},e))]}),children:(0,i.jsx)("div",{className:e5.default.circleIconSmall,children:(0,i.jsx)(eH.Users,{size:12})})}):null]},e.id):null})},e.name):null)]}):null]}),(0,i.jsxs)(T.Modal.Actions,{children:[(0,i.jsx)(T.Modal.Action,{onClick:()=>H(!1),type:"secondary",children:"Back"}),(0,i.jsx)(T.Modal.Action,{onClick:eg,children:"Confirm and Sync"})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.Modal.Body,{children:(0,i.jsxs)("div",{children:[(0,i.jsx)(T.Modal.Title,{children:"Directory Sync"}),(0,i.jsxs)(I.Text,{color:"gray-900",children:["Choose which roles will be assigned to synced members. Non-configured groups default to the Viewer role.",h?" Users can be part of multiple groups and have multiple roles.":null]}),(0,i.jsxs)("div",{className:"flex items-center justify-center pb-4 pt-6",children:[(0,i.jsxs)("div",{className:"flex w-28 flex-col items-center gap-2",children:[(0,i.jsx)(p.Avatar,{size:48,src:eu}),(0,i.jsx)(I.Text,{color:"gray-900",title:ed,truncate:!0,weight:500,children:ed})]}),(0,i.jsx)(e8,{}),(0,i.jsxs)("div",{className:"flex w-28 flex-col items-center gap-2",children:[(0,i.jsx)(p.Avatar,{size:48,teamId:e?.id}),(0,i.jsx)(I.Text,{color:"gray-900",title:e?.name,truncate:!0,weight:500,children:e?.name})]})]}),(0,i.jsx)(T.Modal.Outset,{children:(0,i.jsx)("div",{style:{overflow:"scroll",maxHeight:"40vh"},children:el?el.map(e=>{let t,s=!1;if(e.id in Y){var n;let i=Y[e.id];t=i?"string"==typeof(n=i)?n:"accessGroupId"in n?n.accessGroupId:n:Z}return e.predefinedRole&&u.teamRoles.find(i=>i.role===e.predefinedRole)&&(t=e.predefinedRole,s=!0),(0,i.jsxs)(d.Fragment,{children:[(0,i.jsx)("hr",{className:"geist-hr-reset"}),(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:1,justify:"space-between",style:{padding:"var(--geist-gap-half) var(--geist-gap)"},children:[(0,i.jsx)(k.Stack,{align:"center",direction:"row",gap:2,style:{flexBasis:"60%"},children:(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:2,children:[(0,i.jsx)(p.Avatar,{size:20,src:eu}),(0,i.jsx)(I.Text,{weight:500,children:e.name})]})}),(0,i.jsx)(eY.Tooltip,{disableTriggers:!s,text:"This group has a predefined role which cannot be modified.",children:(0,i.jsx)(e2,{disabled:s,onChange:i=>{var t;let s=(t=i).startsWith("ag_")?{accessGroupId:t}:t;J({...Y,[e.id]:s})},placeholder:ee,value:t})})]})]},e.id)}):(0,i.jsx)(T.Modal.Inset,{children:(0,i.jsx)(k.Stack,{align:"center",justify:"center",children:(0,i.jsxs)(k.Stack,{direction:"row",gap:3,children:[(0,i.jsx)(I.Text,{align:"center",children:"Loading Groups"}),(0,i.jsx)(eW.Spinner,{})]})})})})})]})}),(0,i.jsxs)(T.Modal.Actions,{children:[(0,i.jsx)(T.Modal.Action,{onClick:ej,type:"secondary",children:"Cancel"}),(0,i.jsx)(T.Modal.Action,{onClick:()=>H(!0),children:"Continue"})]})]})})]})}let e4=(e,i,t,s,n)=>{let r={},l=t.map(e=>e.role);for(let e of t)r[e.role]={name:e.label,role:e.role,groups:{},accessGroups:{},users:{}};let o=new Set;for(let t of e){let e=[];for(let n of t.groups){let l=i[n.id];if(l){if(n.predefinedRole){e.push(n.predefinedRole);continue}if("string"==typeof l&&r[l]){r[l].groups[n.id]=n,e.push(l);continue}if("string"!=typeof l){o.add(t.id);let i=s?.find(e=>e.accessGroupId===l.accessGroupId);if(!i)continue;let a=s?.find(e=>e.accessGroupId===l.accessGroupId)?.teamRoles;for(let t of(a&&e.push(...a),a||[]))r[t]&&(r[t].groups[n.id]=n,r[t].accessGroups[l.accessGroupId]=i)}}}let a=o.has(t.id)?"CONTRIBUTOR":"VIEWER",c=l.filter(i=>e.includes(i));0===c.length&&c.push(a);let d=l.find(e=>t.groups.some(i=>i.predefinedRole===e));for(let e of n?c:[d||c[0]||a])r[e]&&(r[e].users[t.id]=t)}return l.map(e=>r[e]).filter(e=>void 0!==e)};function e7(e){let{groups:t}=e;return Object.keys(t).length>0?(0,i.jsxs)(i.Fragment,{children:[1===Object.keys(t).length?(0,i.jsx)(I.Text,{weight:500,children:Object.values(t)[0]?.name}):null,Object.values(t).length>1?(0,i.jsx)(eY.Tooltip,{text:Object.values(t).map(e=>e?.name).join("\n"),children:(0,i.jsxs)(I.Text,{children:[Object.values(t).length," groups"]})}):null]}):(0,i.jsx)(I.Text,{children:"No group"})}function e6(e){let{groups:t}=e,s=Object.values(t);return 0===s.length?null:(0,i.jsx)(eY.Tooltip,{text:(0,i.jsxs)("div",{className:"text-left",children:[(0,i.jsx)("strong",{children:"Access Groups"}),s.map(e=>(0,i.jsx)("div",{className:"max-w-48 overflow-hidden truncate whitespace-nowrap",children:(0,i.jsx)(I.Text,{children:e?.name})},e?.accessGroupId))]}),children:(0,i.jsx)("div",{className:e5.default.circleIconSmall,children:(0,i.jsx)(eH.Users,{size:12})})})}function e8(){return(0,i.jsxs)("svg",{fill:"none",height:"24",width:"66",children:[(0,i.jsx)("path",{d:"M65 11.625H1",stroke:"var(--accents-4)",strokeDasharray:"3 3",strokeLinecap:"square"}),(0,i.jsx)("rect",{fill:"var(--geist-background)",height:"24",rx:"12",width:"24",x:"21"}),(0,i.jsx)("path",{d:"M33 22c5.523 0 10-4.477 10-10S38.523 2 33 2 23 6.477 23 12s4.477 10 10 10z",fill:"var(--accents-5)"}),(0,i.jsx)("g",{clipPath:"url(#clip0)",stroke:"var(--geist-background)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",children:(0,i.jsx)("path",{d:"M34.5 9.5H36a2.5 2.5 0 110 5h-1.5m-3 0H30a2.5 2.5 0 010-5h1.5M31 12h4"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0",children:(0,i.jsx)("path",{d:"M0 0h12v12H0z",fill:"var(--geist-background)",transform:"translate(27 6)"})})})]})}var e9=e.i(6787183),ie=e.i(8010833),ii=e.i(9284176),it=e.i(1095473),is=e.i(36632),ir=e.i(5144966),il=e.i(6683076),io=e.i(4196468),ia=e.i(8466107),ic=e.i(9590492),id=e.i(3621043),iu=e.i(6008643),ih=e.i(429832),ig=e.i(5036602);function ix(e){let{gitProvider:t,skeleton:s=!1,onGitScopeChange:n,onSwitchGitProvider:r,onAddGitAccountSuccess:l,disabledScopes:o,...a}=e,{data:c,mutate:u}=(0,iu.default)({provider:t}),h=(0,d.useCallback)(e=>{(async()=>{let i=await u(),t=i?.find(i=>i.installationId===e.installationId);l?.(t)})()},[u,l]),{open:g}=(0,ih.default)({onSuccess:h});return(0,i.jsx)(w.Skeleton,{show:s,children:(0,i.jsxs)(id.Combobox,{className:"select-git-scope",clearable:!1,onChange:function(e){switch(e){case"switch-git-provider":r?.();break;case"add-github-account":g();break;default:{let i=c?.find(i=>i.slug===e);if(!i)break;n?.(i)}}},placeholder:"Select Git Scope",...a,children:[(0,i.jsx)(id.Combobox.Input,{}),(0,i.jsx)(id.Combobox.List,{children:(0,i.jsxs)(i.Fragment,{children:[c?.map(e=>(0,i.jsx)(id.Combobox.Option,{disabled:o?.some(i=>{let{scope:t}=i;return t===e.name}),isMenu:!1,prefix:(0,i.jsx)(ig.default,{gitType:e.provider}),suffix:(0,i.jsx)(I.Text,{color:"gray-900",size:14,children:o?.find(i=>{let{scope:t}=i;return t===e.name})?.reason}),value:String(e.slug),children:e.name},e.slug)),"github"===t?(0,i.jsx)(id.Combobox.Option,{isMenu:!0,prefix:(0,i.jsx)(ej.Plus,{}),value:"add-github-account",children:"Add GitHub Account"}):null,r?(0,i.jsx)(id.Combobox.Option,{"data-testid":(0,_.tid)("git-scope-combobox","switch-git-provider"),isMenu:!0,prefix:(0,i.jsx)(ic.ListUnordered,{}),value:"switch-git-provider",children:"Switch Git Provider"}):null]})})]})})}function ip(e){let{isOpen:t,setIsOpen:s,onAdd:n,selectedScopes:r}=e,[l,o]=(0,d.useState)(null),[a,c]=(0,d.useState)(!1),[u,h]=(0,d.useState)(null),[{localGitAccount:g},x]=(0,d.useReducer)(ia.reducer,{search:null,debouncedSearch:null,ts:Date.now()}),p=async()=>{if(u&&g?.provider){o(null),c(!0);try{await n({gitProvider:g.provider,gitNamespaceId:im(u),gitNamespaceOwnerType:u.ownerType}),c(!1),h(null),x({type:"SET_GIT_ACCOUNT",gitAccount:null}),M.toasts.success("Protected Git scope added.")}catch(e){c(!1),(0,is.isError)(e)?o(e):o({message:"Unable to add protected Git scope."});return}s(!1)}},m=(0,d.useCallback)(()=>{s(!1),setTimeout(()=>{h(null),x({type:"SET_GIT_ACCOUNT",gitAccount:null}),o(null)},500)},[s,o]),j=(0,d.useCallback)(()=>{h(null),x({type:"SET_GIT_ACCOUNT",gitAccount:null}),o(null)},[x]),f=(0,d.useMemo)(()=>g?(0,i.jsxs)(k.Stack,{gap:3,children:[(0,i.jsx)(ix,{disabledScopes:r?.map(e=>({scope:e,reason:"Added"})),gitProvider:g.provider,onGitScopeChange:h}),l?(0,i.jsx)(ep.Note,{type:"error",children:l.message}):null]}):(0,i.jsx)(k.Stack,{gap:3,children:["github","gitlab","bitbucket"].map(e=>(0,i.jsx)("div",{children:(0,i.jsx)(ia.ConnectGitButton,{"data-testid":(0,_.tid)("select-git-repository","choose-provider",e),dispatch:x,gitType:e})},e))}),[g,l,r]),b=(0,d.useCallback)(()=>g?(0,i.jsx)(T.Modal.Action,{onClick:j,type:"secondary",children:"Back"}):(0,i.jsx)(T.Modal.Action,{onClick:m,type:"secondary",children:"Cancel"}),[g,j,m]),y=(0,d.useMemo)(()=>g?`Select a ${g.provider} scope to protect:`:"To protect your git repositories, select a Git provider and then choose the scope to protect.",[g]);return(0,i.jsxs)(T.Modal,{active:t,onClickOutside:m,children:[(0,i.jsxs)(T.Modal.Body,{children:[(0,i.jsxs)(T.Modal.Header,{children:[(0,i.jsx)(T.Modal.Title,{children:"Add Protected Git Scope"}),(0,i.jsx)(T.Modal.Subtitle,{children:y})]}),f]}),(0,i.jsxs)(T.Modal.Actions,{children:[(0,i.jsx)(b,{}),(0,i.jsx)(T.Modal.Action,{disabled:!u,loading:a,onClick:p,children:"Save"})]})]})}let im=e=>"bitbucket"===e.provider?e.id.toString():e.slug;function ij(){let{team:e}=(0,eo.useAccount)(),{can:t,isLoading:s}=(0,V.default)(),n=t($.Action.Update,$.Resource.TeamGitExclusivity),r=t($.Action.List,$.Resource.TeamGitExclusivity),[l,o]=(0,d.useState)(!1),a=e?.billing?.plan==="enterprise",{data:{gitExclusivity:c}={},isLoading:p,mutate:j}=(0,ir.useListGitExclusivity)({teamId:a&&r?e.id:void 0}),f=!e||p,b=(0,H.useDisabled)()||s||!n||!a,y=async i=>{e&&(await (0,ir.postGitExclusivity)({teamId:e.id,...i}),await j())},v=async e=>{await (0,ir.removeGitExclusivity)(e),await j()},S=(0,d.useMemo)(()=>n?c&&c.length>=5?"You have reached the maximum number of protected Git scopes.":void 0:"You do not have permission to add protected Git scopes.",[n,c]),A=(0,d.useMemo)(()=>s?null:a?n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.FieldsetFooter.Status,{children:(0,i.jsxs)("span",{children:["Learn more about"," ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/security/protected-git-scopes",variant:"highlight",children:"Protected Git Scopes"})]})}),(0,i.jsx)(g.FieldsetFooter.Actions,{children:f?null:(0,i.jsx)(eY.Tooltip,{text:S,children:(0,i.jsx)(m.Button,{disabled:!!(b||S),onClick:()=>o(!0),size:"small",children:"Add"})})})]}):(0,i.jsx)(g.FieldsetFooter.Status,{children:"You need additional permissions to manage your team's protected git scopes."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.FieldsetFooter.Status,{children:(0,i.jsxs)("span",{children:["Protected Git Scopes are available on the"," ",(0,i.jsx)(E.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]})}),(0,i.jsx)(g.FieldsetFooter.Actions,{children:(0,i.jsx)(E.ButtonLink,{href:B.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]}),[n,s,a,b,S,f]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(h.Fieldset,{disabled:b,children:[(0,i.jsxs)(u.FieldsetContent,{children:[(0,i.jsx)(ed.FieldsetTitle,{id:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.gitExclusivity,children:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.gitExclusivity}),(0,i.jsxs)(x.FieldsetSubtitle,{children:["Add up to 5"," ",(0,i.jsx)(eY.Tooltip,{text:"GitHub organization or account. GitLab group or account. Bitbucket workspace.",children:(0,i.jsx)("u",{style:{cursor:"help",textDecorationStyle:"dotted",textUnderlineOffset:2},children:"Git scopes"})})," ","to this team to limit other Vercel teams from deploying repositories from the protected scope. Multiple teams can specify the same scope, allowing both teams access."]}),(0,i.jsx)(il.EntityCollapsible,{disabled:!n,emptyDescription:"Add a protected Git scope to limit other Vercel teams from deploying repositories from the protected scope.",entities:c?.map(e=>({key:`${e.gitProvider}-${e.gitNamespaceOwnerType}-${e.gitNamespaceId}`,component:(0,i.jsx)(ib,{entity:e,onRemove:v})})),isLoading:f,title:"Protected Scopes"})]}),(0,i.jsx)(g.FieldsetFooter,{disabled:!1,children:A})]}),(0,i.jsx)(ip,{isOpen:l,onAdd:y,selectedScopes:c?.map(e=>e.gitNamespaceId),setIsOpen:o})]})}function ib(e){let{entity:t,onRemove:s}=e,[n,r]=(0,d.useState)(!1),l=async()=>{r(!0);try{await s(t),M.toasts.success("Protected Git scope removed.")}catch(e){(0,is.isError)(e)&&M.toasts.error(e.message),M.toasts.error("An error occurred while removing the protected Git scope.")}r(!1)};return(0,i.jsx)(f.Entity,{left:(0,i.jsx)(iy,{entity:t}),right:(0,i.jsx)(m.Button,{loading:n,onClick:()=>void l(),size:"small",type:"secondary",children:"Remove"}),children:(0,i.jsxs)(k.Stack,{align:"center",direction:"row",justify:"space-between",style:{width:"100%"},children:[(0,i.jsx)(k.Stack,{className:io.default.entityContent,justify:"center",style:{flex:1},children:(0,i.jsxs)(E.Link,{href:function(e){switch(e.gitProvider){case"github":return`https://github.com/${e.gitNamespaceId}`;case"github-custom-host":return`https://${e.gitProviderCustomHost}/${e.gitNamespaceId}`;case"gitlab":return`https://gitlab.com/${e.gitNamespaceId}`;case"bitbucket":return`https://bitbucket.org/${e.gitNamespaceId}`}}(t),children:[(0,i.jsx)(I.Text,{weight:500,children:t.name}),(0,i.jsx)(I.Text,{className:"geist-hide-on-mobile",color:"gray-900",children:function(e){switch(e.gitProvider){case"github":return`github.com/${e.slug||e.gitNamespaceId}`;case"github-custom-host":return`${e.gitProviderCustomHost}/${e.slug||e.gitNamespaceId}`;case"gitlab":return`gitlab.com/${e.slug||e.gitNamespaceId}`;case"bitbucket":return`bitbucket.org/${e.slug||e.gitNamespaceId}`}}(t)})]})}),(0,i.jsx)(I.Text,{align:"right",className:"geist-hide-on-mobile",color:"gray-900",style:{flex:1},children:t.description})]})})}function iy(e){let{entity:t}=e,[s,n]=(0,d.useState)(!1);switch(t.gitProvider){case"github":case"github-custom-host":return(0,i.jsx)(ie.GitHubAvatar,{right:0,size:32,username:t.gitNamespaceId});case"gitlab":return t.avatarUrl&&!s?(0,i.jsx)(e9.AvatarWithIcon,{gitType:"gitlab",icon:(0,i.jsxs)("div",{className:io.default.iconWrapper,children:[(0,i.jsx)(it.LogoGitlab,{className:io.default.iconUnderlay}),(0,i.jsx)(it.LogoGitlab,{className:io.default.iconOverlay})]}),onError:()=>{n(!0)},right:0,size:32,url:t.avatarUrl}):(0,i.jsx)("div",{className:io.default.emptyAvatar,children:(0,i.jsx)(it.LogoGitlab,{size:20})});case"bitbucket":return t.avatarUrl&&!s?(0,i.jsx)(e9.AvatarWithIcon,{gitType:"bitbucket",icon:(0,i.jsxs)("div",{className:io.default.iconWrapper,children:[(0,i.jsx)(ii.LogoBitbucketColor,{className:io.default.iconUnderlay}),(0,i.jsx)(ii.LogoBitbucketColor,{className:io.default.iconOverlay})]}),onError:()=>{n(!0)},right:0,size:32,url:t.avatarUrl}):(0,i.jsx)("div",{className:io.default.emptyAvatar,children:(0,i.jsx)(ii.LogoBitbucketColor,{size:20})})}}function iv(){let e=(0,M.useToasts)(),{user:s}=(0,O.useUser)(),{team:n,mutate:r}=(0,R.useTeam)(),[l,o]=(0,d.useTransition)(),{can:a}=(0,V.default)(),c=a($.Action.Update,$.Resource.Team),[p,j]=(0,d.useState)(n?.mfa?.enforced??null),{value:f}=(0,z.useMfaEnforcementTeamFlag)();if(!f)return null;n&&null===p&&j(n.mfa?.enforced??!1);let b=!c||!n||!s?.mfa?.enabled||l;return(0,i.jsx)(J,{id:"two-factor-enforcement",children:(0,i.jsxs)(h.Fieldset,{disabled:!c,children:[(0,i.jsxs)(u.FieldsetContent,{className:"flex flex-col",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(em.FieldsetTitle,{children:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.mfaEnforcement}),(0,i.jsxs)(x.FieldsetSubtitle,{children:["Require two-factor authentication (2FA) for members of your team. Team members who do not have 2FA will not be able access your team, but will remain a member. Visit the"," ",(0,i.jsx)(E.Link,{href:`/${n?.slug}/~/settings/members`,type:"highlight",children:"team members page"})," ","to view the 2FA status of each member."]})]}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(eY.Tooltip,{disableTriggers:s?.mfa?.enabled,text:(0,i.jsxs)(i.Fragment,{children:["You must have two-factor authentication enabled to enforce it on the team. Go to"," ",(0,i.jsx)(E.Link,{href:"/account/settings/authentication#two-factor-authentication",type:"highlight",children:"account settings"})," ","to enabled 2FA."]}),children:(0,i.jsx)(C.Toggle,{"aria-label":"Two-factor enforcement","aria-checked":p??!1,checked:p??!1,direction:"switch-first",disabled:b,onChange:()=>j(e=>!e),size:"large",children:(0,i.jsx)(I.Text,{as:"span",className:b?"text-gray-700":"",children:p?"Enabled":"Disabled"})})})}),(0,i.jsx)("div",{className:"pt-4",children:(0,i.jsx)(ep.Note,{children:"To prevent workflow disruptions, configure two-factor authentication on all user-managed accounts prior to enforcement. Any CI/CD pipeline tokens associated with users who do not have two-factor authentication enabled will cease to work."})})]}),(0,i.jsx)(g.FieldsetFooter,{highlight:!c,children:c?(0,i.jsxs)(i.Fragment,{children:[" ",(0,i.jsxs)(g.FieldsetFooter.Status,{children:["Learn more about "," ",(0,i.jsxs)(E.Link,{external:!0,href:"/docs/two-factor-enforcement",type:"highlight",children:["Two-Factor"," ",(0,i.jsx)("span",{className:"hidden md:inline",children:"Authentication"})," ","enforcement"]})]}),(0,i.jsx)(g.FieldsetFooter.Actions,{children:(0,i.jsx)(m.Button,{disabled:!n||p===n.mfa?.enforced,loading:l,onClick:()=>{o(async()=>{if(n)try{await (0,F.fetchAPI)(`${L.API_TEAMS}/${n.id}`,{method:"PATCH",body:JSON.stringify({mfaEnforced:!n.mfa?.enforced}),throwOnHTTPError:!0});let i=await r(),t=i?.teams?.find(e=>e.id===n.id);e.success(`Two-factor enforcement successfully ${t?.mfa?.enforced?"enabled":"disabled"}.`)}catch(i){e.error((0,t.normalizeError)(i).message)}})},size:"small",children:"Save"})})]}):(0,i.jsx)(g.FieldsetFooter.Status,{children:"You need additional permissions to manage two-factor enforcement."})})]})})}var iS=e.i(5184832);function iA(){let{team:e,isReady:t}=(0,R.useTeam)(),{can:s,isLoading:n}=(0,V.default)(),{isReady:r}=(0,er.useIsRoleEnabled)(er.RBACRole.VIEWER),{isReady:l}=(0,er.useIsRoleEnabled)(er.RBACRole.DEVELOPER),{value:o}=(0,z.useGitExclusivityFlag)(),a=s($.Action.Update,$.Resource.Team),c=s($.Action.Read,$.Resource.SensitiveEnvironmentVariablePolicy),d=!t||!e||n||!r||!l,u=ee(e,"saml"),h=d||!a||!u;return(0,i.jsxs)(i.Fragment,{children:[o?(0,i.jsx)(J,{id:"git-exclusivity",children:(0,i.jsx)(ij,{})}):null,d?(0,i.jsx)(J,{children:(0,i.jsx)(eh.default,{height:80})}):null,c?(0,i.jsx)(J,{id:"sensitive-environment-variable-policy",children:(0,i.jsx)(iw,{})}):null,(0,i.jsx)(J,{id:"audit-log-export",children:(0,i.jsx)(iT,{})}),(0,i.jsx)(H.DisabledContext.Provider,{value:h,children:(0,i.jsx)(U.PlaceholderContext.Provider,{value:d,children:(0,i.jsx)(J,{id:"saml-options",children:(0,i.jsx)(ik,{})})})}),(0,i.jsx)(iv,{}),(0,i.jsx)(J,{id:"hide-ip-addresses",children:(0,i.jsx)(eu,{})}),(0,i.jsx)(eV,{})]})}function iT(){let{team:e,isReady:t}=(0,R.useTeam)(),{can:o,isLoading:a}=(0,V.default)(),{value:x}=(0,z.useAuditLogStreamsFlag)(),p=x||e?.enabledInvoiceItems?.siem?.enabled===!0,b=o($.Action.Create,$.Resource.AuditLog),T=(0,D.useIsMobile)(),I=(0,M.useToasts)(),C=(0,d.useMemo)(()=>new Date,[]),N=(0,d.useMemo)(()=>(0,r.addDays)(C,-90),[C]),[O,G]=(0,d.useState)({start:N,end:C}),[H,U]=(0,d.useState)(!1),W=(0,d.useCallback)(async()=>{if(!H&&O&&e)try{U(!0);let i=(0,P.encode)({teamId:e.id}),t=new Date(O.start),r=new Date(O.end),l=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),o=Math.min(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())+864e5-1,Date.now());s.analytics.track(n.AnalyticsEvent.AUDIT_LOG_EXPORT_CLICKED,{teamId:e.id,from:l,to:o}),await (0,F.fetchAPI)(`${L.API_EVENTS_EXPORT}${i}`,{method:"POST",throwOnHTTPError:!0,body:JSON.stringify({format:"CSV",from:l,to:o}),headers:{"Content-Type":"application/json"}}),I.success({text:"Successfully started the export. You will receive an email when your download is ready.",key:"audit-log-export-success"})}catch(e){if(e instanceof Error)I.error(e.message);else throw e}finally{U(!1)}},[e,H,U,I,O]),Y=t||!a,J=e?.billing?.plan==="enterprise",K=(0,d.useMemo)(()=>Y?J?b?(0,i.jsxs)(i.Fragment,{children:["Learn more about ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/observability/audit-log",variant:"highlight",children:"Audit Logs"})]}):(0,i.jsx)(i.Fragment,{children:"You need additional permissions to manage your team's audit logs."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{children:["Audit Logs are available on the"," ",(0,i.jsx)(E.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,i.jsx)(g.FieldsetFooter.Actions,{children:(0,i.jsx)(E.ButtonLink,{href:B.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]}):(0,i.jsx)(w.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}),[b,Y,J]),X=(0,P.encode)({teamId:e?.id});return(0,i.jsxs)(h.Fieldset,{disabled:!Y||!b||!J,children:[(0,i.jsx)(u.FieldsetContent,{children:(0,i.jsxs)(k.Stack,{direction:"column",gap:6,children:[(0,i.jsx)(k.Stack,{align:"center",direction:"row",gap:2,children:(0,i.jsx)(ed.FieldsetTitle,{id:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.auditLog,children:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.auditLog})}),(0,i.jsxs)(k.Stack,{gap:4,children:[(0,i.jsx)("div",{children:(0,i.jsx)(q.FormTitleDescription,{description:"Export your team's activity up to the last 90 days.",title:"Export Audit Log"})}),(0,i.jsxs)(k.Stack,{align:T?void 0:"center",direction:T?"column":"row",gap:4*!!T,justify:"space-between",children:[(0,i.jsx)(j.Calendar,{dataTestId:(0,_.tid)("security-page","calendar"),maxValue:C,minValue:N,onChange:e=>G(e),value:O,width:"auto"}),(0,i.jsx)(m.Button,{disabled:!O,loading:H,onClick:()=>void W(),size:"small",children:H?"Exporting CSV":"Export CSV"})]})]}),(0,i.jsx)(Z.default,{margin:0}),(0,i.jsx)(f.Entity.List,{children:(0,i.jsx)(f.Entity,{right:T?(0,i.jsxs)(S.MenuContainer,{children:[(0,i.jsx)(v.MenuButton,{"aria-label":"Show options",svgOnly:!0,type:"tertiary",children:(0,i.jsx)(c.MoreHorizontal,{})}),(0,i.jsx)(y.Menu,{children:(0,i.jsx)(A.MenuItem,{href:`/api/audit-logs/log-stream${X}`,isLink:!0,prefetch:!1,rel:"noopener noreferrer",target:"_blank",children:"Configure"})})]}):(0,i.jsx)(E.ButtonLink,{disabled:!p,href:`/api/audit-logs/log-stream${X}`,prefetch:!1,rel:"noopener noreferrer",size:"small",suffix:(0,i.jsx)(l.ExternalSmall,{}),target:"_blank",type:"secondary",children:"Configure"}),children:(0,i.jsx)(f.Entity.Content,{description:p?"Set up a log stream for audit logs to be sent to your SIEM provider.":"Setting up a log stream for audit logs is not available for your plan.",title:"SIEM Integration"})})})]})}),(0,i.jsx)(g.FieldsetFooter,{disabled:!1,highlight:!b||!J,children:K})]})}function iw(){let{team:e,isTeamReady:t,error:s,isLoading:n,saving:r,handleSave:l,hasChangedSensitiveEnvVarPolicy:o,sensitiveEnvVarPolicySetting:a,setSensitiveEnvVarPolicySetting:c}=(0,X.useSensitiveEnvironmentVariablePolicy)(),d=(0,H.useDisabled)(),{can:u,isLoading:h}=(0,V.default)(),g=u($.Action.Update,$.Resource.SensitiveEnvironmentVariablePolicy),x=(0,X.getBooleanValueFromOnOffDefault)(a);return(0,i.jsx)(K.ProjectSettingsFieldset,{description:"Enforce policies for the creation and editing of this team's environment variables.",disabled:!g||d||!!e?.limited||n||!(t||!h),error:s,highlightNote:d,note:d?(0,i.jsx)(i.Fragment,{children:"You need additional permissions to manage your team's Environment Variable Policy."}):(0,i.jsxs)("span",{children:["Learn more about"," ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/environment-variables/sensitive-environment-variables#environment-variables-policy",variant:"highlight",children:"Environment Variable Policies"})]}),onSave:async()=>{await l()},saveDisabled:!o,saveLoading:r,title:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.environmentVariablePolicy,children:(0,i.jsxs)(k.Stack,{gap:4,children:[(0,i.jsx)(Z.default,{margin:10}),(0,i.jsx)(I.Text,{className:d?"disabled":"",color:"inherit","data-testid":(0,_.tid)("geist","fieldset","subtitle"),size:16,weight:600,children:"Enforce Sensitive Environment Variables"}),(0,i.jsxs)(I.Text,{color:"inherit",children:["Ensures that all environment variables created by members of this team will be created as"," ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/environment-variables/sensitive-environment-variables",variant:"highlight",children:"Sensitive Environment Variables"})," ","which can only be decrypted by Vercel's deployment system."]}),(0,i.jsx)("label",{htmlFor:"toggle-env-var-policy",style:{cursor:"pointer"},children:(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:2,children:[(0,i.jsx)(C.Toggle,{checked:x,id:"toggle-env-var-policy",onChange:()=>{c(x?"off":"on")},size:"large"}),(0,i.jsx)(I.Text,{as:"span",children:x?"Enabled":"Disabled"})]})})]})})}function ik(){let{team:e,isReady:t}=(0,R.useTeam)(),{can:s,isLoading:n}=(0,V.default)(),r=s($.Action.Update,$.Resource.SamlConfig),l=!t||!e||n,o=l||!r,a=ee(e,"saml");return(0,i.jsxs)(h.Fieldset,{disabled:o||!a,children:[(0,i.jsxs)(u.FieldsetContent,{children:[(0,i.jsx)(ed.FieldsetTitle,{id:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.samlSingleSignOn,children:ei.TEAM_SETTINGS_NAVIGATION_TITLES.security.samlSingleSignOn}),(0,i.jsx)(x.FieldsetSubtitle,{children:"Customize the behavior of SAML authentication and directory syncing for your Team."}),(0,i.jsx)(iI,{}),(0,i.jsx)("hr",{className:"geist-hr-reset",style:{margin:"24px 0"}}),(0,i.jsx)(e3,{})]}),(0,i.jsxs)(g.FieldsetFooter,{disabled:!1,highlight:!r||!a,children:[l?(0,i.jsx)(w.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):o||a?r?(0,i.jsxs)("span",{children:["Learn more about"," ",(0,i.jsx)(E.Link,{external:!0,href:"/docs/saml",variant:"highlight",children:"SAML Single Sign-On"})]}):"You need additional permissions to manage your team's SAML single sign-on.":(0,i.jsxs)("span",{children:["SAML Single Sign-On is optionally available on the"," ",(0,i.jsx)(E.Link,{"data-testid":(0,_.tid)("account-settings","security","enterprise-learn-more"),href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),!o&&!a&&(0,i.jsx)(g.FieldsetFooter.Actions,{children:(0,i.jsx)(E.ButtonLink,{"data-testid":(0,_.tid)("account-settings","security","upgrade"),href:B.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]})]})}function iI(){let{team:e,mutate:s}=(0,R.useTeam)(),{can:n}=(0,V.default)(),r=n($.Action.Update,$.Resource.SamlConfig),l=(0,M.useToasts)(),[u,h]=(0,en.default)(!!e?.saml?.enforced),[g,x]=(0,d.useState)(!1),[j,w]=(0,d.useState)(null),{data:I}=(0,G.default)(),[_,O]=(0,d.useState)(!1),B=(0,D.useIsMobile)(),z=e&&(0,N.isSAMLConfigured)(e),H=async n=>{if(e&&I){if(n&&!(0,N.tokenHasSamlScope)(I.token,e))return w({message:(0,i.jsxs)(i.Fragment,{children:["To ensure your configuration is working correctly, please authenticate with SAML before Enforcing SAML for this Team.",(0,i.jsx)(E.Link,{onClick:()=>(0,N.loginWithSAMLInline)(e.slug,{next:`${window.location.origin}${window.location.pathname}#saml-options`}),variant:"blend",children:"Click here to re-authenticate with SAML SSO"}),"."]})});w(null);try{await (0,F.fetchAPI)(`${L.API_TEAMS}/${e.id}`,{method:"PATCH",body:JSON.stringify({saml:{enforced:n}}),throwOnHTTPError:!0}),await s(),l.success("Updated SAML for your Team successfully.")}catch(e){w((0,t.normalizeError)(e))}}},U=(0,d.useRef)(null),q=async()=>{if(e){if(U.current)return void U.current.open();try{let i=location.origin+`/popups/saml-sso${(0,P.encode)({teamSlug:e.slug})}`,t=`${L.API_TEAMS}/${e.id}/sso/configure${(0,P.encode)({redirect:1,intent:"sso",next:i})}`,n=e.slug;U.current=new Q.default({id:"saml-configure-popup",width:1200,height:840,url:t,callbacks:{onPoll:async e=>{if(e.location.href===i){U.current?.cancelPolling(),U.current?.close();let e=await s();if(e?.teams){let i=e.teams.find(e=>e.slug===n);(0,N.isSAMLConfigured)(i)?(w(null),z||l.success("SAML Single Sign-On configured successfully.")):w({message:"The SAML configuration was not completed. Please try again."})}else w({message:"Failed to fetch updated Team information."});U.current=null}},onClose:()=>{U.current=null},onAbort:()=>{U.current=null},onBlocked:()=>{w({message:"The popup to configure SAML Single Sign-On could not be opened."}),U.current=null}}}),U.current.open()}catch(e){w((0,t.normalizeError)(e))}}},W=async()=>{if(e){x("removeSAML");try{await (0,F.fetchAPI)(`${L.API_TEAMS}/${e.id}/sso`,{method:"DELETE",throwOnHTTPError:!0}),await s(),w(null),l.success("Removed SAML configuration successfully.")}catch(e){w((0,t.normalizeError)(e))}x(!1),O(!1)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(f.Entity.List,{children:[(0,i.jsxs)(f.Entity,{left:e?.saml?.connection?.type?(0,i.jsx)(p.Avatar,{size:32,src:(0,N.getSAMLConnectionLogo)(e.saml.connection.type)}):(0,i.jsx)("div",{className:iS.default.circleIcon,children:(0,i.jsx)(a.LockClosed,{})}),children:[(0,i.jsx)(f.Entity.Content,{description:z?"Manage the configuration with your Identity Provider.":"Allow Team Members to login using an Identity Provider.",fill:!0,title:e?.saml?.connection?.type?(0,N.getSAMLConnectionType)(e.saml.connection.type):"SAML"}),z?(0,i.jsxs)(k.Stack,{align:"center",direction:"row",gap:4,children:[!B&&(0,i.jsx)(m.Button,{onClick:()=>void q(),size:"small",type:"secondary",children:"Manage"}),(0,i.jsx)(o.CheckCircleFill,{color:"blue-700",size:20})]}):!B&&(0,i.jsx)(m.Button,{onClick:()=>void q(),size:"small",children:"Configure"}),(0,i.jsxs)(S.MenuContainer,{children:[(0,i.jsx)(v.MenuButton,{"aria-label":"Show options",disabled:!z&&!B,svgOnly:!0,type:"tertiary",children:(0,i.jsx)(c.MoreHorizontal,{})}),(0,i.jsx)(y.Menu,{children:z?(0,i.jsxs)(i.Fragment,{children:[B?(0,i.jsx)(A.MenuItem,{onClick:()=>void q(),children:"Manage"}):null,(0,i.jsx)(A.MenuItem,{onClick:()=>O(!0),type:"error",children:"Remove"})]}):B&&(0,i.jsx)(A.MenuItem,{onClick:()=>void q(),children:"Configure"})})]})]}),(0,i.jsxs)(f.Entity,{children:[(0,i.jsx)(f.Entity.Content,{description:z&&r&&I&&!(0,N.tokenHasSamlScope)(I.token,e)?"Please authenticate with SAML before enforcing SAML for this Team.":"Require Team Members to login with SAML to access this Team.",fill:!0}),z&&r&&I&&!(0,N.tokenHasSamlScope)(I.token,e)?(0,i.jsx)(iC,{disabled:!z,team:e}):(0,i.jsx)(C.Toggle,{checked:u,disabled:!r||!z,onChange:()=>{H(!u),h(e=>!e)},size:"large"})]})]}),j?(0,i.jsx)("div",{className:iS.default.kolchb,children:(0,i.jsx)(b.Error,{error:j})}):null,(0,i.jsxs)(T.Modal.Modal,{active:_,onClickOutside:()=>O(!1),children:[(0,i.jsxs)(T.Modal.Body,{children:[(0,i.jsx)(T.Modal.Title,{children:"Disconnect SAML"}),(0,i.jsx)("div",{className:iS.default.hbsbyw,children:(0,i.jsxs)(T.Modal.Subtitle,{children:["You are about to remove the SAML Configuration. After removing it,"," ","you won't be able to use SAML Single Sign-On to log in to Vercel anymore."]})}),(0,i.jsx)(T.Modal.Subtitle,{children:"Do you want to continue?"})]}),(0,i.jsxs)(T.Modal.Actions,{children:[(0,i.jsx)(T.Modal.Action,{onClick:()=>O(!1),type:"secondary",children:"Cancel"}),(0,i.jsx)(T.Modal.Action,{loading:"removeSAML"===g,onClick:W,children:"Continue"})]})]})]})}function iC(e){let{disabled:t,team:s}=e,{mutate:n}=(0,R.useTeam)(),{mutate:r}=(0,O.useUser)(),{mutate:l}=(0,G.default)(),{login:o,state:a}=(0,et.useAuth)("login",{onAuthenticated:async()=>{await Promise.all([n,r,l])},defaultState:{teamSlug:s.slug}}),{loginState:c}=a;return(0,i.jsx)(m.Button,{disabled:t,loading:c===es.LOGIN_STATE.LOADING_SAML,onClick:()=>void o("saml"),size:"small",children:"Re-Authenticate"})}}}]);

//# sourceMappingURL=0ebd7d77c6f07cf8.js.map
//# debugId=f54db345-8ab7-5d75-84fc-b7a8c3820c08
