
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f9a948a4-3e4e-5922-b226-44a64e0ff9aa")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{6485937:e=>{e.v({container:"styled-combobox-module__ucBlrG__container"})},203220:e=>{"use strict";e.s({FirewallOverview:()=>tc},203220);var t=e.i(6645307),l=e.i(6530772),i=e.i(5674541),a=e.i(889716),n=e.i(5163670),s=e.i(1190215),r=e.i(653558),o=e.i(2733203),c=e.i(4105925),u=e.i(8069802),d=e.i(8084653),m=e.i(3921802),x=e.i(902156),f=e.i(6192985),g=e.i(1406255),h=e.i(2362802),p=e.i(8483852),j=e.i(2537276),b=e.i(4652282),v=e.i(3432213),y=e.i(7963051),w=e.i(5124754),C=e.i(674684),S=e.i(1296342),k=e.i(4909006),_=e.i(3585235),N=e.i(5785123),A=e.i(7573892),R=e.i(9802771),M=e.i(503726),B=e.i(226017),T=e.i(5610210),L=e.i(2240289),I=e.i(5400681),P=e.i(841144),$=e.i(284627),F=e.i(4345726),D=e.i(4852610),O=e.i(6144234),z=e.i(9428264),U=e.i(6753602),E=e.i(3326412),q=e.i(2567082),H=e.i(2306774);e.i(2282870),e.i(1863837);var G=e.i(6508134);let V=[{value:"group_by_category",label:"Group by Category"},{value:"group_by_action",label:"Group by Action"}],W=[{label:"User Agent",value:"clientUserAgent"},{label:"Country",value:"clientIpCountry"},{label:"IP Address",value:"clientIp"},{label:"Request Path",value:"requestPath"},{label:"Target Path",value:"route"},{label:"JA4 Digest",value:"clientJa4Digest"},{label:"Host",value:"requestHostname"}],Z=[{value:"botCheckResult",label:"Check Result"},...W],Q=[{icon:v.Clock,label:"Live",value:"live"},{label:"Past Hour",value:"1h"},{label:"Past Day",value:"1d"},{label:"Past 3 Days",value:"3d"}];function J(e){let{isReady:t,value:i}=(0,E.useIPBlockingTeamFlag)(),{set:a,state:n}=(0,H.useSearchParamsState)({action:{defaultValue:"all"},filter:{defaultValue:"all_rules"},groupBy:{defaultValue:V[0].value,parseFromUrl:e=>(0,U.tryNormalizeDimension)(e)||e},range:{defaultValue:"1h"}});"BotID"===n.filter?n={...n,groupBy:n.groupBy===V[0].value?Z[0].value:n.groupBy}:"botCheckResult"===n.groupBy&&"BotID"!==n.filter&&(n={...n,groupBy:W[0].value});let s=(0,l.useCallback)(l=>{let s=e?.hideIpAddresses||!i||!t;if("filter"===l.type){if("all_rules"===n.filter&&"all_rules"!==l.value){let e=(0,G.isLimitedSystemRule)(l.value)?G.systemFilter:G.defaultFilter;s&&(e=e.filter(e=>"clientIp"!==e.value)),a({filter:l.value,groupBy:e[0].value});return}if("all_rules"!==n.filter&&"all_rules"===l.value)return void a({filter:l.value,groupBy:V[0].value});if(!(0,G.isLimitedSystemRule)(n.filter)&&(0,G.isLimitedSystemRule)(l.value)){let e=s?G.systemFilter.filter(e=>"clientIp"!==e.value):G.systemFilter;a({filter:l.value,groupBy:e[0].value});return}a({filter:l.value})}else a({[l.type]:l.value})},[a,n,e,i,t]),r=(0,l.useMemo)(()=>{let l=e?.hideIpAddresses||!i||!t;if("all_rules"===n.filter)return V;if("BotID"===n.filter)return Z;let a=(0,G.isLimitedSystemRule)(n.filter)?G.systemFilter:G.defaultFilter;return l?a.filter(e=>"clientIp"!==e.value):a},[n.filter,e,i,t]);return[n,s,r]}var K=e.i(6760874),Y=e.i(5901785),X=e.i(8169983),ee=e.i(6251299);let et=(0,l.createContext)({});function el(){return(0,l.useContext)(et)}function ei(e){let{children:i,formatter:a,series:n}=e,s=(0,ee.default)(),[r,o]=J(),[c,u]=(0,l.useState)(null),d=(0,l.useMemo)(()=>Array.from(n.values()).reduce((e,t)=>e.concat(t),[]),[n]),m=(0,l.useMemo)(()=>{let e={};return d.forEach(t=>{e[t.key]?e[t.key]+=t.value??0:e[t.key]=t.value??0}),e},[d]),x=(0,l.useMemo)(()=>[...n.keys()].sort((e,t)=>m[t]-m[e]),[n,m]);(0,l.useEffect)(()=>{!c||x.includes(c)||u(null)},[x,c]);let f=(0,l.useMemo)(()=>(0,X.scaleOrdinal)({domain:x.sort(G.stableSort),range:[700,600,400,200].flatMap(e=>[`var(--ds-blue-${e})`,`var(--ds-amber-${e})`,`var(--ds-green-${e})`,`var(--ds-teal-${e})`,`var(--ds-purple-${e})`,`var(--ds-pink-${e})`,`var(--ds-red-${e})`,`var(--ds-gray-${e})`])}),[x]),g=(0,l.useMemo)(()=>Object.fromEntries(x.map(e=>[e,f(e)])),[x,f]),h=(0,l.useCallback)(e=>{"all_rules"===r.filter?e&&o({type:"filter",value:e.split("$")[0]}):u(e)},[o,r.filter]),p=(0,l.useMemo)(()=>({activeDataKey:c,allData:d,allKeys:x,colorScale:f,formatter:a,maxByKeys:m,seriesColor:g,setActiveDataKey:h,tooltip:s}),[c,d,x,f,a,m,h,g,s]);return(0,t.jsx)(et.Provider,{value:p,children:i})}et.displayName="VisualizationContext",e.i(6977237);var ea=e.i(9713118),en=e.i(6756623),es=e.i(3621043),er=e.i(4689185),eo=e.i(2198335),ec=e.i(3454847),eu=e.i(4237550),ed=e.i(9948746),em=e.i(2192580),ex=e.i(5535439),ef=e.i(6485937),eg=e.i(1164214),eh=e.i(3903554);function ep(e){let l,{toolbarState:i,setToolbarState:a,rules:n,options:u,isCustomRuleSelected:d,team:m,managedRulesets:x}=e,f=Q.filter(e=>"live"===e.value||function(e,t){let l=e?.billing?.plan==="enterprise"?(0,q.default)("72h"):(0,q.default)("24h");return t<=l+l/12}(m,(0,q.default)(e.value))),g=f.find(e=>e.value===i.range),p=g?.icon||null,j=(0,ex.useParams)(),b=n.find(e=>e.value===i.filter);if("all_rules"===i.filter)l="Overview";else if(b)l=b.label;else if(i.filter.startsWith("managed_")){let e=i.filter.slice(8);if(l=e,x){let t=(0,eh.getRulesetFromRulesets)(x,e);t&&(l=t.name)}}else l=i.filter;let v=u.find(e=>e.value===i.groupBy);return(0,t.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:gap-[unset] lg:divide-x lg:[&>*:not(:first-child)]:pl-3 lg:[&>*:not(:last-child)]:pr-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:gap-3",children:[(0,t.jsxs)(es.Combobox,{"data-testid":(0,eg.tid)("firewall","graph-toolbar","filters"),"aria-label":"Select firewall filter option",className:(0,T.clsx)(ef.default.container,"w-full lg:w-[226px]"),clearable:"all_rules"!==i.filter,onChange:e=>{a({type:"filter",value:e||"all_rules"})},value:l,children:[(0,t.jsx)(es.Combobox.Input,{}),(0,t.jsx)(es.Combobox.List,{children:n.map(e=>(0,t.jsx)(es.Combobox.Option,{"data-testid":(0,eg.tid)("firewall","graph-toolbar","filter-value"),value:e.value,children:e.label},e.value))})]}),d?(0,t.jsx)(h.ButtonLink,{href:`/${j?.teamSlug}/${j?.project}/firewall/configure/rule/${i.filter}`,prefix:(0,t.jsx)(em.PencilEdit,{}),type:"secondary",children:"Edit Rule"}):null]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:gap-3",children:[(0,t.jsxs)(s.MenuContainer,{children:[(0,t.jsx)(o.MenuButton,{align:"flex-grow",className:"w-full text-left font-normal lg:w-[176px]",style:{fontWeight:400},suffix:(0,t.jsx)(eu.ChevronDown,{}),type:"secondary",children:v?.label??""}),(0,t.jsx)(r.Menu,{className:"overflow-y-auto md:max-h-[250px] md:max-w-[200px] lg:min-w-[200px]",portalClassName:"tailwind-preflight",children:u.map(e=>{let{value:l,label:i}=e;return(0,t.jsx)(c.MenuItem,{label:i,onClick:()=>a({type:"groupBy",value:l}),suffix:v?.value===l?(0,t.jsx)(ed.Check,{size:16}):null,value:l,children:(0,t.jsx)("span",{children:i})},l)})})]}),(0,t.jsxs)(s.MenuContainer,{children:[(0,t.jsx)(o.MenuButton,{align:"flex-grow",className:"w-full text-left lg:w-[146px]",prefix:p?(0,t.jsx)(p,{}):null,style:{fontWeight:400},suffix:(0,t.jsx)(eu.ChevronDown,{}),type:"secondary",children:g?.label||"live"}),(0,t.jsx)(r.Menu,{className:"overflow-y-auto md:max-h-[250px] md:max-w-[200px] lg:min-w-[200px]",portalClassName:"tailwind-preflight",children:f.map(e=>{let{value:l,label:i}=e;return(0,t.jsx)(c.MenuItem,{label:i,onClick:()=>a({type:"range",value:l}),suffix:g?.value===l?(0,t.jsx)(ed.Check,{size:16}):null,value:l,children:(0,t.jsx)("span",{children:i})},l)})})]})]})]})}function ej(){return(0,t.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:gap-[unset] lg:divide-x lg:[&>*:not(:first-child)]:pl-3 lg:[&>*:not(:last-child)]:pr-3",children:[(0,t.jsx)("div",{className:"flex w-full flex-col gap-4 lg:flex-row lg:gap-3",children:(0,t.jsx)("div",{className:"w-full lg:w-[226px]",children:(0,t.jsx)(n.Skeleton,{height:40,width:"100%"})})}),(0,t.jsxs)("div",{className:"flex w-full flex-col gap-4 lg:flex-row lg:gap-3",children:[(0,t.jsx)("div",{className:"w-full lg:w-[176px]",children:(0,t.jsx)(n.Skeleton,{height:40,width:"100%"})}),(0,t.jsx)("div",{className:"w-full lg:w-[146px]",children:(0,t.jsx)(n.Skeleton,{height:40,width:"100%"})})]})]})}function eb(e){let{positionTop:i=0,...a}=e,[n,s]=(0,l.useState)(!1),{scrollY:r}=(0,er.useScroll)(),o=(0,l.useRef)(null);return(0,ec.useMotionValueEvent)(r,"change",e=>{o.current&&s(e>(0,en.getOffsetTop)(o.current)-56)}),(0,t.jsxs)("div",{ref:o,children:[(0,t.jsx)(eo.motion.div,{className:"z-[12]",style:{position:n?"fixed":void 0,top:n?i-56:0,left:0,right:0,paddingTop:8*!!n,paddingBottom:8*!!n,borderBottom:n?"1px solid var(--ds-gray-alpha-400)":void 0,background:n?"var(--ds-background-100)":void 0},children:(0,t.jsx)("div",{className:(0,T.clsx)({container:n}),children:(0,t.jsx)(ep,{...a})})}),n?(0,t.jsx)("div",{className:"h-[150px] lg:h-[40px]"}):null]})}var ev=e.i(2273091),ey=e.i(8551999);function ew(e){let{height:i,data:a,query:n,error:s,width:r,isLoading:o}=e,{allData:c,allKeys:u,colorScale:m,formatter:x}=el(),f=(0,l.useMemo)(()=>(function(e,t){let l=new Map(e.map(e=>{let{date:l}=e;return[l.toISOString(),{time:l.toISOString(),name:l.toISOString(),date:l,...Object.fromEntries(t.map(e=>[e,0]))}]}));return e.forEach(e=>{let{date:t,key:i,value:a}=e,n=l.get(t.toISOString());n&&(n[i]=a)}),[...l.values()].sort((e,t)=>e.date.getTime()-t.date.getTime())})(c.filter(e=>!(0,en.isOthersAggregate)(e.key)),u),[c,u]);return r<10?null:s?(0,t.jsxs)("div",{"data-testid":(0,eg.tid)("firewall","graph","error"),className:"border-border flex flex-col items-center justify-center gap-2 rounded-md border border-gray-400 bg-[var(--accents-1)]",style:{height:i},children:[(0,t.jsx)(d.Text,{className:"capitalize",weight:500,children:s.code}),(0,t.jsx)(d.Text,{className:"max-w-[400px] text-gray-800",children:s.message})]}):!a||o&&0===a.size?(0,t.jsx)(eC,{height:i}):0===a.size?(0,t.jsxs)("div",{"data-testid":(0,eg.tid)("firewall","graph","empty"),className:"border-border flex flex-col items-center justify-center gap-2 rounded-md border border-gray-400 bg-[var(--accents-1)]",style:{height:i},children:[(0,t.jsx)(d.Text,{weight:500,children:"No Data"}),(0,t.jsx)(d.Text,{className:" max-w-[400px] text-gray-800",children:"There's no data available for your selection."})]}):(0,t.jsx)("div",{style:{height:i},children:(0,t.jsx)(ev.LineChart,{agentWorkflow:"firewall-agent",data:f,categories:u,getColor:m,isLoading:o,syncId:"firewall",disableLegend:!0,formatValue:e=>x(e),formatXAxisValue:ek,xTickCount:5,yTickCount:5,builderQuery:(0,ey.fromSonarQuery)(n),tooltipStyle:"dots",disableZoom:!0})})}function eC(e){let{height:l}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-col",style:{height:l},children:[(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(n.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(n.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(n.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(n.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(n.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,t.jsx)(n.Skeleton,{height:16,width:28}),(0,t.jsx)("hr",{className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex flex-row justify-around",children:[(0,t.jsx)(n.Skeleton,{height:16,width:48}),(0,t.jsx)(n.Skeleton,{height:16,width:48}),(0,t.jsx)(n.Skeleton,{className:"xs:block hidden",height:16,width:48}),(0,t.jsx)(n.Skeleton,{className:"hidden sm:block",height:16,width:48}),(0,t.jsx)(n.Skeleton,{className:"hidden md:block",height:16,width:48}),(0,t.jsx)(n.Skeleton,{className:"hidden lg:block",height:16,width:48})]})]})}let eS={hour:"numeric",minute:"2-digit",second:"numeric"};function ek(e){return e.toLocaleTimeString(void 0,eS)}var e_=e.i(2459259),eN=e.i(8247297),eA=e.i(8934201),eR=e.i(631755),eM=e.i(5485417);function eB(e){let{open:i,isEnabled:n,isLoading:s,onClose:r,onSubmit:o,confirmText:c}=e,[u,m]=(0,l.useState)(""),[x,f]=(0,l.useState)(!1),g=n?"Resume":"Pause",p=n?(0,t.jsx)("p",{children:"Are you sure you want to resume all system mitigations?"}):(0,t.jsxs)(a.Stack,{gap:1,children:[(0,t.jsxs)(d.Text,{size:14,children:["You are pausing ",(0,t.jsx)("strong",{children:"all DDoS protections"}),". Here's what to expect:"]}),(0,t.jsxs)(a.Stack,{className:"pl-3 pt-3",children:[(0,t.jsxs)(a.Stack,{direction:"row",gap:2,align:"flex-start",children:[(0,t.jsx)(d.Text,{size:14,color:"gray-600",children:"•"}),(0,t.jsxs)(d.Text,{size:14,children:["All traffic will be accepted by your project over the"," ",(0,t.jsx)("strong",{children:"next 24 hours"})]})]}),(0,t.jsxs)(a.Stack,{direction:"row",gap:2,align:"flex-start",children:[(0,t.jsx)(d.Text,{size:14,color:"gray-600",children:"•"}),(0,t.jsx)(d.Text,{size:14,children:"You will incur usage fees for all malicious traffic, including failed requests"})]}),(0,t.jsxs)(a.Stack,{direction:"row",gap:2,align:"flex-start",children:[(0,t.jsx)(d.Text,{size:14,color:"gray-600",children:"•"}),(0,t.jsx)(d.Text,{size:14,children:"Malicious traffic and associated fees will continue until DDoS protection is manually resumed or after 24 hours elapses"})]})]}),(0,t.jsx)(a.Stack,{className:"pt-2",gap:1,children:(0,t.jsxs)(d.Text,{children:["System mitigations should be paused as a temporary measure. Permanent system bypasses may be applied through the firewall configuration page."," ",(0,t.jsxs)(h.Link,{href:"./firewall/configure",variant:"blend",className:"inline-flex items-center gap-1",children:["Configure ",(0,t.jsx)(eM.ArrowRight,{size:12})]})]})})]});return(0,l.useEffect)(()=>{i||m("")},[i]),(0,t.jsxs)(eA.Modal.Modal,{active:i,onClickOutside:r,children:[(0,t.jsx)(eA.Modal.Body,{children:(0,t.jsxs)(a.Stack,{gap:2,children:[(0,t.jsx)(eA.Modal.Title,{children:`${g} System Mitigations`}),(0,t.jsx)(eA.Modal.P,{children:p}),n?null:(0,t.jsx)(eA.Modal.Inset,{last:!0,children:(0,t.jsxs)(a.Stack,{gap:3,children:[(0,t.jsxs)(d.Text,{color:"gray-900",size:14,weight:400,children:["To confirm, enter the project name"," ",(0,t.jsxs)("b",{style:{},children:[c," "]})," below:"]}),(0,t.jsx)(eR.Input,{"aria-label":"Project name",disabled:s,name:"projectName",onChange:e=>m(e.target.value),value:u}),(0,t.jsx)(eN.Checkbox,{checked:x,onChange:e=>f(e.target.checked),children:"I understand that pausing system mitigations may result in additional fees due to unmitigated attack traffic."})]})})]})}),(0,t.jsxs)(eA.Modal.Actions,{children:[(0,t.jsx)(eA.Modal.Action,{onClick:r,type:"secondary",children:"Cancel"}),(0,t.jsx)(eA.Modal.Action,{disabled:s||!n&&(u!==c||!x),loading:s,onClick:o,children:g})]})]})}var eT=e.i(4946061),eL=e.i(2774258),eI=e.i(5140160),eP=e.i(5076671);function e$(e){let{onActionClick:l,query:i,state:a}=e,{can:n}=(0,_.default)(),s=(0,en.wafRuleId)(a.filter),{currentData:r}=(0,$.useSonarLiveQuery)({...i,filter:"all_rules"===a.filter?void 0:`wafRuleId eq '${s}'`,groupBy:["wafAction"],summaryOnly:!0},"live"===a.range&&(n(N.Action.Read,N.Resource.SeawallConfig)||n(N.Action.List,N.Resource.SeawallConfig))),o=(r?.summary??[]).reduce((e,t)=>{let l="allow"===t.wafAction?"allow":(0,en.normalizeFirewallAction)(t.wafAction);return l in e&&(e[l]+=t.value??0),e.all+=t.value??0,e},{all:0,allow:0,challenge:0,deny:0,log:0,rate_limit:0});return(0,t.jsx)("div",{className:"relative overflow-hidden rounded-t-md @container before:pointer-events-none before:absolute before:inset-0 before:shadow-[inset_-30px_0_20px_-20px_var(--ds-background-200)] before:content-[''] @[966px]:before:shadow-none",children:(0,t.jsxs)("div",{className:"flex flex-1 flex-row overflow-x-scroll divide-x [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[(0,t.jsx)(eF,{active:"all"===a.action,icon:(0,t.jsx)(eI.Globe,{}),label:"All Traffic",onClick:()=>l("all"),children:o.all}),(0,t.jsx)(eF,{active:"allow"===a.action,icon:(0,t.jsx)(eP.ShieldCheck,{}),label:"Allowed",onClick:()=>l("allow"),children:o.allow}),(0,t.jsx)(eF,{active:"deny"===a.action,icon:(0,t.jsx)(j.ShieldOff,{}),label:"Denied",onClick:()=>l("deny"),children:o.deny}),(0,t.jsx)(eF,{active:"challenge"===a.action,icon:(0,t.jsx)(p.Shield,{}),label:"Challenged",onClick:()=>l("challenge"),children:o.challenge}),(0,t.jsx)(eF,{active:"log"===a.action,icon:(0,t.jsx)(eT.CodeWrap,{}),label:"Logged",onClick:()=>l("log"),children:o.log}),(0,t.jsx)(eF,{active:"rate_limit"===a.action,icon:(0,t.jsx)(eL.Gauge,{}),label:"Rate Limited",onClick:()=>l("rate_limit"),children:o.rate_limit})]})})}function eF(e){let{active:l,children:i,icon:n,label:s,onClick:r}=e;return(0,t.jsxs)(a.Stack,{as:"button",className:(0,T.clsx)("min-w-[166px] cursor-pointer",{"bg-background-100 border-b-2 border-b-gray-1000":l,"bg-background-200 border-b border-b-gray-200":!l}),flex:1,gap:1,onClick:r,padding:5,children:[(0,t.jsxs)(a.Stack,{align:"center",direction:"row",gap:2,className:l?"text-gray-1000":"text-gray-800",children:[n,(0,t.jsx)(d.Text,{className:"whitespace-nowrap",variant:"label-14",weight:500,children:s})]}),(0,t.jsx)(d.Text,{align:"left",variant:"heading-24",weight:500,children:0===i?"-":(0,en.formatShortPrecision)(i)})]})}var eD=e.i(6284911),eO=e.i(3583950),ez=e.i(2338803);let eU=(0,e.i(6895406).withNewIcon)(`<g clip-path="url(#clip0_4628_1818)">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0932 7.64904C14.8377 3.56123 11.3168 0.454519 7.22898 0.710006C5.45234 0.821046 3.8593 1.54996 2.64882 2.67365L3.66933 3.77299C4.63533 2.87625 5.90403 2.29574 7.32254 2.20709C10.5835 2.00327 13.3923 4.48161 13.5961 7.74261C13.663 8.81244 14.0605 10.1035 15.1336 10.8299L15.9745 9.58773C15.4544 9.23567 15.1467 8.50463 15.0932 7.64904ZM1.21934 4.48945C0.544864 5.69225 0.197633 7.09732 0.28994 8.57425C0.414316 10.5643 0.700415 12.5343 1.14241 14.4655L2.6046 14.1308C2.1807 12.2786 1.90631 10.3893 1.78702 8.48068C1.71326 7.30048 1.99016 6.18167 2.52767 5.22312L1.21934 4.48945ZM11.9314 8.14996C11.7883 5.86143 9.81714 4.12215 7.5286 4.26518C5.24007 4.40822 3.50079 6.3794 3.64382 8.66793C3.6894 9.3971 3.75974 10.1232 3.85448 10.845L5.34173 10.6498C5.25141 9.9617 5.18435 9.2695 5.1409 8.57437C5.04955 7.11264 6.16045 5.85362 7.62217 5.76226C9.0839 5.67091 10.3429 6.78181 10.4343 8.24353C10.4726 8.85698 10.5332 9.46767 10.6157 10.0745L12.102 9.87246C12.0244 9.30161 11.9674 8.72708 11.9314 8.14996ZM13.0024 13.8749C12.7538 13.0919 12.5457 12.2962 12.379 11.4908L10.9101 11.7947C11.0749 12.5911 11.2779 13.3786 11.5181 14.1546L13.0024 13.8749ZM14.6499 24.8207L10.8508 25.5691C11.9295 25.8912 13.1347 25.7761 14.176 25.1513C14.3437 25.0507 14.5018 24.94 14.6499 24.8207ZM4.79771 15.421C4.62667 14.8172 4.47329 14.2083 4.33781 13.5951C4.27053 13.2906 4.20767 12.985 4.14924 12.6784L5.62272 12.3976C5.67842 12.6899 5.73835 12.9812 5.80249 13.2715C5.94137 13.9001 6.09998 14.5239 6.27803 15.142L4.79771 15.421ZM8.11677 14.7955L8.0783 14.6651L8.0775 14.6624C7.46325 12.5503 7.08106 10.3695 6.94287 8.1585C6.91703 7.7451 7.23122 7.38902 7.64463 7.36318C8.05803 7.33734 8.41411 7.65153 8.43995 8.06494C8.57119 10.1649 8.93413 12.2361 9.51744 14.2421L9.51783 14.2435L9.5983 14.5164L8.11677 14.7955Z" fill="currentColor" />
  </g>
  <defs>
  <clipPath id="clip0_4628_1818">
  <rect width="16" height="16" fill="white" style="fill:white;fill-opacity:1;"/>
  </clipPath>
  </defs>`);var eE=e.i(6129921),eq=e.i(6621512),eH=e.i(6954631),eG=e.i(4583851),eV=e.i(3514588),eW=e.i(6320924),eZ=e.i(1379429),eQ=e.i(4746738);let eJ=(0,l.createContext)({});function eK(e){let{children:i,className:a}=e,[n,s]=(0,l.useState)(!1),r=(0,l.useMemo)(()=>({expanded:n,setExpanded:s}),[n,s]);return(0,t.jsx)(eZ.Card,{border:!0,className:(0,T.clsx)("relative overflow-hidden",a),children:(0,t.jsx)(eJ.Provider,{value:r,children:i})})}eJ.displayName="ExpandablePanelContext",eK.Header=function(e){let{children:l,className:i}=e;return(0,t.jsx)("div",{className:(0,T.clsx)("border-b px-5 py-3",i),children:l})},eK.Footer=function(e){let{children:l}=e;return(0,t.jsx)("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 flex flex-row items-center justify-center bg-gradient-to-t from-background-200 to-background-200/0 pb-4",children:l})},eK.Expand=function(){let{setExpanded:e}=(0,l.useContext)(eJ);return(0,t.jsx)(i.Button,{className:"pointer-events-auto",onClick:()=>e(!0),shadow:!0,shape:"rounded",size:"small",suffix:(0,t.jsx)(eQ.Fullscreen,{}),type:"secondary",children:"View All"})},eK.Expanded=function(e){let{children:i,...a}=e,{expanded:n,setExpanded:s}=(0,l.useContext)(eJ);return(0,t.jsxs)(eA.Modal.Modal,{...a,active:n,onClickOutside:()=>s(!1),style:{height:"80vh"},width:600,children:[(0,t.jsx)(eA.Modal.Body,{className:"flex-1 p-0",children:i}),(0,t.jsx)(eA.Modal.Actions,{children:(0,t.jsx)(eA.Modal.Action,{fullWidth:!0,onClick:()=>s(!1),children:"Close"})})]})};var eY=e.i(7229353),eX=e.i(3602900),e0=e.i(9960073);function e1(e){let{isOpen:l,onClose:i}=e;return(0,t.jsxs)(eA.Modal.Modal,{active:l,onClickOutside:i,children:[(0,t.jsxs)(eA.Modal.Body,{children:[(0,t.jsxs)(eA.Modal.Header,{children:[(0,t.jsx)(eA.Modal.Title,{children:(0,t.jsxs)(a.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(e0.FileText,{size:20}),"Deployment Rules"]})}),(0,t.jsxs)(eA.Modal.Subtitle,{children:["Rules defined in ",(0,t.jsx)("code",{children:"vercel.json"})," files, created at build time."]})]}),(0,t.jsxs)(eA.Modal.P,{children:["Deployment rules are firewall rules that are automatically created from your project's ",(0,t.jsx)("code",{children:"vercel.json"})," configuration file. They are generated at build time and run at the edge before your application code executes to protect your deployment."]}),(0,t.jsxs)(eA.Modal.P,{children:["Each action type is shown separately and these rules are automatically generated from your ",(0,t.jsx)("code",{children:"vercel.json"}),"."]}),(0,t.jsxs)(eA.Modal.P,{children:["Learn more about configuring deployment rules in"," ",(0,t.jsx)(h.Link,{href:"/docs/project-configuration",target:"_blank",external:!0,variant:"highlight",children:"project configuration"})," ","or read about the"," ",(0,t.jsx)(h.Link,{href:"/docs/vercel-firewall",target:"_blank",external:!0,variant:"highlight",children:"Vercel firewall"}),"."]})]}),(0,t.jsx)(eA.Modal.Actions,{children:(0,t.jsx)(eA.Modal.Action,{onClick:i,type:"secondary",children:"Close"})})]})}function e2(e){let{config:i,project:a,rulesets:n}=e,{hoveredTimestamp:s}=(0,eX.useSonarContext)(),[r,o,c]=J(),{maxByKeys:u,allData:d}=el(),m=(0,ex.useParams)(),x=function(e,t){let[i,a]=(0,l.useState)(e7(e,t)),n=(0,l.useRef)(e7(e,t));return(0,l.useEffect)(()=>{let l=performance.now(),i=e7(e,t),s=n.current,r=s.length===i.length,o=0,c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),t=Math.sin(Math.min((e-l)/100,1))*Math.PI*.5;if(!r||t>=1){a(i),Object.assign(s,i);return}o=requestAnimationFrame(c);let n=Array(i.length);for(let e=i.length;e--;){let l=i[e],a=s[e];n[e]={name:l.name,total:l.total,value:e9(a.value,l.value,t),ratio:e9(a.ratio,l.ratio,t)}}a(n)};return c(),()=>{cancelAnimationFrame(o),a(l=>(Object.assign(s,l),e7(e,t)))}},[e,t]),i}(u,(0,l.useMemo)(()=>{if(s)return Object.fromEntries(d.filter(e=>e.date.getTime()===s.getTime()).map(e=>[e.key,e.value]))},[s,d])),f=(0,l.useCallback)(e=>{let t="all_rules"===r.filter;if("BotID"===r.filter)return`/${m?.teamSlug}/${m?.project}/observability?builder=true&${new URLSearchParams({time:"1d",metric:"botIdCheck.count",by:"botCheckResult",aggregate:"sum"}).toString()}`;let l=(0,en.wafRuleId)(t?e:r.filter),i={time:"1d",by:"wafAction",filter:[a?.id&&`projectId eq '${a.id}'`,`wafRuleId eq '${l}'`].filter(e=>!!e).join(" and "),aggregate:"sum"};(0,G.isLimitedSystemRule)(l)?(i.metric="blockedConnection.count","clientIp"===r.groupBy&&(i.by="clientIp",i.where=`clientIp eq '${e}'`)):(i.metric="incomingRequest.count",t||(i.filter=[i.filter,`${r.groupBy} eq '${e}'`].join(" and ")));let n=new URLSearchParams(i);return`/${m?.teamSlug}/${m?.project}/observability?builder=true&${n.toString()}`},[m,a?.id,r.filter,r.groupBy]),g=(0,l.useCallback)(e=>{let t,l,[i]=e.split(eY.SEPARATOR);switch(r.groupBy){case"clientIp":t="ip_address",l="IP Address";break;case"clientIpCountry":t="geo_country",l="Country";break;case"clientAsn":t="geo_as_number",l="ASN";break;case"requestPath":t="path",l="Request Path";break;case"edgeNetworkRegion":t="region",l="Vercel Region";break;case"clientUserAgent":t="user_agent",l="User Agent";break;case"sourcePath":t="target_path",l="Target Path";break;case"clientJa4Digest":t="ja4_digest",l="JA4";break;case"requestHostname":t="host",l="Host";break;default:return null}let a=[{conditions:[{type:t,op:"eq",value:i}]}],n=i;n&&n.length>60&&(n=n.slice(0,60));let s=JSON.stringify({name:`Rule for ${l}: ${n}`,description:`Automatically created from firewall table for ${l} ${n}`,conditionGroup:a,active:!0,action:{mitigate:{action:"log"}}}),o=(0,k.getRuleTemplateSignature)(s),c=new URLSearchParams({template:s,sig:o});return`/${m?.teamSlug}/${m?.project}/firewall/configure/rule/new?${c.toString()}`},[m?.teamSlug,m?.project,r.groupBy]),h=Object.fromEntries(Object.entries((0,l.useMemo)(()=>"all_rules"===r.filter?"group_by_category"===r.groupBy?x.reduce((e,t)=>{let[l,i]=t.name.split(eY.SEPARATOR),a=G.ruleToMappings[l];if(a?.groupBy){let l=e[a.groupBy];l?l.push(t):l=[t],e[a.groupBy]=l}else(0,en.isCustomRuleId)(l)?e["Custom Rules"].push(t):e.System.push(t);return e},{System:[],"Custom Rules":[]}):x.reduce((e,t)=>{let[,l]=t.name.split(eY.SEPARATOR),i=(0,en.formatFirewallActionForDisplay)(l),a=e[i];return a?a.push(t):a=[t],e[i]=a,e},{}):{[r.groupBy]:x},[x,r.filter,r.groupBy])).filter(e=>{let[,t]=e;return t.length>0}));return(0,t.jsx)("div",{className:(0,T.clsx)("grid w-full grid-cols-1 gap-3",{"lg:grid-cols-2":Object.keys(h).length>1}),children:Object.entries(h).map(e=>{let[l,a]=e;return(0,t.jsx)(e4,{config:i,createMonitoringSearchParams:f,createRuleBuilderLink:g,header:l,params:m,rulesets:n,segment:a,toolbarState:r,ruleOptions:c},l)})})}function e4(e){let{config:i,header:a,rulesets:n,segment:s,toolbarState:r,ruleOptions:o,createMonitoringSearchParams:c,createRuleBuilderLink:u,params:m}=e,[x,f]=(0,l.useState)(""),[g,h]=(0,l.useState)(!1),p=e8(i,n,r),j=s;x&&(j=j.filter(e=>{let{label:t,suffix:l}=p(e.name);return t.toLowerCase().includes(x.toLowerCase())||l?.toLowerCase().includes(x.toLowerCase())}));let b=e=>{let t=e.name.replace(/\$\$.*/,""),l=i?.ruleMap.get(t),a=i?.ruleMap.get(t)?.type==="custom_rule";return{config:i,createMonitoringSearchParams:c,createRuleBuilderLink:u,fieldId:t,isCustomRule:a,params:m,point:e,ruleFields:l,rulesets:n,toolbarState:r,onDeploymentRuleInfoClick:()=>{h(!0)}}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(eK,{children:[(0,t.jsxs)(eK.Header,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(d.Text,{className:"leading-6",variant:"label-14",weight:500,children:(0,en.formatTableHeader)(o,a)}),"Custom Rules"===a?(0,t.jsx)(e5,{}):null]}),(0,t.jsx)("div",{className:"p-2 [&>*:nth-child(odd)]:bg-background-200",children:s.slice(0,5).map(e=>(0,t.jsx)(e3,{...b(e)},e.name))}),s.length>5&&(0,t.jsx)(eK.Footer,{children:(0,t.jsx)(eK.Expand,{})}),(0,t.jsx)(eK.Expanded,{disableFocusTrap:!0,children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"border-b border-red-100 p-5",children:(0,t.jsx)(d.Text,{variant:"heading-16",weight:500,children:(0,en.formatTableHeader)(o,a)})}),(0,t.jsx)("div",{className:"px-2",children:(0,t.jsx)(eD.SearchInput,{clearable:!1,onChange:e=>f(e.target.value),placeholder:"Search",value:x})}),(0,t.jsx)("div",{className:"p-2",children:j.map(e=>(0,t.jsx)(e3,{...b(e)},e.name))})]})})]}),(0,t.jsx)(e1,{isOpen:g,onClose:()=>h(!1)})]})}function e5(){let e=(0,ex.useParams)(),{isLoading:l,team:i}=(0,eV.useTeam)(),{can:a,isLoading:s}=(0,_.default)(),{data:r,isLoading:o}=(0,L.useProject)(e?.project,{apiVersion:"v13"}),{config:c,isLoadingConfig:u}=(0,F.useFirewallConfig)({projectId:r?.id}),d=(0,B.useServerFlag)("enable-microfrontends-support",!1);if(s||u||o||l)return(0,t.jsx)(n.Skeleton,{height:24,width:24});let m=a(N.Action.All,N.Resource.SeawallConfig),x=d&&r?.microfrontends!==void 0&&!r.microfrontends.isDefaultApp,f=(0,en.isPlanLimitReached)({config:c,teamPlan:i?.billing?.plan,type:"customRules"});return(0,t.jsx)(h.ButtonLink,{"aria-label":"Add a custom rule",disabled:!m||x||f,href:"firewall/configure/rule/new",size:"tiny",style:{"--height":"24px"},svgOnly:!0,type:"secondary",children:(0,t.jsx)(b.Plus,{})})}function e3(e){let{config:l,createMonitoringSearchParams:i,createRuleBuilderLink:a,fieldId:n,isCustomRule:m,params:x,point:f,ruleFields:g,rulesets:h,toolbarState:p,onDeploymentRuleInfoClick:j}=e,{activeDataKey:b,formatter:v,seriesColor:y,setActiveDataKey:C}=el(),S=!(0,en.isOthersAggregate)(f.name),k=a(n),_=!(0,en.isOthersAggregate)(f.name)&&null!==k,N=()=>{S&&C(b===f.name?null:f.name)};return(0,t.jsxs)("div",{className:(0,T.clsx)("flex min-h-[36px] flex-1 items-center gap-5 rounded-md p-2",{"transition-colors hover:!bg-gray-100 cursor-pointer":S}),onClick:N,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&N()},role:"button",tabIndex:0,"aria-disabled":!S,children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-2 border-none bg-transparent text-start",children:[(0,t.jsx)("div",{className:"size-[8px] rounded-full",style:{backgroundColor:null!==b&&b!==f.name?"var(--ds-gray-400)":y[f.name]}}),(0,t.jsx)(e6,{config:l,disabled:g?.type==="custom_rule"&&!g.active,rulesets:h,toolbarState:p,children:f.name}),(0,t.jsx)(d.Text,{className:"select-text tabular-nums",color:"gray-900",variant:"label-14",children:v(f.value)})]}),(0,t.jsxs)(s.MenuContainer,{position:"bottom-end",children:[(0,t.jsx)(o.MenuButton,{"aria-label":"more menu button",className:"flex max-h-[24px] items-center",shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(w.MoreHorizontal,{})}),(0,t.jsxs)(r.Menu,{className:"min-w-[180px]",portalClassName:"tailwind-preflight",children:[m?(0,t.jsx)(u.MenuLink,{href:`/${x?.teamSlug}/${x?.project}/firewall/configure/rule/${n}`,target:"_blank",children:(0,t.jsx)("span",{children:"Edit Rule"})}):null,(0,t.jsx)(c.MenuItem,{onClick:e=>{e.stopPropagation();let[t]=f.name.split("$$");navigator.clipboard.writeText(t)},children:(0,t.jsx)("span",{children:"Copy Value"})}),"deployment_defined_rules"===n?(0,t.jsx)(c.MenuItem,{onClick:e=>{e.stopPropagation(),j()},children:(0,t.jsx)("span",{children:"What is this?"})}):null,(0,en.isOthersAggregate)(f.name)?null:(0,t.jsx)(u.MenuLink,{href:i(n),target:"_blank",children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Inspect Traffic"})}),_?(0,t.jsx)(u.MenuLink,{href:k,target:"_blank",children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Create Custom Rule"})}):null]})]})]})}function e6(e){let{children:l,config:i,disabled:a,rulesets:n,toolbarState:s}=e,{context:r,icon:o,label:c,suffix:u}=e8(i,n,s)(l);return(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-center gap-2",children:[(0,t.jsx)(eO.ContextCard.Trigger,{content:r??null,noPadding:!0,children:(0,t.jsxs)(d.Text,{className:"flex items-center gap-2",color:a?"gray-600":"gray-1000",variant:"label-14",weight:500,children:[c,u?(0,t.jsx)(d.Text,{as:"span",color:a?"gray-600":"gray-900",children:u}):null,o?(0,t.jsx)("span",{className:`flex items-center ${a?"text-gray-600":"text-gray-900"}`,children:o}):null]})}),a?(0,t.jsx)(m.Badge,{variant:"gray-subtle",children:"Disabled"}):null]})}function e8(e,l,i){return a=>{var n,s;if((0,en.isOthersAggregate)(a))return{label:"Other"};let[r,o,...c]=a.split(eY.SEPARATOR);if("clientIp"===i.groupBy){let e=c[2]?.toUpperCase(),l=eW.countriesByAlpha2[e],i=Array.isArray(l)?l[0]:l||e,a=eW.flagsByAlpha2[e];return{label:r,suffix:(0,en.formatFirewallActionForDisplay)(o),context:(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(d.Text,{className:"mb-3",variant:"heading-14",weight:500,children:["Details for ",r]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(d.Text,{className:"shrink-0",variant:"label-13",children:"AS Name"}),(0,t.jsx)(d.Text,{align:"right",color:"gray-800",variant:"label-13",children:c[1]||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)(d.Text,{variant:"label-13",children:"AS Number"}),(0,t.jsx)(d.Text,{color:"gray-800",variant:"label-13",children:c[0]||"N/A"})]})]})]}),i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ez.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(d.Text,{variant:"label-13",children:[a,i].filter(Boolean).join(" ")})})]}):null]})}}if("clientIpCountry"===i.groupBy){let e=eW.countriesByAlpha2[r.toUpperCase()];return{label:Array.isArray(e)?e[0]:e||a,suffix:(0,en.formatFirewallActionForDisplay)(o)}}if("clientUserAgent"===i.groupBy&&(0,eh.isBotProtectionData)(i.filter)&&(n=r,te.some(e=>!(!e.must_contain.every(e=>n.includes(e))||e.must_not_contain&&e.must_not_contain.some(e=>n.includes(e)))&&!0)))return{label:r,suffix:(0,en.formatFirewallActionForDisplay)(o),icon:(0,t.jsx)(eq.Information,{size:14,className:"flex-none"}),context:(0,t.jsx)("div",{className:"flex w-[250px] flex-col",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(d.Text,{className:"mb-3 flex items-center gap-1",variant:"heading-14",weight:500,children:[(0,t.jsx)(eE.Robot,{className:"flex-none"})," Spoofed or malicious traffic"]}),(0,t.jsxs)(d.Text,{variant:"label-13",children:["These requests claimed to be from a legitimate bot but were flagged because they failed our"," ",(0,t.jsx)(h.Link,{external:!0,href:"/docs/bot-management#verified-bots",isDifferentZone:!0,variant:"highlight",children:"verification"})]})]})})};if("clientUserAgent"===i.groupBy&&(0,eh.isBotProtectionData)(i.filter)&&(s=r).startsWith("Mozilla/")&&!s.includes("Headless")&&!s.includes("bot")&&!s.includes("Bot"))return{label:r,suffix:(0,en.formatFirewallActionForDisplay)(o),icon:(0,t.jsx)(eq.Information,{size:14,className:"flex-none"}),context:(0,t.jsx)("div",{className:"flex w-[250px] flex-col",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)(d.Text,{className:"mb-3 flex items-center gap-1",variant:"heading-14",weight:500,children:[(0,t.jsx)(eU,{className:"flex-none"})," Likely non-browser traffic"]}),(0,t.jsxs)(d.Text,{variant:"label-13",children:["These requests use browser User-Agents but their HTTP and TLS"," ",(0,t.jsx)(h.Link,{external:!0,href:"/docs/bot-management#bot-protection-managed-ruleset",isDifferentZone:!0,variant:"highlight",children:"fingerprints"})," ","do not match actual browser behavior"]})]})})};if("clientUserAgent"===i.groupBy)return{label:r,suffix:(0,en.formatFirewallActionForDisplay)(o),context:(0,t.jsx)(eH.UserAgentDetailCard,{value:r})};if("edgeNetworkRegion"===i.groupBy){let e=eG.regions[r];return e?{label:e.name,suffix:e.providerRegion}:{label:a,suffix:(0,en.formatFirewallActionForDisplay)(o)}}if("wafRuleId"===i.groupBy||"all_rules"===i.filter){if(r.startsWith("managed_")){let[e,t]=r.split("managed_"),i=(0,eh.getRulesetFromRulesets)(l,t);if(i)return{label:i.name,suffix:(0,en.formatFirewallActionForDisplay)(o)}}let t=[];e&&(t.push(...e.rules),t.push(...e.crsRules),t.push(...e.currentConfig.ips.map(e=>({id:e.id,name:`IP Block ${"*"===e.hostname?"":e.hostname} ${e.ip}`}))));let i=t.find(e=>e.id===r);if(i)return{label:i.name,suffix:(0,en.formatFirewallActionForDisplay)(o)};let a=G.ruleToMappings[r];if(a)return{label:a.label,suffix:(0,en.formatFirewallActionForDisplay)(o)};if("deployment_rules"===r)return{label:"Deployment Rules",suffix:(0,en.formatFirewallActionForDisplay)(o)};if("deployment_defined_rules"===r)return{label:"Deployment Defined Rules",suffix:(0,en.formatFirewallActionForDisplay)(o)}}return"BotID"===i.filter?{label:r}:{label:r,suffix:(0,en.formatFirewallActionForDisplay)(o)}}}function e7(e,t){let l=0;return Object.entries(e).map(e=>{let[i,a]=e,n=a;return void 0!==t?.[i]&&(n=t[i]),l+=n,{name:i,value:n,total:a,ratio:0}}).sort((e,t)=>(0,en.isOthersAggregate)(e.name)?1:(0,en.isOthersAggregate)(t.name)?-1:t.total-e.total).map(e=>({name:e.name,value:e.value,ratio:e.value/Math.max(l,1)*100,total:e.total}))}function e9(e,t,l){if(null===e)return t;let i=e||0;return Math.max(0,i+(t-i)*l)}e2.Skeleton=function(){return(0,t.jsxs)("div",{className:"grid w-full grid-cols-1 gap-3 lg:grid-cols-2",children:[(0,t.jsx)(e4.Skeleton,{}),(0,t.jsx)(e4.Skeleton,{})]})},e4.Skeleton=function(){return(0,t.jsxs)(eK,{children:[(0,t.jsx)(eK.Header,{children:(0,t.jsx)(n.Skeleton,{height:20,width:100})}),(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsx)(e3.Skeleton,{}),(0,t.jsx)(e3.Skeleton,{}),(0,t.jsx)(e3.Skeleton,{}),(0,t.jsx)(e3.Skeleton,{}),(0,t.jsx)(e3.Skeleton,{})]})]})},e3.Skeleton=function(){return(0,t.jsxs)("div",{className:"flex h-[36px] flex-1 items-center gap-5 p-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,t.jsx)(n.Skeleton,{height:8,pill:!0,width:8}),(0,t.jsx)(n.Skeleton,{height:16,width:144})]}),(0,t.jsx)(n.Skeleton,{height:16,width:32})]})};let te=[{must_contain:["Googlebot"]},{must_contain:["bingbot/2.0"]},{must_contain:["DuckDuckBot"]},{must_contain:["DuckAssistBot"]},{must_contain:["YandexBot"]},{must_contain:["Applebot"]},{must_contain:["AhrefsBot"]},{must_contain:["AhrefsSiteAudit"]},{must_contain:["SemrushBot"]},{must_contain:["SiteAuditBot"]},{must_contain:["SplitSignalBot"]},{must_contain:["BacklinksExtendedBot"]},{must_contain:["ImagesiftBot"]},{must_contain:["GPTBot"]},{must_contain:["Claude-Web"]},{must_contain:["Claude-Search"]},{must_contain:["PerplexityBot"]},{must_contain:["OAI-SearchBot"]},{must_contain:["AlgoliaBot"]},{must_contain:["AdsBot-Google"]},{must_contain:["Mediapartners-Google"]},{must_contain:["APIs-Google"]},{must_contain:["Google-Safety"]},{must_contain:["Google-Site-Verification"]},{must_contain:["Google-InspectionTool"]},{must_contain:["Google-Read-Aloud"]},{must_contain:["Google-PageRenderer"]},{must_contain:["Google-PublisherCenter"]},{must_contain:["Google-Storebot"]},{must_contain:["Google-CloudVertexBot"]},{must_contain:["facebookexternalhit"],must_not_contain:["facebookexternalhit/1.1 Facebot Twitterbot/1.0"]},{must_contain:["facebookcatalog"]},{must_contain:["Twitterbot"],must_not_contain:["facebookexternalhit/1.1 Facebot Twitterbot/1.0"]},{must_contain:["LinkedInBot"]},{must_contain:["http://www.pinterest.com/bot.html"]},{must_contain:["meta-externalfetcher"]},{must_contain:["meta-externalagent"]},{must_contain:["UptimeRobot"]},{must_contain:["Pingdom"]},{must_contain:["Site24x7"]},{must_contain:["Better Uptime Bot"]},{must_contain:["Datadog/Synthetics"]},{must_contain:["SentryUptimeBot"]},{must_contain:["HetrixTools Uptime Monitoring Bot"]},{must_contain:["StatusCake"]},{must_contain:["Checkly"]},{must_contain:["Hydrozen.io"]},{must_contain:["ChatGPT-User"]},{must_contain:["Perplexity-User"]},{must_contain:["Stripe/"]},{must_contain:["PayPal"]},{must_contain:["GitHub-Hookshot"]},{must_contain:["GitHub-Camo"]},{must_contain:["Amazon-Route53-Health-Check"]},{must_contain:["amazonbot"]},{must_contain:["Amazon-Q"]},{must_contain:["Amazon-Kendra"]},{must_contain:["Cookiebot"]},{must_contain:["lumar.io"]},{must_contain:["deepcrawl.com"]},{must_contain:["inngest.com"]},{must_contain:["hookdeck.com"]},{must_contain:["qstash.com"]},{must_contain:["svix.com"]},{must_contain:["v0.dev"]},{must_contain:["Vercel Screenshot"]},{must_contain:["Vercel Favicon"]},{must_contain:["artemis web reader"]}];var tt=e.i(6854012),tl=e.i(3682401),ti=e.i(7544595),ta=e.i(3112824);function tn(e){let{totalRequests:l}=e;return(0,t.jsx)("div",{className:"relative overflow-hidden rounded-t-md @container before:pointer-events-none before:absolute before:inset-0 before:shadow-[inset_-30px_0_20px_-20px_var(--ds-background-200)] before:content-[''] @[966px]:before:shadow-none",children:(0,t.jsx)("div",{className:"flex flex-1 flex-row divide-x [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:(0,t.jsx)(ts,{icon:(0,t.jsx)(eI.Globe,{}),label:"All Traffic",children:l})})})}function ts(e){let{children:l,icon:i,label:n}=e;return(0,t.jsxs)(a.Stack,{className:"min-w-[166px] border-b-2 border-b-gray-1000 bg-background-100",flex:1,gap:1,padding:5,children:[(0,t.jsxs)(a.Stack,{align:"center",direction:"row",gap:2,className:"text-gray-1000",children:[i,(0,t.jsx)(d.Text,{className:"whitespace-nowrap",variant:"label-14",weight:500,children:n})]}),(0,t.jsx)(d.Text,{align:"left",variant:"heading-24",weight:500,children:0===l?"-":(0,en.formatShortPrecision)(l)})]})}var tr=e.i(540570);let to=JSON.stringify({name:"",description:"",active:!0,conditionGroup:[{conditions:[{type:"path",op:"eq",value:""}]}],action:{mitigate:{action:"rate_limit",rateLimit:{action:"rate_limit",algo:"fixed_window",window:"60",limit:"100",keys:["ip"]}}}});function tc(){let{team:e}=(0,eV.useTeam)(),i=(0,ex.useParams)(),a=i?.teamSlug??"",n=i?.project??"",s=(0,B.useServerFlag)("bot-id-ui",!1),{data:r,isLoading:o}=(0,L.useProject)(i?.project,{apiVersion:"v13"}),[c,u,d]=J(e??void 0),{can:m,isLoading:x}=(0,_.default)(),f=m(N.Action.Read,N.Resource.SeawallConfig)||m(N.Action.List,N.Resource.SeawallConfig),g=(0,l.useRef)(null),{activeConfig:h,isLoadingConfig:p}=(0,F.useFirewallConfig)({projectId:n}),{data:j,isLoading:b}=(0,ti.useManagedRulesets)({projectIdOrName:n,teamIdOrSlug:a}),v=[{label:"Overview",value:"all_rules",action:"allow",active:!0},...s?[{label:"BotID",value:"BotID",action:"allow",active:!0}]:[],...G.defaultShowSystemRules.map(e=>({...e,active:!0}))];if(h&&j){for(let[e,t]of Object.entries(h.currentConfig.managedRules??{})){let l=(0,eh.getRulesetFromRulesets)(j,e);if("owasp"===e){let e=(0,G.owaspToCrsConfig)(h.crsRules);v.push(...e.map(e=>({...e,active:t?.active??!1})))}else l&&v.push({label:l.name||e,value:`managed_${e}`,action:t?.action||l.defaultAction||l.actions?.[0]||"log",active:t?.active||l.active||!1})}for(let e of h.rules)v.push({label:e.name,value:e.id,action:e.action,active:e.active})}let w=v.filter(e=>e.active),C=(0,K.useQuerySelect)(c),{isLoading:S,error:k,currentData:A}=(0,$.useSonarLiveQuery)(f?C:void 0,"live"===c.range&&f),R=(0,l.useMemo)(()=>x&&!A?.data?null:f?A?.data?(0,en.getSonarSeriesData)(A.data,C.groupBy,v,c):null:new Map,[C.groupBy,v,f,x,A?.data,c]),{totalRequests:M}=function(e,t){let{can:i}=(0,_.default)(),{currentData:a}=(0,$.useSonarLiveQuery)({...e,filter:void 0,groupBy:void 0,summaryOnly:!0},"live"===t.range&&(i(N.Action.Read,N.Resource.SeawallConfig)||i(N.Action.List,N.Resource.SeawallConfig)));return{totalRequests:(0,l.useMemo)(()=>a?.summary[0]?.value??0,[a])}}(C,c),{data:I,isLoading:P}=(0,O.useAttackStatus)({projectId:n,teamId:a}),{data:D,isLoading:U}=(0,z.useReverseProxyStatus)({projectIdOrName:n,teamIdOrSlug:a}),E=I?.anomalies.find(e=>"active"===e.state&&!e.endTime),q=b||P||p||o||U,H=q||S,V=(0,en.globalBypassStatus)(r),W=!!E||V.enabled||!!D?.length;return(0,t.jsx)(ta.ProjectFirewallCriticalContentConditionalMarker,{enabled:!q,children:(0,t.jsx)(Y.ReviewChangeProvider,{projectIdOrName:n,teamIdOrSlug:a,children:(0,t.jsxs)("div",{"data-testid":(0,eg.tid)("firewall","overview","layout"),className:"tailwind-preflight",ref:g,children:[(0,t.jsx)(tu,{params:{teamSlug:a,project:n}}),(0,t.jsxs)("div",{className:"container flex flex-col gap-3 py-8",children:[(0,t.jsx)("div",{className:"flex flex-1 flex-row items-center justify-between gap-2",children:q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tl.FirewallStatusBadge.Skeleton,{}),(0,t.jsx)("div",{className:"flex flex-1 flex-row justify-end",children:(0,t.jsx)("div",{className:"w-full lg:w-auto",children:(0,t.jsx)(ej,{})})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tl.FirewallStatusBadge,{className:(0,T.clsx)("hidden",{"lg:flex":!W}),config:h,project:r,rulesets:j}),(0,t.jsx)("div",{className:"flex flex-1 flex-row justify-end",children:(0,t.jsx)("div",{className:"w-full lg:w-auto",children:(0,t.jsx)(eb,{isCustomRuleSelected:h?.rules.some(e=>e.id===c.filter),options:d,positionTop:(0,en.getOffsetTop)(g.current),rules:w,setToolbarState:u,team:e??void 0,toolbarState:c,managedRulesets:j})})})]})}),(0,t.jsx)(eX.SonarContextProvider,{children:(0,t.jsxs)(ei,{formatter:en.formatShortPrecision,series:R??new Map,children:[(0,t.jsxs)("div",{className:(0,T.clsx)("flex flex-col gap-3",{"lg:flex-row":W}),children:[q?(0,t.jsx)(tt.FirewallStatusCard.Skeleton,{className:(0,T.clsx)("block w-full lg:h-[388px] lg:w-[300px]",{"lg:hidden":!W})}):(0,t.jsx)(tt.FirewallStatusCard,{anomaly:E,className:(0,T.clsx)("block w-full lg:h-[388px] lg:w-[300px]",{"lg:hidden":!W}),config:h,globalBypass:V,reverseProxies:D,rulesets:j}),(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col rounded-md border border-gray-alpha-400 bg-background-100",children:["BotID"===c.filter?(0,t.jsx)(tn,{totalRequests:M}):(0,t.jsx)(e$,{onActionClick:e=>u({type:"action",value:e}),query:C,state:c}),(0,t.jsx)("div",{"data-testid":(0,eg.tid)("firewall","graph","container"),className:"flex-1 px-4 pb-4 pt-8",children:(0,t.jsx)(y.default,{children:e=>{let{width:l}=e;return(0,t.jsx)(ew,{data:R,error:k,height:240,isLoading:H,query:C,width:l})}})})]})]}),H?(0,t.jsx)(e2.Skeleton,{}):(0,t.jsx)(e2,{config:h,project:r,rulesets:j??{}})]})})]})]})})})}function tu(e){let{params:i}=e,m=(0,C.useRouter)(),{team:x,user:j}=(0,M.useAccount)(),[b,v]=(0,l.useState)(!1),{can:y,isLoading:S}=(0,_.default)(),{data:B,isLoading:T,mutate:$}=(0,L.useProject)(i.project,{apiVersion:"v13"}),{config:O}=(0,F.useFirewallConfig)({projectId:B?.id}),{updateMitigationsBypassAll:z,isLoading:U,bypassRules:E}=(0,D.useFirewallBypass)({projectId:B?.id}),q=(0,tr.useOpenUpgradeModal)(),{config:H}=(0,F.useFirewallConfig)({projectId:i.project});(0,l.useEffect)(()=>{B?.id&&x?.id&&j?.uid&&A.analytics.track(R.AnalyticsEvent.FIREWALL_TAB_VISITED,{projectId:B.id,teamId:x.id,userId:j.uid})},[B?.id,x?.id,j?.uid]);let G=y(N.Action.Read,N.Resource.SeawallConfig)||y(N.Action.List,N.Resource.SeawallConfig),V=y(N.Action.All,N.Resource.SeawallConfig),{enabled:W}=(0,en.globalBypassStatus)(B),Z=["enterprise","pro"].includes(x?.billing?.plan||""),{menuItems:Q,upgradeMenu:J}=(0,l.useMemo)(()=>{let e=[],l=[],a={teamPlan:x?.billing?.plan,config:H,bypassRules:E},n=x?.billing?.plan==="hobby";for(let{title:s,usage:r,key:o,href:u}of[{title:"Rule",key:"rule",href:`/${i.teamSlug}/${i.project}/firewall/configure/rule/new`,usage:(0,en.getPlanUsage)({...a,type:"customRules"})},{title:"Rate Limit",key:"rate-limit",href:`/${i.teamSlug}/${i.project}/firewall/configure/rule/new?template=${encodeURIComponent(to)}&sig=${encodeURIComponent((0,k.getRuleTemplateSignature)(to))}`,usage:(0,en.getPlanUsage)({...a,type:"rateLimit"})},{title:"IP Block",key:"ip-blocks",href:`/${i.teamSlug}/${i.project}/firewall/configure?add-ip=1`,usage:(0,en.getPlanUsage)({...a,type:"ipBlocks"})},{title:"System Bypass",key:"system-bypass",href:`/${i.teamSlug}/${i.project}/firewall/configure?add-system-bypass=1`,usage:(0,en.getPlanUsage)({...a,type:"ipBypass"})}]){if(!r)continue;let i=r.limit?(0,t.jsxs)("span",{className:"text-label-13 tabular-nums text-gray-900",children:[r.used," /"," ",r.limitReached&&r.nextPlanLimit?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("s",{className:"text-gray-700",children:r.limit})," ",(0,t.jsx)("span",{className:n?"text-blue-900":"text-purple-900",children:r.nextPlanLimit})]}):r.limit]}):void 0;if(r.limitReached){let e=n?{onClick:()=>q({teamHint:x.id,source:`firewall-configure-menu-${o}`,onConversionSuccess:()=>{m.push(u)}})}:{isLink:!0,href:"https://vercel.com/contact/sales"};l.push((0,t.jsx)(c.MenuItem,{...e,suffix:i,children:s},o))}else e.push((0,t.jsx)(c.MenuItem,{href:u,isLink:!0,suffix:i,children:s},o))}return{menuItems:e,upgradeMenu:l.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.MenuDivider,{}),(0,t.jsx)(g.MenuSection,{title:n?"Upgrade to Pro":"Upgrade to Enterprise",children:l})]}):null}},[E,H,q,i.project,i.teamSlug,m,x?.billing?.plan,x?.id]),K=(0,l.useMemo)(()=>W?"Resume":"Pause",[W]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.DashboardHeading,{buttons:(0,t.jsxs)(a.Stack,{className:"hidden md:flex md:flex-wrap",direction:{sm:"column",md:"row",lg:"row"},gap:3,children:[(0,t.jsx)(e_.ReviewChangesButton,{currentConfig:O}),T||S?(0,t.jsx)("div",{className:"w-full md:w-[255px]",children:(0,t.jsx)(n.Skeleton,{height:40,width:"100%"})}):(0,t.jsx)(h.ButtonLink,{disabled:!G,href:`/${i.teamSlug}/${i.project}/firewall/configure#bot-management`,prefix:(0,t.jsx)(p.Shield,{}),prefetch:!0,children:"Bot Management"}),(0,t.jsxs)(s.MenuContainer,{children:[(0,t.jsx)(o.MenuButton,{type:"secondary",children:"Add New..."}),(0,t.jsxs)(r.Menu,{width:224,children:[Q,J]})]}),(0,t.jsxs)(s.MenuContainer,{closeOnSelect:!0,position:"bottom-end",children:[(0,t.jsx)(o.MenuButton,{"aria-label":"Menu",shape:"square",size:"medium",svgOnly:!0,type:"secondary",children:(0,t.jsx)(w.MoreHorizontal,{})}),(0,t.jsxs)(r.Menu,{className:"min-w-[220px]",children:[(0,t.jsx)(c.MenuItem,{isLink:!0,href:`/${i.teamSlug}/${i.project}/firewall/configure`,children:"Configure"}),(0,t.jsx)(u.MenuLink,{href:"firewall/activity-log",children:"View Audit Log"}),Z?(0,t.jsx)(P.EnsureSWRData,{data:[B],fallback:(0,t.jsx)(c.MenuItem,{children:(0,t.jsx)(n.Skeleton,{height:40,width:"100%"})}),children:(0,t.jsxs)(c.MenuItem,{disabled:!V,onClick:()=>v(!0),type:"error",children:[K," System Mitigations"]})}):null]})]})]}),title:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)(d.Text,{as:"h1",size:32,weight:500,children:"Firewall"}),(0,t.jsx)(I.MicrofrontendsBadge,{pageContext:"Firewall rules for the default app also run for every request to this microfrontend."})]}),(0,t.jsx)("div",{className:"md:hidden",children:(0,t.jsx)(td,{canViewConfig:G,canWriteConfig:V,currentConfig:O,isBypassEnabled:W,onClickBypass:()=>v(!0),params:i,showBypassOption:Z})})]})}),(0,t.jsx)(eB,{confirmText:`${x?x.slug:j?.username}/${B?.name}`,isEnabled:W,isLoading:U||T,onClose:()=>v(!1),onSubmit:()=>{z(!W).then(async()=>{v(!1),await $()}).catch(()=>{})},open:b})]})}function td(e){let{params:i,onClickBypass:a,currentConfig:n,canViewConfig:c,canWriteConfig:u,isBypassEnabled:d,showBypassOption:x}=e,f=(0,C.useRouter)(),g=d?p.Shield:j.ShieldOff,{setOpen:h}=(0,Y.useReviewChangeContext)(),y=(0,l.useRef)(null),_=(0,l.useMemo)(()=>d?"Resume":"Pause",[d]);return(0,t.jsx)("div",{className:"",ref:y,children:(0,t.jsxs)(s.MenuContainer,{closeOnSelect:!0,position:"bottom-end",children:[(0,t.jsx)(o.MenuButton,{"aria-label":"Menu",shape:"square",size:"small",svgOnly:!0,type:"secondary",children:(0,t.jsx)(w.MoreHorizontal,{})}),(0,t.jsx)(r.Menu,{className:"md:hidden",containerRef:y,mobileContainerClassName:"z-[5001]",portalClassName:"tailwind-preflight md:hidden",width:"14rem",children:(0,t.jsxs)("div",{className:"flex h-full flex-col gap-y-3 p-2",children:[n?.changes&&n.changes.length>0&&c?(0,t.jsx)(tm,{onClick:()=>setTimeout(()=>h(!0),30),prefix:(0,t.jsx)(S.CloudUpload,{size:16}),suffix:(0,t.jsx)(m.Badge,{className:"min-w-[28px]",size:"sm",variant:"blue",children:n.changes.length}),type:"secondary",children:"Review Changes"}):null,(0,t.jsx)(tm,{onClick:()=>{f.push(`/${i.teamSlug}/${i.project}/firewall/configure/rule/new`)},type:"secondary",prefix:(0,t.jsx)(b.Plus,{size:16}),children:"Add Rule"}),(0,t.jsx)(tm,{onClick:()=>{let e=(0,k.getRuleTemplateSignature)(to);f.push(`/${i.teamSlug}/${i.project}/firewall/configure/rule/new?template=${encodeURIComponent(to)}&sig=${encodeURIComponent(e)}`)},type:"secondary",prefix:(0,t.jsx)(v.Clock,{size:16}),children:"Add Rate Limit"}),(0,t.jsx)(tm,{onClick:()=>{f.push(`/${i.teamSlug}/${i.project}/firewall/configure`)},type:"secondary",children:"Configure Rules"}),(0,t.jsx)(tm,{onClick:()=>{f.push(`/${i.teamSlug}/${i.project}/firewall/activity-log`)},type:"secondary",children:"View Audit Log"}),x?(0,t.jsxs)(tm,{disabled:!u,onClick:a,prefix:(0,t.jsx)(g,{size:16}),children:[_," System Mitigations"]}):null,(0,t.jsx)(tm,{disabled:!c,onClick:()=>{f.push(`/${i.teamSlug}/${i.project}/firewall/configure#bot-management`)},prefix:(0,t.jsx)(p.Shield,{size:16}),children:"Bot Management"})]})})]})})}function tm(e){let{disabled:l,onClick:a,prefix:n,suffix:s,type:r,children:o}=e,{actions:c}=(0,x.useMenu)();return(0,t.jsx)(i.Button,{disabled:l,onClick:()=>{c.setOpen(!1),a()},prefix:n,suffix:s,type:r,width:"100%",children:o})}}}]);

//# sourceMappingURL=a527c42ee0baccb3.js.map
//# debugId=f9a948a4-3e4e-5922-b226-44a64e0ff9aa
