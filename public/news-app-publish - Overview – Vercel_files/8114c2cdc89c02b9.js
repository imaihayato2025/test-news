
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="91d33cc4-5f7c-5e46-8db1-f271959d69bd")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{7432683:e=>{"use strict";e.s({FirewallConfigurePage:()=>e_},7432683);var l=e.i(6645307),i=e.i(889716),s=e.i(5163670),n=e.i(1190215),t=e.i(2733203),a=e.i(653558),r=e.i(555528),o=e.i(5674541),d=e.i(4105925),c=e.i(6192985),u=e.i(1406255),h=e.i(6530772),x=e.i(3585235),g=e.i(5785123);e.i(6977237);var f=e.i(9713118),m=e.i(2240289),p=e.i(4345726),j=e.i(4852610),b=e.i(7210350),y=e.i(4909006),w=e.i(5901785),v=e.i(1712573),k=e.i(9480517),C=e.i(8700049),M=e.i(8084653),S=e.i(4652282),I=e.i(8934201),N=e.i(5124754),P=e.i(7284756),R=e.i(8735078),B=e.i(841144),A=e.i(631755),T=e.i(4789498),D=e.i(7918027),L=e.i(8158100),E=e.i(5729015),F=e.i(503726),O=e.i(2362802);let $={hostname:"",ip:"",notes:""};function z(e){let{rule:i,hostname:s}=e,{team:n}=(0,F.useAccount)(),t=`/dashboard/${n?.slug||""}/monitoring?title=Blocked Requests from ${i} on ${s}&visualize=sum%28blocked_requests%29&where=host+%3D+%27${s}%27+and+public_ip+%3D+%27${i}%27&groupBy=host%2Cpublic_ip`;return(0,l.jsx)(O.ButtonLink,{href:t,children:"View Rule in Monitoring"})}function U(e){var s;let{open:n,onClose:t,updateConfig:a,isUpdatingConfig:r,microfrontendsProjectInfo:o}=e,[d,c]=(0,h.useState)({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:null}),[u,x]=(0,h.useState)({...$}),g=()=>{t(),c(e=>({...e,showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:null})),x({...$})},{isValid:f,errorMsg:m}=function(e){if(E.default.isIP(e))return{isValid:!0,errorMsg:""};if(E.default.isIPRange(e)){let[l,i]=e.split("/"),s=Number.parseInt(i,10);return l.includes(".")?s<16?{isValid:!1,errorMsg:"IPv4 CIDR cannot have a net mask less than /16"}:{isValid:!0,errorMsg:""}:s<48?{isValid:!1,errorMsg:"IPv6 CIDR cannot have a net mask less than /48"}:{isValid:!0,errorMsg:""}}return{isValid:!1,errorMsg:"Please enter a valid IP address or CIDR."}}(u.ip),p=u.notes.length<=500,j=(s=u.hostname,/^\*{1}$|^(?!-)(?:\*\.?)?[A-Za-z0-9-]{1,63}(?<!-)(?:\.(?!-)[A-Za-z0-9-]{1,63}(?<!-))*$/.test(s)),{showErrors:b,succeeded:y}=d;return(0,l.jsx)(I.Modal,{active:n,disableFocusTrap:!0,onAnimationDone:()=>{x({...$})},onClickOutside:g,children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a({action:"ip.insert",id:null,value:{action:"deny",...u}}).then(()=>{g()}).catch(()=>{c({showErrors:{ip:!0,hostname:!0,notes:!0},succeeded:!1})})},children:[(0,l.jsxs)(I.Modal.Body,{children:[(0,l.jsxs)(I.Modal.Header,{children:[(0,l.jsx)(I.Modal.Title,{children:"Configure New Domain Protection"}),(0,l.jsx)(I.Modal.Subtitle,{children:"Configure the Advanced Firewall for a domain associated with your team's projects."})]}),(0,l.jsxs)(i.Stack,{gap:4,children:[o.isMicrofrontendsEnabled&&o.isChildMicrofrontend?(0,l.jsxs)(L.Note,{children:["IP Blocking rules added here will only affect paths routed to this microfrontend. To add rules for the entire domain, configure them in"," ",(0,l.jsx)(O.Link,{href:`${o.defaultProjectBaseUrl}/firewall/configure`,icon:!1,children:o.defaultProjectName}),"."]}):null,o.isMicrofrontendsEnabled&&!o.isChildMicrofrontend?(0,l.jsxs)(L.Note,{children:["IP Blocking rules added here will affect all microfrontends in the"," ",(0,l.jsx)(O.Link,{href:`${o.defaultProjectBaseUrl}/settings/microfrontends`,children:o.groupName})," ","group."]}):null,(0,l.jsxs)(i.Stack,{gap:3,children:[(0,l.jsx)(T.Label,{id:"ip-address",value:"IP Address or CIDR",children:(0,l.jsx)(A.Input,{autoFocus:!0,disabled:!0===y,error:!f&&b.ip?m:void 0,id:"ip-address",onBlur:()=>c({...d,showErrors:{...d.showErrors,ip:u.ip.length>0}}),onChange:e=>{x({...u,ip:e.target.value})},placeholder:"127.0.0.1/24",required:!0,value:u.ip,width:"100%"})}),(0,l.jsx)(T.Label,{id:"host",value:"Host",children:(0,l.jsx)(A.Input,{disabled:!0===y,error:!j&&b.hostname?"Hostname is invalid":void 0,id:"host",onBlur:()=>c({...d,showErrors:{...d.showErrors,hostname:u.hostname.length>0}}),onChange:e=>{x({...u,hostname:e.target.value})},placeholder:"*, *.vercel.com, vercel.com",required:!0,value:u.hostname,width:"100%"})}),(0,l.jsx)(T.Label,{id:"notes",value:"Note",children:(0,l.jsx)(D.Textarea,{error:!p&&b.notes?"Note cannot be longer than 500 characters":void 0,id:"notes",onBlur:()=>c({...d,showErrors:{...d.showErrors,notes:u.notes.length>0}}),onChange:e=>{x({...u,notes:e.target.value})},placeholder:"Add an optional reason for the block rule",rows:3,value:u.notes})})]}),y?(0,l.jsx)(L.Note,{label:!1,type:"success",children:"Rule created."}):null]})]}),(0,l.jsx)(I.Modal.Actions,{children:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(I.Modal.Action,{buttonType:"button",onClick:t,type:"secondary",children:"Close"}),(0,l.jsx)(z,{hostname:u.hostname,rule:u.ip})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(I.Modal.Action,{disabled:!1,onClick:t,type:"secondary",children:"Cancel"}),(0,l.jsx)(I.Modal.Action,{buttonType:"submit",disabled:!(f&&j),loading:r,children:"Create IP Block Rule"})]})})]})})}var H=e.i(301999),V=e.i(9242048);function q(e){let{ips:n,config:t,updateConfig:a,isUpdatingConfig:r,isLoading:d,showFooter:c,isDisabled:u,teamPlan:h,refresh:f,microfrontendsProjectInfo:m,open:p,setOpen:j}=e,{can:b,isLoading:y}=(0,x.default)(),w=b(g.Action.All,g.Resource.SeawallConfig);return(0,V.default)("add-ip",y?void 0:()=>{w&&!u&&j(!0)}),(0,l.jsx)(B.EnsureSWRData,{data:[t],fallback:(0,l.jsx)(_,{}),children:(0,l.jsxs)(i.Stack,{gap:4,children:[(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,children:"IP Blocking"}),(0,l.jsxs)(i.Stack,{className:"flex w-full flex-col overflow-hidden rounded border border-gray-400 bg-background-100",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-5 p-5",children:[(0,l.jsxs)(i.Stack,{align:"center",direction:"row",justify:"space-between",children:[(0,l.jsx)(M.Text,{className:"text-gray-900",children:"Configure the IP addresses and CIDRs that Vercel should block requests from. Requests will not contribute to your bill."}),(0,l.jsx)(s.Skeleton,{show:y,children:(0,l.jsx)(o.Button,{disabled:!w||u,onClick:()=>j(!0),prefix:(0,l.jsx)(S.Plus,{}),variant:"secondary",children:"Add IP"})})]}),(0,l.jsx)(Z,{disabled:!w,ips:n,isLoading:d,isUpdatingConfig:r,updateConfig:a})]}),c?(0,l.jsx)(H.CtaFooter,{limitType:"ipBlocks",refresh:f,teamPlan:h}):null]}),(0,l.jsx)(U,{microfrontendsProjectInfo:m,isUpdatingConfig:r,onClose:()=>j(!1),open:p,updateConfig:a})]})})}function _(){return(0,l.jsxs)(i.Stack,{gap:4,children:[(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,children:"IP Blocking"}),(0,l.jsxs)(i.Stack,{className:"flex w-full flex-col gap-y-6 overflow-hidden rounded border border-gray-400 bg-background-100 p-6",children:[(0,l.jsxs)(i.Stack,{align:"center",direction:"row",justify:"space-between",children:[(0,l.jsx)(M.Text,{className:"text-gray-900",children:"Configure the IP addresses and CIDRs that Vercel should block requests from. Requests will not contribute to your bill."}),(0,l.jsx)(s.Skeleton,{show:!0,children:(0,l.jsx)(o.Button,{disabled:!0,prefix:(0,l.jsx)(S.Plus,{}),variant:"secondary",children:"Add IP"})})]}),(0,l.jsx)(Z,{disabled:!0,ips:[],isLoading:!0})]})]})}function Z(e){let{ips:n,disabled:t,updateConfig:a,isUpdatingConfig:r,isLoading:o}=e,d=(0,h.useMemo)(()=>{let e=(0,P.default)(n,"hostname");return Object.keys(e).map(l=>{let i=e[l],s="*"===l?"All hosts":l;return 1===i.length?{...i[0],hostname:s}:{hostname:`${s} (${i.length})`,subRows:i.map(e=>({...e,hostname:s}))}})},[n]),c=[{Header:"Host",accessor:"hostname",ellipsis:!0,expandable:!0},{Header:"IP Address",accessor:"ip",align:"left"},{Header:"Note",accessor:"notes",align:"left"},{Header:"",accessor:"_",fixedWidth:40,disableSortBy:!0,Cell:e=>(0,l.jsx)(W,{cell:e.cell,disabled:t,isUpdatingConfig:r,updateConfig:a})}];return(0,l.jsx)(i.Stack,{className:"w-full [&_span]:flex [&_span]:items-center",direction:"column",gap:3,children:o?(0,l.jsx)(s.Skeleton,{height:96,width:"100%"}):(0,l.jsx)(R.default,{caption:"Your IP Blocking Rules",columns:c,data:d,empty:"Your team has no IP Blocking rules.",fixed:!0,sortable:!0})})}function W(e){let{cell:i,disabled:s,updateConfig:r,isUpdatingConfig:o}=e,[c,u]=(0,h.useState)(!1),x=i.row.original;return"subRows"in x?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.MenuContainer,{children:[(0,l.jsx)(t.MenuButton,{"aria-label":"Menu",shape:"square",size:"small",type:"tertiary",children:(0,l.jsx)(N.MoreHorizontal,{})}),(0,l.jsx)(a.Menu,{children:(0,l.jsx)(d.MenuItem,{disabled:s,onClick:()=>{u(!0)},type:"error",children:"Delete Rule"})})]}),(0,l.jsxs)(I.Modal.Modal,{active:c,onClickOutside:()=>u(!1),children:[(0,l.jsx)(I.Modal.Body,{children:(0,l.jsxs)(I.Modal.Header,{children:[(0,l.jsx)(I.Modal.Title,{children:"Delete Rule"}),(0,l.jsxs)(I.Modal.Subtitle,{children:["You are about to unblock requests from"," ",(0,l.jsx)(C.InlineCode,{children:x.ip})," from making requests to"," ",(0,l.jsx)(C.InlineCode,{children:x.hostname}),". IP blocking will take affect when published."]})]})}),(0,l.jsxs)(I.Modal.Actions,{children:[(0,l.jsx)(I.Modal.Action,{onClick:()=>u(!1),type:"secondary",children:"Cancel"}),(0,l.jsx)(I.Modal.Action,{loading:o,onClick:async()=>{try{await r?.({id:x.id,action:"ip.remove",value:null}),u(!1)}catch{}},children:"Delete Rule"})]})]})]})}let Y={domain:"",sourceIp:"",note:""};function G(e){var s;let{open:n,onClose:t,updateBypass:a,isUpdatingBypass:r,microfrontendsProjectInfo:o}=e,[d,c]=(0,h.useState)({showErrors:{sourceIp:!1,domain:!1,note:!1},succeeded:null}),[u,x]=(0,h.useState)({...Y}),g=()=>{t(),c(e=>({...e,showErrors:{sourceIp:!1,domain:!1,note:!1},succeeded:null})),x({...Y})},{isValid:f,errorMsg:m}=function(e){if(E.default.isIP(e))return{isValid:!0,errorMsg:""};if(E.default.isIPRange(e)){let[l,i]=e.split("/"),s=Number.parseInt(i,10);return l.includes(".")?0===s&&"0.0.0.0"===l?{isValid:!0,errorMsg:""}:s<16?{isValid:!1,errorMsg:"IPv4 CIDR cannot have a net mask less than /16"}:{isValid:!0,errorMsg:""}:s<48&&"::/0"!==e?{isValid:!1,errorMsg:"IPv6 CIDR cannot have a net mask less than /48"}:{isValid:!0,errorMsg:""}}return{isValid:!1,errorMsg:"Please enter a valid IP address or CIDR."}}(u.sourceIp),p=u.note.length<=500,j=(s=u.domain,/^\*{1}$|^(?!-)(?:\*\.?)?[A-Za-z0-9-]{1,63}(?<!-)(?:\.(?!-)[A-Za-z0-9-]{1,63}(?<!-))*$/.test(s)),{showErrors:b,succeeded:y}=d;return(0,l.jsx)(I.Modal,{active:n,disableFocusTrap:!0,onAnimationDone:()=>{x({...Y})},onClickOutside:g,children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(!1,{...u}).then(()=>{g()}).catch(()=>{c({showErrors:{sourceIp:!0,domain:!0,note:!0},succeeded:!1})})},children:[(0,l.jsxs)(I.Modal.Body,{children:[(0,l.jsxs)(I.Modal.Header,{children:[(0,l.jsx)(I.Modal.Title,{children:"Configure New System Bypass"}),(0,l.jsx)(I.Modal.Subtitle,{children:"Create a rule to bypass system DDoS mitigations for a production domain associated with your project."})]}),(0,l.jsxs)(i.Stack,{gap:4,children:[o.isMicrofrontendsEnabled&&o.isChildMicrofrontend?(0,l.jsxs)(L.Note,{children:["System bypass rules added here will only affect paths routed to this microfrontend. To add rules for the entire domain, configure them in"," ",(0,l.jsx)(O.Link,{href:`${o.defaultProjectBaseUrl}/firewall/configure`,icon:!1,children:o.defaultProjectName}),"."]}):null,o.isMicrofrontendsEnabled&&!o.isChildMicrofrontend?(0,l.jsxs)(L.Note,{children:["System bypass rules added here will affect all microfrontends in the"," ",(0,l.jsx)(O.Link,{href:`${o.defaultProjectBaseUrl}/settings/microfrontends`,children:o.groupName})," ","group."]}):null,(0,l.jsxs)(i.Stack,{gap:3,children:[(0,l.jsx)(T.Label,{id:"ip-address",value:"IP Address or CIDR",children:(0,l.jsx)(A.Input,{autoFocus:!0,disabled:!0===y,error:!f&&b.sourceIp?m:void 0,id:"ip-address",onBlur:()=>c({...d,showErrors:{...d.showErrors,sourceIp:u.sourceIp.length>0}}),onChange:e=>{x({...u,sourceIp:e.target.value})},placeholder:"127.0.0.1/24",required:!0,value:u.sourceIp,width:"100%"})}),(0,l.jsx)(T.Label,{id:"domain",value:"Domain",children:(0,l.jsx)(A.Input,{disabled:!0===y,error:!j&&b.domain?"Domain is invalid":void 0,id:"domain",onBlur:()=>c({...d,showErrors:{...d.showErrors,domain:u.domain.length>0}}),onChange:e=>{x({...u,domain:e.target.value})},placeholder:"vercel.com, staging.vercel.com, *",required:!0,value:u.domain,width:"100%"})}),(0,l.jsx)(T.Label,{id:"note",value:"Note",children:(0,l.jsx)(D.Textarea,{error:!p&&b.note?"Note cannot be longer than 500 characters":void 0,id:"notes",onBlur:()=>c({...d,showErrors:{...d.showErrors,note:u.note.length>0}}),onChange:e=>{x({...u,note:e.target.value})},placeholder:"Add an optional reason for the bypass rule",rows:3,value:u.note})})]}),y?(0,l.jsx)(L.Note,{label:!1,type:"success",children:"Rule created."}):null]})]}),(0,l.jsx)(I.Modal.Actions,{children:y?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(I.Modal.Action,{buttonType:"button",onClick:t,type:"secondary",children:"Close"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(I.Modal.Action,{disabled:!1,onClick:t,type:"secondary",children:"Cancel"}),(0,l.jsx)(I.Modal.Action,{buttonType:"submit",disabled:!(f&&j),loading:r,children:"Create System Bypass"})]})})]})})}function J(e){let{ips:n,updateBypass:t,isUpdatingBypass:a,isLoading:r,showFooter:d,isDisabled:c,teamPlan:u,refresh:h,microfrontendsProjectInfo:f,open:m,setOpen:p}=e,{can:j,isLoading:b}=(0,x.default)(),y=j(g.Action.Create,g.Resource.IpBlocking);return(0,V.default)("add-system-bypass",b?void 0:()=>{y&&!c&&p(!0)}),(0,l.jsx)(B.EnsureSWRData,{data:[n],fallback:(0,l.jsx)(K,{}),children:(0,l.jsxs)(i.Stack,{gap:4,children:[(0,l.jsx)(M.Text,{className:"leading-[26px]",id:"system-bypass",size:20,weight:600,children:"System Bypass Rules"}),(0,l.jsxs)(i.Stack,{className:"flex w-full flex-col overflow-hidden rounded border border-gray-400 bg-background-100",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-5 p-5",children:[(0,l.jsxs)(i.Stack,{align:"center",direction:"row",justify:"space-between",children:[(0,l.jsxs)(M.Text,{className:"text-gray-900",children:["Configure the IP addresses and CIDRs that should bypass Vercel's system mitigations."," ",(0,l.jsx)("strong",{children:"Requests will contribute to your bill."})]}),(0,l.jsx)(s.Skeleton,{show:b,children:(0,l.jsx)(o.Button,{disabled:!y||c,onClick:()=>p(!0),prefix:(0,l.jsx)(S.Plus,{size:16}),variant:"secondary",children:"Add Rule"})})]}),(0,l.jsx)(Q,{disabled:!j(g.Action.Delete,g.Resource.IpBlocking),ips:n,isLoading:r,isUpdatingBypass:a,updateBypass:t})]}),d?(0,l.jsx)(H.CtaFooter,{limitType:"ipBypass",refresh:h,teamPlan:u}):null]}),(0,l.jsx)(G,{isUpdatingBypass:a,onClose:()=>p(!1),open:m,updateBypass:t,microfrontendsProjectInfo:f})]})})}function K(){return(0,l.jsxs)(i.Stack,{gap:4,children:[(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,children:"System Bypass Rules"}),(0,l.jsxs)(i.Stack,{className:"flex w-full flex-col gap-y-6 overflow-hidden rounded border border-gray-400 bg-background-100 p-6",children:[(0,l.jsxs)(i.Stack,{align:"center",direction:"row",justify:"space-between",children:[(0,l.jsx)(M.Text,{className:"text-gray-900",children:"Configure the IP addresses and CIDRs that Vercel should block requests from. Requests will not contribute to your bill."}),(0,l.jsx)(s.Skeleton,{show:!0,children:(0,l.jsx)(o.Button,{disabled:!0,prefix:(0,l.jsx)(S.Plus,{size:16}),variant:"secondary",children:"Add IP"})})]}),(0,l.jsx)(Q,{disabled:!0,ips:[],isLoading:!0})]})]})}function Q(e){let{ips:n,disabled:t,updateBypass:a,isUpdatingBypass:r,isLoading:o}=e,d=(0,h.useMemo)(()=>{let e=(0,P.default)(n,"Domain");return Object.keys(e).map(l=>{let i=e[l],s="*"===l?"All hosts":l;return 1===i.length?{...i[0],Domain:s}:{Domain:`${s} (${i.length})`,subRows:i.map(e=>({...e,Domain:s}))}})},[n]),c=[{Header:"Host",accessor:"Domain",ellipsis:!0,expandable:!0},{Header:"IP Address",accessor:"Ip",align:"left"},{Header:"Note",accessor:"Note",align:"left"},{Header:"",accessor:"_",fixedWidth:40,disableSortBy:!0,Cell:e=>(0,l.jsx)(X,{cell:e.cell,disabled:t,isUpdatingBypass:r,updateBypass:a})}];return(0,l.jsx)(i.Stack,{className:"w-full [&_span]:flex [&_span]:items-center",direction:"column",gap:3,children:o?(0,l.jsx)(s.Skeleton,{height:96,width:"100%"}):(0,l.jsx)(R.default,{caption:"Your System Bypass Rules",columns:c,data:d,empty:"Your team has no System Bypass rules.",fixed:!0,sortable:!0})})}function X(e){let{cell:i,disabled:s,updateBypass:r,isUpdatingBypass:o}=e,[c,u]=(0,h.useState)(!1),x=i.row.original;return"subRows"in x?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.MenuContainer,{children:[(0,l.jsx)(t.MenuButton,{"aria-label":"Menu",shape:"square",size:"small",type:"tertiary",children:(0,l.jsx)(N.MoreHorizontal,{})}),(0,l.jsx)(a.Menu,{children:(0,l.jsx)(d.MenuItem,{disabled:s,onClick:()=>{u(!0)},type:"error",children:"Delete Rule"})})]}),(0,l.jsxs)(I.Modal.Modal,{active:c,onClickOutside:()=>u(!1),children:[(0,l.jsx)(I.Modal.Body,{children:(0,l.jsxs)(I.Modal.Header,{children:[(0,l.jsx)(I.Modal.Title,{children:"Delete Rule"}),(0,l.jsxs)(I.Modal.Subtitle,{children:["You are about to enable mitigations for"," ",(0,l.jsx)(C.InlineCode,{children:x.Ip})," when making requests to"," ",(0,l.jsx)(C.InlineCode,{children:x.Domain}),"."]})]})}),(0,l.jsxs)(I.Modal.Actions,{children:[(0,l.jsx)(I.Modal.Action,{onClick:()=>u(!1),type:"secondary",children:"Cancel"}),(0,l.jsx)(I.Modal.Action,{loading:o,onClick:async()=>{try{await r?.(!0,{domain:x.Domain,sourceIp:x.Ip}),u(!1)}catch{}},children:"Delete Rule"})]})]})]})}var ee=e.i(2459259),el=e.i(3921802),ei=e.i(4946541),es=e.i(9495609),en=e.i(5076279),et=e.i(584439),ea=e.i(5535439),er=e.i(4283941),eo=e.i(8727559),ed=e.i(7315479),ec=e.i(5328172),eu=e.i(9428264),eh=e.i(1049812),ex=e.i(4060703),eg=e.i(3903554);function ef(e){let{currentConfig:s,isUpdatingConfig:n,params:t,rulesets:a,subscriptions:r,team:o,updateConfig:d}=e,c=(0,et.useToasts)(),u=(0,ea.useRouter)(),[x,g]=(0,h.useState)(!1),f=(0,eh.useSubscribedProducts)(r),{trigger:m}=(0,ec.useUpdateBillingSubscription)(o?.id??t.teamSlug),[p,j]=(0,h.useState)(null),[b,y]=(0,h.useState)(null),{data:w}=(0,eu.useReverseProxyStatus)({projectIdOrName:t.project,teamIdOrSlug:t.teamSlug}),v=function(e,l){for(let[i,s]of Object.entries(l)){let l=e?.currentConfig.managedRules?.[i];if(l){if(l.active)return!0}else if(s.active)return!0}return!1}(s,a),k=!!w?.length,C=`/${t.teamSlug}/${t.project}/firewall/configure`,S=(0,h.useCallback)((e,l)=>function(){for(var i=arguments.length,s=Array(i),n=0;n<i;n++)s[n]=arguments[n];if(!k||v||null!==p)return void l(...s);j({props:{onEnable:()=>{g(!0),l(...s).then(()=>j(null)).finally(()=>g(!1))}},rulesetId:e})},[v,k,p]),I=(0,h.useCallback)(async(e,l)=>{if("plan"===l)y({rulesetId:e});else try{await d({action:"managedRules.update",id:e,value:{active:!0}}),(0,eg.getRulesetFromRulesets)(a,e)?.ruleGroups&&u.push(`${C}/${e}`)}catch(e){c.error((0,ed.errorToString)(e))}},[a,C,u,c,d]),N=(0,h.useCallback)(async(e,l)=>{let i=(0,eg.getRulesetFromRulesets)(a,e);i&&ej(i)&&l&&o?.billing?.planIteration==="unbundled"&&!f.getProduct(i.slug)&&!s?.currentConfig.managedRules?.[e]&&(await m({action:"add_product",data:{productSlug:i.slug}}),c.success(`${i.name} was added to your plan`)),await d({action:"managedRules.update",id:e,value:{active:l}})},[d,s,c,m,f,o?.billing,a]);return 0===Object.keys(a).length?null:(0,l.jsxs)(i.Stack,{gap:4,children:[(0,l.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,children:"Managed Rulesets"}),k?(0,l.jsx)(O.Link,{external:!0,href:"/guides/can-i-use-a-proxy-on-top-of-my-vercel-deployment",icon:!1,isDifferentZone:!0,children:(0,l.jsx)(el.Badge,{size:"sm",variant:"amber-subtle",children:"Reverse Proxy detected"})}):null]}),(0,l.jsx)(i.Stack,{className:"flex w-full flex-col overflow-hidden rounded border border-gray-400 divide-y",children:Object.entries(a).map(e=>{let[i,n]=e;return(0,l.jsx)(em,{config:s,id:i,onActionChange:e=>void d({action:"managedRules.update",id:i,value:{active:!0,action:e}}),onAddClick:S(i,e=>I(i,e)),onToggleClick:S(i,e=>N(i,e)),ruleset:n,subscriptions:r,team:o},i)})}),(0,l.jsx)(ep,{loading:x,active:null!==p,onCancel:()=>j(null),onEnable:()=>p?.props.onEnable()}),(0,l.jsx)(ex.ManagedRuleSetModal,{isUpdatingConfig:n||x,onClose:()=>y(null),onConfirm:async()=>{if(b)try{g(!0),await N(b.rulesetId,!0),y(null),u.push(`${C}/${b.rulesetId}`)}catch(e){y(null),c.error(e.message)}finally{g(!1)}},open:null!==b,selectedRuleSet:b?a[b.rulesetId]:null})]})}function em(e){let{config:s,id:n,onActionChange:t,onAddClick:a,onToggleClick:r,ruleset:d,subscriptions:c,team:u,tooltip:h}=e,{can:f}=(0,x.default)(),m=(0,eh.useSubscribedProducts)(c),p=s?.currentConfig.managedRules?.[n],j=f(g.Action.All,g.Resource.SeawallConfig),b=f(g.Action.Update,g.Resource.BillingPlan),y=p?.active??d.active,w=!ej(d)||!!m.getProduct(d.slug),v=u?.billing?.plan!=="enterprise"||"unbundled"!==u.billing.planIteration;return(0,l.jsxs)("div",{className:"flex w-full flex-wrap items-center justify-between gap-x-4 gap-y-5 p-5",children:[(0,l.jsxs)(i.Stack,{direction:"row",gap:5,children:[y&&d.ruleGroups?(0,l.jsx)(es.Toggle,{checked:y,disabled:!j,onChange:r,size:"medium"}):ej(d)&&eb(d,u?.billing?.plan??"hobby")?(0,l.jsx)("div",{className:"flex w-9 items-center justify-center text-gray-900",children:(0,l.jsx)(en.DollarFill,{})}):null,(0,l.jsxs)("div",{className:"flex flex-col justify-between gap-x-4 gap-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(M.Text,{id:n,lineHeight:20,size:14,weight:500,children:d.name}),h]}),ej(d)&&!eb(d,u?.billing?.plan??"hobby")?(0,l.jsx)(eo.FixedPlanBadge,{plan:d.planRequirement,size:"sm"}):null]}),(0,l.jsx)(M.Text,{className:"text-gray-900",lineHeight:20,size:14,children:d.description}),ej(d)&&!y?(0,l.jsx)(M.Text,{className:"text-gray-900",size:14,weight:400,children:d.pricingDescription}):null]})]}),(0,l.jsx)("div",{className:"inline-flex w-full items-center gap-x-3 lg:w-fit",children:(0,l.jsxs)("div",{className:"flex w-full flex-row justify-between gap-x-3",children:[!y&&ej(d)?(0,l.jsx)(l.Fragment,{children:v?(0,l.jsx)(O.ButtonLink,{className:"flex flex-1 md:min-w-[147px] md:max-w-[147px]",href:"/contact/sales",tab:!0,type:"secondary",children:"Contact Sales"}):(0,l.jsx)(o.Button,{className:"flex flex-1 md:min-w-[147px] md:max-w-[147px]",disabled:w?!j:!b,onClick:()=>a(w?"project":"plan"),type:"secondary",children:w?"Add to Project":"Add to Plan"})}):null,d.ruleGroups?(0,l.jsx)(O.ButtonLink,{className:"flex min-w-[147px] flex-1 md:max-w-[147px]",href:`configure/${n}`,type:"secondary",children:y&&j?"Configure":"View Rules"}):d.actions?(0,l.jsx)(ei.Switch,{"aria-label":"Choose which action to take on traffic matching this managed ruleset",className:"w-full md:min-w-[192px]",children:["off",...d.actions].map((e,i)=>{let s=!1;return s=p?.active?p.action?e===p.action:e===d.defaultAction:0===i,(0,l.jsx)(ei.Switch.Control,{checked:s,disabled:!j,label:(0,er.default)(e),onChange:()=>{"off"===e?r(!1):t(e)}},e)})}):null]})})]})}function ep(e){let{active:i,loading:s,onCancel:n,onEnable:t}=e;return(0,l.jsxs)(I.Modal.Modal,{active:i,onClickOutside:n,children:[(0,l.jsxs)(I.Modal.Body,{children:[(0,l.jsx)(I.Modal.Header,{children:(0,l.jsx)(I.Modal.Title,{children:"Managed rulesets may not work properly with a reverse proxy"})}),(0,l.jsx)(I.Modal.P,{children:"We do not recommend using managed rulesets alongside a reverse proxy due to impaired visibility. You may experience legitimate traffic being challenged or blocked."})]}),(0,l.jsxs)(I.Modal.Actions,{children:[(0,l.jsx)(I.Modal.Action,{disabled:s,onClick:n,type:"secondary",children:"Cancel"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(I.Modal.Action,{loading:s,onClick:t,type:"error",children:"Enable anyway"}),(0,l.jsx)(O.ButtonLink,{disabled:s,href:"/guides/can-i-use-a-proxy-on-top-of-my-vercel-deployment",icon:!1,isDifferentZone:!0,tab:!0,children:"Learn how to disable"})]})]})]})}function ej(e){return!!e.slug}function eb(e,l){let i=["hobby","pro","enterprise"];return i.indexOf(e.planRequirement)<=i.indexOf(l)}ef.Skeleton=function(){return(0,l.jsxs)(i.Stack,{gap:4,children:[(0,l.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,children:"Managed Rulesets"})}),(0,l.jsx)(i.Stack,{className:"flex w-full flex-col overflow-hidden rounded border border-gray-400 divide-y",children:(0,l.jsx)(em.Skeleton,{})})]})},em.Skeleton=function(){return(0,l.jsx)("div",{className:"w-full",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-x-4 gap-y-5 bg-white p-5",children:[(0,l.jsx)(i.Stack,{className:"flex-1",direction:"row",children:(0,l.jsxs)("div",{className:"pointer-events-none flex flex-1 flex-col justify-between gap-x-4 gap-y-1",children:[(0,l.jsx)(s.Skeleton,{height:20,width:"20%"}),(0,l.jsx)(s.Skeleton,{height:20,width:"30%"}),(0,l.jsx)(s.Skeleton,{height:20,width:"25%"})]})}),(0,l.jsx)("div",{className:"flex",children:(0,l.jsx)(s.Skeleton,{height:40,width:100})})]})})};var ey=e.i(6756623),ew=e.i(7544595),ev=e.i(7806943),ek=e.i(5485417),eC=e.i(6465700),eM=e.i(8483852),eS=e.i(2537276),eI=e.i(5610210),eN=e.i(1318155);function eP(e){let{currentConfig:i,isUpdatingConfig:s,updateConfig:n}=e,{can:t}=(0,x.default)(),a=t(g.Action.All,g.Resource.SeawallConfig),r=(0,h.useCallback)(e=>{n({action:"botId.toggle",id:null,value:e})},[n]),o=i?.changes.find(e=>"botId.toggle"===e.action),d=o?.action==="botId.toggle"?o.value:!!i?.currentConfig.botIdEnabled;return(0,l.jsx)("div",{className:"flex w-full flex-col divide-y",children:(0,l.jsxs)("div",{className:"flex w-full flex-wrap items-center justify-between gap-x-4 gap-y-5 p-5",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(M.Text,{weight:500,children:"BotID"}),(0,l.jsx)(el.Badge,{variant:"blue-subtle",size:"sm",children:"New"})]}),(0,l.jsxs)(M.Text,{size:14,className:"flex flex-col items-start gap-1 text-gray-900 md:flex-row md:items-center",children:["Invisible CAPTCHA for high-value pages and routes, with Deep Analysis powered by Kasada."," ",(0,l.jsxs)(O.Link,{href:"/docs/botid",variant:"blend",className:"flex items-center gap-1",children:["Get started with BotID",(0,l.jsx)(eN.External,{size:12})]})]})]}),(0,l.jsx)("div",{className:"inline-flex w-full items-center gap-x-3 lg:w-fit",children:(0,l.jsx)(ei.Switch,{"aria-label":"Enable or disable BotID",className:"w-full md:min-w-[192px]",children:["basic","deep analysis"].map(e=>(0,l.jsx)(ei.Switch.Control,{checked:"deep analysis"===e?d:!d,className:"whitespace-nowrap",disabled:(s??!1)||!a,label:(0,er.default)(e),onChange:()=>{r("deep analysis"===e)}},e))})})]})})}eP.Skeleton=function(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,children:"BotID"})}),(0,l.jsx)("div",{className:"flex w-full flex-col rounded border border-gray-400 divide-y",children:(0,l.jsx)(em.Skeleton,{})})]})};var eR=e.i(226017);function eB(e){let{open:i,isEnabled:s,onClose:n,onSubmit:t}=e,a=s?"Disable":"Enable";return(0,l.jsxs)(I.Modal.Modal,{active:i,onClickOutside:n,children:[(0,l.jsxs)(I.Modal.Body,{children:[(0,l.jsx)(I.Modal.Header,{children:(0,l.jsx)(I.Modal.Title,{children:`${a} Attack Challenge Mode`})}),s?(0,l.jsx)(I.Modal.P,{children:"Are you sure you want to disable Attack Challenge Mode?"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(I.Modal.P,{children:["When you enable Attack Challenge Mode, all traffic, excluding verified bots, will be challenged. This means:",(0,l.jsxs)("ul",{className:"my-0 flex flex-col gap-2 pl-6",children:[(0,l.jsx)(M.Text,{as:"li",children:"Verified bots will still have access"}),(0,l.jsxs)(M.Text,{as:"li",children:["All other traffic will be served a"," ",(0,l.jsx)(O.Link,{external:!0,href:"/docs/vercel-firewall/firewall-concepts#challenge",isDifferentZone:!0,variant:"highlight",children:"challenge"})," ","to verify it is originating from real browsers"]}),(0,l.jsx)(M.Text,{as:"li",children:"Bots that fail challenges will be blocked"}),(0,l.jsx)(M.Text,{as:"li",children:"Human visitors in browsers will continue normally after solving the challenge"})]}),"We recommend enabling this mode only when experiencing a very large and unexpected spike in traffic to stop unwanted automated traffic from accessing your site."]}),(0,l.jsx)(O.Link,{external:!0,href:"/docs/attack-challenge-mode",isDifferentZone:!0,variant:"highlight",children:"Learn More"})]})]}),(0,l.jsxs)(I.Modal.Actions,{children:[(0,l.jsx)(I.Modal.Action,{onClick:n,type:"secondary",children:"Cancel"}),(0,l.jsx)(I.Modal.Action,{onClick:t,children:a})]})]})}var eA=e.i(4374461),eT=e.i(6649026),eD=e.i(1183506),eL=e.i(9336536),eE=e.i(3514588);async function eF(e,l){let{arg:i}=l;return await (0,eD.fetchAPI)(e,{method:"POST",throwOnHTTPError:!0,returnStatus:!0,body:JSON.stringify(i)})}var eO=e.i(2156254);function e$(e){let{currentConfig:i,isUpdatingConfig:s,hasReverseProxy:n,rulesets:t,subscriptions:a,team:r,updateConfig:d,project:c}=e,u=(0,eR.useServerFlag)("bot-id-ui",!1),{trigger:x}=function(){let{team:e}=(0,eE.useTeam)(),l=(0,eT.encode)({teamId:e?.id});return(0,eA.default)(`${eL.API_SECURITY}/attack-mode${l}`,eF)}(),[g,f]=(0,h.useState)(!1),[m,p]=(0,h.useState)(null),[j,b]=(0,h.useState)(null),y=(0,h.useCallback)((e,l)=>{let s=l=>d({action:"managedRules.update",id:e,value:{active:!0,action:l}});if((0,eg.isBotProtectionManagedRuleset)(e)&&!j){let n=!i?.currentConfig.managedRules?.[e]?.active;b({rulesetId:e,props:{initialAction:l,onEnable:e=>void s(e).then(()=>b(null)),isFromOff:n}})}else s(l)},[j,d,i]);return((0,h.useEffect)(()=>{if("#bot-management"===window.location.hash){let e=document.getElementById("bot-management");e&&e.scrollIntoView({block:"start"})}},[]),0===Object.keys(t).length)?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,id:"bot-management",children:"Bot Management"}),n?(0,l.jsx)(O.Link,{external:!0,href:"/guides/can-i-use-a-proxy-on-top-of-my-vercel-deployment",icon:!1,isDifferentZone:!0,children:(0,l.jsx)(el.Badge,{size:"sm",variant:"amber-subtle",children:"Reverse Proxy detected"})}):null]}),(0,l.jsxs)("div",{className:"flex w-full flex-col rounded border border-gray-400 divide-y",children:[Object.entries(t).map(e=>{let[s,n]=e;return(0,l.jsx)(em,{config:i,id:s,ruleset:n,subscriptions:a,team:r,tooltip:(0,l.jsx)(ez,{id:s}),onAddClick:()=>{},onActionChange:e=>y(s,e),onToggleClick:e=>void d({action:"managedRules.update",id:s,value:{active:e}})},s)}),c?(0,l.jsxs)("div",{className:"flex w-full flex-wrap items-center justify-between gap-x-4 gap-y-5 p-5",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(M.Text,{weight:500,children:"Attack Challenge Mode"}),(0,l.jsx)(M.Text,{size:14,className:"text-gray-900",children:"Challenge suspicious traffic with JavaScript verification to block automated attacks while allowing legitimate users."})]}),(0,l.jsx)("div",{className:"inline-flex w-full items-center gap-x-3 lg:w-fit",children:(0,l.jsx)(o.Button,{onClick:()=>f(!0),prefix:m??c.security?.attackModeEnabled?(0,l.jsx)(eS.ShieldOff,{}):(0,l.jsx)(eM.Shield,{}),type:"secondary",children:m??c.security?.attackModeEnabled?"Disable":"Enable"})})]}):null,u?r?.billing?.plan==="hobby"?(0,l.jsx)(l.Fragment,{}):(0,l.jsx)(eP,{currentConfig:i,isUpdatingConfig:s,updateConfig:d}):null,(0,l.jsx)("div",{className:"flex justify-start px-5 py-4",children:(0,l.jsxs)(O.Link,{href:"/docs/bot-management",isDifferentZone:!0,variant:"highlight",tab:!0,className:"flex items-center gap-1",children:["Learn more about Bot Management",(0,l.jsx)(ek.ArrowRight,{size:12})]})})]})]}),(0,l.jsx)(eU,{loading:s??!1,onCancel:()=>b(null),initialAction:j?.props.initialAction,onEnable:e=>j?.props.onEnable(e),isFromOff:j?.props.isFromOff??!1,hasReverseProxy:n}),c?(0,l.jsx)(eB,{isEnabled:c.security?.attackModeEnabled||!1,onClose:()=>{f(!1),p(null)},onSubmit:async()=>{if(!c)return;let e=!c.security?.attackModeEnabled;f(!1),p(e);try{await x({projectId:c.id,attackModeEnabled:e}),await (0,eO.mutate)(e=>"string"==typeof e&&e.includes(`projects/${c.name}`)&&e.includes(`teamId=${r?.id}`))}catch(e){console.error("Failed to update attack mode:",e),p(null)}},open:g}):null]})}function ez(e){let{id:i}=e;return"ai_bots"===i?(0,l.jsx)(r.Tooltip,{center:!1,text:(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(M.Text,{weight:500,children:"AI Bots"}),(0,l.jsx)(M.Text,{children:'Detects traffic from known AI services and scrapers that may consume your content. When set to "Deny" will block traffic from these sources.'})]}),children:(0,l.jsx)(eC.InformationFillSmall,{})}):(0,eg.isBotProtectionManagedRuleset)(i)?(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(r.Tooltip,{center:!1,text:(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(M.Text,{weight:500,children:"Bot Protection"}),(0,l.jsx)(M.Text,{children:'Detects non-browser requests using fingerprinting and heuristics. In "Challenge" mode, serves a JavaScript challenge only browsers can solve.'}),(0,l.jsx)(O.Link,{external:!0,href:"/docs/vercel-firewall/vercel-waf/managed-rulesets#configure-bot-protection-managed-ruleset",isDifferentZone:!0,children:"Learn more"})]}),children:(0,l.jsx)(eC.InformationFillSmall,{})})}):null}function eU(e){let{initialAction:i,loading:s,onCancel:n,onEnable:t,isFromOff:a,hasReverseProxy:r}=e,o=(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(L.Note,{type:"warning",className:"mt-4",children:[(0,l.jsx)(el.Badge,{size:"sm",variant:"amber-subtle",className:"my-2",children:"Reverse Proxy Detected"}),(0,l.jsxs)(M.Text,{children:["Bot protection is not intended for use behind a reverse proxy and may"," ","log"===i?"match":"challenge"," legitimate traffic."]}),(0,l.jsxs)(O.Link,{href:"/docs/bot-protection",external:!0,isDifferentZone:!0,type:"secondary",tab:!0,children:[(0,l.jsx)(M.Text,{children:"Learn more"}),(0,l.jsx)(ek.ArrowRight,{size:12})]})]})});return i?(0,l.jsxs)(I.Modal.Modal,{active:!0,onClickOutside:n,children:[(0,l.jsxs)(I.Modal.Body,{children:[(0,l.jsx)(I.Modal.Header,{children:(0,l.jsxs)(I.Modal.Title,{children:["Bot Protection - ",(0,er.default)(i)]})}),"log"===i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(I.Modal.P,{children:["When you enable ",(0,l.jsx)("strong",{children:"Log"})," mode, your site's traffic will be monitored without any blocking. This means:"]}),(0,l.jsxs)("ul",{className:"my-0 flex flex-col gap-2 pl-6",children:[(0,l.jsx)(M.Text,{as:"li",children:"Bot Protection will identify potential bot traffic"}),(0,l.jsx)(M.Text,{as:"li",children:"All traffic will continue to reach your site"}),(0,l.jsx)(M.Text,{as:"li",children:"Bot activity will be recorded in logs"}),(0,l.jsx)(M.Text,{as:"li",children:"You'll be able to review traffic patterns"})]}),r?o:null]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(I.Modal.P,{children:["When you enable ",(0,l.jsx)("strong",{children:"Challenge"})," mode, suspicious traffic will be actively challenged and potentially blocked. This means:"]}),(0,l.jsxs)("ul",{className:"my-0 flex flex-col gap-2 pl-6",children:[(0,l.jsx)(M.Text,{as:"li",children:"Non-browser traffic will be challenged"}),(0,l.jsx)(M.Text,{as:"li",children:"Bots that fail challenges will be blocked"}),(0,l.jsx)(M.Text,{as:"li",children:"Clients that exhibit bot-like behavior will be challenged"}),(0,l.jsx)(M.Text,{as:"li",children:"Human visitors in browsers will continue normally"}),(0,l.jsx)(M.Text,{as:"li",children:"Verified bots will still have access"})]}),r?o:null]})]}),(0,l.jsxs)(I.Modal.Actions,{className:(0,eI.clsx)({"flex flex-col-reverse gap-4 md:flex-row":"challenge"===i&&a}),children:[(0,l.jsx)(I.Modal.Action,{disabled:s,onClick:n,type:"secondary",children:"Cancel"}),"challenge"===i&&a?(0,l.jsxs)("div",{className:"flex flex-col-reverse md:flex-row",children:[(0,l.jsx)(I.Modal.Action,{disabled:s,onClick:()=>t("log"),children:"Start with Log Mode"}),(0,l.jsx)(I.Modal.Action,{disabled:s,onClick:()=>t(i),type:"warning",children:"Enable anyway"})]}):(0,l.jsx)(I.Modal.Action,{loading:s,onClick:()=>t(i),children:"Enable"})]})]}):null}e$.Skeleton=function(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)("div",{className:"flex flex-row items-center gap-2",children:(0,l.jsx)(M.Text,{className:"leading-[26px]",size:20,weight:600,id:"bot-management",children:"Bot Management"})}),(0,l.jsx)("div",{className:"flex w-full flex-col overflow-hidden rounded border border-gray-400 divide-y",children:(0,l.jsx)(em.Skeleton,{})})]})};var eH=e.i(540570),eV=e.i(674684);let eq=JSON.stringify({name:"",description:"",active:!0,conditionGroup:[{conditions:[{type:"path",op:"eq",value:""}]}],action:{mitigate:{action:"rate_limit",rateLimit:{action:"rate_limit",algo:"fixed_window",window:"60",limit:"100",keys:["ip"]}}}});function e_(e){let{params:C,team:M}=e,S=(0,eV.useRouter)(),{data:I}=(0,b.useBillingSubscription)(C.teamSlug),{can:N,isLoading:P}=(0,x.default)(),{data:R}=(0,m.useProject)(C.project,{apiVersion:"v13"}),[B,A]=(0,h.useState)(!1),[T,D]=(0,h.useState)(!1),{data:L}=(0,eu.useReverseProxyStatus)({projectIdOrName:C.project,teamIdOrSlug:C.teamSlug}),{config:E,updateConfig:F,reorderItem:O,isUpdatingConfig:$,isLoadingConfig:z,refresh:U}=(0,p.useFirewallConfig)({projectId:C.project}),{bypassRules:H,updateBypass:V,isLoading:_}=(0,j.useFirewallBypass)({projectId:R?.id}),{data:Z}=(0,ew.useManagedRulesets)({projectIdOrName:C.project,teamIdOrSlug:C.teamSlug}),W=P||z||void 0===E,Y=(0,ey.isPlanLimitReached)({teamPlan:M?.billing?.plan,config:E,bypassRules:H,type:"customRules"}),G=(0,ey.isPlanLimitReached)({teamPlan:M?.billing?.plan,config:E,bypassRules:H,type:"ipBlocks"}),K=(0,ey.isPlanLimitReached)({teamPlan:M?.billing?.plan,config:E,bypassRules:H,type:"ipBypass"}),Q=(0,ey.isPlanLimitReached)({teamPlan:M?.billing?.plan,config:E,type:"rateLimit"}),X=(0,ev.useMicrofrontendsProjectInfo)(),el=void 0===E||!I||!Z,ei=N(g.Action.All,g.Resource.SeawallConfig),es=function(e){let l={bot_management:{},default:{}};for(let[i,s]of Object.entries(e)){let e="default";i.includes("bot")&&(e="bot_management"),l[e][i]=s}return l}(Z??{}),en=(0,eH.useOpenUpgradeModal)(),{menuItems:et,upgradeMenu:ea}=(0,h.useMemo)(()=>{let e=[],i=[],s={teamPlan:M?.billing?.plan,config:E,bypassRules:H},n=M?.billing?.plan==="hobby";for(let{title:t,usage:a,key:r,href:o,onClick:c}of[{title:"Rule",key:"rule",href:`/${C.teamSlug}/${C.project}/firewall/configure/rule/new`,usage:(0,ey.getPlanUsage)({...s,type:"customRules"})},{title:"Rate Limit",key:"rate-limit",href:`/${C.teamSlug}/${C.project}/firewall/configure/rule/new?template=${encodeURIComponent(eq)}&sig=${encodeURIComponent((0,y.getRuleTemplateSignature)(eq))}`,usage:(0,ey.getPlanUsage)({...s,type:"rateLimit"})},{title:"IP Block",key:"ip-blocks",onClick:()=>{A(!0)},usage:(0,ey.getPlanUsage)({...s,type:"ipBlocks"})},{title:"System Bypass",key:"system-bypass",onClick:()=>{D(!0)},usage:(0,ey.getPlanUsage)({...s,type:"ipBypass"})}]){if(!a)continue;let s=a.limit?(0,l.jsxs)("span",{className:"text-label-13 tabular-nums text-gray-900",children:[a.used," /"," ",a.limitReached&&a.nextPlanLimit?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("s",{className:"text-gray-700",children:a.limit})," ",(0,l.jsx)("span",{className:n?"text-blue-900":"text-purple-900",children:a.nextPlanLimit})]}):a.limit]}):void 0;if(a.limitReached){let e=n?{onClick:()=>en({teamHint:M.id,source:`firewall-add-new-${r}`,onConversionSuccess:()=>{o?S.push(o):c?.()}})}:{isLink:!0,href:"https://vercel.com/contact/sales"};i.push((0,l.jsx)(d.MenuItem,{...e,suffix:s,children:t},r))}else{let i=o?{href:o,isLink:!0}:{onClick:c};e.push((0,l.jsx)(d.MenuItem,{...i,suffix:s,children:t},r))}}return{menuItems:e,upgradeMenu:i.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.MenuDivider,{}),(0,l.jsx)(u.MenuSection,{title:n?"Upgrade to Pro":"Upgrade to Enterprise",children:i})]}):null}},[H,E,en,C.project,C.teamSlug,S,M?.billing?.plan,M?.id]);return(0,l.jsx)(w.ReviewChangeProvider,{projectIdOrName:C.project,teamIdOrSlug:C.teamSlug,children:(0,l.jsxs)(i.Stack,{className:"tailwind-preflight",children:[(0,l.jsx)(f.DashboardHeading,{buttons:(0,l.jsxs)(i.Stack,{className:"flex w-full flex-1",direction:{sm:"column",md:"row",lg:"row"},gap:3,children:[(0,l.jsx)(ee.ReviewChangesButton,{currentConfig:E}),(0,l.jsx)(s.Skeleton,{show:W,children:ei?(0,l.jsxs)(n.MenuContainer,{children:[(0,l.jsx)(t.MenuButton,{className:"w-full",width:"100%",children:"Add New…"}),(0,l.jsxs)(a.Menu,{width:224,children:[et,ea]})]}):(0,l.jsx)(r.Tooltip,{position:"bottom",text:`Additional permissions for ${M?.name||"this team"} are required to add new Firewall rules.`,children:(0,l.jsx)(o.Button,{disabled:!0,children:"Add New…"})})})]}),title:(0,l.jsx)(v.TitleBackLinkOverview,{microfrontendsChildAppMessage:"Firewall rules that apply to the entire domain should be added to the default app.",microfrontendsDefaultAppMessage:"Firewall rules defined here will run for all microfrontends in the group.",children:"Configure"})}),(0,l.jsx)("div",{className:"h-full flex-1 grow ",children:(0,l.jsxs)(i.Stack,{className:"container py-12",gap:12,children:[(0,l.jsx)(k.FirewallConfigureCustomRules,{config:E,projectId:R?.id,refresh:U,reorderItem:O,showFooterCustomRules:Y,showFooterRateLimit:!Y&&Q,teamPlan:M?.billing?.plan,updateConfig:F}),el?(0,l.jsx)(e$.Skeleton,{}):(0,l.jsx)(e$,{currentConfig:E,isUpdatingConfig:$,hasReverseProxy:!!L?.length,subscriptions:I,team:M,rulesets:es.bot_management,updateConfig:F,project:R}),M?.billing?.plan==="hobby"?(0,l.jsx)(l.Fragment,{}):el?(0,l.jsx)(ef.Skeleton,{}):(0,l.jsx)(ef,{currentConfig:E,isUpdatingConfig:$,params:C,subscriptions:I,team:M,updateConfig:F,rulesets:es.default}),(0,l.jsx)(q,{microfrontendsProjectInfo:X,config:E,ips:E?.currentConfig.ips||[],isDisabled:G,isLoading:z,isUpdatingConfig:$,refresh:U,showFooter:G,teamPlan:M?.billing?.plan,updateConfig:F,open:B,setOpen:A}),(0,l.jsx)(J,{microfrontendsProjectInfo:X,ips:H,isDisabled:K,isLoading:_,isUpdatingBypass:_,refresh:U,showFooter:K,teamPlan:M?.billing?.plan,updateBypass:V,open:T,setOpen:D})]})})]})})}}}]);

//# sourceMappingURL=364e2fe0072ef61b.js.map
//# debugId=91d33cc4-5f7c-5e46-8db1-f271959d69bd
