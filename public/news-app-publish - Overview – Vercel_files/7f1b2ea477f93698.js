
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="7d2e6671-1394-58a7-9fe4-3fc42f9458ac")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{5346083:e=>{"use strict";e.s({useConnectableIntegrations:()=>a});var t=e.i(7207682),r=e.i(4418725),i=e.i(3521787);function a(){let e=(0,r.useTeamSlug)();return(0,i.default)(e?(0,t.getMarketplaceIntegrationsApiUrl)({integrationType:"external",teamIdOrSlug:e}):null,e=>fetch(e).then(e=>e.json()))}},4091107:e=>{e.v({buttonAdd:"form-custom-headers-module__9G3V9W__buttonAdd",customHeadersList:"form-custom-headers-module__9G3V9W__customHeadersList",customHeadersWrapper:"form-custom-headers-module__9G3V9W__customHeadersWrapper"})},1837786:[e=>{"use strict";e.s({FormCustomHeaders:()=>f},1837786);var t=e.i(6645307),r=e.i(6530772),i=e.i(3920197),a=e.i(5674541),s=e.i(631755),n=e.i(889716),o=e.i(8084653),l=e.i(9495609),c=e.i(4168375),d=e.i(4091107);function u(e,t){return e.url?t.isVerified?0===e.sources.length?"At least one source is required":0===e.environments.length?"At least one environment is required":"secret"in e&&e.secret&&g(e.secret)?g(e.secret):e.projectIds&&0===e.projectIds.length?"At least one project is required":0===e.samplingRate?"Sampling rate must be greater than 0":null:"The Endpoint must be verified.":"An Endpoint is required!"}function p(e,t){return t.deliveryFormat!==e.deliveryFormat?"Delivery format cannot be changed":new URL(e.url).hostname!==new URL(t.url).hostname?"Domain cannot be changed":null}function h(e,t){let r=[];for(let i=e;i<t;i++)r.push(i);return r}e.s({validateHeaderName:()=>x,validateHeaderValue:()=>j,validateLogDrainForm:()=>u,validateUpdateLogDrain:()=>p},4719941);let g=e=>e.length<30?`Secret needs to have at least 30 characters. The current length is ${e.length}.`:null;function m(e){return"[object String]"!==Object.prototype.toString.call(e)||0===e.length}let x=e=>{if(m(e))return!1;let t=[].concat(h(48,58)).concat(h(65,91)).concat(h(97,123)).concat([94,95,96,124,126]).concat([33,35,36,37,38,39,42,43,45,46]);return e.split("").map(e=>e.charCodeAt(0)).every(e=>t.includes(e))},j=e=>!m(e)&&e.split("").map(e=>e.charCodeAt(0)).every(e=>e>31&&e<=255&&127!==e||9===e);function f(e){let{headers:u,hasInitialCustomHeaders:p,onHeadersUpdated:h,showToggle:g=!0,placeholder:m}=e,[f,v]=(0,r.useState)(p);(0,r.useEffect)(()=>{v(p)},[p]);let[y,S]=(0,r.useState)({key:"",value:""}),C=Object.keys(u??{}),k=(0,r.useCallback)(()=>{let e=!f;v(e),h(e?u:void 0)},[f,u,h]),T=(0,r.useCallback)(()=>{let e={...u,[y.key]:y.value};S({key:"",value:""}),h(e)},[u,y,h]),L=(0,r.useCallback)(e=>{x(e.target.value)&&S({...y,key:e.target.value})},[y]),b=(0,r.useCallback)(e=>{j(e.target.value)&&S({...y,value:e.target.value})},[y]);return(0,t.jsxs)(n.Stack,{gap:3,children:[g?(0,t.jsxs)(n.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(l.Toggle,{checked:f,id:"custom-headers",onChange:k,size:"large"}),(0,t.jsx)(o.Text,{as:"label",color:"inherit",htmlFor:"custom-headers",children:"Custom Headers"})]}):null,f?(0,t.jsxs)(n.Stack,{className:d.default.customHeadersWrapper,gap:5,children:[(0,t.jsxs)(n.Stack,{direction:"row",gap:3,children:[(0,t.jsxs)(n.Stack,{flex:1,gap:2,children:[(0,t.jsx)(o.Text,{color:"gray-900",size:12,weight:600,children:"Header Key"}),(0,t.jsx)(s.Input,{id:"custom-header-key",onChange:L,placeholder:"x-header-key",value:y.key,width:"100%"})]}),(0,t.jsxs)(n.Stack,{flex:1,gap:2,children:[(0,t.jsx)(o.Text,{color:"gray-900",size:12,weight:600,children:"Header Value"}),(0,t.jsx)(s.Input,{id:"custom-header-value",onChange:b,placeholder:m??"custom value",value:y.value,width:"100%"})]}),(0,t.jsx)(a.Button,{className:d.default.buttonAdd,disabled:!y.key||!y.value||5===C.length,onClick:T,children:"Add"})]}),(0,t.jsxs)(n.Stack,{className:d.default.customHeadersList,gap:3,children:[0===C.length&&(0,t.jsx)(n.Stack,{align:"center",children:(0,t.jsx)(o.Text,{color:"gray-900",children:"Add up to 5 custom headers"})}),u?C.map(e=>(0,t.jsxs)(n.Stack,{direction:"row",gap:3,justify:"space-between",children:[(0,t.jsxs)(o.Text,{color:"gray-900",monospace:!0,children:[e,": ",u[e]]}),(0,t.jsx)(n.Stack,{align:"center",children:(0,t.jsx)(c.IconAction,{Icon:i.CrossCircle,onAction:()=>{let{[e]:t,...r}=u;h(r)}})})]},e)):null]})]}):null]})}e.s({FormDeliveryFormat:()=>C},8690072);var v=e.i(5249128),y=e.i(1460036),S=e.i(5019368);function C(e){let{onDeliveryFormatChanged:r,deliveryFormat:i,disabled:a}=e;return(0,t.jsxs)(n.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(S.FormTitleDescription,{description:"Format log data should be delivered in.",title:"Delivery Format"})}),(0,t.jsx)(v.RadioGroup,{disabled:a,onChange:e=>{r&&r(e)},value:i,children:(0,t.jsxs)(n.Stack,{direction:"row",gap:6,children:[(0,t.jsx)(v.RadioGroup.Item,{value:y.DeliveryFormats.JSON,children:"JSON"}),(0,t.jsx)(v.RadioGroup.Item,{value:y.DeliveryFormats.NDJSON,children:"NDJSON"})]})})]})}},[4719941,8690072]],5501761:e=>{e.v({projectSelectItem:"project-select-item-module__D1hM1a__projectSelectItem"})},8242533:e=>{"use strict";e.s({ProjectSelector:()=>g,ProjectTypes:()=>h},8242533);var t=e.i(6645307),r=e.i(889716),i=e.i(8084653),a=e.i(5249128),s=e.i(787594),n=e.i(5019368),o=e.i(3920197),l=e.i(1164214),c=e.i(2146499),d=e.i(4168375),u=e.i(5501761);function p(e){let{project:a,onRemove:s,disabled:n}=e;return(0,t.jsxs)("div",{className:u.default.projectSelectItem,"data-testid":(0,l.tid)("project-selected","item"),children:[(0,t.jsxs)(r.Stack,{align:{sm:"flex-start",lg:"center"},direction:{sm:"column",lg:"row"},gap:2,children:[(0,t.jsxs)(r.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(c.ProjectLogo,{deploymentId:a.latestDeployments?.[a.latestDeployments.length-1]?.id,framework:a.framework,project:a,size:20}),(0,t.jsx)(i.Text,{color:"gray-900",weight:600,children:a.name})]}),(0,t.jsx)(i.Text,{color:"gray-900",children:a.targets?.production?.alias?.[0]})]}),s&&!n?(0,t.jsx)(d.IconAction,{Icon:o.CrossCircle,onAction:()=>s(a.id)}):null]},a.id)}var h=function(e){return e.ALL="all",e.SOME="some",e}({});function g(e){let{projects:o,projectType:l,onProjectTypeUpdated:c,onProjectsUpdated:d,title:u,description:h,disabled:g}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(n.FormTitleDescription,{description:h,title:u})}),(0,t.jsx)(a.RadioGroup,{disabled:g,onChange:e=>c(e),value:l,children:(0,t.jsxs)(r.Stack,{direction:"row",gap:6,children:[(0,t.jsx)(a.RadioGroup.Item,{value:"all",children:"All Team Projects"}),(0,t.jsx)(a.RadioGroup.Item,{value:"some",children:"Specific Projects"})]})})]}),"some"===l&&(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)(i.Text,{as:"h4",color:"gray-900",lineHeight:12,size:12,weight:600,children:"LINK TO PROJECTS"}),(0,t.jsx)(s.ProjectSelect,{disabled:g,hasLogo:!0,onSelect:e=>{d([...o,e])},selected:o,verifyIntegrationsPermissions:!1}),o.length?(0,t.jsx)("div",{children:o.map(e=>(0,t.jsx)(p,{disabled:g,onRemove:e=>d(o.filter(t=>t.id!==e)),project:e},e.id))}):null]})]})}},8741377:e=>{e.v({formEndpointVerify:"form-verify-endpoint-module__Tdpw0W__formEndpointVerify",inputCheckIcon:"form-verify-endpoint-module__Tdpw0W__inputCheckIcon",spinner:"form-verify-endpoint-module__Tdpw0W__spinner",verifyContent:"form-verify-endpoint-module__Tdpw0W__verifyContent"})},9974803:e=>{"use strict";e.s({FormEnvironment:()=>o});var t=e.i(6645307),r=e.i(8247297),i=e.i(889716),a=e.i(1164214),s=e.i(1460036),n=e.i(5019368);function o(e){let{disabled:o,onEnvironmentsChanged:l,environments:c}=e;return(0,t.jsxs)(i.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(n.FormTitleDescription,{description:"Logs from the selected environments will be forwarded to your webhook. At least one must be selected.",title:"Environments"})}),(0,t.jsx)(i.Stack,{direction:"row",gap:6,children:s.DEFAULT_LOG_ENVIRONMENTS.map(e=>(0,t.jsx)(r.Checkbox,{checked:c.includes(e),"data-testid":(0,a.tid)("log-drain-environment",e),disabled:o,onChange:()=>{c.includes(e)?l(c.filter(t=>t!==e)):l([...c,e])},children:s.LOG_ENVIRONMENT_LABELS[e]},e))})]})}},2044156:e=>{e.v({inputWrapper:"form-custom-secret-module__CNf-xW__inputWrapper"})},584477:e=>{"use strict";e.s({CustomNameForm:()=>n});var t=e.i(6645307),r=e.i(889716),i=e.i(631755),a=e.i(5019368),s=e.i(2044156);function n(e){let{onCustomNameUpdated:n,title:o,description:l,name:c}=e;return(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(a.FormTitleDescription,{description:l,title:o})}),(0,t.jsx)("div",{className:s.default.inputWrapper,children:(0,t.jsx)(i.Input,{id:"custom-name",maxLength:300,onChange:e=>n(e.target.value.trim()),placeholder:"Defaults to the domain name of your log drain url",value:c,width:"100%"})})]})}},2955320:e=>{"use strict";e.s({useLogDrainsData:()=>l,useLogDrainsResources:()=>d});var t=e.i(1314819);e.i(7196151);var r=e.i(5330315);e.i(6591346);var i=e.i(5037292),a=e.i(7555208),s=e.i(5346083),n=e.i(3334373);let o={"<100":0,"<500":1,">500":2,"<1000":3,">1000":4};function l(){let{data:e}=(0,a.useConfigurations)({skipBillingData:!0}),r=d(),l=function(e){let{logDrainsResources:t}=e,r=(0,n.useMarketplaceIntegrations)({protocolType:"logDrain"});return r.data?.flatMap(e=>e.products.filter(e=>(0,i.isProtocolSupported)(e,"logDrain")&&!t?.some(t=>t.product.id===e.id)).map(t=>({product:t,integration:e})))}({logDrainsResources:r}),c=(0,s.useConnectableIntegrations)(),u=c.data?.filter(r=>!!(0,t.integrationSupportsLogDrains)(r)&&!e?.some(e=>"external"===e.installationType&&e.integrationId===r.id)).sort((e,t)=>o[e.installs]<o[t.installs]?1:-1);return{marketplaceConfigurations:e?.filter(e=>"marketplace"===e.installationType),logDrainsResources:r,availableProducts:l,logDrainExternalIntegrations:u}}function c(e,t){t&&t.forEach(t=>{(0,i.isProtocolSupported)(t.product,"logDrain")&&e.set(t.id,t)})}function d(){let{data:e}=(0,r.useResourceList)({protocolType:"observability"}),{data:t}=(0,r.useResourceList)({protocolType:"logDrain"}),i=new Map;return c(i,e?.stores),c(i,t?.stores),e&&t?Array.from(i.values()):void 0}},1331356:e=>{e.v({codeWrapper:"add-logdrain-modal-module__kqGeqW__codeWrapper",modalMain:"add-logdrain-modal-module__kqGeqW__modalMain",modalTitle:"add-logdrain-modal-module__kqGeqW__modalTitle",secret:"add-logdrain-modal-module__kqGeqW__secret",secretWarn:"add-logdrain-modal-module__kqGeqW__secretWarn",secretWarnText:"add-logdrain-modal-module__kqGeqW__secretWarnText",secretWrapper:"add-logdrain-modal-module__kqGeqW__secretWrapper"})},6865796:[e=>{"use strict";e.s({AddLogDrainModal:()=>v},6865796);var t=e.i(6645307),r=e.i(6530772),i=e.i(3277953),a=e.i(4203388),s=e.i(4237550),n=e.i(7916122),o=e.i(889716),l=e.i(8084653),c=e.i(8934201),d=e.i(584439),u=e.i(1164214),p=e.i(8975439),h=e.i(8188445),g=e.i(8995909),m=e.i(2362802);function x(){return(0,t.jsxs)("div",{children:[(0,t.jsxs)(l.Text,{as:"span",color:"gray-900",children:["Learn more about"," "]}),(0,t.jsx)(m.Link,{external:!0,href:"/docs/log-drains/log-drains-reference#secure-log-drains",type:"secondary",children:"Securing Log Drains"})]})}var j=e.i(4168375),f=e.i(1331356);function v(e){let{logDrain:m,onClose:v}=e,y=(0,d.useToasts)(),[S,C]=(0,r.useState)(!1),k=(0,r.useCallback)(()=>{(0,h.copyToClipboard)(m?.secret??""),y.message("Log Drain secret copied to clipboard.")},[y,m?.secret]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(c.Modal.Body,{children:[(0,t.jsx)(c.Modal.Header,{children:(0,t.jsx)(l.Text,{align:"center",as:"h1",className:f.default.modalTitle,size:24,children:"Log Drain Created"})}),(0,t.jsxs)(o.Stack,{gap:6,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Text,{monospace:!0,weight:500,children:"Make sure to secure all Log Drains requests"}),(0,t.jsxs)(l.Text,{children:["Confirm authenticity by comparing the"," ",(0,t.jsx)(p.default,{children:"x-vercel-signature"})," request header to a dynamically generated SHA based on:"]})]}),(0,t.jsxs)(o.Stack,{align:"center",className:f.default.secretWrapper,direction:"row",gap:1,justify:"space-between",children:[(0,t.jsxs)(o.Stack,{direction:"row",children:[(0,t.jsx)(l.Text,{children:"Secret:"}),(0,t.jsx)(l.Text,{className:f.default.secret,color:"pink-900","data-testid":(0,u.tid)("webhooks","secret"),children:m?.secret})]}),(0,t.jsx)(j.IconAction,{Icon:a.Copy,onAction:k})]}),(0,t.jsxs)(o.Stack,{align:"center",className:f.default.secretWarn,direction:"row",gap:3,children:[(0,t.jsx)(i.Warning,{}),(0,t.jsx)(l.Text,{className:f.default.secretWarnText,children:"This secret will not be shown again"})]}),(0,t.jsxs)(o.Stack,{direction:"row",gap:2,children:[(0,t.jsx)(j.IconAction,{Icon:S?s.ChevronDown:n.ChevronRight,onAction:()=>C(!S),size:20}),(0,t.jsx)(l.Text,{color:"gray-900",lineHeight:20,weight:600,children:"How to verify request headers"})]}),S?(0,t.jsx)("div",{className:f.default.codeWrapper,children:(0,t.jsx)(g.CodeHighlight,{highlightedLinesNumbers:void 0,language:"javascript",children:`const crypto = require('crypto');

async function verifySignature(req) {
  const signature = crypto
    .createHmac('sha1', process.env.LOG_DRAIN_SECRET)
    .update(JSON.stringify(req.body))
    .digest('hex');
  return signature === req.headers['x-vercel-signature'];
}`})}):null,(0,t.jsx)(x,{})]})]}),(0,t.jsx)(c.Modal.Actions,{children:(0,t.jsx)(c.Modal.Action,{fullWidth:!0,onClick:v,children:"Done"})})]})}e.s({FormVerifyEndpoint:()=>E},7219467);var y=e.i(1541732),S=e.i(5528554),C=e.i(5165976),k=e.i(5674541),T=e.i(631755),L=e.i(3821772),b=e.i(503726),D=e.i(9326250),_=e.i(4374461),w=e.i(1183506),A=e.i(9336536),I=e.i(3514588),N=e.i(3585235),F=e.i(5785123),R=e.i(5019368),V=e.i(8741377),M=e.i(1837786);function E(e){var r;let{title:i="Endpoint",placeholder:a,description:s,endpoint:n,onUrlChanged:c,secret:u}=e,{team:p}=(0,b.useAccount)(),h=p?.id?(r=p.id,(0,y.createHash)("sha1").update(r).digest("hex")):null,{trigger:g,isMutating:m,error:x}=((e,t)=>{let{endpoint:r,secret:i}=e,{isReady:a,team:s}=(0,I.useTeam)(),{can:n,isLoading:o}=(0,N.default)(),l=(0,d.useToasts)(),c=n(F.Action.Read,F.Resource.EndpointVerification),u=(0,_.default)(()=>{if(!a||o||!c||!s?.id||!r.url)return null;let e=new URLSearchParams;return e.set("skip[]","logs-domains"),s.id&&e.set("teamId",s.id),`${A.API_VERIFY_ENDPOINT}?${e.toString()} `},async e=>{if(r.url&&!(e=>{try{return new URL(e),!0}catch(e){return!1}})(r.url))return l.error("Invalid URL. Please provide a valid URL to verify."),{...r,isVerified:!1,xVercelVerify:u.data?.xVercelVerify??""};try{let t=await (0,w.fetchAPI)(e,{method:"POST",body:JSON.stringify({url:r.url,headers:r.headers,secret:i}),throwOnHTTPError:!0});return{...r,xVercelVerify:t.xVercelVerify,isVerified:!0}}catch(e){if(!e.xVercelVerify)throw e;return r.url&&l.error("URL verification failed. Please make sure to respond with a 200 status code and the provided header to verify ownership of the URL."),{...r,xVercelVerify:e.xVercelVerify,isVerified:!1}}},t);return u})({endpoint:n,secret:u},{onSuccess:e=>{e.isVerified&&e.url===n.url&&c({url:n.url,headers:n.headers,isVerified:e.isVerified,hasCustomHeaders:n.hasCustomHeaders})}});return(0,t.jsxs)(o.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(R.FormTitleDescription,{as:"label",description:s,htmlFor:"endpoint-url",title:i})}),(0,t.jsx)(T.Input,{disabled:m,explicitId:"endpoint-url",id:"endpoint-url",maxLength:300,onChange:e=>c({...n,url:e.target.value,isVerified:!1}),placeholder:a,suffix:n.isVerified?(0,t.jsx)(S.CheckCircleFill,{color:"green-700"}):null,suffixStyling:!1,value:n.url,width:"100%"}),!n.isVerified&&h&&n.url||x?(0,t.jsxs)(o.Stack,{align:"center",className:V.default.formEndpointVerify,direction:{sm:"column",md:"row",lg:"row"},gap:3,justify:"space-between",children:[(0,t.jsxs)(o.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(C.LockClosed,{className:"shrink-0",size:24}),x||!h?(0,t.jsx)("div",{children:"Unable to generate the verification code"}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:V.default.verifyContent,children:["Verify URL ownership by responding with status code"," ",(0,t.jsx)(l.Text,{as:"span",color:"pink-900",monospace:!0,children:"`200`"}),"and the following header:"," "]}),(0,t.jsxs)("div",{className:V.default.verifyContent,children:["`<x-vercel-verify: ",(0,t.jsx)(l.Text,{as:"span",color:"pink-900",monospace:!0,children:h}),">`"]})]})]}),m||x?(0,t.jsx)(o.Stack,{className:V.default.spinner,justify:"center",children:(0,t.jsx)(L.Spinner,{})}):(0,t.jsx)(k.Button,{onClick:(0,D.promiseToCallback)(()=>g()),typeName:"submit",children:"Verify"})]}):null,(0,t.jsx)(M.FormCustomHeaders,{hasInitialCustomHeaders:n.hasCustomHeaders,headers:n.headers,onHeadersUpdated:e=>c({...n,headers:e,isVerified:!1,hasCustomHeaders:!0})})]})}},[7219467]],6450369:e=>{"use strict";e.s({CustomSecretForm:()=>n});var t=e.i(6645307),r=e.i(889716),i=e.i(631755),a=e.i(5019368),s=e.i(2044156);function n(e){let{onCustomSecretUpdated:n,title:o,description:l,secret:c}=e;return(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(a.FormTitleDescription,{description:l,title:o})}),(0,t.jsx)("div",{className:s.default.inputWrapper,children:(0,t.jsx)(i.Input,{id:"custom-secret",maxLength:300,onChange:e=>n(e.target.value.trim()),placeholder:"e.g. at_least_32_characters_long_secret_password",value:c??"",width:"100%"})})]})}},8912223:e=>{"use strict";e.s({CreateLogDrainModal:()=>G},8912223);var t=e.i(6645307),r=e.i(889716),i=e.i(8084653),a=e.i(8934201),s=e.i(3921802),n=e.i(5847686),o=e.i(6530772),l=e.i(3514588),c=e.i(2774739);e.i(5941325);var d=e.i(8250207);e.i(6591346);var u=e.i(5037292),p=e.i(4325351);e.i(6358385);var h=e.i(7146658),g=e.i(147614),m=e.i(541360),x=e.i(7555208);e.i(1477245);var j=e.i(3827171),f=e.i(7030156);e.i(9389778);var v=e.i(1310591),y=e.i(2240289),S=e.i(5006659),C=e.i(5674541),k=e.i(6531164),T=e.i(584439),L=e.i(2362802),b=e.i(1164214),D=e.i(9326250),_=e.i(1460036),w=e.i(4418725),A=e.i(6202145),I=e.i(8242533),N=e.i(6865796),F=e.i(7219467),R=e.i(4719941),V=e.i(8690072),M=e.i(2031422),E=e.i(9974803),P=e.i(6450369),O=e.i(4798346),W=e.i(584477);function B(e){let{onBack:s,onCreated:n}=e,l=(0,T.useToasts)(),[c,d]=(0,o.useState)(!1),u=(0,w.useTeamSlug)(),{createLogDrain:p,testLogDrain:h,permissions:g}=(0,S.useLogDrainsOperations)({teamSlug:u??null}),[m,x]=(0,o.useState)({url:"",isVerified:!1,hasCustomHeaders:!1}),[j,f]=(0,o.useState)(_.DeliveryFormats.JSON),[v,y]=(0,o.useState)([]),[b,B]=(0,o.useState)(I.ProjectTypes.ALL),[q,U]=(0,o.useState)([]),[G,z]=(0,o.useState)(null),[J,Y]=(0,o.useState)(void 0),[$,K]=(0,o.useState)(void 0),[Q,X]=(0,o.useState)(_.DEFAULT_LOG_ENVIRONMENTS),[Z,ee]=(0,o.useState)([100]),et=v.length>0&&m.url,er=async()=>{try{await h({sources:v,deliveryFormat:j,url:m.url,headers:m.headers,secret:J}),l.success({key:"test-log-drain",text:"Test log drain sent successfully"})}catch(e){l.error({key:"test-log-drain-error",text:`Test log drain failed: ${e.message}`})}},ei=(0,o.useMemo)(()=>({sources:v,deliveryFormat:j,name:$,url:m.url,projectIds:b===I.ProjectTypes.ALL?void 0:q.map(e=>e.id),headers:m.headers,secret:J&&0!==J.length?J:void 0,environments:Q,samplingRate:100===Z[0]?void 0:Z[0]/100}),[v,j,m,b,q,J,$,Q,Z]),ea=(0,o.useCallback)(()=>{let e=(0,R.validateLogDrainForm)(ei,m);if(e)return void l.error({key:"log_drain_api_error",text:e});d(!0)},[m,ei,l]),es=(0,o.useCallback)(async()=>{let e=(0,R.validateLogDrainForm)(ei,m);if(e)return void l.error({key:"log_drain_api_error",text:e});try{let e=await p(ei);z(e),y([]),f(_.DeliveryFormats.JSON),x({url:"",isVerified:!1,hasCustomHeaders:!1}),B(I.ProjectTypes.ALL),U([]),X(_.DEFAULT_LOG_ENVIRONMENTS),ee([100])}catch(e){l.error(e?.message??"An error occurred while creating the Log Drain")}finally{d(!1)}},[ei,l,p,m]),en=g.isLoading||!g.create;return(0,t.jsxs)(t.Fragment,{children:[G||c?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsxs)(r.Stack,{gap:2,children:[(0,t.jsx)(a.Modal.Title,{center:!0,children:"Add a Log Drain"}),(0,t.jsx)(a.Modal.Subtitle,{children:(0,t.jsx)(i.Text,{align:"center",color:"gray-900",children:en?"You need additional permissions to manage Log Drains.":(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(L.Link,{external:!0,href:"/docs/log-drains/log-drains-reference",type:"highlight",children:"Log Drains"})]})})})]}),(0,t.jsxs)(k.FieldsetContent,{disabled:en,noPadding:!0,children:[(0,t.jsxs)(r.Stack,{gap:6,children:[(0,t.jsx)(I.ProjectSelector,{description:"Choose which projects should send logs to the specified endpoint.",disabled:en,onProjectTypeUpdated:B,onProjectsUpdated:U,projectType:b,projects:q,title:"Projects"}),(0,t.jsx)(M.FormLogSources,{disabled:en,onSourcesChanged:y,selectedSourceValues:v,sources:_.LogSourcesWithDescription}),(0,t.jsx)(V.FormDeliveryFormat,{deliveryFormat:j,disabled:en,onDeliveryFormatChanged:f}),(0,t.jsx)(P.CustomSecretForm,{description:"Set custom secret (Optional).",onCustomSecretUpdated:Y,secret:J,title:"Custom Secret"}),(0,t.jsx)(W.CustomNameForm,{description:"Set custom name (Optional).",name:$,onCustomNameUpdated:K,title:"Custom Name"}),(0,t.jsx)(E.FormEnvironment,{disabled:en,environments:Q,onEnvironmentsChanged:X}),(0,t.jsx)("form",{children:(0,t.jsx)(O.FormSamplingRate,{disabled:en,onSamplingRateChanged:ee,samplingRate:Z})}),(0,t.jsx)(F.FormVerifyEndpoint,{description:(0,t.jsxs)(i.Text,{as:"span",children:["Logs will be forwarded as ",(0,t.jsx)(A.InlineCode,{children:"POST"})," ","request to this URL."]}),endpoint:m,onUrlChanged:x,placeholder:"https://my-app.com/log-drain",secret:J,title:"Endpoint"})]}),(0,t.jsx)(r.Stack,{align:"center",className:"mt-4",direction:"row",gap:3,justify:"end",children:(0,t.jsx)(C.Button,{disabled:!et||en,onClick:(0,D.promiseToCallback)(er),size:"small",type:"secondary",typeName:"submit",children:"Test Log Drain"})})]})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:s,type:"secondary",children:"Back"}),(0,t.jsx)(a.Modal.Action,{disabled:!m.isVerified,onClick:ea,children:"Add Log Drain"})]})]}),G?(0,t.jsx)(N.AddLogDrainModal,{logDrain:G,onClose:()=>{z(null),n()}}):null,c?(0,t.jsx)(H,{onClose:()=>d(!1),onConfirm:(0,D.promiseToCallback)(es)}):null]})}function H(e){let{onConfirm:s,onClose:n}=e,[l,c]=(0,o.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Header,{children:(0,t.jsx)(i.Text,{align:"left",as:"h1",size:24,children:"Add a Log Drain"})}),(0,t.jsx)(r.Stack,{gap:6,children:(0,t.jsxs)(i.Text,{children:["Once a Log Drain is added, any volume generated by the Log Drain will be counted as usage and charged at"," ",(0,t.jsxs)(i.Text,{as:"span",weight:600,children:["$0.50"," "]}),"per"," ",(0,t.jsxs)(i.Text,{as:"span",weight:600,children:["1GB"," "]}),". A minimum of"," ",(0,t.jsxs)(i.Text,{as:"span",weight:600,children:["$0.50"," "]})," ","is charged as soon as any usage occurs from your active Log Drains."," ",(0,t.jsx)(L.Link,{external:!0,href:"/docs/log-drains#usage-and-pricing",variant:"highlight",children:"Learn more"})]})})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:n,type:"secondary",children:"Back"}),(0,t.jsx)(a.Modal.Action,{"data-testid":(0,b.tid)("log-drains","add-log-drain-confirmation"),loading:l,onClick:()=>{c(!0),s()},children:"Confirm and Add Log Drain"})]})]})}function q(e,t){if("step"in t)return"select"===t.step?{step:"select"}:{...e,step:t.step};switch(t.type){case"integration":case"product":case"resource":return{...e,type:t.type,value:t.value};case"self-served":return{...e,type:t.type};default:return e}}let U="Add Log Drain";function G(e){let{active:r,availableList:i,onClose:s,projectSlug:n,teamSlug:c}=e,{team:d}=(0,l.useTeam)(),{mutate:u}=(0,S.useLogDrains)({projectSlug:n,teamSlug:c}),[p,h]=(0,o.useReducer)(q,{step:"select"}),{data:m}=(0,x.useConfigurations)({type:"marketplace",skipBillingData:!0});return"create"===p.step&&"integration"===p.type?(0,t.jsx)(g.InstallExternalIntegrationModal,{account:d,integration:p.value,onAnimationDone:()=>{h({step:"select"}),s()},teamSlugOrPublic:{teamSlug:c}}):(0,t.jsx)(a.Modal.Modal,{active:r,onClickOutside:()=>{h({step:"select"}),s()},children:"select"===p.step?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(z,{availableList:i,onClose:s,onSelectLogDrainType:e=>h(e),selectedLogDrainType:p,teamSlug:c})}):(0,t.jsx)(J,{marketplaceConfigurations:m,onBack:()=>h({step:"select"}),onCreated:e=>{e?h(e):(h({step:"select"}),u(),s())},selectedLogDrainType:p,teamSlug:c})})}function z(e){let{availableList:i,selectedLogDrainType:s,onClose:o,onSelectLogDrainType:l,teamSlug:c}=e,{logDrainsResources:d,availableProducts:u,logDrainExternalIntegrations:p}=i,{permissions:g}=(0,S.useLogDrainsOperations)({teamSlug:c});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Modal.Body,{children:(0,t.jsxs)(r.Stack,{gap:6,children:[(0,t.jsx)(r.Stack,{gap:2,children:(0,t.jsx)(a.Modal.Title,{center:!0,children:U})}),(0,t.jsxs)(r.Stack,{gap:2,children:[d?.length||u?.length?(0,t.jsxs)(t.Fragment,{children:[d?.map(e=>(0,t.jsx)($,{isDisabled:!g.resource.update,isSelected:K(s)&&"resource"===s.type&&s.value.id===e.id,onSelect:()=>{l({value:e,type:"resource"})},resource:e,tooltip:{isEnabled:!g.resource.update,text:"You do not have permission to create a log drain for this product."}},e.id)),u?.map(e=>{let{product:r,integration:i}=e;return(0,t.jsx)(h.CreateResourceCard,{description:r.shortDescription,icon:{url:r.iconUrl},isDisabled:!g.resource.create,isSelected:K(s)&&"product"===s.type&&s.value.product.id===r.id,name:r.name,onClick:()=>{l({value:{product:r,integration:i},type:"product"})},showCreateButton:!1,tooltip:{isEnabled:!g.resource.create,text:"You do not have permission to create a log drain for this product."}},r.id)}),(0,t.jsx)(Y,{text:"or"})]}):null,(0,t.jsx)(h.CreateResourceCard,{Icon:(0,t.jsx)(r.Stack,{padding:2,children:(0,t.jsx)(n.Logs,{size:20})}),description:"Forward logs to a custom endpoint.",isDisabled:!g.create,isSelected:K(s)&&"self-served"===s.type,name:"Custom Log Drain",onClick:()=>{l({type:"self-served"})},showCreateButton:!1,tooltip:{isEnabled:!g.create,text:"You do not have permission to create log-drains."}}),(0,t.jsx)(Y,{text:"or Existing Account"}),p?.map(e=>(0,t.jsx)(h.CreateResourceCard,{description:e.shortDescription,icon:{url:e.icon},isDisabled:!g.integration.create,isSelected:K(s)&&"integration"===s.type&&s.value.id===e.id,name:e.name,onClick:()=>{l({type:"integration",value:e})},showCreateButton:!1,tooltip:{isEnabled:!g.create,text:"You do not have permission to install this integration."}},e.id))]})]})}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:()=>{K(s)?l({step:"select"}):o()},type:"secondary",children:"Cancel"}),(0,t.jsx)(a.Modal.Action,{buttonType:"button",disabled:!K(s),onClick:()=>{K(s)&&l({step:"create"})},type:"secondary",children:"Continue"})]})]})}function J(e){let{selectedLogDrainType:r,onCreated:i,onBack:a,teamSlug:s,marketplaceConfigurations:n}=e,{projectSlug:l,hasProject:c}=(0,v.useProjectSlug)(),{data:h}=(0,y.useProject)(l),[g,x]=(0,o.useState)(null),S=(c?h:g)??null;switch(r.type){case"self-served":return(0,t.jsx)(B,{onBack:a,onCreated:i});case"integration":default:return null;case"product":{let{integration:e,product:o}=r.value;return(0,t.jsx)(d.CreateResourceModal,{cancelLabel:"Back",initialConfigurationStatus:(0,m.getConfigurationStatusByIntegrationId)(n,e.id),integration:e,neonIntegrationStatus:{isNeonDisabled:!1,isLoading:!1},onBack:a,onIntegrationResourceCreate:e=>{i({type:"resource",value:e})},product:(0,u.getProductWithSupportedProtocols)(o),teamSlug:s})}case"resource":{let e=r.value;return(0,t.jsx)(j.CreateResourceConnectionModalStep,{ProjectSelector:l?void 0:(0,t.jsx)(f.ResourceProjectSelector,{account:s,allowSelectConnectedProjects:(0,u.isProtocolSupported)(e.product,"logDrain"),connectedProjectIds:e.projectsMetadata.map(e=>e.projectId),onProjectSelected:e=>{x(e)},resourceTitle:(0,p.getResourceTitleByResource)(e),selectedProject:S}),backOrCancelLabel:"Back",logDrainEnabled:!0,onBack:a,onClickOutside:a,onConnectionCreated:i,project:c?h:S,resourceId:e.id,store:e,title:c?`${U} to ${S?.name}`:U})}}}function Y(e){let{text:a}=e;return(0,t.jsx)(r.Stack,{align:"center",direction:"row",justify:"center",padding:2,children:(0,t.jsx)(i.Text,{color:"gray-800",size:12,children:a})})}function $(e){let{resource:r,isSelected:a,onSelect:n,isDisabled:o,tooltip:l}=e,d=(0,c.useAgo)(r.createdAt,{formatYearsWeeksMonths:!0});return(0,t.jsx)(h.CreateResourceCard,{Badge:(0,t.jsx)(s.Badge,{size:"sm",children:"Installed"}),RightAction:(0,t.jsxs)(i.Text,{color:"gray-900",children:[(0,t.jsx)("span",{className:"geist-hide-on-mobile",children:"Created "}),d]}),description:r.product.name,icon:{url:r.product.iconUrl},isDisabled:o,isSelected:a,name:r.name,onClick:n,showCreateButton:!1,tooltip:l})}function K(e){return"type"in e}},9367986:e=>{"use strict";e.s({AddLogDrainButton:()=>c});var t=e.i(6645307),r=e.i(6530772),i=e.i(5674541),a=e.i(555528);e.i(5941325);var s=e.i(2405013),n=e.i(5006659),o=e.i(8912223),l=e.i(2955320);function c(e){let{teamSlug:c,projectSlug:d,variant:u,onClick:p,className:h}=e,[g,m]=(0,r.useState)(!1),x=(0,l.useLogDrainsData)(),{permissions:j}=(0,n.useLogDrainsOperations)({teamSlug:c});return(0,t.jsxs)(s.ResourceModalsProvider,{protocolType:"logDrain",children:[(0,t.jsx)(a.Tooltip,{disableTriggers:j.create,text:"You do not have permission to create a log drain.",children:(0,t.jsx)(i.Button,{className:h,disabled:!j.create,onClick:()=>{m(!0),p?.()},variant:u,children:"Add Log Drain"})}),(0,t.jsx)(o.CreateLogDrainModal,{active:g,availableList:x,onClose:()=>m(!1),projectSlug:d,teamSlug:c})]})}}}]);

//# sourceMappingURL=d720ce77390c625a.js.map
//# debugId=7d2e6671-1394-58a7-9fe4-3fc42f9458ac
