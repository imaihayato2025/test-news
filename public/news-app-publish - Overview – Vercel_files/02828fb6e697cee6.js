
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f6ca66d6-1bdf-577d-aaa3-09571703e9b9")}catch(e){}}();
(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{8804902:e=>{"use strict";e.s({DeploymentSource:()=>x});var t=e.i(6645307),l=e.i(5610210),n=e.i(1235226),i=e.i(2362802),a=e.i(5154216),s=e.i(3138389),o=e.i(6530772),r=e.i(5299128),d=e.i(555528),c=e.i(5669542),u=e.i(5343945),m=e.i(6859825),p=e.i(587741),h=e.i(7696797);function x(e){let x,y,{deployment:g,singleLine:j=!1,lineClassName:b,branchClassName:k,commitClassName:v,secondLineLinkClassName:f}=e,{meta:T}=g,S=(0,p.useDeploymentLink)(g),R=(0,o.useMemo)(()=>(0,m.getGitMeta)(T),[T]),C="source"in g?g.source:void 0,A=`${S}/source`;if(x=j?null:R?(0,t.jsx)(h.Attribute.Item,{Icon:s.GitBranch,className:b,mono:!0,children:(0,t.jsx)(i.Link,{className:(0,l.clsx)("font-mono","hover:underline",k),href:R.branchUrl,title:"Git Branch",children:R.branchName})}):(0,t.jsx)(h.Attribute.Item,{Icon:r.Code,className:b,children:(0,t.jsx)(i.Link,{className:(0,l.clsx)("hover:underline",k),href:A,children:"View code"})}),R){let e="1"===R.gitDirty,s=R.sha.substring(0,7),[o]=R.commitMessage.split("\n");y=(0,t.jsx)(h.Attribute.Item,{Icon:"cli"===C?c.Terminal:a.GitCommit,className:b,mono:!0,children:(0,t.jsxs)(i.Link,{className:(0,n.twMerge)("flex gap-1.5 truncate hover:underline",f),href:e?A:R.commitUrl,title:"Git Commit",children:[(0,t.jsx)("span",{className:(0,l.clsx)("font-mono",v),children:e?(0,t.jsx)(d.Tooltip,{className:"flex-none",desktopOnly:!0,text:(0,t.jsxs)("span",{children:["Based on commit ",(0,t.jsx)("code",{children:s})," with additional modifications"]}),children:s}):s}),(0,t.jsx)("span",{className:"text-label-14 truncate",title:o,children:o.length>100?`${o.substring(0,100)}…`:o})]})})}else y=T.v0?(0,t.jsxs)(h.Attribute.Item,{className:b,children:[(0,t.jsx)(u.V0Mark,{size:16,style:{"--geist-foreground":"var(--ds-gray-900)"}}),(0,t.jsx)(i.Link,{className:"hover:underline",href:T.v0BlockId&&T.v0ChatId?`https://v0.dev/chat/${T.v0ChatId}?b=${T.v0BlockId}`:"https://v0.dev",title:"v0.dev",children:"Deployed with v0"})]}):(0,t.jsx)(h.Attribute.Item,{Icon:c.Terminal,className:b,mono:!0,children:(0,t.jsx)(i.Link,{className:"hover:underline",href:"/docs/cli/deploy",title:"Vercel CLI Docs",children:"vercel deploy"})});return(0,t.jsxs)(t.Fragment,{children:[x,y]})}},6054209:e=>{"use strict";e.s({useDeploymentEnvironmentLabel:()=>n});var t=e.i(5535439),l=e.i(2013047);let n=e=>{let{deployment:n,customEnvironments:i}=e,{project:a,teamSlug:s}=(0,t.useParams)()??{};return function(e){let{deployment:t,teamSlug:n,projectSlug:i,customEnvironments:a}=e,s=`/${n}/${i}/settings/environments/`;if(!t)return{deploymentTargetLabel:"",deploymentTargetConfigurationUrl:s};if(t.customEnvironment?.slug!==void 0&&t.customEnvironment?.slug!==null)return{deploymentTargetLabel:t.customEnvironment.slug,deploymentTargetConfigurationUrl:`${s}${t.customEnvironment.id}`};if(t.customEnvironment){let e=a?.find(e=>e.id===t.customEnvironment?.id);return e?{deploymentTargetLabel:e.slug,deploymentTargetConfigurationUrl:`${s}${e.id}`}:{deploymentTargetLabel:"(Deleted)",deploymentTargetConfigurationUrl:null}}return null===t.target||void 0===t.target?{deploymentTargetLabel:"Preview",deploymentTargetConfigurationUrl:`${s}preview`}:{deploymentTargetLabel:(0,l.default)(t.target),deploymentTargetConfigurationUrl:`${s}${t.target}`}}({deployment:n,teamSlug:s,projectSlug:a,customEnvironments:i})}},3661681:e=>{e.v({wrapper:"loading-checkmark-module__EHiHhG__wrapper"})},1213995:[e=>{"use strict";e.s({useInstantRollbackModal:()=>ec,useRollbackTooltip:()=>ed},1213995);var t=e.i(6645307),l=e.i(6530772),n=e.i(3514588),i=e.i(3585235),a=e.i(5785123),s=e.i(6700141),o=e.i(3326412),r=e.i(3184563),d=e.i(3277953),c=e.i(595691),u=e.i(889716),m=e.i(8084653),p=e.i(5674541),h=e.i(8934201),x=e.i(584439),y=e.i(8158100),g=e.i(5165976),j=e.i(1164214),b=e.i(6649026),k=e.i(1183506),v=e.i(9336536),f=e.i(5454140),T=e.i(7320579),S=e.i(2270026),R=e.i(3920197),C=e.i(2700425),A=e.i(3821772),D=e.i(4576696),I=e.i(3661681);function w(e){let{className:l,label:n,labelPadding:i=7,labelSize:a=14,size:s=22,status:o}=e,r=(0,D.px)(s);return(0,t.jsxs)("div",{className:`${I.default.wrapper} ${l||""}`,style:{height:r},children:["loading"===o&&(0,t.jsx)(A.Spinner,{size:s}),"error"===o&&(0,t.jsx)(R.CrossCircle,{color:"red-700",size:s}),"success"===o&&(0,t.jsx)(C.CheckCircle,{color:"green-700",size:s}),n?(0,t.jsx)(m.Text,{as:"span",size:a,style:{lineHeight:r,paddingLeft:(0,D.px)(i)},children:n}):null]})}var P=e.i(4088387);e.i(6791234);var M=e.i(4722050),L=e.i(7095283),N=e.i(8673823);e.i(442955);var E=e.i(4418725);let _="[teamSlug]";var O=e.i(2240289),B=e.i(6858714),$=e.i(44994),F=e.i(2782408),U=e.i(5300522),z=e.i(4896100),H=e.i(1000863);e.s({default:()=>V},5096484);var K=e.i(3921802),W=e.i(555528),G=e.i(4760712);function q(e){let{hidden:l,showIcon:n=!0,linkProps:i,defaultRoute:a}=e;return(0,t.jsx)(t.Fragment,{children:l.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(G.default,{defaultRoute:a,icon:n,title:e,truncate:!0,url:e,...i})},e))})}function J(e){let{hidden:l,linkProps:n}=e;return(0,t.jsx)(W.Tooltip,{text:(0,t.jsx)(q,{hidden:l,linkProps:n}),children:(0,t.jsx)(K.Badge,{size:"sm",variant:"gray-subtle",children:`+${l.length}`})})}let V=function(e){let{className:l,defaultRoute:n,domains:i,firstOnly:a,showIcon:s=!0,style:o,linkProps:r}=e;if(!i)return(0,t.jsx)(m.Text,{as:"span",className:l,color:"gray-900",style:o,weight:400,children:"-"});let{visible:d,hidden:c}=i.reduce((e,t)=>(0===e.visible.length||!a&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)(m.Text,{as:"span",className:l,weight:500,children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:2,style:{display:"flex",maxWidth:"100%",alignItems:"stretch",...o},children:[d.map((e,l)=>{let i=l===d.length-1;return(0,t.jsx)(G.default,{defaultRoute:n,icon:s,style:{marginRight:i?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...r},e)}),c.length?(0,t.jsx)(J,{hidden:c,linkProps:r}):null]})})};var Y=e.i(5378884),X=e.i(1654051);function Q(){return(0,t.jsx)(h.Modal.Header,{children:(0,t.jsx)(h.Modal.Title,{center:!0,children:"Instant Rollback"})})}function Z(e){let{setStage:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Q,{}),(0,t.jsx)(m.Text,{as:"p",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{fullWidth:!0,onClick:()=>{l("initial")},type:"secondary",children:"Back"})})]})}function ee(){return(0,t.jsx)("div",{children:(0,t.jsx)(y.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:4},children:[(0,t.jsx)(d.Warning,{style:{flexShrink:0}}),(0,t.jsxs)(u.Stack,{align:"start",children:[(0,t.jsx)(m.Text,{as:"p",color:"inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)(m.Text,{as:"p",color:"inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function et(e){let{hasFloatingAliases:i,onCancel:a,previousDeployment:r,productionAliases:d,productionDeployment:x,project:b,rollbackCandidates:k,setStage:v,selectedDeployment:f,setSelectedDeployment:T,deploymentSwr:S,wouldBeUndoRollback:R}=e,C=function(e){let t=(0,E.useTeamSlug)();return(0,l.useMemo)(()=>e.includes(_)?e.replace(`/${_}`,t?`/${t}`:""):e,[t,e])}("/[teamSlug]"),[A,D]=(0,l.useState)(!1),{team:I}=(0,n.useTeam)(),w=!I||I.billing?.plan==="hobby",{value:P}=(0,s.useInstantRollbackHobbyRestrictionFlag)(),{value:L}=(0,o.useInstantRollbackHobbyRestrictionTeamFlag)(),{value:N}=(0,s.useEnableNewInstantRollbackFlow)();return(N&&(R=!1),k.length&&r&&f)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Q,{}),(0,t.jsxs)(u.Stack,{gap:6,children:[(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsxs)(m.Text,{as:"p",children:[R?"Undo previous rollback for":"Rolling back"," ",(0,t.jsx)(V,{domains:d,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),i?(0,t.jsx)(ee,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(H.DeploymentCardSmall,{deployment:x,isProductionDeployment:!0,selectedDeployment:f,setSelectedDeployment:T})})]}),(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsx)(m.Text,{as:"p",children:"To the following deployment:"}),A?(0,t.jsx)("div",{children:(0,t.jsx)(B.ChooseDeploymentList,{deployments:k,previousDeployment:r,productionDeployment:x,rolledBackDeploymentId:b?.lastAliasRequest?.type==="rollback"?b.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:f,setSelectedDeployment:T,swr:S})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.DeploymentCardSmall,{deployment:f,isForm:A,isPreviousDeployment:f.uid===r.uid,selectedDeployment:f,setSelectedDeployment:T}),(P||L)&&w?(0,t.jsx)(u.Stack,{style:{marginTop:"24px"},children:(0,t.jsx)(y.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:8},children:[(0,t.jsx)(g.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)(u.Stack,{align:"start",direction:"column",children:[(0,t.jsx)(m.Text,{as:"p",color:"inherit",weight:500,children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(M.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===C?"/dashboard?createTeam=instant-rollback":`${C}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)(m.Text,{as:"span",color:"inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(c.ExternalSmall,{className:"ml-1"}),(0,t.jsx)(m.Text,{as:"span",color:"inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(p.Button,{onClick:()=>{D(!0)},type:"secondary",width:"100%",children:"Choose another deployment"})]})]}),N?(0,t.jsx)(m.Text,{color:"gray-900",children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}):null]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:a,type:"secondary",children:"Cancel"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","continue-button"),onClick:()=>{v("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Q,{}),(0,t.jsx)(m.Text,{as:"p",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{onClick:a,type:"secondary",children:"Cancel"})})]})}function el(e){let n,{selectedDeployment:i,setStage:a,requestRollback:o,project:r,wouldBeUndoRollback:d,rollbackReason:p,setRollbackReason:x,setSelectedDeployment:g,productionAliases:b,hasFloatingAliases:k,productionDeployment:v,rollbackCandidates:T}=e,{value:S}=(0,s.useEnableNewInstantRollbackFlow)(),[R,C]=(0,l.useState)("editing"),{user:A}=(0,f.useUser)();if(!i)return(0,t.jsx)(Z,{setStage:a});n=!!S&&p.length>=B.REASON_MAX_CHARACTER_LENGTH;let D=(0,B.getMostRecentlyPromotedDeployment)(T);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Q,{}),S?(0,t.jsxs)(u.Stack,{gap:6,children:["editing"===R&&(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsxs)(u.Stack,{as:"label",gap:1,htmlFor:"rollback-reason",children:[(0,t.jsx)(m.Text,{as:"span",size:16,children:"What is the reason for the rollback?"}),(0,t.jsx)(m.Text,{as:"span",color:"gray-900",size:16,children:"Let your team know why the project is rolled back, or provide links to incident response channels."}),(0,t.jsx)(m.Text,{as:"span",color:"gray-900",size:16,children:"You can update this later from the project overview."})]}),(0,t.jsx)(B.RollbackDescriptionTextarea,{value:p,onChange:x,id:"rollback-reason"})]}),"confirming"===R&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsx)(m.Text,{size:16,children:"Note to be shared with your team:"}),(0,t.jsx)(B.RollbackDescriptionCard,{rollbackDescription:{description:p.trim(),userId:A?.uid??"",username:A?.username??"",deploymentId:i.uid,projectId:r?.id??"",createdAt:new Date().getTime()},project:r})]}),(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsx)(m.Text,{size:16,children:"Rolling back to:"}),(0,t.jsx)(H.DeploymentCardSmall,{deployment:i,isPreviousDeployment:i.uid===D?.uid,selectedDeployment:i,setSelectedDeployment:()=>null})]}),(r?.autoAssignCustomDomains??!0)||r?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(y.Note,{fill:!0,type:"secondary",children:(0,t.jsx)(u.Stack,{align:"center",direction:"row",gap:4,children:(0,t.jsx)(u.Stack,{align:"start",children:(0,t.jsx)(m.Text,{as:"p",color:"inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}):(0,t.jsx)(u.Stack,{gap:6,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.Text,{as:"p",children:[d?"Undo previous rollback for":"Roll back"," ",(0,t.jsx)(V,{domains:b,style:{display:"inline-flex",fontWeight:"600"}})]}),k?(0,t.jsx)(ee,{}):null,(0,t.jsx)(H.DeploymentCardSmall,{deployment:v,isProductionDeployment:!0,selectedDeployment:i,setSelectedDeployment:g}),(0,t.jsx)(m.Text,{as:"p",children:"To the following deployment:"}),(0,t.jsx)(H.DeploymentCardSmall,{deployment:i,isPreviousDeployment:i.uid===D?.uid,selectedDeployment:i,setSelectedDeployment:g}),(0,t.jsxs)(P.UL,{className:"mb-0",children:[(0,t.jsx)(P.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(P.LI,{children:[(0,t.jsxs)(M.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${i.url}`,target:"_blank",children:["View the selected deployment"," ",(0,t.jsx)(c.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]})]})]})})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:()=>{"editing"===R?a("initial"):C("editing")},type:"secondary",children:"Back"}),S?(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","rollback-button"),disabled:n,onClick:()=>{"editing"===R?C("confirming"):(o(i.uid),a("processing"))},children:"editing"===R?"Continue":"Confirm Rollback"}):(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","rollback-button"),onClick:()=>{o(i.uid),a("processing")},children:d?"Undo Rollback":"Confirm Rollback"})]})]})}function en(e){let{jobStatus:n,rollbackDeploymentId:i,rollbackCandidates:a,selectedDeployment:o,setStage:r,onCancel:d,statusSwr:c,requestRollback:x,rollbackReason:y}=e,{user:g}=(0,f.useUser)(),{value:b}=(0,s.useEnableNewInstantRollbackFlow)();if((0,l.useEffect)(()=>{i===o?.uid&&("failed"===n?r("error"):"succeeded"===n&&r("done"))},[i,n,o,r]),!o)return(0,t.jsx)(Z,{setStage:r});let k=(0,B.getMostRecentlyPromotedDeployment)(a);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Q,{}),(0,t.jsxs)(u.Stack,{gap:6,children:[(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsx)(m.Text,{children:"Assigning production domains:"}),(0,t.jsx)(H.DeploymentCardSmall,{deployment:o,isPreviousDeployment:o.uid===k?.uid,selectedDeployment:o,setSelectedDeployment:()=>null})]}),b&&""!==y?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)(m.Text,{color:"gray-900",children:["“",(0,t.jsx)(U.LinkParser,{text:y.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)(m.Text,{children:"Rolled back by"}),g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.PrincipalAvatar,{size:20,principalId:g.uid,principal:{type:"user",uid:g.uid,username:g.username}}),(0,t.jsxs)(m.Text,{weight:500,children:["@",g.username]})]}):null]})]}):null,(0,t.jsxs)(P.UL,{className:"mx-4 my-0 list-none",children:[c.aliases.map(e=>{let l="loading";return"completed"===e.status?l="success":"failed"===e.status&&(l="error"),(0,t.jsx)(P.LI,{children:(0,t.jsx)(w,{label:e.alias,labelPadding:"12px",size:24,status:l})},e.alias)}),!c.isReachingEnd&&c.initialDataLoaded?(0,t.jsx)(P.LI,{children:(0,t.jsx)(p.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==n&&"succeeded"!==n,onClick:()=>{"failed"===n?x(o.uid):"succeeded"===n&&(r("initial"),d())},children:"failed"===n?"Retry":"Done"})})]})}function ei(e){let{active:i,initialSelectedDeployment:a,onCancel:o,productionBranch:r,productionDeployment:d,projectId:c,rollbackCandidates:u,swr:m,wouldBeUndoRollback:p,rollbackDescription:y}=e,{mutate:g}=(0,T.useSWRConfig)(),[f,R]=(0,l.useState)("initial"),[C,A]=(0,l.useState)(""),{isReady:D,team:I}=(0,n.useTeam)(),w=(0,x.useToasts)(),P=(0,l.useMemo)(()=>{let e=u.filter(e=>e.uid!==d.id);return(0,B.getMostRecentlyPromotedDeployment)(e)},[u,d]),[M,E]=(0,l.useState)(null);null===M&&E(a||P||null);let _=(0,l.useCallback)(R,[R]),H=(0,l.useCallback)(E,[E]),{value:K}=(0,s.useEnableNewInstantRollbackFlow)(),[,{aliases:W}]=(0,N.useAliasesInfinite)({rollbackDeploymentId:d.id}),{data:G}=(0,O.useProject)(c,U.INSTANT_ROLLBACK_PROJECT_API_PARAMS),{lastAliasRequest:q,hasFloatingAliases:J}=G||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:V,jobStatus:Y}=q||{toDeploymentId:null,jobStatus:null},[,Q]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:a,team:s}=(0,n.useTeam)(),o=(0,L.default)((t,l)=>{if(!a)return null;let n={teamId:s?.id,limit:i};return t?l?.next?`${(0,v.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)({...n,until:l.next})}`:null:`${(0,v.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)(n)}`},e=>(0,k.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),r=(0,l.useMemo)(()=>o.data?[].concat(...o.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[o.data,i]),d=!!o.data,c=d&&0===r.length,u=d&&o.data&&o.size>o.data.length,m=d&&o.data&&o.data[o.data.length-1]?.aliases.length<i;return[o,{aliases:r,initialDataLoaded:d,isEmpty:c,loadMore:()=>o.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:o.mutate}]}(c,2e3),Z=(0,l.useMemo)(()=>d,[i]),ee=()=>{R("initial"),E(a||P||null),o()},ei=(0,l.useCallback)(async e=>{if(!D)return;let t=`${(0,v.API_DEPLOYMENT_ROLLBACK)(c,e)}${(0,b.encode)({teamId:I?.id,description:K?C.trim():void 0})}`;try{await (0,k.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),I&&(void 0!==G&&(g((0,$.getProjectKey)(G.name,{...U.INSTANT_ROLLBACK_PROJECT_API_PARAMS,teamId:I.slug})),g((0,$.getProjectKey)(G.name,{...z.DEPLOYMENTS_PROJECT_API_PARAMS,teamId:I.slug}))),await g((0,F.getProjectProductionDeploymentKey)({projectIdOrName:c,teamId:I.slug})),g((0,X.getRollingReleaseEndpoint)(I.slug,c)))}catch(e){w.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,S.captureError)(e)}},[D,c,w,C,g,I,K,G]),ea=function(){let{value:e}=(0,s.useEnableNewInstantRollbackFlow)();return e?"New deployments will not be automatically assigned production domains until this rollback is removed.":"Pushing a new deployment will remove this rollback."}(),es={rollbackDeploymentId:V,hasFloatingAliases:!!J,jobStatus:Y,onCancel:ee,previousDeployment:P,productionBranch:r,productionDeployment:Z,productionAliases:W.map(e=>{let{alias:t}=e;return t}),project:G,rollbackCandidates:u,setStage:_,selectedDeployment:M,setSelectedDeployment:H,deploymentSwr:m,statusSwr:Q,requestRollback:ei,rollbackWarningText:ea,wouldBeUndoRollback:p,rollbackReason:C,setRollbackReason:A,rollbackDescription:y};return(0,t.jsxs)(h.Modal.Modal,{active:i,"data-testid":(0,j.tid)("deployment","rollback-modal"),onClickOutside:ee,sticky:!0,width:"500px",children:["initial"===f&&(0,t.jsx)(et,{...es}),"selected"===f&&(0,t.jsx)(el,{...es}),["processing","error","done"].includes(f)&&(0,t.jsx)(en,{...es})]})}var ea=e.i(1766200),es=e.i(594689),eo=e.i(8328767);e.i(9389778);var er=e.i(1310591);function ed(e){let{team:t}=(0,n.useTeam)(),i=!t||t.billing?.plan==="hobby",{value:a}=(0,s.useInstantRollbackHobbyRestrictionFlag)(),{value:d}=(0,o.useInstantRollbackHobbyRestrictionTeamFlag)(),c=a||d,u=e?.name,{deployment:m,isLoading:p}=(0,r.useProjectProductionDeployment)(u);return(0,l.useMemo)(()=>{let t=(0,es.asListDeployment)(e),l=i&&!t?.isRollbackCandidate;return t?p?"Loading...":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":c?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,i,p,m?.id,c])}function ec(e){let{onClose:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[s,o]=(0,l.useState)(!1),[d,c]=(0,l.useState)(),{teamSlug:u,projectSlug:m}=(0,er.useProjectAndTeamSlug)(),{data:p}=(0,O.useProject)(d?.name,U.INSTANT_ROLLBACK_PROJECT_API_PARAMS),h=m??d?.name,x=e??p,y=(0,B.useIsUndoRollback)({projectId:x?.id||"",deployment:d}),{data:g}=(0,eo.useRollingRelease)({teamIdOrSlug:u,projectSlug:h}),j=g?.rollingRelease?g?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:b,rollbackDescription:k,mutate:v}=(0,r.useProjectProductionDeployment)(x?.name),{can:f}=(0,i.default)({projectIdOrName:x?.name}),T=f(a.Action.Create,a.Resource.DeploymentRollback),S=x?.link?.productionBranch?x.link.productionBranch:void 0,[R,C]=(0,ea.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:A,initialDataLoaded:D}=C,I=A.filter(e=>!!e.isRollbackCandidate&&e.uid!==j),w=!!(D&&x&&!I.length),P=(0,l.useCallback)(e=>{c((0,es.asListDeployment)(e)),o(!0)},[]),M=(0,l.useCallback)(()=>{o(!1),v().finally(()=>null),n?.()},[v,n]);return{rollbackModal:(0,l.useMemo)(()=>T&&s&&b&&x?(0,t.jsx)(ei,{active:s,initialSelectedDeployment:d,onCancel:M,productionBranch:S,productionDeployment:b,projectId:x.id,rollbackCandidates:I,rollbackDescription:k,swr:C,wouldBeUndoRollback:y}):null,[T,s,d,S,b,I,x,C,M,y,k]),closeRollbackModal:M,openRollbackModal:P,canRollbackDeployment:T,noRollbackCandidates:w}}},[5096484]]}]);

//# sourceMappingURL=86a1bec35c9af2eb.js.map
//# debugId=f6ca66d6-1bdf-577d-aaa3-09571703e9b9
